const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/stubs-8eV23p6k.js","assets/fr-BdaUL5-d.js"])))=>i.map(i=>d[i]);
var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&(console.log=()=>{},console.debug=()=>{},console.info=()=>{});const i=991,s=512,l={START_X:100,START_Y:382,WIDTH:40,HEIGHT:40,GROUND_Y:382,JUMP_FORCE:-8,JUMP_FORCE_BOOSTED:-10,FLY_SPEED:-3,GRAVITY:.3,FRICTION:.97},a=.5,o=140,n=200,r={SIZE_GROWTH_RATE:.01,MAX_HAIR_LENGTH:50},h={POINTS_PER_METER:10,POINTS_PER_OBSTACLE:100},c={WIDTH:60,HEIGHT:100,POSITION_X_OFFSET:100},d={GOLD_LIGHT:"#FFD700",SKY_BLUE:"#87CEEB"};class u{draw(t,e,i,s,l,a,o=!1,n=0){t.save();let r=0;o&&(r=Date.now()/100%(2*Math.PI)),t.translate(e+20,i+25),t.rotate(r),t.scale(s,s),this.drawAura(t,0,0,s);const h=t.createRadialGradient(0,0,5,0,0,20);h.addColorStop(0,"#FFFFFF"),h.addColorStop(1,"#F0F8FF"),t.fillStyle=h,t.beginPath(),t.arc(0,0,18,0,2*Math.PI),t.fill(),t.strokeStyle="#DDD",t.lineWidth=2,t.stroke(),t.fillStyle="#FFFFFF",t.beginPath(),t.arc(15,-10,12,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#000",t.beginPath(),t.arc(12,-13,2,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(18,-13,2,0,2*Math.PI),t.fill(),t.fillStyle=d.GOLD_LIGHT,t.beginPath(),t.arc(13,-14,.5,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(19,-14,.5,0,2*Math.PI),t.fill();const c=l+n;c>0&&this.drawHair(t,0,0,c,n>0),"flying"!==a||o||this.drawWings(t,0,0),o||(t.strokeStyle="#000",t.lineWidth=3,t.beginPath(),t.moveTo(-10,10),t.lineTo(-10,20),t.moveTo(10,10),t.lineTo(10,20),t.stroke()),t.restore()}drawAura(t,e,i,s){s>1.5&&(t.fillStyle="rgba(255,0,0,0.2)",t.beginPath(),t.arc(e,i,35,0,2*Math.PI),t.fill())}drawHair(t,e,i,s,l=!1){const a=l?8:3,o=l?"#FFD700":"#8B4513",n=.6*s;t.save(),t.strokeStyle=o,t.lineWidth=a,t.lineCap="round",t.beginPath(),t.moveTo(e+15,i-18),t.bezierCurveTo(e+25,i-18-.3*n,e+28,i-18-.6*n,e+22,i-18-n),t.stroke();const r=l?"#FFA500":"#654321";t.fillStyle=r,t.beginPath(),t.arc(e+22,i-18-n,.6*a,0,2*Math.PI),t.fill(),t.restore()}drawWings(t,e,i){const s=.003*Date.now();t.save(),t.translate(e-10,i-8),t.fillStyle="#C0C0C0",t.fillRect(-8,-4,16,8),t.fillStyle="#FF4444",t.beginPath(),t.moveTo(8,-4),t.lineTo(14,0),t.lineTo(8,4),t.fill(),t.fillStyle="#FF6666",t.beginPath(),t.moveTo(-4,-4),t.lineTo(-8,-8),t.lineTo(-4,-8),t.fill(),t.beginPath(),t.moveTo(-4,4),t.lineTo(-8,8),t.lineTo(-4,8),t.fill();const l=6+3*Math.sin(2*s);t.fillStyle="#FFA500",t.beginPath(),t.moveTo(-8,-3),t.lineTo(-8-l,0),t.lineTo(-8,3),t.fill(),t.fillStyle="#FFFF00",t.beginPath(),t.moveTo(-8,-2),t.lineTo(-8-.7*l,0),t.lineTo(-8,2),t.fill(),t.restore(),t.save(),t.translate(e-10,i+8),t.fillStyle="#C0C0C0",t.fillRect(-8,-4,16,8),t.fillStyle="#FF4444",t.beginPath(),t.moveTo(8,-4),t.lineTo(14,0),t.lineTo(8,4),t.fill(),t.fillStyle="#FF6666",t.beginPath(),t.moveTo(-4,-4),t.lineTo(-8,-8),t.lineTo(-4,-8),t.fill(),t.beginPath(),t.moveTo(-4,4),t.lineTo(-8,8),t.lineTo(-4,8),t.fill();const a=6+3*Math.sin(2*s+1);t.fillStyle="#FFA500",t.beginPath(),t.moveTo(-8,-3),t.lineTo(-8-a,0),t.lineTo(-8,3),t.fill(),t.fillStyle="#FFFF00",t.beginPath(),t.moveTo(-8,-2),t.lineTo(-8-.7*a,0),t.lineTo(-8,2),t.fill(),t.restore()}}class f{constructor(t){this.onModeSelected=t.onModeSelected,this.onShow=t.onShow,this.audioManager=t.audioManager,this.container=document.getElementById("main-menu"),this.sheepAnimator=new u,this.setupSheepAnimations(),this.setupEventListeners(),this.startBubbleAmbience()}startBubbleAmbience(){const t=()=>{this.audioManager&&this.audioManager.initialized&&"1"===this.container.style.opacity&&this.audioManager.playBubblePopSound();const e=2e3+6e3*Math.random();setTimeout(t,e)};setTimeout(t,1e3+2e3*Math.random())}setupSheepAnimations(){const t=document.getElementById("sheep-adventure");if(!t)return;const e=t.getContext("2d"),i=document.getElementById("sheep-endless");if(!i)return;const s=i.getContext("2d");let l=0;const a=()=>{l++,e.clearRect(0,0,80,80),e.save();const t=e.createLinearGradient(0,0,0,80);t.addColorStop(0,"#87CEEB"),t.addColorStop(1,"#E0F6FF"),e.fillStyle=t,e.fillRect(0,0,80,80);const i=2*Math.sin(.05*l);this.sheepAnimator.draw(e,20,35+i,.8,0,"normal"),e.restore(),s.clearRect(0,0,80,80),s.save();const o=s.createLinearGradient(0,0,0,80);o.addColorStop(0,"#FFE5B4"),o.addColorStop(1,"#FFD700"),s.fillStyle=o,s.fillRect(0,0,80,80);const n=4*Math.sin(.08*l);this.sheepAnimator.draw(s,15,35+n,1,0,"flying"),s.restore(),requestAnimationFrame(a)};a()}setupEventListeners(){window.selectMode=t=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),this.selectMode(t)};const t=document.getElementById("btn-adventure"),e=document.getElementById("btn-endless");t&&t.addEventListener("mouseenter",()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playChiouaSound()}),e&&e.addEventListener("mouseenter",()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playChiouaSound()})}selectMode(t){console.log(`Mode s√©lectionn√©: ${t}`),this.container.style.transition="none",this.hide(),this.onModeSelected&&this.onModeSelected(t)}show(){this.container.style.transition="opacity 0.3s",this.container.style.display="flex",this.container.offsetHeight,this.container.style.opacity="1",this.onShow&&this.onShow()}hide(){this.container.style.opacity="0",this.container.style.display="none"}}class g{constructor(t){this.game=t,this.x=l.START_X,this.y=l.START_Y,this.width=l.WIDTH,this.height=l.HEIGHT,this.groundY=l.GROUND_Y,this.velX=0,this.velY=0,this.rotation=0,this.rotationSpeed=0,this.whirlpoolScale=1,this.tangageTimer=0,this.tangageIntensity=0,this.tentacleGrab=!1,this.jellyfishX=0,this.jellyfishY=0,this.jumping=!1,this.flying=!1,this.parachuting=!1,this.parachuteTimer=0,this.flyCooldown=0,this.frozen=!1,this.frozenTimer=0,this.exclamationMark=!1,this.exclamationTimer=0,this.fuel=100,this.maxFuel=100,this.fuelConsumption=.08,this.bonusFuel=0,this.bonusFuelTimer=0,this.goldCollected=0,this.size=1,this.hairLength=0,this.isRich=!1,this.maxLives=10,this.lives=10,this.equippedWeapon=null,this.facingDirection=1,this.rocketSoundActive=!1,this.invincible=!0,this.invincibleTimer=30,this.invincibleDuration=30,this.invincibleCooldown=0,this.specialEffect=null,this.effectTimer=0,this.rolling=!1,this.hairEffect=0,this.manualControl=!1}update(){if(!this.manualControl){if("endless"===this.game.mode&&(this.fuel=this.maxFuel,this.bonusFuel=0,this.flying||(this.flying=!0),this.flying&&!this.rocketSoundActive&&this.game.audioManager&&(this.game.audioManager.startRocketSound(),this.rocketSoundActive=!0),this.velX*=.95,this.velY*=.95),this.game.level2Active&&(this.fuel=this.maxFuel,this.bonusFuel=0),this.game.boatMode){const t=256;this.y>=t?(this.velX*=.9,this.velY*=.7,this.flying||(this.fuel=Math.min(this.maxFuel,this.fuel+1.5))):(this.velX*=.98,this.velY*=.95)}if(this.effectTimer>0&&(this.effectTimer--,"rolling"===this.specialEffect&&(this.rolling=!0,this.velY=-2,this.velX=3,0===this.effectTimer&&(this.rolling=!1,this.specialEffect=null,console.log("‚ôø Effet handicap termin√©"))),"hair"===this.specialEffect&&(this.hairEffect=20*Math.sin(Date.now()/200)+30,0===this.effectTimer&&(this.hairEffect=0,this.specialEffect=null,console.log("üí∞ Effet richesse termin√©")))),this.frozen&&this.frozenTimer>0)return this.frozenTimer--,this.tentacleGrab?(this.velX=0,this.velY=0,this.rotation=.1*Math.sin(.2*this.frozenTimer),void(0===this.frozenTimer&&(this.frozen=!1,this.tentacleGrab=!1,this.rotation=0,console.log("üêô Lib√©r√© des tentacules!")))):(this.velX=0,this.velY+=2*l.GRAVITY,this.x+=this.velX,this.y+=this.velY,void(this.y>=this.groundY&&(this.y=this.groundY,this.velY=0,this.frozen=!1,this.frozenTimer=0,console.log("‚ùÑÔ∏è D√©gel√© !"))));if(this.flying?(this.bonusFuelTimer>0&&(this.bonusFuelTimer--,this.bonusFuelTimer<=0&&(this.bonusFuel=0)),this.bonusFuel>0?(this.bonusFuel-=this.fuelConsumption,this.bonusFuel<0&&(this.fuel+=this.bonusFuel,this.bonusFuel=0)):this.fuel-=this.fuelConsumption,this.fuel<=0&&(this.fuel=0,this.stopFlying())):this.y>=this.groundY-5&&(this.fuel=Math.min(this.maxFuel,this.fuel+.5)),this.velX*=l.FRICTION,!this.flying)if(this.parachuting&&this.parachuteTimer>0)this.velY+=.15*l.GRAVITY,this.velX*=.99,this.parachuteTimer--,this.parachuteTimer<=0&&(this.parachuting=!1);else{const t=this.game.boatMode?1.8:1;this.velY+=l.GRAVITY*t}if(this.flyCooldown>0&&this.flyCooldown--,this.x+=this.velX,this.y+=this.velY,0!==this.rotationSpeed&&(this.rotation+=this.rotationSpeed,this.rotationSpeed*=.98,Math.abs(this.rotationSpeed)<.001&&(this.rotationSpeed=0,this.rotation=0)),this.tangageTimer>0){this.tangageTimer--;const t=.15;this.rotation=Math.sin(this.tangageTimer*t)*this.tangageIntensity,this.tangageIntensity*=.99,0===this.tangageTimer&&(this.rotation=0,this.tangageIntensity=0)}if(Math.abs(this.velX)>.5&&(this.facingDirection=this.velX>0?1:-1),this.x<0&&(this.x=0),this.x>this.game.canvas.width-this.width&&(this.x=l.START_X,console.log("üîÑ Retour au d√©but - Le mouton continue!")),this.y>=this.groundY&&(this.y=this.groundY,this.velY=0,this.jumping=!1),this.y<0&&(this.y=0,this.velY=0),this.invincible&&this.invincibleTimer>0&&(this.invincibleTimer--,this.invincibleTimer<=0&&(this.invincible=!1,this.invincibleCooldown=60)),this.invincibleCooldown>0&&this.invincibleCooldown--,this.exclamationTimer>0&&(this.exclamationTimer--,0===this.exclamationTimer&&(this.exclamationMark=!1)),this.goldCollected>0){const t=1/this.size;this.velX*=t}}}jump(t=!1,e=0){var i;if(this.y>=this.groundY-5){this.autoJumpMode&&(this.autoJumpMode=!1,console.log("‚úã Mode saut automatique d√©sactiv√© - Contr√¥le manuel!"));let s=(null==(i=this.game.powerUpManager)?void 0:i.hasPower("force"))?l.JUMP_FORCE_BOOSTED:l.JUMP_FORCE;const a=Math.min(1+e/400,2.5);s*=a,e>100&&console.log(`‚¨ÜÔ∏è Saut charg√©: ${a.toFixed(2)}x (${e}ms)`),this.velY=s;const o=Math.min(1+e/300,3),n=1.5;this.velX+=n*o,t&&(this.velX+=2,this.velY+=-1,console.log("üöÄüöÄ Double saut!")),this.lastJumpTime=Date.now(),this.jumping=!0,this.isChargingJump=!1}}startFlying(){var t;return this.game.boatMode||this.game.level3Active?this.flyCooldown>0?(console.log("‚è≥ Attends 2 secondes avant de revoler!"),!1):(this.flying=!0,this.velY=-4,!0):(null==(t=this.game.powerUpManager)?void 0:t.hasPower("liberte"))?this.fuel>=.05*this.maxFuel&&(this.flying=!0,this.velY=l.FLY_SPEED,!this.rocketSoundActive&&this.game.audioManager&&(this.game.audioManager.startRocketSound(),this.rocketSoundActive=!0),!0):(console.log("‚õî Tu dois avoir le powerup de libert√© pour voler!"),!1)}stopFlying(){this.flying=!1,(this.game.boatMode||this.game.level3Active)&&(this.flyCooldown=120),this.rocketSoundActive&&this.game.audioManager&&(this.game.audioManager.stopRocketSound(),this.rocketSoundActive=!1),this.parachuting=!0,this.parachuteTimer=480,console.log("ü™Ç Mode parachute activ√© !")}flyTowards(t,e){if(this.flying&&this.fuel>0){const i=t-(this.x+this.width/2),s=e-(this.y+this.height/2),l=Math.sqrt(i*i+s*s);if(l>10){const t=4,e=1-.05*this.hairLength,a=Math.max(e,.3);this.velX=.7*this.velX+i/l*t*.3,this.velY=.7*this.velY+s/l*t*.15*a}}}moveTowards(t,e){const i=t-(this.x+this.width/2),s=e-(this.y+this.height/2),l=Math.sqrt(i*i+s*s);if(l>10){const t=8;this.velX=i/l*t,this.y<this.groundY-5&&(this.velY=s/l*t*.6)}}startChargingJump(){this.y>=this.groundY-5&&(this.isChargingJump=!0,this.jumpChargeStartTime=Date.now())}getJumpTrajectory(){if(!this.isChargingJump)return null;const t=Date.now()-this.jumpChargeStartTime,e=Math.min(1+t/400,2.5),i=Math.min(1+t/300,3);return{velY:l.JUMP_FORCE*e,velX:6*i,chargePercent:Math.min(t/1e3,1)}}refillFuel(t){const e=this.fuel;this.fuel=Math.min(this.maxFuel,this.fuel+t),this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.ploqueSound();const i=e+t-this.maxFuel;i>0?(this.bonusFuel+=i,this.bonusFuelTimer=180,console.log(`üíß Carburant: ${Math.floor(this.fuel)}/${this.maxFuel} + ${Math.floor(this.bonusFuel)} BONUS!`)):console.log(`üíß Carburant recharg√©: ${Math.floor(this.fuel)}/${this.maxFuel}`),this.game.renderer&&this.game.renderer.triggerRefuelEffect(this.x+this.width/2,this.y)}isPointInside(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}bounce(){this.y>=this.groundY-10&&(this.velY=-6,console.log("üêë Boing !"))}freeze(){this.frozen=!0,this.frozenTimer=60,this.flying=!1,this.parachuting=!1,console.log("‚ùÑÔ∏è Gel√© par le Phantom !")}equipWeapon(t){this.equippedWeapon=t,console.log(`‚öîÔ∏è ${t.text} √©quip√©e ! Peut tuer: ${t.kills.join(", ")}`);let e=null;for(const i of t.kills)if(e=this.game.obstacleManager.bossLine.find(t=>t.id===i),e)break;e?(e.targetIndicator=180,console.log(`üéØ Boss ${e.text} cibl√©!`)):(console.log(`‚ö†Ô∏è Aucun boss actif pour ${t.text}. Respawn d'une nouvelle arme...`),setTimeout(()=>{var t;(null==(t=this.game)?void 0:t.obstacleManager)&&this.game.obstacleManager.spawnWeapon()},1e3))}canKill(t){return this.equippedWeapon&&this.equippedWeapon.kills.includes(t)}moveLeft(){this.velX=-4}moveRight(){this.velX=4}moveUp(){this.game.boatMode&&(this.velY=-4)}moveDown(){this.game.boatMode&&(this.velY=4)}collectGold(t){this.goldCollected+=t,this.goldCollected>0&&(this.isRich=!0,!this.rocketSoundActive&&this.game.audioManager&&(this.game.audioManager.startRocketSound(),this.rocketSoundActive=!0)),this.size=1+this.goldCollected*r.SIZE_GROWTH_RATE,this.hairLength=Math.min(this.goldCollected,r.MAX_HAIR_LENGTH),this.width=l.WIDTH*this.size,this.height=l.HEIGHT*this.size,console.log(`üíà Or collect√©: ${this.goldCollected} - Cheveux: ${this.hairLength} m√®ches - Taille: ${this.size.toFixed(2)}x`)}giveGold(){const t=this.goldCollected>0;this.goldCollected=0,this.size=1,this.hairLength=0,this.width=l.WIDTH,this.height=l.HEIGHT,this.isRich=!1,this.rocketSoundActive&&!this.flying&&this.game.audioManager&&(this.game.audioManager.stopRocketSound(),this.rocketSoundActive=!1),t&&this.game.trophySystem&&this.game.trophySystem.unlockTrophy("charity"),console.log("üíù Charit√© ! Tu as donn√© ton or pour redevenir humble."),this.height=l.HEIGHT}setManualControl(t){this.manualControl=t,t&&(this.velX=0,this.velY=0)}setPosition(t,e){this.x=t-this.width/2,this.y=e-this.height/2,this.x<0&&(this.x=0),this.x>this.game.canvas.width-this.width&&(this.x=this.game.canvas.width-this.width),this.y<0&&(this.y=0),this.y>this.game.canvas.height-80-this.height&&(this.y=this.game.canvas.height-80-this.height)}getHitbox(){return{x:this.x,y:this.y,width:this.width,height:this.height}}applySpecialEffect(t,e=180){this.specialEffect=t,this.effectTimer=e,"rolling"===t?console.log("‚ôø Effet HANDICAP: roulement pendant 3s!"):"hair"===t&&console.log("üí∞ Effet RICHESSE: grosse m√®che de cheveux!")}loseLife(){return this.lives>0&&(this.lives--,console.log(`üíî Vie perdue ! Vies restantes: ${this.lives}/${this.maxLives}`),this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPafSound(),this.invincible||0!==this.invincibleCooldown||(this.invincible=!0,this.invincibleTimer=this.invincibleDuration,console.log("üõ°Ô∏è Invincibilit√© activ√©e pour 1 seconde")),this.lives>0)}gainLife(){this.lives<this.maxLives&&(this.lives++,console.log(`‚ù§Ô∏è Vie gagn√©e ! Vies: ${this.lives}/${this.maxLives}`))}isDead(){return this.lives<=0}}const m={},x=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),i=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));s=Promise.allSettled(e.map(t=>{if((t=function(t){return"/X-Sheep/"+t}(t))in m)return;m[t]=!0;const e=t.endsWith(".css"),s=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const l=document.createElement("link");return l.rel=e?"stylesheet":"modulepreload",e||(l.as="script"),l.crossOrigin="",l.href=t,i&&l.setAttribute("nonce",i),document.head.appendChild(l),e?new Promise((e,i)=>{l.addEventListener("load",e),l.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function l(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return s.then(e=>{for(const t of e||[])"rejected"===t.status&&l(t.reason);return t().catch(l)})};const p=new class{constructor(){this.currentLang=localStorage.getItem("xsheep_lang")||"fr",this.translations={},this.rtlLanguages=["ar","he"],this.onLanguageChange=null,this.cache=new Map}async init(){await this.loadTranslations(this.currentLang),this.applyDirection()}async loadTranslations(t){try{let i;try{i=await((t,e,i)=>{const s=t[e];return s?"function"==typeof s?s():Promise.resolve(s):new Promise((t,s)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==i?". Note that variables only represent file names one level deep.":""))))})})(Object.assign({"./translations/ar.js":()=>x(()=>import("./ar-sLAQhMs1.js"),[]),"./translations/de.js":()=>x(()=>import("./de-DRd2OoEs.js"),[]),"./translations/en.js":()=>x(()=>import("./en-BN1dbwVI.js"),[]),"./translations/es.js":()=>x(()=>import("./es-DALA0wJk.js"),[]),"./translations/fr.js":()=>x(()=>import("./fr-BdaUL5-d.js"),[]),"./translations/he.js":()=>x(()=>import("./he-D5GynMF-.js"),[]),"./translations/it.js":()=>x(()=>import("./it-Jg6nKVKH.js"),[]),"./translations/jp.js":()=>x(()=>import("./jp-Xv5y8h4z.js"),[]),"./translations/ko.js":()=>x(()=>import("./ko-igywBII-.js"),[]),"./translations/ln.js":()=>x(()=>import("./ln-C5V3WBEE.js"),[]),"./translations/pt.js":()=>x(()=>import("./pt-Bd5U5d5M.js"),[]),"./translations/rc.js":()=>x(()=>import("./rc-BqR7hJu-.js"),[]),"./translations/ru.js":()=>x(()=>import("./ru-BuqdHMsK.js"),[]),"./translations/stubs.js":()=>x(()=>import("./stubs-8eV23p6k.js"),__vite__mapDeps([0,1])),"./translations/uk.js":()=>x(()=>import("./uk-CVhdCFuq.js"),[]),"./translations/zh.js":()=>x(()=>import("./zh-DPX_MLtS.js"),[])}),`./translations/${t}.js`,3)}catch(e){console.warn(`‚ö†Ô∏è Langue ${t} non trouv√©e, fallback sur fran√ßais`),i=await x(()=>import("./fr-BdaUL5-d.js"),[])}this.translations=i.default||i,this.cache.clear(),console.log(`üåç Traductions charg√©es: ${t}`)}catch(e){if(console.error(`Erreur chargement langue ${t}:`,e),"fr"!==t)try{const t=await x(()=>import("./fr-BdaUL5-d.js"),[]);this.translations=t.default}catch(i){console.error("Impossible de charger m√™me le fran√ßais:",i)}}}async changeLanguage(t){this.currentLang=t,localStorage.setItem("xsheep_lang",t),await this.loadTranslations(t),this.applyDirection(),this.onLanguageChange&&this.onLanguageChange(t)}t(t){if(this.cache.has(t))return this.cache.get(t);if(!this.translations||0===Object.keys(this.translations).length)return t;const e=t.split(".");let i=this.translations;for(const s of e)if(i=null==i?void 0:i[s],void 0===i)return t;return this.cache.size<100&&this.cache.set(t,i),i}applyDirection(){const t=this.rtlLanguages.includes(this.currentLang);document.documentElement.dir=t?"rtl":"ltr",document.documentElement.lang=this.currentLang}isRTL(){return this.rtlLanguages.includes(this.currentLang)}getAvailableLanguages(){return[{code:"fr",name:"Fran√ßais",flag:"üá´üá∑",dir:"ltr"},{code:"en",name:"English",flag:"üá¨üáß",dir:"ltr"},{code:"es",name:"Espa√±ol",flag:"üá™üá∏",dir:"ltr"},{code:"de",name:"Deutsch",flag:"üá©üá™",dir:"ltr"},{code:"it",name:"Italiano",flag:"üáÆüáπ",dir:"ltr"},{code:"pt",name:"Portugu√™s",flag:"üáµüáπ",dir:"ltr"},{code:"ru",name:"–†—É—Å—Å–∫–∏–π",flag:"üá∑üá∫",dir:"ltr"},{code:"uk",name:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",flag:"üá∫üá¶",dir:"ltr"},{code:"zh",name:"‰∏≠Êñá",flag:"üá®üá≥",dir:"ltr"},{code:"jp",name:"Êó•Êú¨Ë™û",flag:"üáØüáµ",dir:"ltr"},{code:"ko",name:"ÌïúÍµ≠Ïñ¥",flag:"üá∞üá∑",dir:"ltr"},{code:"rc",name:"Kr√©ol R√©nion√©",flag:"üá∑üá™",dir:"ltr"},{code:"ln",name:"Lingala",flag:"üá®üá©",dir:"ltr"},{code:"ar",name:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",flag:"üá∏üá¶",dir:"rtl"},{code:"he",name:"◊¢◊ë◊®◊ô◊™",flag:"üáÆüá±",dir:"rtl"}]}};class y{static checkCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}static checkCircleCollision(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)<t.radius+e.radius}static getDistance(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}}class v{static getTranslatedText(t){var e,i,s;return(null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.ground)?void 0:s[t])||""}static getRandom(){const t=this.definitions[Math.floor(Math.random()*this.definitions.length)];return{...t,text:this.getTranslatedText(t.id)||t.text,x:i,y:s-80-t.height,type:"ground"}}}e(v,"definitions",[{id:"wheelchair",icon:"‚ôø",text:"HANDICAP",color:"#4169E1",width:35,height:38},{id:"car_accident",icon:"üöó",text:"ACCIDENT",color:"#DC143C",width:38,height:28},{id:"coffin",icon:"‚ö∞Ô∏è",text:"DEUIL",color:"#2F4F4F",width:42,height:32},{id:"safe",icon:"üè¶",text:"PAUVRET√â",color:"#8B4513",width:35,height:35},{id:"house",icon:"üè†",text:"FAMILLE",color:"#800080",width:38,height:35},{id:"wolf",icon:"üê∫",text:"VIOLENCE",color:"#8B0000",width:35,height:35},{id:"black_sheep",icon:"üêë",text:"REJET",color:"#000000",width:35,height:32},{id:"addiction",icon:"üì¶",text:"ADDICTION",color:"#4B0082",width:32,height:35},{id:"job_stress",icon:"üíº",text:"TRAVAIL",color:"#696969",width:35,height:32},{id:"debt",icon:"üí≥",text:"DETTES",color:"#8B0000",width:32,height:35},{id:"loneliness",icon:"üíî",text:"SOLITUDE",color:"#4B0082",width:35,height:35},{id:"betrayal",icon:"üó°Ô∏è",text:"TRAHISON",color:"#8B0000",width:38,height:32},{id:"chains",icon:"‚õìÔ∏è",text:"PRISON",color:"#696969",width:40,height:35}]);class b{static getTranslatedText(t){var e,i,s;return(null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.sky)?void 0:s[t])||""}static getRandom(){const t=this.definitions[Math.floor(Math.random()*this.definitions.length)],e=80+120*Math.random();return{...t,text:this.getTranslatedText(t.id)||t.text,x:i,y:Math.max(80,Math.min(200,e)),type:"sky"}}}e(b,"definitions",[{id:"death",icon:"üíÄ",text:"MORT",color:"#000000",width:40,height:45},{id:"cancer",icon:"üéóÔ∏è",text:"CANCER",color:"#FF1493",width:35,height:50},{id:"nuclear",icon:"‚ò¢Ô∏è",text:"NUCL√âAIRE",color:"#32CD32",width:45,height:45},{id:"meteor",icon:"‚òÑÔ∏è",text:"M√âT√âORITE",color:"#FF6347",width:50,height:30},{id:"procrastination",icon:"‚è∞",text:"PARESSE",color:"#708090",width:40,height:40},{id:"anger",icon:"üò°",text:"COL√àRE",color:"#FF4500",width:40,height:40},{id:"madness",icon:"üåÄ",text:"FOLIE",color:"#9932CC",width:45,height:45}]);class T{static getTranslatedText(t){var e,i,s;return(null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.middle)?void 0:s[t])||""}static getRandom(){const t=this.definitions.filter(t=>!["shark","cruise_ship"].includes(t.id)),e=150+130*Math.random();return{...t[Math.floor(Math.random()*t.length)],x:i,y:Math.max(150,Math.min(280,e)),type:"middle",floatSpeed:.5+Math.random()}}}e(T,"definitions",[{id:"depression",icon:"‚òÅÔ∏è",text:"D√âPRESSION",color:"#2F4F4F",width:60,height:30},{id:"anxiety",icon:"üí®",text:"ANXI√âT√â",color:"#4682B4",width:50,height:35},{id:"doubt",icon:"‚ùì",text:"DOUTE",color:"#6A5ACD",width:35,height:40},{id:"phantom",icon:"üëª",text:"PHANTOM",color:"#800080",width:40,height:45,effect:"freeze"},{id:"shark",icon:"ü¶à",text:"REQUIN",color:"#4682B4",width:55,height:40,dangerous:!0,damage:2},{id:"eagle",icon:"ü¶Ö",text:"AIGLE",color:"#8B4513",width:70,height:65,dangerous:!0,damage:1},{id:"thunder",icon:"‚ö°",text:"√âCLAIR",color:"#FFD700",width:40,height:60,dangerous:!0,damage:2},{id:"cruise_ship",icon:"üö¢",text:"PAQUEBOT",color:"#0055A4",width:90,height:60,dangerous:!0,damage:2,flag:"üá´üá∑"}]);class S{static getTranslatedText(t){var e,i,s;return(null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.richness)?void 0:s[t])||""}static getRandom(){const t=this.definitions[Math.floor(Math.random()*this.definitions.length)];return{...t,text:this.getTranslatedText(t.id)||t.text,x:i,y:s-80-t.height,type:"richness"}}}e(S,"definitions",[{id:"avarice",icon:"üí∞",text:"AVARICE",color:"#FFD700",width:45,height:50},{id:"luxure",icon:"üíã",text:"LUXURE",color:"#FF1493",width:40,height:45},{id:"nepotisme",icon:"ü§ù",text:"N√âPOTISME",color:"#8B4513",width:50,height:50},{id:"selection",icon:"üë•",text:"S√âLECTION",color:"#4B0082",width:55,height:45},{id:"esclavage",icon:"‚õìÔ∏è",text:"ESCLAVAGE",color:"#2F4F4F",width:45,height:55},{id:"surexploitation",icon:"üè≠",text:"EXPLOITATION",color:"#696969",width:60,height:50}]);class F{static getTranslatedText(t){var e,i,s;return null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.fun)?void 0:s[t]}static getTranslatedMessage(t){var e,i,s;return null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.funMessages)?void 0:s[t]}static getRandom(){const t=this.definitions[Math.floor(Math.random()*this.definitions.length)],e=s-100,l=[Math.max(80,s-80-t.height),s/2-t.height/2,100],a=l[Math.floor(Math.random()*l.length)];return{...t,x:i,y:Math.max(80,Math.min(e,a)),type:"fun",text:this.getTranslatedText(t.id)||t.text,message:this.getTranslatedMessage(t.id)||t.message}}}e(F,"definitions",[{id:"disco_ball",icon:"ü™©",text:"SOIR√âE",color:"#FF69B4",width:40,height:40,effect:"bounce",lifeBonus:2,message:"ü™© Party time! Le mouton danse!"},{id:"pizza",icon:"üçï",text:"PAUSE",color:"#FFD700",width:40,height:40,effect:"slow",lifeBonus:2,message:"üçï Trop mang√©! Digestion lente..."},{id:"trampoline",icon:"üé™",text:"BOING",color:"#FF6347",width:50,height:30,effect:"super_bounce",lifeBonus:1,message:"üé™ SUPER BOING! üöÄ"},{id:"banana",icon:"üçå",text:"GLISSE",color:"#FFFF00",width:35,height:35,effect:"slide",lifeBonus:1,message:"üçå Peau de banane! WHOOOOSH!"},{id:"magnet",icon:"üß≤",text:"AIMANT",color:"#FF0000",width:40,height:40,effect:"attract",lifeBonus:-3,message:"üß≤ Attir√© comme un aimant!"},{id:"balloon",icon:"üéà",text:"L√âGER",color:"#87CEEB",width:35,height:45,effect:"float",lifeBonus:3,message:"üéà L√©ger comme une plume!"},{id:"tornado",icon:"üå™Ô∏è",text:"TORNADO",color:"#708090",width:50,height:60,effect:"spin",lifeBonus:-1,message:"üå™Ô∏è Tourbillon de folie!"},{id:"rocket",icon:"üöÄ",text:"FUS√âE",color:"#FF4500",width:40,height:50,effect:"boost",lifeBonus:2,message:"üöÄ D√âCOLLAGEEEE!"}]);class w{static getTranslatedText(t){var e,i,s;return null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.weapons)?void 0:s[t]}static getRandom(){const t=this.definitions[Math.floor(Math.random()*this.definitions.length)];return{...t,x:i,y:s-80-t.height,type:"weapon",isWeapon:!0,text:this.getTranslatedText(t.id)||t.text}}}e(w,"definitions",[{id:"sword",icon:"‚öîÔ∏è",text:"√âP√âE",color:"#C0C0C0",width:35,height:35,kills:["dragon","shark","eagle"]},{id:"laser_gun",icon:"üî´",text:"LASER",color:"#00FF00",width:35,height:30,kills:["ufo","pacman","thunder"]},{id:"net",icon:"ü•Ö",text:"FILET",color:"#4169E1",width:40,height:40,kills:["whale","phantom"]},{id:"shield",icon:"üõ°Ô∏è",text:"BOUCLIER",color:"#FFD700",width:38,height:38,kills:["cruise_ship"]},{id:"hammer",icon:"üî®",text:"MARTEAU",color:"#8B4513",width:35,height:35,kills:["robot","monster"]},{id:"raygun",icon:"üî¶",text:"RAYON",color:"#FFD700",width:35,height:30,kills:["alien","robot"]}]);class C{constructor(t){this.game=t,this.obstacles=[],this.weapons=[],this.fallingObjects=[],this.explosions=[],this.bossLine=[],this.projectiles=[],this.nextShooterIndex=0,this.bossSpawnCount={},this.maxSpawnsPerBoss=2,this.bossesKilled={},this.narrativeBubblesPopped=0,this.totalXP=0,this.messagesPopped=0,this.timer=0,this.dropTimer=0,this.funTimer=0,this.weaponTimer=0,this.bossTimer=0,this.bossFireTimer=0,this.bigBoss=null,this.bigBossTimer=0,this.bigBossShootCount=0,this.bigBossShootTimer=0,this.bigBossSpawned=!1,this.spawnRate=o,this.dropInterval=3600,this.funInterval=7200,this.weaponInterval=2700,this.bossInterval=120,this.bossFireInterval=7200}update(){var t;if("endless"===this.game.mode)return;if(this.timer++,this.dropTimer++,this.funTimer++,this.weaponTimer++,this.bossTimer++,this.bossFireTimer++,this.bigBossTimer++,this.bigBoss&&this.bigBossShootTimer++,this.dropTimer>=this.dropInterval&&(this.dropRandomObjects(),this.dropTimer=0),this.funTimer>=this.funInterval&&(this.spawnFunObstacle(),this.funTimer=0),this.bossTimer>=this.bossInterval&&this.bossLine.length<6&&this.canSpawnMoreBosses()&&(this.spawnBossInLine(),this.bossTimer=0),this.bossFireTimer>=this.bossFireInterval&&this.bossLine.length>0){for(let t=0;t<this.bossLine.length;t++)this.bossFire(t);this.bossFireTimer=0}!this.bigBossSpawned&&this.bigBossTimer>=10800&&(this.spawnBigBoss(),this.bigBossSpawned=!0),this.bigBoss&&this.bigBossShootCount<3&&this.bigBossShootTimer>=120&&(this.bigBossFire(),this.bigBossShootCount++,this.bigBossShootTimer=0,this.bigBossShootCount>=3&&setTimeout(()=>{if(this.bigBoss){const t=this.obstacles.indexOf(this.bigBoss);t>-1&&this.obstacles.splice(t,1),this.bigBoss=null,console.log("üíÄ BIG BOSS dispara√Æt apr√®s 3 tirs!")}},2e3)),this.updateFallingObjects(),this.updateExplosions(),this.updateBossLine(),this.updateProjectiles(),this.updateWeapons();this.timer>this.spawnRate/this.game.gameSpeed&&this.obstacles.length<8&&(this.spawnObstacle(),this.timer=0);for(let e=this.obstacles.length-1;e>=0;e--){const i=this.obstacles[e];if(this.moveObstacle(i),this.checkCollision(i)){if("fun"===i.type){this.handleFunCollision(i),this.obstacles.splice(e,1),this.game.score+=100;continue}if("phantom"===i.id&&"freeze"===i.effect){if(this.game.player.canKill("phantom")){console.log("ü•Ö Phantom captur√©!"),this.game.score+=500,this.obstacles.splice(e,1);continue}this.game.player.freeze(),this.createIceBreakEffect(this.game.player.x,this.game.player.y),this.game.player.loseLife();this.game.player.loseLife()||this.game.gameOver(),this.obstacles.splice(e,1);continue}if(i.dangerous&&i.damage){if("boss"===i.type){if(this.game.player.canKill(i.id)){this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPoufSound(),this.createExplosion(i.x+i.width/2,i.y+i.height/2),this.obstacles.splice(e,1),this.game.player.invincible=!0,this.game.player.invincibleTimer=60,console.log("üõ°Ô∏è Invuln√©rabilit√© de 1 seconde apr√®s avoir tu√© le boss!");const t=this.bossLine.indexOf(i);t>-1&&(this.bossLine.splice(t,1),this.nextShooterIndex>=this.bossLine.length&&this.bossLine.length>0&&(this.nextShooterIndex=0)),this.bossesKilled[i.id]=(this.bossesKilled[i.id]||0)+1,console.log(`üíÄ ${i.text} tu√© ${this.bossesKilled[i.id]}/2`),this.addXP(1e4),this.checkVictoryCondition()&&(console.log("‚ú®‚ú®‚ú® TOUS LES BOSS √âLIMIN√âS! VICTOIRE! ‚ú®‚ú®‚ú®"),this.game.victory());continue}if(!this.game.player.invincible&&(!i.spawnProtection||i.spawnProtection<=0)){console.log(`üõ°Ô∏è ${i.text} est indestructible! -${i.damage} vies! Besoin de l'arme appropri√©e!`);let t=!0;for(let e=0;e<i.damage&&(t=this.game.player.loseLife(),t);e++);this.game.player.fuel=Math.max(0,this.game.player.fuel-30),t||this.game.gameOver()}this.game.player.velY=10,this.game.player.velX=-5;continue}if(this.game.player.canKill(i.id)){console.log(`‚öîÔ∏è ${i.text} √©limin√© avec ${this.game.player.equippedWeapon.icon}!`),this.game.score+=1e3,this.createExplosion(i.x+i.width/2,i.y+i.height/2),this.obstacles.splice(e,1);continue}console.log(`üí• ${i.text} ! -${i.damage} vies!`);let t=!0;for(let e=0;e<i.damage&&(t=this.game.player.loseLife(),t);e++);this.game.player.fuel=Math.max(0,this.game.player.fuel-30),t||this.game.gameOver(),this.obstacles.splice(e,1),this.game.onObstacleCleared(i);continue}if(null==(t=this.game.powerUpManager)?void 0:t.hasPower("resilience")){this.game.powerUpManager.usePower("resilience",50),this.obstacles.splice(e,1),this.game.score+=150;continue}this.game.player.fuel>0&&(this.game.player.fuel=Math.max(0,this.game.player.fuel-20),console.log(`üí• Collision ! Carburant: ${Math.round(this.game.player.fuel)}/${this.game.player.maxFuel}`)),"wheelchair"===i.id?this.game.player.applySpecialEffect("rolling",180):"richness"===i.type&&this.game.player.applySpecialEffect("hair",180);this.game.player.loseLife()||this.game.gameOver(),this.obstacles.splice(e,1),this.game.onObstacleCleared(i);continue}this.isOffScreen(i)&&(this.obstacles.splice(e,1),this.game.score+=50,i.isWeapon||"boss"===i.type||"fun"===i.type||this.game.onObstacleCleared(i))}}spawnObstacle(){const t=Math.random();let e;e=t<.2?v.getRandom():t<.45?b.getRandom():t<.7?T.getRandom():S.getRandom(),this.obstacles.push(e)}moveObstacle(t){if("boss"!==t.type||!t.isFixed)switch(t.type){case"sky":t.fixed||(t.x-=.5*this.game.gameSpeed,t.y+=t.fallSpeed||2);break;case"middle":t.x-=this.game.gameSpeed,t.y+=Math.sin(.005*Date.now()+.01*t.x)*(t.floatSpeed||1);break;default:t.x-=this.game.gameSpeed}}checkCollision(t){const e=this.game.player.getHitbox();return y.checkCollision(e,{x:t.x,y:t.y,width:t.width,height:t.height})}isOffScreen(t){return("sky"!==t.type||!t.fixed)&&(t.x+t.width<0||t.y>this.game.canvas.height)}updateWeapons(){for(let t=this.weapons.length-1;t>=0;t--){const e=this.weapons[t];e.x-=2*this.game.gameSpeed,this.checkCollision(e)?(this.game.player.equipWeapon(e),this.weapons.splice(t,1),this.game.score+=50,this.game.renderer.addParticle(this.game.player.x,this.game.player.y,e.icon+"‚ú®",e.color)):e.x+e.width<0&&this.weapons.splice(t,1)}}createExplosion(t,e){this.explosions.push({x:t,y:e,radius:0,maxRadius:40,opacity:1,particles:Array(15).fill(0).map(()=>({angle:Math.random()*Math.PI*2,speed:2+3*Math.random(),distance:0,size:2+3*Math.random()}))})}dropRandomObjects(){const t=.25*this.game.canvas.width,e=.75*this.game.canvas.width,i=["üíÄ","üéóÔ∏è","‚ò¢Ô∏è","‚òÑÔ∏è","‚è∞","üò°","üåÄ","üíé","‚≠ê","‚ú®"];for(let s=0;s<6;s++)this.fallingObjects.push({x:t+Math.random()*(e-t),y:50,width:20,height:20,icon:i[Math.floor(Math.random()*i.length)],isDangerous:Math.random()>.5,velocityY:.5,oscillation:Math.random()*Math.PI*2,oscillationSpeed:.03+.03*Math.random()})}updateFallingObjects(){for(let t=this.fallingObjects.length-1;t>=0;t--){const e=this.fallingObjects[t];e.y+=e.velocityY,e.velocityY+=.05,e.oscillation+=e.oscillationSpeed;const i=e.baseX||e.x;if(e.baseX||(e.baseX=e.x),e.x=i+30*Math.sin(e.oscillation),e.x=Math.max(20,Math.min(this.game.canvas.width-20,e.x)),this.checkCollision(e)){if(e.isDangerous){this.game.player.loseLife()||this.game.gameOver()}this.fallingObjects.splice(t,1)}else e.y>this.game.canvas.height-50&&this.fallingObjects.splice(t,1)}}updateExplosions(){for(let t=this.explosions.length-1;t>=0;t--){const e=this.explosions[t];e.radius+=2,e.opacity-=.02,e.particles.forEach(t=>{t.distance+=t.speed}),(e.opacity<=0||e.radius>=e.maxRadius)&&this.explosions.splice(t,1)}}spawnFunObstacle(){const t=F.getRandom();this.obstacles.push(t),console.log(`üéâ ${t.message}`),this.game.renderer.addParticle(t.x,t.y,t.icon+t.icon+t.icon,t.color)}handleFunCollision(t){const e=this.game.player;if(void 0!==t.lifeBonus)if(t.lifeBonus>0){const i=e.lives;e.lives=Math.min(e.maxLives,e.lives+t.lifeBonus);const s=e.lives-i;s>0&&console.log(`‚ù§Ô∏è ${t.text}: +${s} vies! (${e.lives}/${e.maxLives})`)}else if(t.lifeBonus<0){const i=Math.abs(t.lifeBonus);let s=!0;for(let t=0;t<i&&(s=e.loseLife(),s);t++);console.log(`üíî ${t.text}: ${i} vies perdues! (${e.lives}/${e.maxLives})`),s||this.game.gameOver()}switch(t.effect){case"bounce":e.velY=-8,e.velX=4*Math.random()-2;break;case"slow":e.velX*=.3,e.velY*=.3;break;case"super_bounce":e.velY=-15;break;case"slide":e.velX=10,e.velY=0;break;case"attract":const i=t.x-e.x,s=t.y-e.y;e.velX+=.05*i,e.velY+=.05*s;break;case"float":e.velY=-.5;break;case"spin":e.velX=5*Math.cos(.01*Date.now()),e.velY=5*Math.sin(.01*Date.now());break;case"boost":e.velX=12,e.velY=-5}return void 0!==t.lifeBonus&&t.lifeBonus<0?this.createExplosion(t.x+t.width/2,t.y+t.height/2):this.game.renderer.addParticle(e.x,e.y,t.icon+"‚ú®",t.color),!0}createIceBreakEffect(t,e){for(let i=0;i<8;i++)this.game.renderer.addParticle(t,e,"‚ùÑÔ∏è","#87CEEB");console.log("‚ùÑÔ∏èüí• Bris de glace!")}onMessagePopped(){this.narrativeBubblesPopped++,this.totalXP++,this.game.score+=1e3,this.game.player.lives<this.game.player.maxLives&&(this.game.player.lives=Math.min(this.game.player.maxLives,this.game.player.lives+.25),console.log(`‚ù§Ô∏è +0.25 vie ! Vies: ${this.game.player.lives.toFixed(2)}/${this.game.player.maxLives}`)),console.log(`üí≠ Bulle √©clat√©e! Total: ${this.narrativeBubblesPopped} | XP: ${this.totalXP} | +1000 pts`),this.narrativeBubblesPopped%7==0&&(console.log("üéØ 7 bulles atteintes! Spawn d'arme..."),this.spawnWeapon())}addXP(t){this.totalXP+=t;const e=parseInt(localStorage.getItem("xsheep_totalXP")||"0")+t;localStorage.setItem("xsheep_totalXP",e.toString()),t>=50&&console.log(`üéâ +${t} XP! Total session: ${this.totalXP} | Total global: ${e}`)}spawnWeapon(){const t=w.getRandom();this.weapons.push(t),console.log(`‚öîÔ∏è Arme ${t.text} spawn√©e (bulles: ${this.narrativeBubblesPopped})`)}spawnBossInLine(){var t,e,i;const s=this.bossLine.map(t=>t.id),l=[{id:"whale",icon:"üêã",text:"BALEINE",color:"#4169E1",width:80,height:50,damage:2},{id:"pacman",icon:"üëæ",text:"PACMAN",color:"#FFFF00",width:60,height:60,damage:2},{id:"dragon",icon:"üêâ",text:"DRAGON",color:"#FF4500",width:70,height:55,damage:2},{id:"ufo",icon:"üõ∏",text:"OVNI",color:"#00FF00",width:65,height:45,damage:2},{id:"shark",icon:"ü¶à",text:"REQUIN",color:"#4682B4",width:55,height:40,damage:2},{id:"cruise_ship",icon:"üö¢",text:"PAQUEBOT",color:"#0055A4",width:90,height:60,damage:2},{id:"robot",icon:"ü§ñ",text:"ROBOT",color:"#C0C0C0",width:65,height:60,damage:2},{id:"alien",icon:"üëΩ",text:"ALIEN",color:"#00FF7F",width:60,height:55,damage:2},{id:"monster",icon:"üëπ",text:"MONSTRE",color:"#8B0000",width:70,height:65,damage:2}].filter(t=>{const e=this.bossSpawnCount[t.id]||0;return!s.includes(t.id)&&e<this.maxSpawnsPerBoss});if(0===l.length)return void console.log("‚ö†Ô∏è Tous les boss ont atteint leur limite de spawn!");const a=this.bossLine.map(t=>t.bossPosition);let o=-1;for(let d=0;d<6;d++)if(!a.includes(d)){o=d;break}if(-1===o)return void console.log("‚ö†Ô∏è Aucune position libre dans la ligne de boss!");const n=l[Math.floor(Math.random()*l.length)],r=(this.game.canvas.width-600)/2+50,h={...n,x:r+100*o,y:50,type:"boss",dangerous:!0,bossPosition:o,cloudEffect:120,isFixed:!0};this.bossLine.push(h),this.obstacles.push(h),this.bossSpawnCount[n.id]=(this.bossSpawnCount[n.id]||0)+1;const c=(null==(i=null==(e=null==(t=p.translations)?void 0:t.obstacles)?void 0:e.level1Bosses)?void 0:i[n.id])||n.text;console.log(`üêâ Boss ${c} ajout√© en position ${o+1}/6 (spawn ${this.bossSpawnCount[n.id]}/${this.maxSpawnsPerBoss})`)}updateBossLine(){for(let t=this.bossLine.length-1;t>=0;t--){const e=this.bossLine[t];e.cloudEffect>0&&e.cloudEffect--,e.targetIndicator>0&&e.targetIndicator--,e.spawnProtection>0&&(e.spawnProtection--,0===e.spawnProtection&&console.log(`üõ°Ô∏è Protection du ${e.text} termin√©e`))}}canSpawnMoreBosses(){const t=["whale","pacman","dragon","ufo","shark","cruise_ship","robot","alien","monster"];for(const e of t){if((this.bossSpawnCount[e]||0)<this.maxSpawnsPerBoss)return!0}return!1}checkVictoryCondition(){if(this.bossLine.length>0)return!1;const t=["whale","pacman","dragon","ufo","shark","cruise_ship","robot","alien","monster"];for(const e of t){if((this.bossSpawnCount[e]||0)>(this.bossesKilled[e]||0))return!1}return!this.canSpawnMoreBosses()}bossFire(t){if(t>=this.bossLine.length)return;const e=this.bossLine[t];if(!e)return;const i=e.x+e.width/2,s=e.y+e.height,l=this.game.player.x-i,a=this.game.player.y-s,o=Math.sqrt(l*l+a*a),n={x:i-10,y:s,width:20,height:30,velX:l/o*6,velY:a/o*6,icon:"üêâ"===e.icon?"üî•":"üõ∏"===e.icon?"‚ö°":"ü¶à"===e.icon?"üíß":"üí•",color:e.color,damage:1};this.projectiles.push(n),console.log(`üí• ${e.text} tire un projectile vers le mouton!`)}spawnBigBoss(){this.bigBoss={id:"big_boss",icon:"üëπ",text:"BIG BOSS",color:"#8B0000",width:140,height:130,x:this.game.canvas.width-160,y:this.game.canvas.height/2-65,type:"boss",dangerous:!0,damage:3,isFixed:!0,isBigBoss:!0,spawnProtection:120},this.obstacles.push(this.bigBoss),this.bigBossShootCount=0,this.bigBossShootTimer=0,console.log("üî•üíÄ BIG BOSS appara√Æt √† droite!")}bigBossFire(){if(!this.bigBoss)return;const t=this.bigBoss.x,e=this.bigBoss.y+this.bigBoss.height/2,i=this.game.player.x-t,s=this.game.player.y-e,l=Math.sqrt(i*i+s*s),a={x:t,y:e-15,width:30,height:30,velX:i/l*8,velY:s/l*8,icon:"üíÄ",color:"#8B0000",damage:2};this.projectiles.push(a),console.log(`üíÄüí• BIG BOSS tire (${this.bigBossShootCount+1}/3)!`)}updateProjectiles(){for(let t=this.projectiles.length-1;t>=0;t--){const e=this.projectiles[t];if(e.x+=e.velX,e.y+=e.velY,this.checkCollision(e)){const e=this.game.player.loseLife();this.game.player.fuel=Math.max(0,this.game.player.fuel-15),console.log("üí• Projectile touch√©! -1 vie"),e||this.game.gameOver(),this.projectiles.splice(t,1);continue}e.y>this.game.canvas.height&&this.projectiles.splice(t,1)}}getAll(){return this.obstacles}getWeapons(){return this.weapons}getFallingObjects(){return this.fallingObjects}getProjectiles(){return this.projectiles}}const R=class{static getTranslated(t){var e,i,s;return(null==(s=null==(i=null==(e=p.translations)?void 0:e.powerUps)?void 0:i.spiritual)?void 0:s[t])||{}}static getRandom(){return this.definitions[Math.floor(Math.random()*this.definitions.length)]}static getById(t){return this.definitions.find(e=>e.id===t)}};e(R,"definitions",[{id:"courage",icon:"üí™",name:"COURAGE",color:"#FFD700",duration:300,message:"üí™ COURAGE ! Tu peux tout affronter !",tip:"Sauts surpuissants !",xpReward:100,get translatedName(){return R.getTranslated("courage").name||this.name},get translatedMessage(){return R.getTranslated("courage").message||this.message},get translatedTip(){return R.getTranslated("courage").tip||this.tip}},{id:"force",icon:"‚ö°",name:"FORCE",color:"#FF6347",duration:300,message:"‚ö° FORCE DIVINE ! Guerrier de lumi√®re !",tip:"D√©fonce tout !",xpReward:120,get translatedName(){return R.getTranslated("force").name||this.name},get translatedMessage(){return R.getTranslated("force").message||this.message},get translatedTip(){return R.getTranslated("force").tip||this.tip}},{id:"patience",icon:"üï∞Ô∏è",name:"PATIENCE",color:"#87CEEB",duration:300,message:"üï∞Ô∏è PATIENCE ! Vole avec s√©r√©nit√© !",tip:"Vol contr√¥l√© !",xpReward:300,get translatedName(){return R.getTranslated("patience").name||this.name},get translatedMessage(){return R.getTranslated("patience").message||this.message},get translatedTip(){return R.getTranslated("patience").tip||this.tip}},{id:"resilience",icon:"üõ°Ô∏è",name:"R√âSILIENCE",color:"#32CD32",duration:300,message:"üõ°Ô∏è R√âSILIENCE ! Tu es blind√© !",tip:"Bouclier activ√© !",xpReward:250,get translatedName(){return R.getTranslated("resilience").name||this.name},get translatedMessage(){return R.getTranslated("resilience").message||this.message},get translatedTip(){return R.getTranslated("resilience").tip||this.tip}},{id:"assurance",icon:"üëë",name:"ASSURANCE",color:"#DDA0DD",duration:300,message:"üëë ASSURANCE ! Tu rayonnes !",tip:"Aura de puissance !",xpReward:200,get translatedName(){return R.getTranslated("assurance").name||this.name},get translatedMessage(){return R.getTranslated("assurance").message||this.message},get translatedTip(){return R.getTranslated("assurance").tip||this.tip}},{id:"liberte",icon:"üïäÔ∏è",name:"LIBERT√â",color:"#87CEFA",duration:1/0,message:"üïäÔ∏è LIBERT√â ! Vole libre pour toujours !",tip:"Vol automatique permanent !",xpReward:500,get translatedName(){return R.getTranslated("liberte").name||this.name},get translatedMessage(){return R.getTranslated("liberte").message||this.message},get translatedTip(){return R.getTranslated("liberte").tip||this.tip}},{id:"controle",icon:"üéØ",name:"CONTR√îLE",color:"#FF69B4",duration:300,message:"üéØ CONTR√îLE ! Ma√Ætre de ton destin !",tip:"Pr√©cision maximale !",xpReward:150,get translatedName(){return R.getTranslated("controle").name||this.name},get translatedMessage(){return R.getTranslated("controle").message||this.message},get translatedTip(){return R.getTranslated("controle").tip||this.tip}},{id:"sagesse",icon:"ü¶â",name:"SAGESSE",color:"#B8860B",duration:300,message:"ü¶â SAGESSE ! Vision claire !",tip:"Clairvoyance !",xpReward:1e3,get translatedName(){return R.getTranslated("sagesse").name||this.name},get translatedMessage(){return R.getTranslated("sagesse").message||this.message},get translatedTip(){return R.getTranslated("sagesse").tip||this.tip}},{id:"gestion",icon:"‚öñÔ∏è",name:"GESTION",color:"#4B0082",duration:300,message:"‚öñÔ∏è GESTION ! √âquilibre divin !",tip:"Balance parfaite !",xpReward:180,get translatedName(){return R.getTranslated("gestion").name||this.name},get translatedMessage(){return R.getTranslated("gestion").message||this.message},get translatedTip(){return R.getTranslated("gestion").tip||this.tip}},{id:"agir",icon:"üöÄ",name:"AGIR",color:"#FF4500",duration:300,message:"üöÄ ACTION ! Fonce maintenant !",tip:"Vitesse turbo !",xpReward:220,get translatedName(){return R.getTranslated("agir").name||this.name},get translatedMessage(){return R.getTranslated("agir").message||this.message},get translatedTip(){return R.getTranslated("agir").tip||this.tip}},{id:"se_battre",icon:"‚öîÔ∏è",name:"SE BATTRE",color:"#8B0000",duration:300,message:"‚öîÔ∏è MODE GUERRIER ! Au combat !",tip:"Force maximale !",xpReward:400,get translatedName(){return R.getTranslated("combattre").name||this.name},get translatedMessage(){return R.getTranslated("combattre").message||this.message},get translatedTip(){return R.getTranslated("combattre").tip||this.tip}},{id:"ne_pas_abandonner",icon:"üîí",name:"NE PAS ABANDONNER",color:"#2E8B57",duration:300,message:"üîí JAMAIS ABANDONNER ! Increvable !",tip:"T√©nacit√© l√©gendaire !",xpReward:350,get translatedName(){return R.getTranslated("nepasabandonner").name||this.name},get translatedMessage(){return R.getTranslated("nepasabandonner").message||this.message},get translatedTip(){return R.getTranslated("nepasabandonner").tip||this.tip}},{id:"perseverer",icon:"üèîÔ∏è",name:"PERS√âV√âRER",color:"#1E90FF",duration:300,message:"üèîÔ∏è PERS√âV√âRANCE ! Champion !",tip:"Endurance infinie !",xpReward:450,get translatedName(){return R.getTranslated("perseverer").name||this.name},get translatedMessage(){return R.getTranslated("perseverer").message||this.message},get translatedTip(){return R.getTranslated("perseverer").tip||this.tip}}]);let P=R;class M{static getTranslated(t){var e,i,s;const l=null==(s=null==(i=null==(e=p.translations)?void 0:e.powerUps)?void 0:i.fun)?void 0:s[t];return l?{name:l.name||"",message:l.message||"",tip:l.tip||""}:null}static getRandom(){return this.definitions[Math.floor(Math.random()*this.definitions.length)]}}e(M,"definitions",[{id:"disco",icon:"üï∫",name:"MODE DISCO",color:"#FF1493",duration:180,message:"üï∫ MODE DISCO! Let's dance!",tip:"Mouvement disco automatique!"},{id:"giant",icon:"ü¶£",name:"G√âANT",color:"#8B4513",duration:180,message:"ü¶£ MOUTON G√âANT! GROOOOOS!",tip:"Taille x3!"},{id:"tiny",icon:"üê≠",name:"MINUSCULE",color:"#FFB6C1",duration:180,message:"üê≠ Tout petit! Esquive facile!",tip:"Mode furtif!"},{id:"rainbow",icon:"üåà",name:"ARC-EN-CIEL",color:"#FF69B4",duration:180,message:"üåà RAINBOW SHEEP! Fabuleux!",tip:"Tra√Æn√©e color√©e!"},{id:"magnet_bonus",icon:"üß≤",name:"AIMANT √Ä BONUS",color:"#FFD700",duration:180,message:"üß≤ Tous les bonus t'attirent!",tip:"Collecte automatique!"},{id:"spring",icon:"ü¶ò",name:"KANGOUROU",color:"#CD853F",duration:180,message:"ü¶ò Mode kangourou! Boing boing!",tip:"Rebonds infinis!"},{id:"jetpack",icon:"üéí",name:"JETPACK",color:"#00CED1",duration:180,message:"üéí JETPACK activ√©! Vrooooom!",tip:"Vol turbo!"},{id:"ninja",icon:"ü•∑",name:"NINJA",color:"#2F4F4F",duration:180,message:"ü•∑ Mode ninja! Invisible!",tip:"Intangible!"},{id:"party",icon:"üéâ",name:"F√äTE",color:"#FF6347",duration:180,message:"üéâ C'EST LA F√äTEEE!",tip:"Confettis partout!"},{id:"coffee",icon:"‚òï",name:"CAF√âINE",color:"#6F4E37",duration:180,message:"‚òï CAF√âINE! Speed x5!",tip:"Hyper vitesse!"}]);class k{constructor(t){this.game=t,this.powerUps=[],this.activePowers={},this.timer=0,this.funTimer=0,this.firstPowerSpawned=!1,P.definitions.forEach(t=>{this.activePowers[t.id]=0}),M.definitions.forEach(t=>{this.activePowers[t.id]=0})}getTranslatedPowerUp(t){var e,i,s;if(t.translatedName)return{...t,name:t.translatedName,message:t.translatedMessage||t.message,tip:t.translatedTip||t.tip};const l=P.definitions.find(e=>e.id===t.id)?"spiritual":"fun",a=null==(s=null==(i=null==(e=p.translations)?void 0:e.powerUps)?void 0:i[l])?void 0:s[t.id];return a?{...t,name:a.name||t.name,message:a.message||t.message,tip:a.tip||t.tip}:t}update(){this.firstPowerSpawned||(this.spawnLibertePowerUp(),this.firstPowerSpawned=!0),this.timer++,this.funTimer++,this.timer>n&&(this.spawnPowerUp(),this.timer=0),this.funTimer>=7200&&(this.spawnFunPowerUp(),this.funTimer=0);for(let t=this.powerUps.length-1;t>=0;t--){const e=this.powerUps[t];e.x-=this.game.gameSpeed,this.checkCollision(e)?(this.activatePower(e,e.x,e.y),this.powerUps.splice(t,1)):e.x<-50&&this.powerUps.splice(t,1)}Object.keys(this.activePowers).forEach(t=>{this.activePowers[t]>0&&"liberte"!==t&&this.activePowers[t]--})}spawnPowerUp(){const t=P.getRandom(),e=s-100,l=s/2-150+300*Math.random();this.powerUps.push({...t,x:i,y:Math.max(100,Math.min(e,l))})}spawnLibertePowerUp(){const t=P.definitions.find(t=>"liberte"===t.id);t&&(this.powerUps.push({...t,x:400,y:400}),console.log("‚ú® Power-up LIBERT√â plac√© au d√©but du jeu!"))}spawnFunPowerUp(){const t=M.getRandom(),e=s-80,l=s/2-200+400*Math.random();this.powerUps.push({...t,x:i+50,y:Math.max(80,Math.min(e,l))}),console.log(`üéâ BONUS FUN: ${t.message}`),this.game.renderer.addParticle(i,s/2,t.icon+"‚ú®‚ú®‚ú®",t.color)}activatePower(t,e,i){var s;this.activePowers[t.id]=t.duration,this.game.score+=300,this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playGlineSound(),"liberte"===t.id&&this.game.player&&this.game.audioManager&&setTimeout(()=>{this.game.player.rocketSoundActive||(this.game.audioManager.startRocketSound(),this.game.player.rocketSoundActive=!0)},200);const l=this.getTranslatedPowerUp(t);console.log(`üí™ ${l.name} activ√© !`),t.xpReward&&(null==(s=this.game)?void 0:s.obstacleManager)&&this.game.obstacleManager.addXP(t.xpReward),this.game.notificationSystem&&this.game.notificationSystem.showSplash({x:e,y:i,icon:t.icon,text:l.name,color:t.color,duration:2e3,onClose:()=>{var t;(null==(t=this.game)?void 0:t.obstacleManager)&&this.game.obstacleManager.onMessagePopped()}})}checkCollision(t){const e=this.game.player.getHitbox();return y.checkCollision(e,{x:t.x-18,y:t.y-18,width:36,height:36})}hasPower(t){return this.activePowers[t]>0}usePower(t,e){this.activePowers[t]>0&&(this.activePowers[t]-=e,this.activePowers[t]<0&&(this.activePowers[t]=0))}getAll(){return this.powerUps}getActivePowers(){return this.activePowers}}const A={wheelchair:{text:"Ce fauteuil roulant ? Moi aussi je vis avec un handicap... Mais regarde, je peux encore voler avec mes r√™ves ! Ton corps peut √™tre limit√©, mais ton esprit est libre. Dieu t'a donn√© des ailes que personne ne peut briser. üí™‚ú®",hope:"Tu n'es pas d√©fini par tes limitations"},car_accident:{text:"Cette voiture bris√©e me rappelle mes propres accidents de la vie... Les chocs, les traumatismes. Mais tu sais quoi ? Dieu r√©pare les c≈ìurs bris√©s. Chaque cicatrice raconte une histoire de survie. Tu es plus fort que tu ne le crois. üöóüíî‚û°Ô∏è‚ù§Ô∏è",hope:"Tes blessures deviennent ta force"},coffin:{text:"Ce cercueil... J'ai perdu des √™tres chers aussi. La douleur du deuil, ce vide qui semble infini. Mais l'amour ne meurt jamais. Ils vivent dans ton c≈ìur, et un jour, on se retrouvera. En attendant, vis pour honorer leur m√©moire. ‚ö∞Ô∏è‚û°Ô∏èüëº",hope:"L'amour est √©ternel"},safe:{text:"Ce coffre-fort ferm√©... L'argent qui manque, les factures qui s'accumulent. Ne sois pas esclave des biens et richesses. Garde dans ton c≈ìur un seul ma√Ætre : l'amour vrai. Ta valeur ne se mesure pas en euros. Tu es un tr√©sor ! üí∞‚û°Ô∏èüíé",hope:"Un seul ma√Ætre : l'amour vrai"},house:{text:"Cette maison bris√©e... Divorce, famille √©clat√©e, solitude. Le foyer qui n'en est plus un. Mais souviens-toi : tu peux reconstruire. Avec Dieu, m√™me les ruines deviennent de beaux jardins. L'espoir fleurit sur les d√©combres. üè†üíî‚û°Ô∏èüå∏",hope:"On peut toujours reconstruire"},wolf:{text:"Ce loup... Les gens toxiques, ceux qui te font du mal, le harc√®lement. J'ai rencontr√© des loups sur mon chemin aussi. Mais tu n'es pas seul. Il y a des bergers qui te prot√®gent. √âloigne-toi des loups, rapproche-toi des agneaux. üê∫‚û°Ô∏èüêë",hope:"Tu m√©rites l'amour, pas la violence"},black_sheep:{text:"Ce mouton noir... Te sentir diff√©rent, rejet√©, incompris. Moi aussi j'ai √©t√© le mouton noir parfois. Mais Dieu aime la diversit√© ! Tu es unique pour une raison. Tes diff√©rences sont tes forces. Brille de ta propre lumi√®re ! üêë‚ö´‚û°Ô∏èüåü",hope:"Tes diff√©rences sont tes forces"},addiction:{text:"Cette bo√Æte 'ADDICTION'... L'alcool, la drogue, les d√©pendances qui encha√Ænent. J'ai vu des amis dans ces cha√Ænes. Mais j'ai aussi vu des miracles ! La libert√© existe. Chaque jour sobre est une victoire. Tu peux y arriver ! üì¶‚õìÔ∏è‚û°Ô∏èüóùÔ∏è",hope:"Fais toi aider courage !"},death:{text:"Cette mort qui plane... La peur de partir, de laisser ceux qu'on aime. Mais la mort n'est qu'un passage, pas une fin. J√©sus a vaincu la mort ! Vis pleinement aujourd'hui, car l'√©ternit√© t'attend. üíÄ‚û°Ô∏èüëë",hope:"La vie √©ternelle est ta destin√©e"},cancer:{text:"Ce cancer qui ronge... La maladie qui d√©vore l'espoir. J'ai vu des guerriers vaincre ce dragon. Chaque jour de bataille est une victoire. Ton corps se bat, ton √¢me reste pure. Tu es plus fort que cette maladie ! üéóÔ∏è‚öîÔ∏è‚û°Ô∏èüëë",hope:"Tu es un guerrier de lumi√®re"},nuclear:{text:"Cette radiation toxique... Les peurs mondiales, les catastrophes qui nous d√©passent. Mais m√™me face √† l'apocalypse, l'amour reste. Focus sur ce que tu peux changer : ton c≈ìur, tes actions, ta paix int√©rieure. ‚ò¢Ô∏è‚û°Ô∏è‚òÆÔ∏è",hope:"La paix commence en toi"},meteor:{text:"Cette m√©t√©orite destructrice... Les catastrophes soudaines, les chocs impr√©visibles de la vie. Mais regarde : m√™me apr√®s l'impact, la vie rena√Æt. Les dinosaures ont disparu, mais nous sommes l√† ! Tu es la preuve que la vie gagne toujours. ‚òÑÔ∏è‚û°Ô∏èüå±",hope:"Tu es la vie qui rena√Æt"},procrastination:{text:"Cette horloge qui m'accuse... La procrastination, remettre √† demain, le temps qui file. Moi aussi j'ai perdu du temps. Mais chaque seconde qui reste est pr√©cieuse ! Commence maintenant, m√™me petit. Un pas vaut mieux que mille projets. ‚è∞‚û°Ô∏èüöÄ",hope:"Il n'est jamais trop tard"},anger:{text:"Cette col√®re qui explose... La rage qui aveugle, les mots qu'on regrette. Moi aussi j'ai eu mes temp√™tes int√©rieures. Mais la col√®re peut devenir force pour la justice ! Canalise ta flamme vers le bien. üò°‚û°Ô∏èüî•",hope:"Ta col√®re peut servir la justice"},madness:{text:"Ce tourbillon de folie... Quand la r√©alit√© vacille, quand l'esprit se perd. J'ai fr√¥l√© cette spirale aussi. Mais m√™me dans le chaos mental, Dieu reste ta boussole. Accroche-toi √† Sa main, Il te ram√®nera √† la lumi√®re. üåÄ‚û°Ô∏èüß≠",hope:"Dieu est ta boussole"},avarice:{text:"Cette avarice qui ronge... Plus tu accumules, plus tu es vide. L'avarice emprisonne ton c≈ìur. Donne et tu seras libre ! La vraie richesse, c'est la g√©n√©rosit√©. üí∞‚õìÔ∏è‚û°Ô∏èüíù",hope:"Donne pour √™tre libre"},luxure:{text:"Ces d√©sirs qui consument... La luxure promet du plaisir mais livre de la honte. Ton corps est un temple, respecte-le ! La puret√© apporte la vraie paix. üíã‚û°Ô∏èüïäÔ∏è",hope:"Ton corps est un temple"},nepotisme:{text:"Favoriser les tiens au d√©triment des autres... Le n√©potisme pourrit les institutions. Le m√©rite vaut mieux que les connections ! La justice vraie ne conna√Æt pas de favoritisme. ü§ù‚û°Ô∏è‚öñÔ∏è",hope:"Le m√©rite sur les connections"},selection:{text:"Trier les gens selon leur valeur... La s√©lection sociale est un mensonge. Chaque √¢me a la m√™me dignit√© devant Dieu ! L'humanit√© ne se divise pas. üë•‚û°Ô∏èüåç",hope:"Dignit√© √©gale pour tous"},esclavage:{text:"Exploiter la libert√© d'autrui... L'esclavage moderne existe encore. Personne ne devrait √™tre la propri√©t√© d'un autre ! La libert√© est un droit sacr√©. ‚õìÔ∏è‚û°Ô∏èüïäÔ∏è",hope:"Libert√© pour tous"},surexploitation:{text:"Presser les gens jusqu'√† la derni√®re goutte... La surexploitation d√©truit les corps et les √¢mes. L'humain vaut plus que le profit ! Le respect du travailleur est sacr√©. üè≠‚û°Ô∏è‚ù§Ô∏è",hope:"L'humain avant le profit"},eagle:{text:"Cet aigle qui plane... La pr√©dation, les rapaces qui t'entourent. Ceux qui attendent ta faiblesse pour fondre sur toi. Mais tu n'es pas une proie ! Deviens toi aussi un aigle, vole plus haut qu'eux ! ü¶Ö‚û°Ô∏èüïäÔ∏è",hope:"Tu es l'aigle, pas la proie"},thunder:{text:"Cet √©clair qui frappe... Les coups du sort, la foudre qui tombe sans pr√©venir. La vie peut √™tre brutale. Mais m√™me apr√®s l'orage, l'arc-en-ciel appara√Æt ! Tu es la promesse apr√®s la temp√™te. ‚ö°‚û°Ô∏èüåà",hope:"Apr√®s l'orage vient l'arc-en-ciel"},disco_ball:{text:"ü™©‚ú® YEEEES! Boule disco! Danse avec moi! La vie c'est aussi √ßa : des moments de pure joie absurde! Parfois il faut juste l√¢cher prise et briller comme une boule √† facettes! üíÉüï∫",hope:"La joie est un acte de r√©sistance !"},pizza:{text:"üçï Pizza party dans le ciel! M√™me le mouton m√©rite sa part! La vie c'est pas que des √©preuves, c'est aussi partager une pizza avec des amis. C√©l√®bre les petits plaisirs! üòã",hope:"Les petits bonheurs comptent aussi !"},trampoline:{text:"ü§∏ BOING BOING! Rebondir c'est la vie! Chaque chute est une occasion de rebondir plus haut! Laisse ton c≈ìur d'enfant s'exprimer, saute, ris, vis! üé™",hope:"Rebondis toujours plus haut !"},banana:{text:"üçå HAHA! La banane cosmique! L'humour c'est sacr√©! Rire de soi-m√™me, rire de l'absurde, c'est un super-pouvoir! Ne te prends pas trop au s√©rieux! üòÇ",hope:"Le rire gu√©rit l'√¢me !"},magnet:{text:"üß≤ ZZZAP! Attire le positif! Comme un aimant, tu attires ce que tu es! Rayonne de bont√© et tu verras des miracles! La loi de l'attraction c'est r√©el! ‚ö°",hope:"Tu attires ce que tu rayonnes !"},balloon:{text:"üéà Envole-toi! Les ballons repr√©sentent les r√™ves d'enfant! N'abandonne jamais ton c≈ìur d'enfant! Garde cette capacit√© √† t'√©merveiller! La l√©g√®ret√© c'est vital! üåà",hope:"Garde ton c≈ìur d'enfant !"},tornado:{text:"üå™Ô∏è WHOOOOSH! La tornade fun! Parfois la vie te secoue, mais √ßa te fait sentir VIVANT! Embrasse le chaos cr√©atif! Laisse-toi surprendre! üé¢",hope:"Le chaos peut √™tre cr√©atif !"},rocket:{text:"üöÄ D√âCOLLAGE! Direction l'infini! Tu es fait pour les √©toiles! Tes r√™ves les plus fous sont r√©alisables! VISE LA LUNE, m√™me si tu rates tu atterris dans les √©toiles! üåü",hope:"Tes r√™ves n'ont pas de limites !"},charity:{text:"üíù Tu as donn√© ton or ! Quelle belle humilit√© ! La vraie richesse n'est pas dans ce qu'on poss√®de, mais dans ce qu'on donne. L'amour se partage et se donne sagement. En donnant, tu re√ßois l'infini. üéÅ‚ú®",hope:"L'amour se partage et se donne sagement"},impatient:{text:"‚è∞üíî HORLOGE BRIS√âE - Ma√Ætre du temps. Quand on veut tout rapidement et toujours plus vite, on rate souvent l'essentiel du moment pr√©sent. Ne sois pas esclave du temps, prends le temps et profite de chaque instant sans stress, sans compter le temps. Tu verras alors que la vie est une grande aventure. Le temps est un alli√©, pas un ennemi. ‚è≥‚ú®",hope:"Ma√Ætre du temps"},gold_coin:{text:"üí∞ PI√àCE D'OR - L'amour du gain des richesses folles est un pi√®ge amer. Ne sois pas esclave des biens : une voiture, une maison ne te d√©finissent pas. Tu es plus pr√©cieux que cela. Et la libert√© est un tr√©sor immuable. üóùÔ∏è‚ú®",hope:"La libert√© est un tr√©sor immuable"},grace:{text:"‚úùÔ∏è LA GR√ÇCE - Ce n'est pas une formule magique ni une incantation. La gr√¢ce se personnifie par une personne : Dieu fait homme et nomm√© J√©sus. On ne trompera pas Dieu par des secrets ou cachotteries. La gr√¢ce est √† lui seul. Et demander gr√¢ce avec repentance est une voie de salut pour tout √™tre imparfait. Nos pires d√©fauts n'auront plus d'importance devant lui avec un c≈ìur dispos√© √† √™tre renouvel√©, transform√© pour le meilleur. Ne vous d√©couragez pas en pensant √™tre le pire p√©cheur. Demandez √† Dieu de vous montrer qui vous √™tes vraiment. üïäÔ∏èüíî",hope:"La gr√¢ce : Dieu fait homme"},white_sheep:{text:"üêë‚ú® LA GR√ÇCE - C'est la vie. Choisir la vie c'est choisir l'amour. Le combat de la vie est parfois tr√®s difficile et les combats spirituels encore plus. N'abandonne jamais. Mais ne te trompe pas : m√™me s'il faut toujours prot√©ger et servir le bien, la cruaut√©, la destruction, la guerre ne sont que l'orgueil de l'homme. Dieu n'est pas raciste, haineux, ma√Ætre de la guerre et de destruction. Ni m√™me homophobe. La diversit√© est de Dieu, et nos diff√©rences sont la beaut√© de l'humanit√©. Apprends la sagesse du respect et porte la paix avec discernement. La libert√© des autres est aussi notre future libert√©. Veille √† ton c≈ìur et respecte les autres comme tu aimerais qu'on te respecte. Rends libre comme tu veux √™tre libre, et ne juge pas comme tu ne veux pas √™tre jug√©. Pardonne le plus possible avec sagesse et justice. üïäÔ∏è‚ù§Ô∏è",hope:"Mouton blanc : le combat spirituel (le bon combat)"},finalDialogue:{ant:"Tant qu'il y a de la vie, il y a de l'espoir...",jojo:"Merde, tu n'as pas v√©cu ma vie !",bee:"On ne peut pas vraiment comprendre la douleur au c≈ìur de l'√™tre unique. Mais on peut toujours faire plus que rien.",sheep:"Et c'est exactement ce qu'on a fait ensemble... Plus que rien. On a partag√© l'espoir, un obstacle √† la fois. Merci d'avoir march√© avec moi.",jesus:"Tu as √©t√© un bon gestionnaire avec un grand c≈ìur. Vient vaillant h√©ros et fid√®le serviteur, le repos est pour toi."}};class B{constructor(t){this.game=t,this.container=null,this.createUI()}createUI(){this.container=document.createElement("div"),this.container.id="narrative-box",this.container.style.cssText="\n            position: fixed;\n            bottom: 150px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: white;\n            padding: 15px 20px;\n            border-radius: 25px;\n            max-width: 300px;\n            text-align: center;\n            display: none;\n            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);\n            border: 4px solid #333;\n            z-index: 1000;\n            position: relative;\n        ",document.body.appendChild(this.container)}show(t,e){var i;(null==(i=this.game)?void 0:i.notificationSystem)?this.game.notificationSystem.showNarrative({text:t.hope,duration:5e3,onClose:()=>{var t;(null==(t=this.game)?void 0:t.obstacleManager)&&this.game.obstacleManager.onMessagePopped(),e&&e()}}):this.showLegacy(t,e)}showLegacy(t,e){this.container.innerHTML=`\n            <div style="position:relative">\n                <p style="color:#333;font-size:14px;font-weight:bold;line-height:1.4;margin:0">\n                    üí≠ ${t.hope}\n                </p>\n                <div style="\n                    position:absolute;\n                    bottom:-20px;\n                    left:50%;\n                    transform:translateX(-50%);\n                    width:0;\n                    height:0;\n                    border-left:15px solid transparent;\n                    border-right:15px solid transparent;\n                    border-top:20px solid white;\n                "></div>\n                <div style="\n                    position:absolute;\n                    bottom:-24px;\n                    left:50%;\n                    transform:translateX(-50%);\n                    width:0;\n                    height:0;\n                    border-left:18px solid transparent;\n                    border-right:18px solid transparent;\n                    border-top:24px solid #333;\n                "></div>\n            </div>\n        `,this.container.style.display="block",this.container.style.opacity="0",this.container.style.transform="translateX(-50%) scale(0.5)",setTimeout(()=>{this.container.style.transition="all 0.3s ease-out",this.container.style.opacity="1",this.container.style.transform="translateX(-50%) scale(1)"},10),setTimeout(()=>{this.container.style.transition="all 0.2s ease-in",this.container.style.transform="translateX(-50%) scale(1.5)",this.container.style.opacity="0",setTimeout(()=>{var t;this.container.style.display="none",(null==(t=this.game)?void 0:t.obstacleManager)&&this.game.obstacleManager.onMessagePopped(),e&&e()},200)},5e3),this.createHopeParticles()}showDialogue(t){this.container.innerHTML=`\n            <h3 style="color:#DAA520;font-size:28px;margin-bottom:20px">\n                ${p.t("narrative.finalDialogue.title")}\n            </h3>\n            <div style="text-align:left;margin:20px 0">\n                <p style="margin-bottom:15px">\n                    <strong>${p.t("narrative.finalDialogue.antLabel")}</strong><br>\n                    "${t.ant}"\n                </p>\n                <p style="margin-bottom:15px">\n                    <strong>${p.t("narrative.finalDialogue.jojoLabel")}</strong><br>\n                    "${t.jojo}"\n                </p>\n                <p style="margin-bottom:15px">\n                    <strong>${p.t("narrative.finalDialogue.beeLabel")}</strong><br>\n                    "${t.bee}"\n                </p>\n                <p style="margin-bottom:15px">\n                    <strong>${p.t("narrative.finalDialogue.sheepLabel")}</strong><br>\n                    "${t.sheep}"\n                </p>\n                <p style="margin-top:20px;padding:15px;background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,165,0,0.2));border-radius:10px;border-left:4px solid #FFD700">\n                    <strong style="color:#DAA520">${p.t("narrative.finalDialogue.jesusLabel")}</strong><br>\n                    <span style="font-size:18px;font-weight:bold;color:#333">"${t.jesus}"</span>\n                </p>\n            </div>\n            <p style="font-style:italic;color:#888;margin-top:20px">\n                ${p.t("narrative.finalDialogue.author")}\n            </p>\n            <div style="text-align:center;margin-top:30px">\n                <button onclick="window.openTrophyMenu()" style="\n                    background:linear-gradient(135deg,#FFD700,#FFA500);\n                    border:none;\n                    padding:15px 30px;\n                    border-radius:25px;\n                    font-size:16px;\n                    font-weight:bold;\n                    color:#333;\n                    cursor:pointer;\n                    box-shadow:0 5px 15px rgba(0,0,0,0.3);\n                ">${p.t("narrative.finalDialogue.viewTrophies")}</button>\n            </div>\n        `,this.container.style.display="block"}createHopeParticles(){console.log("‚ú® Particules d'espoir cr√©√©es")}hide(){this.container.style.display="none"}}class E{constructor(t){this.game=t,this.messageSystem=new B(t),this.currentMessage=null}getTranslatedMessage(t){var e,i,s;const l=null==(i=null==(e=null==p?void 0:p.translations)?void 0:e.narrative)?void 0:i[t];return l?(console.log(`‚úÖ Traduction trouv√©e pour ${t}:`,null==(s=l.hope)?void 0:s.substring(0,30)),l):(console.log(`‚ö†Ô∏è Fallback FR pour ${t}`),A[t])}show(t){const e=this.getTranslatedMessage(t);e&&(this.currentMessage=e,this.game.paused=!0,this.messageSystem.show(e,()=>{this.game.paused=!1,this.game.player.jump(),this.game.gameLoop()}))}showFinalDialogue(){const t=p&&p.translations&&p.translations.narrative&&p.translations.narrative.finalDialogue?p.translations.narrative.finalDialogue:A.finalDialogue;this.game.paused=!0,this.messageSystem.showDialogue(t)}}class I{constructor(){this.trophies=new Map,this.totalXP=0,this.loadFromStorage(),this.createUI(),this.activeNotifications=[]}loadFromStorage(){const t=localStorage.getItem("mouton_trophies");if(t){const e=JSON.parse(t);this.trophies=new Map(e.trophies),this.totalXP=e.totalXP||0}}saveToStorage(){const t={trophies:Array.from(this.trophies.entries()),totalXP:this.totalXP};localStorage.setItem("mouton_trophies",JSON.stringify(t))}unlockTrophy(t){if(!this.trophies.has(t)){const e=50;return this.trophies.set(t,{unlocked:!0,xp:e,readCount:0,unlockedAt:Date.now()}),this.totalXP+=e,this.saveToStorage(),this.showXPNotification(t,e),!0}return!1}showXPNotification(t,e){const i=A[t],s={id:Date.now(),obstacleId:t,xp:e,hope:(null==i?void 0:i.hope)||p.t("game.notifications.trophyUnlocked"),startTime:Date.now(),duration:3e3,x:0,y:100,opacity:1,slideProgress:0};this.activeNotifications.push(s),setTimeout(()=>{const t=this.activeNotifications.findIndex(t=>t.id===s.id);t>-1&&this.activeNotifications.splice(t,1)},3e3)}updateNotifications(){const t=Date.now();for(let e=this.activeNotifications.length-1;e>=0;e--){const i=this.activeNotifications[e],s=t-i.startTime,l=s/i.duration;i.slideProgress=s<500?s/500:1,i.opacity=l>.833?1-(l-.833)/.167:1}}renderNotifications(t,e){this.updateNotifications();for(let i=0;i<this.activeNotifications.length;i++){const s=this.activeNotifications[i],l=300,a=90,o=e-l-20;s.x=o+400*(1-s.slideProgress),s.y=100+i*(a+10),t.save(),t.globalAlpha=s.opacity;const n=t.createLinearGradient(s.x,s.y,s.x+l,s.y);n.addColorStop(0,"#FFD700"),n.addColorStop(1,"#FFA500"),t.fillStyle=n,t.shadowColor="rgba(255, 215, 0, 0.5)",t.shadowBlur=20,t.shadowOffsetX=0,t.shadowOffsetY=5,this.roundRect(t,s.x,s.y,l,a,15),t.fill(),t.shadowBlur=0,t.strokeStyle="#FFA500",t.lineWidth=2,this.roundRect(t,s.x,s.y,l,a,15),t.stroke(),t.fillStyle="#333",t.font="bold 16px Arial",t.textAlign="left",t.fillText(p.t("trophies.newTrophy"),s.x+15,s.y+25),t.font="14px Arial",t.fillText(s.hope,s.x+15,s.y+50),t.fillStyle="#8B4513",t.font="bold 14px Arial",t.fillText(`+${s.xp} ${p.t("trophies.xpGained")}`,s.x+15,s.y+72),t.restore()}}roundRect(t,e,i,s,l,a){t.beginPath(),t.moveTo(e+a,i),t.lineTo(e+s-a,i),t.quadraticCurveTo(e+s,i,e+s,i+a),t.lineTo(e+s,i+l-a),t.quadraticCurveTo(e+s,i+l,e+s-a,i+l),t.lineTo(e+a,i+l),t.quadraticCurveTo(e,i+l,e,i+l-a),t.lineTo(e,i+a),t.quadraticCurveTo(e,i,e+a,i),t.closePath()}createUI(){this.container=document.createElement("div"),this.container.id="trophy-menu",this.container.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.9);\n            display: none;\n            overflow-y: auto;\n            z-index: 3000;\n            padding: 40px 20px;\n        ",document.body.appendChild(this.container)}show(){if(!p.translations)return console.warn("‚ö†Ô∏è Traductions non charg√©es, attente..."),void setTimeout(()=>this.show(),100);this.render(),this.container.style.display="block"}hide(){this.container.style.display="none"}render(){const t=this.trophies.size,e=Object.keys(A).filter(t=>"finalDialogue"!==t).length,i=e>0?Math.round(t/e*100):0;this.container.innerHTML=`\n            <div style="max-width:900px;margin:0 auto;color:#FFF">\n                <div style="text-align:center;margin-bottom:30px">\n                    <h1 style="color:#FFD700;font-size:36px;margin:0">${p.t("trophies.menuTitle")}</h1>\n                    <p style="color:#87CEEB;font-size:18px;margin:10px 0">${p.t("trophies.by")}</p>\n                    <div style="background:rgba(255,215,0,0.2);padding:15px;border-radius:15px;margin:20px 0">\n                        <p style="font-size:20px;margin:5px 0">\n                            <strong>${p.t("trophies.totalXP")} : ${this.totalXP}</strong>\n                        </p>\n                        <p style="font-size:16px;margin:5px 0">\n                            ${p.t("trophies.unlockedCount")} : ${t} / ${e} (${i}%)\n                        </p>\n                        <div style="background:rgba(0,0,0,0.3);height:20px;border-radius:10px;overflow:hidden;margin:10px 0">\n                            <div style="background:linear-gradient(90deg,#FFD700,#FFA500);height:100%;width:${i}%;transition:width 0.5s"></div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px;margin-bottom:80px">\n                    ${this.renderTrophies()}\n                </div>\n                \n                <div style="text-align:center">\n                    <button onclick="window.closeTrophyMenu()" style="\n                        background:linear-gradient(135deg,#FFD700,#FFA500);\n                        border:none;\n                        padding:15px 40px;\n                        border-radius:25px;\n                        font-size:18px;\n                        font-weight:bold;\n                        color:#333;\n                        cursor:pointer;\n                        box-shadow:0 5px 15px rgba(0,0,0,0.3);\n                    ">${p.t("trophies.close")}</button>\n                </div>\n            </div>\n        `,window.closeTrophyMenu=()=>this.hide(),window.shareTrophy=t=>this.shareTrophyImage(t)}shareTrophyImage(t){const e=A[t],i=this.trophies.get(t);if(!e||!i)return;const s=document.createElement("canvas");s.width=1080,s.height=1080;const l=s.getContext("2d"),a=l.createLinearGradient(0,0,0,1080);a.addColorStop(0,"#1a1a2e"),a.addColorStop(.5,"#16213e"),a.addColorStop(1,"#0f3460"),l.fillStyle=a,l.fillRect(0,0,1080,1080),l.strokeStyle="rgba(255, 255, 255, 0.05)",l.lineWidth=1;const o=40;for(let m=0;m<1080;m+=o)l.beginPath(),l.moveTo(m,0),l.lineTo(m,1080),l.stroke();for(let m=0;m<1080;m+=o)l.beginPath(),l.moveTo(0,m),l.lineTo(1080,m),l.stroke();l.fillStyle="#FFFFFF",l.font='bold 24px "Courier New", monospace',l.textAlign="center";for(let m=0;m<40;m++){const t=Math.floor(27*Math.random())*o+20,e=Math.floor(27*Math.random())*o+20;l.fillText("+",t,e)}l.fillStyle="#FFD700",l.font='bold 70px "Courier New", monospace',l.textAlign="center",l.shadowColor="#FFD700",l.shadowBlur=30,l.fillText("X-SHEEP",540,100),l.shadowBlur=0;const n=["ü¶Å","üê∫","üêâ","üëø","üíÄ","ü¶à"],r=n[Math.floor(Math.random()*n.length)];l.font="100px Arial",l.fillText(r,200,280),l.fillStyle="#FF6B6B";for(let m=0;m<3;m++){const t=320+40*m;l.fillRect(t,240,30,16),l.fillRect(t+30,232,16,32)}l.fillText("üêë",540,280),l.fillStyle="rgba(135, 206, 235, 0.5)";for(let m=0;m<5;m++){const t=650+30*m,e=40-6*m;l.fillRect(t,230+10*m,e,8)}l.font="100px Arial",l.fillText("üèÜ",540,420),l.strokeStyle="#FFD700",l.lineWidth=6;const h=140;l.strokeRect(470,340,h,h),l.strokeRect(462,332,156,156),l.fillStyle="#FFD700",l.font='bold 40px "Courier New", monospace',l.textAlign="center",l.fillText(e.hope,540,540),l.fillStyle="rgba(255, 215, 0, 0.2)",l.fillRect(340,555,400,40),l.fillStyle="#87CEEB",l.font='bold 24px "Courier New", monospace',l.fillText(this.getObstacleLabel(t),540,582),l.strokeStyle="#FFD700",l.lineWidth=6;const c=630,d=920;l.strokeRect(80,c,d,300),l.strokeRect(90,640,900,280),l.fillStyle="rgba(10, 14, 39, 0.9)",l.fillRect(90,640,900,280),l.fillStyle="#FFFFFF",l.font='22px "Courier New", monospace',l.textAlign="left";const u=e.text.split(" ");let f="",g=685;for(let m=0;m<u.length;m++){const t=f+u[m]+" ";l.measureText(t).width>840&&m>0?(l.fillText(f,120,g),f=u[m]+" ",g+=32):f=t}l.fillText(f,120,g),l.fillStyle="rgba(255, 215, 0, 0.3)",l.fillRect(420,960,240,50),l.fillStyle="#FFD700",l.font='bold 36px "Courier New", monospace',l.textAlign="center",l.fillText(`+${i.xp} XP`,540,995),l.fillStyle="#87CEEB",l.font='20px "Courier New", monospace',l.fillText(p.t("trophies.by"),540,1050),s.toBlob(e=>{const i=URL.createObjectURL(e),s=document.createElement("a");s.download=`xsheep-trophee-${t}.png`,s.href=i,s.click(),URL.revokeObjectURL(i)})}renderTrophies(){var t,e;let i="";for(const[s,l]of Object.entries(A)){if("finalDialogue"===s)continue;const a=this.trophies.get(s),o=void 0!==a,n=(null==(e=null==(t=null==p?void 0:p.translations)?void 0:t.narrative)?void 0:e[s])||l;i+=`\n                <div style="\n                    background:${o?"linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,165,0,0.15))":"rgba(50,50,50,0.5)"};\n                    border:2px solid ${o?"#FFD700":"#666"};\n                    border-radius:15px;\n                    padding:20px;\n                    position:relative;\n                    ${o?"":"filter:grayscale(1);opacity:0.6;"}\n                ">\n                    <div style="display:flex;align-items:center;margin-bottom:10px">\n                        <span style="font-size:32px;margin-right:10px">${o?"üèÜ":"üîí"}</span>\n                        <div style="flex:1">\n                            <h3 style="color:${o?"#FFD700":"#888"};margin:0;font-size:18px">\n                                ${n.hope}\n                            </h3>\n                            <p style="color:#AAA;font-size:12px;margin:5px 0">\n                                ${this.getObstacleLabel(s)}\n                            </p>\n                        </div>\n                        ${o?`<span style="color:#FFD700;font-weight:bold">+${a.xp} XP</span>`:""}\n                    </div>\n                    \n                    ${o?`\n                        <div style="\n                            background:rgba(0,0,0,0.3);\n                            padding:15px;\n                            border-radius:10px;\n                            border-left:3px solid #FFD700;\n                            margin-top:10px;\n                        ">\n                            <p style="color:#FFF;line-height:1.6;margin:0;font-size:14px">\n                                ${n.text}\n                            </p>\n                        </div>\n                        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">\n                            <p style="color:#666;font-size:11px;margin:0">\n                                ${p.t("trophies.unlockedOn")} ${new Date(a.unlockedAt).toLocaleDateString("en"===p.currentLang?"en-US":"fr-FR")}\n                            </p>\n                            <button onclick="window.shareTrophy('${s}')" style="\n                                background:linear-gradient(135deg,#FFD700,#FFA500);\n                                border:none;\n                                padding:8px 15px;\n                                border-radius:8px;\n                                font-size:12px;\n                                font-weight:bold;\n                                color:#333;\n                                cursor:pointer;\n                                box-shadow:0 2px 5px rgba(0,0,0,0.3);\n                            ">${p.t("trophies.shareButton")}</button>\n                        </div>\n                    `:`\n                        <p style="color:#666;font-style:italic;margin:10px 0 0 0">\n                            ${p.t("trophies.lockedMessage")}\n                        </p>\n                    `}\n                </div>\n            `}return i}getObstacleLabel(t){if(p&&p.translations&&p.translations.trophies&&p.translations.trophies.labels)return p.translations.trophies.labels[t]||t;return{wheelchair:"‚ôø Fauteuil Roulant",car_accident:"üöó Accident",coffin:"‚ö∞Ô∏è Cercueil",safe:"üè¶ Coffre-Fort",house:"üè† Maison Bris√©e",wolf:"üê∫ Loup",black_sheep:"üêë Mouton Noir",addiction:"üì¶ Addiction",death:"üíÄ Mort",cancer:"üéóÔ∏è Cancer",nuclear:"‚ò¢Ô∏è Reaction antiNucl√©aire",meteor:"‚òÑÔ∏è M√©t√©orite",procrastination:"‚è∞ Procrastination",anger:"üò° Col√®re",madness:"üåÄ Folie",avarice:"üí∞ Avarice",luxure:"üíã Luxure",nepotisme:"ü§ù N√©potisme",selection:"üë• S√©lection",esclavage:"‚õìÔ∏è Esclavage",surexploitation:"üè≠ Surexploitation",white_sheep:"üêë‚ú® Mouton Blanc - La Gr√¢ce",charity:"üíù Charit√©",gold_coin:"üí∞ Pi√®ce d'Or - Libert√©",grace:"‚úùÔ∏è La Gr√¢ce - J√©sus",impatient:"‚è∞üíî Horloge bris√©e - Ma√Ætre du temps",eagle:"ü¶Ö Aigle",thunder:"‚ö° Foudre",disco_ball:"ü™© Boule Disco",pizza:"üçï Pizza",trampoline:"ü§∏ Trampoline",banana:"üçå Banane",magnet:"üß≤ Aimant",balloon:"üéà Ballon",tornado:"üå™Ô∏è Tornade",rocket:"üöÄ Fus√©e"}[t]||"Obstacle"}getTotalXP(){return this.totalXP}getProgress(){const t=Object.keys(A).filter(t=>"finalDialogue"!==t).length;return{unlocked:this.trophies.size,total:t,percentage:t>0?Math.round(this.trophies.size/t*100):0}}}class D{constructor(){this.particles=[],this.maxParticles=30,this.lastParticleTime=0,this.particleCooldown=180}add(t,e,i,s="#FFD700",l=0,a=-3){const o=Date.now();o-this.lastParticleTime<16.67*this.particleCooldown||(this.lastParticleTime=o,this.particles.length>=this.maxParticles&&this.particles.shift(),this.particles.push({x:t,y:e,text:i,color:s,life:60,velX:l||4*(Math.random()-.5),velY:a}))}update(){for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.x+=e.velX,e.y+=e.velY,e.life--,e.life<=0&&this.particles.splice(t,1)}}render(t){this.update(),this.particles.forEach(e=>{const i=e.life/60;t.fillStyle=e.color,t.globalAlpha=i,t.font="16px Arial",t.textAlign="center",t.fillText(e.text,e.x,e.y),t.globalAlpha=1})}clear(){this.particles=[]}}class z{static setupContext(t){t.imageSmoothingEnabled=!1,t.lineJoin="miter",t.lineCap="square"}static drawGlow(t,e,i,s,l,a=.6){const o=t.createRadialGradient(e,i,0,e,i,s);o.addColorStop(0,l.replace(")",`, ${a})`).replace("rgb","rgba")),o.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=o,t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.fill()}static drawWheelchair(t,e,i){t.save(),t.fillStyle="#4169E1",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e+8,i+28,8,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#2F4F7F",t.lineWidth=1,t.beginPath(),t.arc(e+8,i+28,4,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#4169E1",t.lineWidth=2,t.beginPath(),t.arc(e+32,i+28,8,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#2F4F7F",t.lineWidth=1,t.beginPath(),t.arc(e+32,i+28,4,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#5B9BD5",t.strokeStyle="#FFF",t.lineWidth=2,t.fillRect(e+10,i+8,3,18),t.strokeRect(e+10,i+8,3,18),t.fillRect(e+10,i+8,12,3),t.strokeRect(e+10,i+8,12,3),t.fillStyle="#4169E1",t.fillRect(e+5,i+20,30,3),t.strokeRect(e+5,i+20,30,3),t.restore()}static drawCarAccident(t,e,i){t.save(),t.fillStyle="#DC143C",t.strokeStyle="#FFF",t.lineWidth=2,t.fillRect(e,i+18,40,15),t.strokeRect(e,i+18,40,15),t.fillStyle="#B22222",t.fillRect(e+8,i+8,24,12),t.strokeRect(e+8,i+8,24,12),t.fillStyle="#333",t.beginPath(),t.arc(e+10,i+33,5,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.arc(e+30,i+33,5,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#000",t.lineWidth=2,t.beginPath(),t.moveTo(e+5,i+10),t.lineTo(e+15,i+18),t.stroke(),t.beginPath(),t.moveTo(e+10,i+10),t.lineTo(e+20,i+16),t.stroke(),t.restore()}static drawCoffin(t,e,i){t.save(),t.fillStyle="#2F4F4F",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.moveTo(e+10,i+5),t.lineTo(e+30,i+5),t.lineTo(e+35,i+25),t.lineTo(e+25,i+40),t.lineTo(e+15,i+40),t.lineTo(e+5,i+25),t.closePath(),t.fill(),t.stroke(),t.strokeStyle="#FFD700",t.lineWidth=3,t.beginPath(),t.moveTo(e+20,i+12),t.lineTo(e+20,i+28),t.stroke(),t.beginPath(),t.moveTo(e+14,i+20),t.lineTo(e+26,i+20),t.stroke(),t.fillStyle="rgba(0,0,0,0.3)",t.beginPath(),t.moveTo(e+12,i+10),t.lineTo(e+28,i+10),t.lineTo(e+32,i+24),t.lineTo(e+24,i+35),t.lineTo(e+16,i+35),t.lineTo(e+8,i+24),t.closePath(),t.fill(),t.restore()}static drawSafe(t,e,i){t.save(),t.fillStyle="#8B4513",t.strokeStyle="#FFF",t.lineWidth=2,t.fillRect(e+5,i+10,35,30),t.strokeRect(e+5,i+10,35,30),t.fillStyle="#A0522D",t.lineWidth=1,t.fillRect(e+8,i+13,29,24),t.strokeRect(e+8,i+13,29,24),t.fillStyle="#FFD700",t.lineWidth=2,t.beginPath(),t.arc(e+25,i+25,6,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#DAA520",t.beginPath(),t.arc(e+25,i+25,3,0,2*Math.PI),t.fill(),t.fillStyle="#696969",t.lineWidth=1,t.fillRect(e+6,i+15,3,5),t.strokeRect(e+6,i+15,3,5),t.fillRect(e+6,i+30,3,5),t.strokeRect(e+6,i+30,3,5),t.restore()}static drawBrokenHouse(t,e,i){t.save(),t.fillStyle="#800080",t.strokeStyle="#FFF",t.lineWidth=2,t.fillRect(e+5,i+20,35,20),t.strokeRect(e+5,i+20,35,20),t.fillStyle="#9932CC",t.beginPath(),t.moveTo(e,i+20),t.lineTo(e+22.5,i+5),t.lineTo(e+45,i+20),t.closePath(),t.fill(),t.stroke(),t.strokeStyle="#000",t.lineWidth=3,t.beginPath(),t.moveTo(e+22,i+5),t.lineTo(e+25,i+15),t.lineTo(e+20,i+25),t.lineTo(e+22,i+40),t.stroke(),t.fillStyle="#4B0082",t.strokeStyle="#FFF",t.lineWidth=1,t.fillRect(e+16,i+28,8,12),t.strokeRect(e+16,i+28,8,12),t.fillStyle="#000",t.fillRect(e+28,i+25,8,8),t.strokeRect(e+28,i+25,8,8),t.strokeStyle="#FFF",t.beginPath(),t.moveTo(e+28,i+25),t.lineTo(e+36,i+33),t.stroke(),t.restore()}static drawDeath(t,e,i){t.save(),t.fillStyle="#EFEFEF",t.strokeStyle="#000",t.lineWidth=2,t.beginPath(),t.ellipse(e+20,i+20,12,14,0,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#000",t.beginPath(),t.ellipse(e+15,i+18,3,5,0,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(e+25,i+18,3,5,0,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(e+20,i+22),t.lineTo(e+18,i+26),t.lineTo(e+22,i+26),t.closePath(),t.fill(),t.fillStyle="#FFF",t.strokeStyle="#000",t.lineWidth=1,t.fillRect(e+14,i+28,4,3),t.strokeRect(e+14,i+28,4,3),t.fillRect(e+18,i+28,4,3),t.strokeRect(e+18,i+28,4,3),t.fillRect(e+22,i+28,4,3),t.strokeRect(e+22,i+28,4,3),t.restore()}static drawCancerRibbon(t,e,i){t.save(),t.fillStyle="#FF1493",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.moveTo(e+15,i+10),t.quadraticCurveTo(e+20,i+15,e+15,i+30),t.quadraticCurveTo(e+10,i+25,e+15,i+10),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e+25,i+10),t.quadraticCurveTo(e+20,i+15,e+25,i+30),t.quadraticCurveTo(e+30,i+25,e+25,i+10),t.fill(),t.stroke(),t.fillStyle="#FF69B4",t.beginPath(),t.arc(e+20,i+15,6,0,2*Math.PI),t.fill(),t.strokeStyle="#FFF",t.lineWidth=2,t.stroke(),t.restore()}static drawNuclear(t,e,i){t.save(),t.fillStyle="#32CD32",t.strokeStyle="#000",t.lineWidth=2,t.beginPath(),t.arc(e+20,i+20,15,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#000",t.beginPath(),t.arc(e+20,i+20,4,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(e+20,i+20),t.lineTo(e+20,i+6),t.lineTo(e+14,i+12),t.closePath(),t.fill(),t.beginPath(),t.moveTo(e+20,i+20),t.lineTo(e+33,i+28),t.lineTo(e+28,i+22),t.closePath(),t.fill(),t.beginPath(),t.moveTo(e+20,i+20),t.lineTo(e+7,i+28),t.lineTo(e+12,i+22),t.closePath(),t.fill(),t.restore()}static drawMeteor(t,e,i){t.save(),t.strokeStyle="#FFA500",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(e+10,i+15),t.quadraticCurveTo(e+8,i+10,e+12,i+8),t.stroke(),t.strokeStyle="#FF4500",t.beginPath(),t.moveTo(e+8,i+20),t.quadraticCurveTo(e+5,i+18,e+8,i+15),t.stroke(),t.strokeStyle="#FFD700",t.lineWidth=2,t.beginPath(),t.moveTo(e+12,i+25),t.quadraticCurveTo(e+10,i+23,e+12,i+20),t.stroke(),t.fillStyle="#FF6347",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e+25,i+20,12,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#8B0000",t.beginPath(),t.arc(e+22,i+18,4,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(e+28,i+23,3,0,2*Math.PI),t.fill(),t.restore()}static drawAnger(t,e,i){t.save(),t.fillStyle="#FF4500",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e+20,i+20,15,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#000",t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(e+12,i+14),t.lineTo(e+16,i+16),t.stroke(),t.beginPath(),t.moveTo(e+28,i+14),t.lineTo(e+24,i+16),t.stroke(),t.fillStyle="#000",t.beginPath(),t.arc(e+14,i+18,2,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(e+26,i+18,2,0,2*Math.PI),t.fill(),t.strokeStyle="#000",t.lineWidth=2,t.beginPath(),t.moveTo(e+12,i+26),t.quadraticCurveTo(e+20,i+30,e+28,i+26),t.stroke(),t.restore()}static drawWolf(t,e,i){t.save(),t.fillStyle="#696969",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.ellipse(e+20,i+22,14,12,0,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e+10,i+15),t.lineTo(e+12,i+8),t.lineTo(e+15,i+12),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e+30,i+15),t.lineTo(e+28,i+8),t.lineTo(e+25,i+12),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#505050",t.lineWidth=1,t.beginPath(),t.ellipse(e+20,i+26,8,6,0,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FF0000",t.beginPath(),t.arc(e+16,i+20,3,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(e+24,i+20,3,0,2*Math.PI),t.fill(),t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.moveTo(e+15,i+28),t.lineTo(e+15,i+32),t.stroke(),t.beginPath(),t.moveTo(e+25,i+28),t.lineTo(e+25,i+32),t.stroke(),t.restore()}static drawBlackSheep(t,e,i){t.save();const s=.005*Date.now(),l=3*Math.sin(s),a=3*Math.sin(s+Math.PI);t.translate(e+17.5,i+20),t.scale(-1,1),t.translate(-17.5,-20),t.fillStyle="#000",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.ellipse(22,25,12,10,0,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.arc(32,18,8,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFF",t.beginPath(),t.arc(30,17,2,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(35,17,2,0,2*Math.PI),t.fill(),t.fillStyle="#333",t.strokeStyle="#FFF",t.lineWidth=1,t.fillRect(16+l,32,3,8),t.strokeRect(16+l,32,3,8),t.fillRect(27+a,32,3,8),t.strokeRect(27+a,32,3,8),t.restore()}static drawAddictionBox(t,e,i){t.save(),t.fillStyle="#4B0082",t.strokeStyle="#FFF",t.lineWidth=2,t.fillRect(e+8,i+15,25,25),t.strokeRect(e+8,i+15,25,25),t.fillStyle="#6A5ACD",t.lineWidth=1,t.fillRect(e+11,i+18,19,19),t.strokeRect(e+11,i+18,19,19),t.fillStyle="#696969",t.beginPath(),t.arc(e+12,i+20,2,0,2*Math.PI),t.fill(),t.strokeStyle="#FFF",t.stroke(),t.beginPath(),t.arc(e+30,i+20,2,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#696969",t.lineWidth=2,t.beginPath(),t.moveTo(e+12,i+20),t.lineTo(e+30,i+20),t.stroke(),t.strokeStyle="#FF0000",t.lineWidth=3,t.beginPath(),t.moveTo(e+15,i+22),t.lineTo(e+27,i+34),t.stroke(),t.beginPath(),t.moveTo(e+27,i+22),t.lineTo(e+15,i+34),t.stroke(),t.restore()}static drawCourage(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(255,215,0)",.6),t.fillStyle="#FFD700",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFA500",t.beginPath(),t.arc(e,i,10,0,2*Math.PI),t.fill(),t.strokeStyle="#FFF",t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(e-5,i-2),t.quadraticCurveTo(e-2,i-5,e,i-2),t.quadraticCurveTo(e+2,i-5,e+5,i-2),t.stroke(),t.fillStyle="#FFF",t.beginPath(),t.arc(e,i+3,3,0,2*Math.PI),t.fill(),t.restore()}static drawForce(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(255,99,71)",.6),t.fillStyle="#FF6347",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#FFD700",t.lineWidth=3,t.lineJoin="bevel",t.beginPath(),t.moveTo(e+2,i-10),t.lineTo(e-4,i),t.lineTo(e+2,i),t.lineTo(e-2,i+10),t.stroke(),t.restore()}static drawPatience(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(135,206,235)",.6),t.fillStyle="#87CEEB",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,8,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e,i),t.lineTo(e,i-6),t.stroke(),t.beginPath(),t.moveTo(e,i),t.lineTo(e+4,i+2),t.stroke(),t.restore()}static drawResilience(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(50,205,50)",.6),t.fillStyle="#32CD32",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.moveTo(e,i-8),t.lineTo(e+6,i-4),t.lineTo(e+6,i+4),t.lineTo(e,i+8),t.lineTo(e-6,i+4),t.lineTo(e-6,i-4),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(e,i-5),t.lineTo(e,i+5),t.stroke(),t.beginPath(),t.moveTo(e-4,i),t.lineTo(e+4,i),t.stroke(),t.restore()}static drawLiberte(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(135,206,250)",.6),t.fillStyle="#87CEFA",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFF",t.beginPath(),t.ellipse(e,i,6,4,0,0,2*Math.PI),t.fill(),t.strokeStyle="#FFF",t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(e-6,i-2),t.quadraticCurveTo(e-10,i-2,e-12,i),t.stroke(),t.beginPath(),t.moveTo(e+6,i-2),t.quadraticCurveTo(e+10,i-2,e+12,i),t.stroke(),t.restore()}static drawAgir(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(255,69,0)",.6),t.fillStyle="#FF4500",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFF",t.beginPath(),t.moveTo(e,i-10),t.lineTo(e-4,i+2),t.lineTo(e,i),t.lineTo(e+4,i+2),t.closePath(),t.fill(),t.fillStyle="#FFD700",t.beginPath(),t.arc(e-2,i+6,2,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(e+2,i+6,2,0,2*Math.PI),t.fill(),t.restore()}static drawSeBattre(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(139,0,0)",.6),t.fillStyle="#8B0000",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFF",t.fillRect(e-2,i-8,4,16),t.strokeRect(e-2,i-8,4,16),t.fillStyle="#FFD700",t.fillRect(e-6,i-10,12,3),t.strokeRect(e-6,i-10,12,3),t.beginPath(),t.arc(e,i-8,2,0,2*Math.PI),t.fill(),t.restore()}static drawPerseverer(t,e,i){t.save(),this.drawGlow(t,e,i,25,"rgb(30,144,255)",.6),t.fillStyle="#1E90FF",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e,i,14,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.moveTo(e-8,i+8),t.lineTo(e,i-8),t.lineTo(e+8,i+8),t.stroke(),t.fillStyle="#FFD700",t.beginPath(),t.arc(e,i-6,2,0,2*Math.PI),t.fill(),t.restore()}static drawEtoileEspoir(t,e,i){t.save(),this.drawGlow(t,e,i,30,"rgb(255,215,0)",.8),t.fillStyle="#FFD700",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath();const s=[[0,-10],[3,-2],[12,-2],[5,4],[8,12],[0,7],[-8,12],[-5,4],[-12,-2],[-3,-2]];t.moveTo(e+s[0][0],i+s[0][1]);for(let a=1;a<s.length;a++)t.lineTo(e+s[a][0],i+s[a][1]);t.closePath(),t.fill(),t.stroke(),t.fillStyle="#FFA500",t.beginPath();const l=[[0,-3],[2,-1],[7,-1],[3,2],[5,7],[0,4],[-5,7],[-3,2],[-7,-1],[-2,-1]];t.moveTo(e+l[0][0],i+l[0][1]);for(let a=1;a<l.length;a++)t.lineTo(e+l[a][0],i+l[a][1]);t.closePath(),t.fill(),t.restore()}static renderObstacle(t,e){const i=e.x+e.width/2,s=e.y+e.height/2;switch(e.id){case"wheelchair":this.drawWheelchair(t,e.x,e.y);break;case"car_accident":this.drawCarAccident(t,e.x,e.y);break;case"coffin":this.drawCoffin(t,e.x,e.y);break;case"safe":this.drawSafe(t,e.x,e.y);break;case"house":this.drawBrokenHouse(t,e.x,e.y);break;case"wolf":this.drawWolf(t,e.x,e.y);break;case"black_sheep":this.drawBlackSheep(t,e.x,e.y);break;case"addiction":this.drawAddictionBox(t,e.x,e.y);break;case"death":this.drawDeath(t,e.x,e.y);break;case"cancer":this.drawCancerRibbon(t,e.x,e.y);break;case"nuclear":this.drawNuclear(t,e.x,e.y);break;case"meteor":this.drawMeteor(t,e.x,e.y);break;case"anger":this.drawAnger(t,e.x,e.y);break;default:t.font="30px Arial",t.textAlign="center",t.textBaseline="middle",t.fillStyle="rgba(0,0,0,0.3)",t.fillText(e.icon||"?",i+2,s+2),t.fillStyle=e.color||"#666",t.fillText(e.icon||"?",i,s)}"ground"!==e.type&&"richness"!==e.type||!e.text||(t.save(),t.font="bold 14px Arial",t.textAlign="center",t.textBaseline="bottom",t.strokeStyle="#FFFFFF",t.lineWidth=3,t.strokeText(e.text,i,e.y-3),t.fillStyle="#000000",t.fillText(e.text,i,e.y-3),t.restore())}static renderPowerUp(t,e){switch(e.id){case"courage":this.drawCourage(t,e.x,e.y);break;case"force":this.drawForce(t,e.x,e.y);break;case"patience":this.drawPatience(t,e.x,e.y);break;case"resilience":this.drawResilience(t,e.x,e.y);break;case"assurance":this.drawGlow(t,e.x,e.y,25,"rgb(218,160,221)",.6),t.fillStyle="#DDA0DD",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFD700",t.strokeStyle="#FFF",t.lineWidth=1;for(let i=0;i<5;i++){const s=i*Math.PI*2/5-Math.PI/2,l=e.x+6*Math.cos(s),a=e.y+6*Math.sin(s)-3;t.beginPath(),t.arc(l,a,2,0,2*Math.PI),t.fill(),t.stroke()}break;case"liberte":this.drawLiberte(t,e.x,e.y);break;case"controle":this.drawGlow(t,e.x,e.y,25,"rgb(255,105,180)",.6),t.fillStyle="#FF69B4",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,14,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#FFF",t.lineWidth=2;for(let i=3;i<=9;i+=3)t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),t.stroke();break;case"sagesse":this.drawGlow(t,e.x,e.y,25,"rgb(184,134,11)",.6),t.fillStyle="#B8860B",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFF",t.beginPath(),t.ellipse(e.x,e.y,6,4,0,0,2*Math.PI),t.fill(),t.fillStyle="#000",t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI),t.fill();break;case"gestion":this.drawGlow(t,e.x,e.y,25,"rgb(75,0,130)",.6),t.fillStyle="#4B0082",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,14,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.moveTo(e.x-8,e.y),t.lineTo(e.x+8,e.y),t.stroke(),t.beginPath(),t.moveTo(e.x,e.y-6),t.lineTo(e.x,e.y+6),t.stroke();break;case"agir":this.drawAgir(t,e.x,e.y);break;case"se_battre":this.drawSeBattre(t,e.x,e.y);break;case"ne_pas_abandonner":this.drawGlow(t,e.x,e.y,25,"rgb(46,139,87)",.6),t.fillStyle="#2E8B57",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,14,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFD700",t.fillRect(e.x-4,e.y,8,6),t.strokeRect(e.x-4,e.y,8,6),t.strokeStyle="#FFD700",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y-2,4,Math.PI,0,!0),t.stroke();break;case"perseverer":this.drawPerseverer(t,e.x,e.y);break;case"espoir":this.drawEtoileEspoir(t,e.x,e.y);break;default:this.drawGlow(t,e.x,e.y,25,"rgb(255,215,0)",.6),t.fillStyle=e.color||"#FFD700",t.strokeStyle="#FFF",t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,14,0,2*Math.PI),t.fill(),t.stroke(),t.font="16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#FFF",t.fillText(e.icon||"‚ú®",e.x,e.y)}}}class L{constructor(){this.cache=new Map,this.blockSize=2}getIcon(t,e=32){const i=`${t}_${e}`;return this.cache.has(i)||this.cache.set(i,this.createIcon(t,e)),this.cache.get(i)}createIcon(t,e){const i=document.createElement("canvas");i.width=e,i.height=e;const s=i.getContext("2d");switch(t){case"‚ôø":this.drawWheelchair(s,e);break;case"üöó":this.drawCar(s,e);break;case"‚ö∞Ô∏è":this.drawCoffin(s,e);break;case"üè¶":this.drawSafe(s,e);break;case"üè†":this.drawHouse(s,e);break;case"üê∫":this.drawWolf(s,e);break;case"üêë":this.drawSheep(s,e);break;case"üì¶":this.drawBox(s,e);break;case"üíÄ":this.drawSkull(s,e);break;case"üéóÔ∏è":this.drawRibbon(s,e);break;case"‚ò¢Ô∏è":this.drawRadiation(s,e);break;case"‚òÑÔ∏è":this.drawMeteor(s,e);break;case"‚è∞":this.drawClock(s,e);break;case"üò°":this.drawAngry(s,e);break;case"üåÄ":this.drawSpiral(s,e);break;case"üí∞":this.drawMoneyBag(s,e);break;case"üíã":this.drawLips(s,e);break;case"ü§ù":this.drawHandshake(s,e);break;case"üë•":this.drawPeople(s,e);break;case"‚õìÔ∏è":this.drawChain(s,e);break;case"üè≠":this.drawFactory(s,e);break;case"üíß":this.drawWater(s,e);break;case"üêü":this.drawFish(s,e);break;default:this.drawDefault(s,e,t)}return i}drawPixel(t,e,i,s,l=2){t.fillStyle=s,t.fillRect(e*l,i*l,l,l)}drawWheelchair(t,e){const i=this.blockSize;this.drawPixel(t,3,10,"#666",i),this.drawPixel(t,4,9,"#666",i),this.drawPixel(t,5,9,"#666",i),this.drawPixel(t,6,10,"#666",i),this.drawPixel(t,4,11,"#666",i),this.drawPixel(t,5,11,"#666",i),this.drawPixel(t,5,7,"#888",i),this.drawPixel(t,6,7,"#888",i),this.drawPixel(t,7,7,"#888",i),this.drawPixel(t,7,8,"#888",i),this.drawPixel(t,7,9,"#888",i),this.drawPixel(t,8,5,"#888",i),this.drawPixel(t,8,6,"#888",i),this.drawPixel(t,8,7,"#888",i)}drawCar(t,e){const i=this.blockSize;for(let s=3;s<10;s++)this.drawPixel(t,s,8,"#FF0000",i),this.drawPixel(t,s,9,"#FF0000",i);for(let s=4;s<9;s++)this.drawPixel(t,s,7,"#CC0000",i);this.drawPixel(t,5,7,"#87CEEB",i),this.drawPixel(t,7,7,"#87CEEB",i),this.drawPixel(t,4,10,"#000",i),this.drawPixel(t,8,10,"#000",i)}drawCoffin(t,e){const i=this.blockSize;for(let s=4;s<11;s++){const e=s<7?4:6,l=s<7?5:4;for(let a=0;a<e;a++)this.drawPixel(t,l+a,s,"#8B4513",i)}this.drawPixel(t,6,6,"#FFD700",i),this.drawPixel(t,5,7,"#FFD700",i),this.drawPixel(t,6,7,"#FFD700",i),this.drawPixel(t,7,7,"#FFD700",i)}drawSafe(t,e){const i=this.blockSize;for(let s=5;s<11;s++)for(let e=4;e<10;e++)this.drawPixel(t,e,s,"#666",i);for(let s=6;s<10;s++)for(let e=5;e<9;e++)this.drawPixel(t,e,s,"#888",i);this.drawPixel(t,7,8,"#FFD700",i),this.drawPixel(t,8,8,"#FFD700",i)}drawHouse(t,e){const i=this.blockSize;for(let s=7;s<11;s++)for(let e=4;e<10;e++)this.drawPixel(t,e,s,"#CD853F",i);this.drawPixel(t,6,5,"#8B0000",i),this.drawPixel(t,7,5,"#8B0000",i);for(let s=5;s<9;s++)this.drawPixel(t,s,6,"#8B0000",i);for(let s=4;s<10;s++)this.drawPixel(t,s,7,"#8B0000",i);this.drawPixel(t,6,9,"#654321",i),this.drawPixel(t,6,10,"#654321",i)}drawWolf(t,e){const i=this.blockSize,s="#808080";for(let l=4;l<9;l++)this.drawPixel(t,l,8,s,i),this.drawPixel(t,l,9,s,i);this.drawPixel(t,8,6,s,i),this.drawPixel(t,9,7,s,i),this.drawPixel(t,9,8,s,i),this.drawPixel(t,8,5,s,i),this.drawPixel(t,10,6,s,i),this.drawPixel(t,9,7,"#FF0000",i),this.drawPixel(t,5,10,s,i),this.drawPixel(t,7,10,s,i)}drawSheep(t,e){const i=this.blockSize;for(let s=7;s<10;s++)for(let e=4;e<8;e++)this.drawPixel(t,e,s,"#FFF",i);this.drawPixel(t,8,7,"#000",i),this.drawPixel(t,8,8,"#000",i),this.drawPixel(t,4,10,"#000",i),this.drawPixel(t,7,10,"#000",i)}drawBox(t,e){const i=this.blockSize;for(let s=6;s<11;s++)for(let e=4;e<10;e++)this.drawPixel(t,e,s,"#8B4513",i);for(let s=4;s<10;s++)this.drawPixel(t,s,8,"#D2691E",i);this.drawPixel(t,7,6,"#D2691E",i),this.drawPixel(t,7,7,"#D2691E",i),this.drawPixel(t,7,9,"#D2691E",i),this.drawPixel(t,7,10,"#D2691E",i)}drawSkull(t,e){const i=this.blockSize;for(let s=5;s<9;s++)for(let e=5;e<9;e++)this.drawPixel(t,e,s,"#FFF",i);this.drawPixel(t,5,6,"#000",i),this.drawPixel(t,8,6,"#000",i),this.drawPixel(t,7,7,"#000",i);for(let s=5;s<9;s++)this.drawPixel(t,s,9,"#FFF",i);this.drawPixel(t,6,10,"#FFF",i),this.drawPixel(t,7,10,"#FFF",i)}drawRibbon(t,e){const i=this.blockSize,s="#FFB6C1";this.drawPixel(t,5,5,s,i),this.drawPixel(t,6,5,s,i),this.drawPixel(t,7,5,s,i),this.drawPixel(t,8,5,s,i),this.drawPixel(t,5,6,s,i),this.drawPixel(t,8,6,s,i),this.drawPixel(t,5,7,s,i),this.drawPixel(t,8,7,s,i),this.drawPixel(t,6,7,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,6,8,s,i),this.drawPixel(t,7,8,s,i),this.drawPixel(t,5,9,s,i),this.drawPixel(t,8,9,s,i),this.drawPixel(t,4,10,s,i),this.drawPixel(t,9,10,s,i)}drawRadiation(t,e){const i=this.blockSize,s="#FFFF00";this.drawPixel(t,6,7,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,6,8,s,i),this.drawPixel(t,7,8,s,i),this.drawPixel(t,6,5,s,i),this.drawPixel(t,7,5,s,i),this.drawPixel(t,4,9,s,i),this.drawPixel(t,5,10,s,i),this.drawPixel(t,9,9,s,i),this.drawPixel(t,8,10,s,i)}drawMeteor(t,e){const i=this.blockSize;this.drawPixel(t,7,5,"#8B4513",i),this.drawPixel(t,6,6,"#8B4513",i),this.drawPixel(t,7,6,"#8B4513",i),this.drawPixel(t,8,6,"#8B4513",i),this.drawPixel(t,7,7,"#8B4513",i),this.drawPixel(t,5,7,"#FF6600",i),this.drawPixel(t,4,8,"#FF6600",i),this.drawPixel(t,3,9,"#FFD700",i),this.drawPixel(t,2,10,"#FFD700",i)}drawClock(t,e){const i=this.blockSize;for(let s=6;s<10;s++)for(let e=5;e<9;e++)this.drawPixel(t,e,s,"#FFF",i);this.drawPixel(t,4,6,"#000",i),this.drawPixel(t,4,9,"#000",i),this.drawPixel(t,9,6,"#000",i),this.drawPixel(t,9,9,"#000",i),this.drawPixel(t,7,7,"#000",i),this.drawPixel(t,7,8,"#000",i),this.drawPixel(t,8,8,"#000",i)}drawAngry(t,e){const i=this.blockSize;for(let s=5;s<10;s++)for(let e=5;e<9;e++)this.drawPixel(t,e,s,"#FF6B6B",i);this.drawPixel(t,5,6,"#000",i),this.drawPixel(t,6,5,"#000",i),this.drawPixel(t,8,6,"#000",i),this.drawPixel(t,7,5,"#000",i),this.drawPixel(t,5,7,"#000",i),this.drawPixel(t,8,7,"#000",i),this.drawPixel(t,6,9,"#000",i),this.drawPixel(t,7,9,"#000",i)}drawSpiral(t,e){const i=this.blockSize,s="#4169E1";this.drawPixel(t,7,5,s,i),this.drawPixel(t,6,6,s,i),this.drawPixel(t,7,6,s,i),this.drawPixel(t,8,6,s,i),this.drawPixel(t,5,7,s,i),this.drawPixel(t,8,7,s,i),this.drawPixel(t,5,8,s,i),this.drawPixel(t,6,8,s,i),this.drawPixel(t,7,8,s,i),this.drawPixel(t,8,8,s,i),this.drawPixel(t,7,9,s,i)}drawMoneyBag(t,e){const i=this.blockSize;for(let s=7;s<11;s++){const e=s<9?4:6,l=s<9?5:4;for(let a=0;a<e;a++)this.drawPixel(t,l+a,s,"#90EE90",i)}this.drawPixel(t,7,8,"#FFD700",i),this.drawPixel(t,6,9,"#FFD700",i),this.drawPixel(t,7,9,"#FFD700",i),this.drawPixel(t,8,9,"#FFD700",i),this.drawPixel(t,7,10,"#FFD700",i)}drawLips(t,e){const i=this.blockSize,s="#FF0000";this.drawPixel(t,5,7,s,i),this.drawPixel(t,6,6,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,8,6,s,i),this.drawPixel(t,9,7,s,i),this.drawPixel(t,5,8,s,i),this.drawPixel(t,6,9,s,i),this.drawPixel(t,7,9,s,i),this.drawPixel(t,8,9,s,i),this.drawPixel(t,9,8,s,i)}drawHandshake(t,e){const i=this.blockSize,s="#FFD7A8";this.drawPixel(t,4,7,s,i),this.drawPixel(t,5,7,s,i),this.drawPixel(t,5,8,s,i),this.drawPixel(t,8,7,s,i),this.drawPixel(t,9,7,s,i),this.drawPixel(t,8,8,s,i),this.drawPixel(t,6,7,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,6,8,s,i),this.drawPixel(t,7,8,s,i)}drawPeople(t,e){const i=this.blockSize;this.drawPixel(t,5,5,"#FFD7A8",i),this.drawPixel(t,5,6,"#4169E1",i),this.drawPixel(t,5,7,"#4169E1",i),this.drawPixel(t,8,5,"#FFD7A8",i),this.drawPixel(t,8,6,"#FF69B4",i),this.drawPixel(t,8,7,"#FF69B4",i)}drawChain(t,e){const i=this.blockSize,s="#808080";this.drawPixel(t,5,5,s,i),this.drawPixel(t,6,5,s,i),this.drawPixel(t,5,6,s,i),this.drawPixel(t,6,6,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,8,7,s,i),this.drawPixel(t,7,8,s,i),this.drawPixel(t,8,8,s,i),this.drawPixel(t,5,9,s,i),this.drawPixel(t,6,9,s,i),this.drawPixel(t,5,10,s,i),this.drawPixel(t,6,10,s,i)}drawFactory(t,e){const i=this.blockSize;for(let s=7;s<11;s++)for(let e=4;e<9;e++)this.drawPixel(t,e,s,"#666",i);this.drawPixel(t,5,5,"#888",i),this.drawPixel(t,5,6,"#888",i),this.drawPixel(t,7,4,"#888",i),this.drawPixel(t,7,5,"#888",i),this.drawPixel(t,7,6,"#888",i),this.drawPixel(t,5,4,"#AAA",i),this.drawPixel(t,7,3,"#AAA",i)}drawWater(t,e){const i=this.blockSize,s="#00BFFF";this.drawPixel(t,7,5,s,i),this.drawPixel(t,6,6,s,i),this.drawPixel(t,7,6,s,i),this.drawPixel(t,8,6,s,i),this.drawPixel(t,6,7,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,8,7,s,i),this.drawPixel(t,6,8,s,i),this.drawPixel(t,7,8,s,i),this.drawPixel(t,8,8,s,i),this.drawPixel(t,7,9,s,i)}drawFish(t,e){const i=this.blockSize,s="#FFA500";this.drawPixel(t,6,7,s,i),this.drawPixel(t,7,7,s,i),this.drawPixel(t,8,7,s,i),this.drawPixel(t,7,6,s,i),this.drawPixel(t,7,8,s,i),this.drawPixel(t,5,6,s,i),this.drawPixel(t,5,8,s,i),this.drawPixel(t,8,7,"#000",i)}drawDefault(t,e,i){const s=this.blockSize,l=`hsl(${i.charCodeAt(0)%360}, 70%, 50%)`;for(let a=5;a<10;a++)for(let e=5;e<10;e++)this.drawPixel(t,e,a,l,s)}}class O{constructor(t){this.ctx=t,this.blockSize=8,this.sheepBlockSize=5,this.iconCache=new L,this.sheepCache=new Map,this.bubbleCache=new Map,this.obstacleCache=new Map,this.iconSizeCache=new Map}drawCachedIcon(t,e,i,s,l,a){const o=`${e}_${l}_${a}`;if(!this.iconSizeCache.has(o)){const t=document.createElement("canvas");t.width=l,t.height=a;const i=t.getContext("2d");i.clearRect(0,0,l,a);const s=this.blockSize;this.blockSize=Math.max(1,Math.floor(l/6)),this.drawObstacleIcon(i,e,0,0),this.blockSize=s,this.iconSizeCache.set(o,t)}const n=this.iconSizeCache.get(o);t.drawImage(n,i,s)}drawObstacleIcon(t,e,i,s){this.drawObstacleShape(t,i,s,e,null)}drawCube(t,e,i,s,l,a){const o=this.ctx;o.fillStyle=s,o.beginPath(),o.moveTo(t,e),o.lineTo(t+i,e+.5*i),o.lineTo(t,e+i),o.lineTo(t-i,e+.5*i),o.closePath(),o.fill(),o.fillStyle=l,o.beginPath(),o.moveTo(t,e+i),o.lineTo(t+i,e+.5*i),o.lineTo(t+i,e+1.5*i),o.lineTo(t,e+2*i),o.closePath(),o.fill(),o.fillStyle=a,o.beginPath(),o.moveTo(t,e+i),o.lineTo(t-i,e+.5*i),o.lineTo(t-i,e+1.5*i),o.lineTo(t,e+2*i),o.closePath(),o.fill(),o.strokeStyle="rgba(0,0,0,0.3)",o.lineWidth=1,o.stroke()}drawBlock(t,e,i,s){const l=this.ctx;l.fillStyle=s,l.fillRect(t,e,i,i),l.fillStyle=this.darkenColor(s,.3),l.fillRect(t,e+.8*i,i,.2*i),l.fillStyle=this.lightenColor(s,.2),l.fillRect(t,e,i,.2*i),l.strokeStyle="rgba(0,0,0,0.5)",l.lineWidth=2,l.strokeRect(t,e,i,i)}drawVoxelSheep(t,e,i=!1,s=!1){const l=this.sheepBlockSize,a=`${i}_${s}`;if(!this.sheepCache.has(a)){const t=document.createElement("canvas");t.width=16*l,t.height=12*l;const e=t.getContext("2d");this.drawSheepToCanvas(e,0,0,i,s),this.sheepCache.set(a,t)}const o=this.sheepCache.get(a);this.ctx.drawImage(o,t,e),s&&this.drawGoldCoins(t,e)}drawGoldCoins(t,e){const i=this.sheepBlockSize;for(let s=0;s<3;s++){const l=(Date.now()/1e3+2*s)%(2*Math.PI),a=Math.cos(l)*i*3,o=Math.sin(l)*i*2;this.ctx.fillStyle="#FFD700",this.ctx.fillRect(t+8*i+a,e+4*i+o,2*i,2*i),this.ctx.fillStyle="#FFA500",this.ctx.fillRect(t+8.5*i+a,e+4.5*i+o,i,i)}}drawSheepToCanvas(t,e,i,s,l){const a=this.sheepBlockSize;t.fillStyle="#FFFFFF",t.fillRect(e+4*a,i+2*a,8*a,6*a),t.fillRect(e+2*a,i+4*a,4*a,4*a),t.fillRect(e+10*a,i+4*a,4*a,4*a),t.fillRect(e+12*a,i+4*a,4*a,4*a),t.fillRect(e+14*a,i+2*a,2*a,2*a),t.fillStyle="#000000",t.fillRect(e+13*a,i+5*a,a,a),t.fillRect(e+15*a,i+5*a,a,a),t.fillStyle="#000000",t.fillRect(e+4*a,i+8*a,2*a,4*a),t.fillRect(e+8*a,i+8*a,2*a,4*a),s&&(t.fillStyle="#FFD700",t.fillRect(e+a,i+4*a,3*a,a),t.fillRect(e,i+5*a,2*a,2*a),t.fillRect(e+12*a,i+3*a,3*a,a),t.fillRect(e+14*a,i+4*a,2*a,2*a),t.strokeStyle="#FFD700",t.lineWidth=2,t.beginPath(),t.arc(e+14*a,i+a,4*a,0,2*Math.PI),t.stroke())}drawVoxelObstacle(t){const e=this.blockSize,i=t.x,s=t.y,l=t.icon;if(!this.obstacleCache.has(l)){const i=document.createElement("canvas");i.width=6*e,i.height=6*e;const s=i.getContext("2d");this.drawObstacleShape(s,0,0,t.icon,t.color||"#888888"),this.obstacleCache.set(l,i)}const a=this.obstacleCache.get(l);this.ctx.drawImage(a,i,s,6*e,6*e)}drawVoxelBoat(t,e,i,s,l){const a=this.sheepBlockSize;this.ctx.save();const o=16*a,n=6*a;this.ctx.translate(t+o/2,e+n/2),this.ctx.rotate(s),this.ctx.scale(l,l),this.ctx.translate(-(t+o/2),-(e+n/2)),this.ctx.fillStyle="#8B4513",this.ctx.fillRect(t,e+4*a,16*a,2*a),this.ctx.fillRect(t-a,e+3*a,a,3*a),this.ctx.fillRect(t+16*a,e+3*a,a,3*a),this.ctx.fillRect(t-2*a,e+4*a,2*a,a),this.ctx.fillStyle="#654321",this.ctx.fillRect(t+a,e+4*a,14*a,a),this.ctx.fillStyle="#8B4513",this.ctx.fillRect(t+7*a,e-4*a,2*a,8*a),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(t+9*a,e-2*a,6*a,5*a),this.ctx.fillStyle="#E8E8E8",this.ctx.fillRect(t+9*a,e+2*a,6*a,a),this.ctx.strokeStyle="#CCCCCC",this.ctx.lineWidth=.3*a,this.ctx.strokeRect(t+9*a,e-2*a,6*a,5*a);const r=t+2*a,h=e+a,c=.75;if(this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(r,h,4*a*c,3*a*c),this.ctx.fillRect(r+3*a*c,h,2*a*c,2*a*c),this.ctx.fillStyle="#000000",this.ctx.fillRect(r+3.5*a*c,h+.5*a*c,.5*a*c,.5*a*c),i){const i=.01*Date.now();this.ctx.fillStyle="#666666",this.ctx.fillRect(t+2*a,e+6*a,a,2*a),this.ctx.fillStyle="#FF6600",this.ctx.fillRect(t+2*a,e+8*a+Math.sin(i)*a,a,2*a),this.ctx.fillStyle="#FFD700",this.ctx.fillRect(t+2*a,e+10*a+Math.sin(i)*a,a,a),this.ctx.fillStyle="#666666",this.ctx.fillRect(t+13*a,e+6*a,a,2*a),this.ctx.fillStyle="#FF6600",this.ctx.fillRect(t+13*a,e+8*a+Math.sin(i+1)*a,a,2*a),this.ctx.fillStyle="#FFD700",this.ctx.fillRect(t+13*a,e+10*a+Math.sin(i+1)*a,a,a)}this.ctx.restore()}drawObstacleShape(t,e,i,s,l){const a=this.blockSize;switch(s){case"‚ôø":t.fillStyle="#4169E1",t.fillRect(e+2*a,i+2*a,3*a,2*a),t.fillRect(e+2*a,i+a,a,2*a),t.fillStyle="#000000",t.fillRect(e+2*a,i+4*a,a,a),t.fillRect(e+4*a,i+4*a,a,a),t.fillStyle="#666666",t.fillRect(e+2.5*a,i+4.5*a,.5*a,.5*a),t.fillRect(e+4.5*a,i+4.5*a,.5*a,.5*a);break;case"üöó":t.fillStyle="#DC143C",t.fillRect(e+a,i+2*a,4*a,2*a),t.fillRect(e+1.5*a,i+1.5*a,3*a,a),t.fillStyle="#87CEEB",t.fillRect(e+2*a,i+1.7*a,a,.8*a),t.fillRect(e+3.5*a,i+1.7*a,a,.8*a),t.fillStyle="#000000",t.fillRect(e+1.5*a,i+4*a,a,a),t.fillRect(e+3.5*a,i+4*a,a,a),t.fillStyle="#FFD700",t.fillRect(e+5*a,i+2.5*a,.5*a,.5*a);break;case"‚ö∞Ô∏è":t.fillStyle="#8B4513",t.fillRect(e+1.5*a,i+a,3*a,4*a),t.fillRect(e+a,i+1.5*a,4*a,2*a),t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+2*a,a,2*a),t.fillRect(e+2*a,i+2.5*a,2*a,a);break;case"üè¶":t.fillStyle="#696969",t.fillRect(e+a,i+a,4*a,4*a),t.fillStyle="#A9A9A9",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillStyle="#FFD700",t.fillRect(e+4*a,i+2.5*a,a,a),t.fillStyle="#000000",t.fillRect(e+2.5*a,i+2.5*a,a,a);break;case"üè†":t.fillStyle="#8B4513",t.fillRect(e+a,i+2*a,4*a,3*a),t.fillStyle="#DC143C",t.fillRect(e+.5*a,i+a,5*a,1.5*a),t.fillStyle="#654321",t.fillRect(e+2.5*a,i+3.5*a,a,1.5*a),t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+2.5*a,a,a);break;case"üê∫":t.fillStyle="#808080",t.fillRect(e+a,i+2*a,4*a,2*a),t.fillRect(e+4*a,i+a,2*a,2*a),t.fillRect(e+4*a,i+.5*a,.7*a,a),t.fillRect(e+5.3*a,i+.5*a,.7*a,a),t.fillStyle="#FF0000",t.fillRect(e+4.5*a,i+1.5*a,.5*a,.5*a),t.fillRect(e+5.5*a,i+1.5*a,.5*a,.5*a),t.fillStyle="#696969",t.fillRect(e+1.5*a,i+4*a,.7*a,a),t.fillRect(e+2.5*a,i+4*a,.7*a,a),t.fillRect(e+3.5*a,i+4*a,.7*a,a);break;case"üêë":t.fillStyle="#000000",t.fillRect(e+a,i+2*a,4*a,2*a),t.fillRect(e+4*a,i+1.5*a,1.5*a,1.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+4.5*a,i+2*a,.4*a,.4*a),t.fillRect(e+5*a,i+2*a,.4*a,.4*a),t.fillStyle="#000000",t.fillRect(e+1.5*a,i+4*a,.7*a,a),t.fillRect(e+3.5*a,i+4*a,.7*a,a);break;case"üíº":t.fillStyle="#000000",t.fillRect(e+a,i+2*a,4*a,3*a),t.fillStyle="#808080",t.fillRect(e+2.5*a,i+1.5*a,a,.7*a),t.fillStyle="#FFD700",t.fillRect(e+2.8*a,i+3*a,.5*a,.5*a);break;case"üíî":t.fillStyle="#DC143C",t.fillRect(e+1.5*a,i+2*a,1.5*a,2*a),t.fillRect(e+3*a,i+2*a,1.5*a,2*a),t.fillRect(e+2*a,i+1.5*a,2*a,a),t.fillRect(e+2.5*a,i+4*a,a,a),t.fillStyle="#000000",t.fillRect(e+2.8*a,i+1.5*a,.4*a,3*a);break;case"üíÄ":t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+a,3*a,3*a),t.fillStyle="#000000",t.fillRect(e+2*a,i+1.5*a,a,a),t.fillRect(e+3.5*a,i+1.5*a,a,a),t.fillRect(e+2.8*a,i+2.5*a,.7*a,.7*a),t.fillRect(e+2*a,i+3.5*a,2.5*a,.7*a);break;case"‚ò†Ô∏è":t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+.5*a,3*a,2.5*a),t.fillStyle="#000000",t.fillRect(e+2*a,i+1*a,.7*a,.7*a),t.fillRect(e+3.3*a,i+1*a,.7*a,.7*a),t.fillRect(e+2.7*a,i+1.8*a,.6*a,.6*a),t.fillRect(e+2*a,i+2.7*a,.5*a,.3*a),t.fillRect(e+2.7*a,i+2.7*a,.5*a,.3*a),t.fillRect(e+3.5*a,i+2.7*a,.5*a,.3*a),t.fillStyle="#EEEEEE",t.fillRect(e+1*a,i+3.5*a,.7*a,.7*a),t.fillRect(e+1.5*a,i+4*a,.7*a,.7*a),t.fillRect(e+2*a,i+4.5*a,.7*a,.7*a),t.fillRect(e+2.5*a,i+4*a,.7*a,.7*a),t.fillRect(e+3*a,i+4.5*a,.7*a,.7*a),t.fillRect(e+3.5*a,i+4*a,.7*a,.7*a),t.fillRect(e+4*a,i+3.5*a,.7*a,.7*a),t.fillRect(e+4*a,i+4.5*a,.7*a,.7*a),t.fillRect(e+3.5*a,i+4*a,.7*a,.7*a),t.fillRect(e+3*a,i+3.5*a,.7*a,.7*a),t.fillRect(e+2.5*a,i+4*a,.7*a,.7*a),t.fillRect(e+2*a,i+3.5*a,.7*a,.7*a),t.fillRect(e+1.5*a,i+4*a,.7*a,.7*a),t.fillRect(e+1*a,i+4.5*a,.7*a,.7*a),t.fillStyle="#CCCCCC",t.fillRect(e+2*a,i+2.3*a,2*a,.4*a);break;case"üéóÔ∏è":t.fillStyle="#FF69B4",t.fillRect(e+2*a,i+a,2*a,3*a),t.fillRect(e+a,i+2*a,4*a,a),t.fillRect(e+2.5*a,i+.5*a,a,a),t.fillRect(e+1.5*a,i+4*a,a,a),t.fillRect(e+3.5*a,i+4*a,a,a);break;case"‚ò¢Ô∏è":t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillStyle="#000000",t.fillRect(e+2.5*a,i+a,a,1.5*a),t.fillRect(e+a,i+3.5*a,1.5*a,a),t.fillRect(e+3.5*a,i+3.5*a,1.5*a,a);break;case"‚òÑÔ∏è":t.fillStyle="#696969",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillRect(e+1.5*a,i+2.5*a,a,a),t.fillRect(e+4*a,i+2.5*a,a,a),t.fillStyle="#FF4500",t.fillRect(e+a,i+3*a,.7*a,a),t.fillRect(e+1.5*a,i+4*a,.7*a,a),t.fillStyle="#FFD700",t.fillRect(e+.5*a,i+3.5*a,.7*a,.7*a);break;case"‚è∞":t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.strokeStyle="#000000",t.lineWidth=2,t.strokeRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillStyle="#000000",t.fillRect(e+3*a,i+2*a,.3*a,1.5*a),t.fillRect(e+3*a,i+3*a,a,.3*a);break;case"üò°":t.fillStyle="#DC143C",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillStyle="#000000",t.fillRect(e+2*a,i+2*a,.7*a,.7*a),t.fillRect(e+3.5*a,i+2*a,.7*a,.7*a),t.fillRect(e+2*a,i+1.8*a,.7*a,.3*a),t.fillRect(e+3.5*a,i+1.8*a,.7*a,.3*a),t.fillRect(e+2.5*a,i+3.5*a,1.5*a,.5*a);break;case"üåÄ":t.fillStyle="#4169E1",t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillRect(e+2*a,i+2*a,.7*a,2*a),t.fillRect(e+3.5*a,i+2*a,.7*a,2*a),t.fillRect(e+2*a,i+2*a,2*a,.7*a),t.fillRect(e+2*a,i+3.5*a,2*a,.7*a);break;case"üí∞":t.fillStyle="#228B22",t.fillRect(e+1.5*a,i+2*a,3*a,3*a),t.fillRect(e+2.5*a,i+1.5*a,a,a),t.fillStyle="#FFD700",t.fillRect(e+2.8*a,i+2.5*a,.7*a,2*a),t.fillRect(e+2.5*a,i+2.8*a,1.3*a,.4*a),t.fillRect(e+2.5*a,i+3.8*a,1.3*a,.4*a);break;case"üëÑ":t.fillStyle="#DC143C",t.fillRect(e+a,i+2.5*a,4*a,a),t.fillRect(e+1.5*a,i+2*a,a,.7*a),t.fillRect(e+3.5*a,i+2*a,a,.7*a),t.fillRect(e+1.5*a,i+3.5*a,a,.7*a),t.fillRect(e+3.5*a,i+3.5*a,a,.7*a);break;case"ü§ù":t.fillStyle="#FFDAB9",t.fillRect(e+a,i+2.5*a,2*a,a),t.fillRect(e+3*a,i+2.5*a,2*a,a),t.fillRect(e+2.5*a,i+2*a,a,.7*a),t.fillRect(e+2.5*a,i+3.5*a,a,.7*a);break;case"üë•":t.fillStyle="#4169E1",t.fillRect(e+a,i+2*a,1.5*a,2*a),t.fillRect(e+1.5*a,i+1.5*a,.7*a,.7*a),t.fillStyle="#DC143C",t.fillRect(e+2.5*a,i+2*a,1.5*a,2*a),t.fillRect(e+3*a,i+1.5*a,.7*a,.7*a),t.fillStyle="#228B22",t.fillRect(e+4*a,i+2*a,1.5*a,2*a),t.fillRect(e+4.5*a,i+1.5*a,.7*a,.7*a);break;case"‚õìÔ∏è":t.fillStyle="#696969",t.fillRect(e+2*a,i+a,a,a),t.fillRect(e+2*a,i+2.5*a,a,a),t.fillRect(e+2*a,i+4*a,a,a),t.fillRect(e+2.5*a,i+1.7*a,.7*a,a),t.fillRect(e+2.5*a,i+3.3*a,.7*a,a);break;case"üè≠":t.fillStyle="#696969",t.fillRect(e+a,i+2*a,4*a,3*a),t.fillRect(e+1.5*a,i+.5*a,.7*a,1.5*a),t.fillRect(e+3*a,i+a,.7*a,a),t.fillRect(e+4*a,i+.5*a,.7*a,1.5*a),t.fillStyle="#A9A9A9",t.fillRect(e+1.5*a,i+.2*a,.7*a,.5*a),t.fillRect(e+4*a,i+.2*a,.7*a,.5*a);break;case"üíß":t.fillStyle="#4169E1",t.fillRect(e+2.5*a,i+2*a,a,2*a),t.fillRect(e+2*a,i+2.5*a,2*a,1.5*a),t.fillRect(e+2.5*a,i+1.5*a,a,.7*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.8*a,i+2.3*a,.4*a,.4*a);break;case"üêü":t.fillStyle="#FF8C00",t.fillRect(e+1.5*a,i+2*a,3*a,2*a),t.fillRect(e+.7*a,i+2.5*a,.8*a,a),t.fillRect(e+4.5*a,i+1.5*a,a,3*a),t.fillRect(e+4*a,i+2*a,.5*a,2*a),t.fillStyle="#FFA500",t.fillRect(e+2.5*a,i+1.5*a,a,.5*a),t.fillRect(e+2.5*a,i+4*a,a,.5*a),t.fillStyle="#000000",t.fillRect(e+1.1*a,i+2.7*a,.4*a,.4*a),t.fillStyle="#FFFFFF",t.fillRect(e+1.2*a,i+2.8*a,.2*a,.2*a),t.fillStyle="#FFD700",t.fillRect(e+2*a,i+2.5*a,.3*a,.3*a),t.fillRect(e+2.8*a,i+2.8*a,.3*a,.3*a),t.fillRect(e+3.5*a,i+2.5*a,.3*a,.3*a);break;case"üçí":t.fillStyle="#DC143C",t.fillRect(e+1.5*a,i+2.5*a,1.5*a,1.5*a),t.fillRect(e+1.8*a,i+2.2*a,a,.3*a),t.fillRect(e+3.5*a,i+3*a,1.5*a,1.5*a),t.fillRect(e+3.8*a,i+2.7*a,a,.3*a),t.fillStyle="#FF6B9D",t.fillRect(e+2*a,i+2.7*a,.5*a,.5*a),t.fillRect(e+4*a,i+3.2*a,.5*a,.5*a),t.fillStyle="#228B22",t.fillRect(e+2.2*a,i+1.5*a,.3*a,a),t.fillRect(e+4.2*a,i+2*a,.3*a,.7*a),t.fillRect(e+2.5*a,i+1.2*a,a,.3*a),t.fillStyle="#32CD32",t.fillRect(e+3.2*a,i+1*a,.8*a,.5*a),t.fillRect(e+3.4*a,i+.8*a,.4*a,.2*a);break;case"üíé":t.fillStyle="#00CED1",t.fillRect(e+2.5*a,i+1.5*a,a,.5*a),t.fillRect(e+2*a,i+2*a,2*a,.5*a),t.fillRect(e+1.5*a,i+2.5*a,3*a,.5*a),t.fillRect(e+a,i+3*a,4*a,.5*a),t.fillRect(e+1.5*a,i+3.5*a,3*a,.5*a),t.fillRect(e+2*a,i+4*a,2*a,.5*a),t.fillRect(e+2.5*a,i+4.5*a,a,.5*a),t.fillStyle="#008B8B",t.fillRect(e+1.5*a,i+2.5*a,.5*a,.5*a),t.fillRect(e+4*a,i+2.5*a,.5*a,.5*a),t.fillRect(e+2.5*a,i+3.5*a,.5*a,.5*a),t.fillStyle="#E0FFFF",t.fillRect(e+2.8*a,i+2*a,.4*a,.4*a),t.fillRect(e+3.5*a,i+2.7*a,.3*a,.3*a),t.fillRect(e+2*a,i+3.2*a,.3*a,.3*a);break;case"üçÉ":t.fillStyle="#32CD32",t.fillRect(e+2*a,i+1.5*a,2*a,.5*a),t.fillRect(e+1.5*a,i+2*a,3*a,a),t.fillRect(e+1.8*a,i+3*a,2.5*a,a),t.fillRect(e+2.2*a,i+4*a,1.5*a,.5*a),t.fillRect(e+2.8*a,i+4.5*a,.5*a,.3*a),t.fillStyle="#228B22",t.fillRect(e+2.9*a,i+1.5*a,.3*a,3*a),t.fillRect(e+2.2*a,i+2.3*a,.7*a,.2*a),t.fillRect(e+3.2*a,i+2.3*a,.7*a,.2*a),t.fillRect(e+2.2*a,i+3*a,.7*a,.2*a),t.fillRect(e+3.2*a,i+3*a,.7*a,.2*a),t.fillStyle="#90EE90",t.fillRect(e+2.5*a,i+2.2*a,.5*a,.5*a);break;case"üåü":t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillRect(e+2.7*a,i+1*a,.6*a,1.5*a),t.fillRect(e+2.5*a,i+1.5*a,a,.5*a),t.fillRect(e+3.5*a,i+1.5*a,a,.5*a),t.fillRect(e+4*a,i+1.8*a,.5*a,.5*a),t.fillRect(e+3.5*a,i+3.5*a,a,.5*a),t.fillRect(e+4*a,i+3.8*a,.5*a,.5*a),t.fillRect(e+1.5*a,i+3.5*a,a,.5*a),t.fillRect(e+1.2*a,i+3.8*a,.5*a,.5*a),t.fillRect(e+1.5*a,i+1.5*a,a,.5*a),t.fillRect(e+1.2*a,i+1.8*a,.5*a,.5*a),t.fillStyle="#FFA500",t.fillRect(e+2.3*a,i+2.3*a,.2*a,1.4*a),t.fillRect(e+3.5*a,i+2.3*a,.2*a,1.4*a),t.fillRect(e+2.3*a,i+2.3*a,1.4*a,.2*a),t.fillRect(e+2.3*a,i+3.5*a,1.4*a,.2*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.8*a,i+2.8*a,.4*a,.4*a);break;case"üê†":t.fillStyle="#FF69B4",t.fillRect(e+1.5*a,i+2*a,3*a,2*a),t.fillRect(e+.7*a,i+2.5*a,.8*a,a),t.fillStyle="#1E90FF",t.fillRect(e+2*a,i+2*a,.4*a,2*a),t.fillRect(e+3.2*a,i+2*a,.4*a,2*a),t.fillStyle="#FFD700",t.fillRect(e+2.6*a,i+2*a,.4*a,2*a),t.fillStyle="#FF69B4",t.fillRect(e+4.5*a,i+1.5*a,a,3*a),t.fillStyle="#1E90FF",t.fillRect(e+3.8*a,i+2*a,.7*a,.5*a),t.fillRect(e+3.8*a,i+3.5*a,.7*a,.5*a),t.fillStyle="#FFD700",t.fillRect(e+3.8*a,i+2.7*a,.7*a,.6*a),t.fillStyle="#FF1493",t.fillRect(e+2.5*a,i+1.2*a,a,.5*a),t.fillRect(e+2.5*a,i+4.3*a,a,.5*a),t.fillStyle="#000000",t.fillRect(e+1.1*a,i+2.7*a,.4*a,.4*a),t.fillStyle="#FFFFFF",t.fillRect(e+1.2*a,i+2.8*a,.2*a,.2*a);break;case"üîã":t.fillStyle="#2F4F4F",t.fillRect(e+1.8*a,i+2*a,2.5*a,3*a),t.fillRect(e+2.5*a,i+1.5*a,a,.5*a),t.strokeStyle="#696969",t.lineWidth=.2*a,t.strokeRect(e+1.8*a,i+2*a,2.5*a,3*a),t.fillStyle="#00FF00",t.fillRect(e+2*a,i+4.5*a,2*a,.3*a),t.fillRect(e+2*a,i+4*a,2*a,.3*a),t.fillRect(e+2*a,i+3.5*a,2*a,.3*a),t.fillRect(e+2*a,i+3*a,2*a,.3*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.7*a,i+2.3*a,.6*a,.15*a),t.fillRect(e+2.93*a,i+2.07*a,.15*a,.6*a),t.fillRect(e+2.7*a,i+4.3*a,.6*a,.15*a),t.fillStyle="#FFFF00",t.fillRect(e+3.2*a,i+2.8*a,.3*a,.5*a),t.fillRect(e+3.4*a,i+3*a,.3*a,.5*a),t.fillRect(e+2.9*a,i+3.3*a,.3*a,.5*a);break;case"‚ú®":t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillRect(e+2.7*a,i+2*a,.6*a,.5*a),t.fillRect(e+2.7*a,i+3.5*a,.6*a,.5*a),t.fillRect(e+2*a,i+2.7*a,.5*a,.6*a),t.fillRect(e+3.5*a,i+2.7*a,.5*a,.6*a),t.fillStyle="#FF69B4",t.fillRect(e+1.2*a,i+1.5*a,.4*a,.4*a),t.fillRect(e+4.4*a,i+1.8*a,.4*a,.4*a),t.fillRect(e+1.5*a,i+4.2*a,.4*a,.4*a),t.fillRect(e+4.2*a,i+4.5*a,.4*a,.4*a),t.fillStyle="#00FFFF",t.fillRect(e+.8*a,i+2.8*a,.3*a,.3*a),t.fillRect(e+4.9*a,i+3*a,.3*a,.3*a),t.fillRect(e+2.2*a,i+1*a,.3*a,.3*a),t.fillRect(e+3.5*a,i+5*a,.3*a,.3*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.8*a,i+2.8*a,.4*a,.4*a),t.fillRect(e+1.5*a,i+2*a,.2*a,.2*a),t.fillRect(e+4*a,i+3.5*a,.2*a,.2*a),t.fillStyle="#FFD700",t.fillRect(e+3*a,i+1.5*a,.15*a,.5*a),t.fillRect(e+3*a,i+4*a,.15*a,.5*a),t.fillRect(e+1.5*a,i+3*a,.5*a,.15*a),t.fillRect(e+4*a,i+3*a,.5*a,.15*a);break;case"üêâ":t.fillStyle="#FF4500",t.fillRect(e+a,i+2*a,4*a,2*a),t.fillRect(e+4.5*a,i+a,1.5*a,2*a),t.fillStyle="#000000",t.fillRect(e+4.5*a,i+.5*a,.5*a,a),t.fillRect(e+5.5*a,i+.5*a,.5*a,a),t.fillStyle="#FFD700",t.fillRect(e+4.8*a,i+1.5*a,.4*a,.4*a),t.fillRect(e+5.5*a,i+1.5*a,.4*a,.4*a),t.fillStyle="#DC143C",t.fillRect(e+.5*a,i+a,1.5*a,2*a),t.fillRect(e+2*a,i+.5*a,a,1.5*a),t.fillStyle="#FFA500",t.fillRect(e+6*a,i+2*a,.5*a,.5*a),t.fillStyle="#FFD700",t.fillRect(e+6.5*a,i+2*a,.3*a,.3*a),t.fillStyle="#FF4500",t.fillRect(e+.5*a,i+3*a,1.5*a,a),t.fillStyle="#8B0000",t.fillRect(e+2*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+3*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+4*a,i+2.3*a,.5*a,.5*a);break;case"üõ∏":t.fillStyle="#C0C0C0",t.fillRect(e+a,i+2.5*a,4*a,a),t.fillStyle="#87CEEB",t.fillRect(e+2*a,i+1.5*a,2*a,a),t.fillStyle="#4169E1",t.fillRect(e+2.5*a,i+1.8*a,a,.7*a),t.fillStyle="#00FF00",t.fillRect(e+1.2*a,i+2.8*a,.5*a,.3*a),t.fillRect(e+3*a,i+2.8*a,.5*a,.3*a),t.fillRect(e+4.3*a,i+2.8*a,.5*a,.3*a),t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+3.5*a,.5*a,.7*a),t.fillRect(e+2.8*a,i+3.5*a,.5*a,.7*a),t.fillRect(e+4*a,i+3.5*a,.5*a,.7*a),t.fillStyle="rgba(0, 255, 0, 0.3)",t.fillRect(e+2*a,i+3.5*a,2*a,a),t.fillStyle="#A9A9A9",t.fillRect(e+2*a,i+a,.3*a,.7*a),t.fillRect(e+3.7*a,i+a,.3*a,.7*a);break;case"ü¶à":t.fillStyle="#708090",t.fillRect(e+a,i+2*a,4*a,2*a),t.fillRect(e+4.5*a,i+2.3*a,1.5*a,1.5*a),t.fillStyle="#696969",t.fillRect(e+2.5*a,i+a,a,1.5*a),t.fillRect(e+1.5*a,i+3.5*a,a,.7*a),t.fillRect(e+3.5*a,i+3.5*a,a,.7*a),t.fillRect(e+.3*a,i+1.5*a,a,2*a),t.fillRect(e+.3*a,i+a,.7*a,a),t.fillStyle="#000000",t.fillRect(e+4.7*a,i+2.5*a,.4*a,.4*a),t.fillStyle="#FFFFFF",t.fillRect(e+5.5*a,i+3*a,.3*a,.5*a),t.fillRect(e+5.8*a,i+3*a,.3*a,.5*a),t.fillRect(e+6.1*a,i+3*a,.3*a,.5*a),t.fillStyle="#A9A9A9",t.fillRect(e+2*a,i+3.2*a,2*a,.8*a);break;case"üî•":t.fillStyle="#FF4500",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillRect(e+2.5*a,i+1.5*a,a,a),t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillStyle="#FFA500",t.fillRect(e+1.8*a,i+2.3*a,.4*a,.4*a),t.fillRect(e+4*a,i+2.7*a,.4*a,.4*a);break;case"‚ö°":t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+a,a,a),t.fillRect(e+2*a,i+2*a,a,a),t.fillRect(e+2.5*a,i+3*a,a,a),t.fillRect(e+2*a,i+4*a,a,a),t.fillStyle="#FFFFFF",t.fillRect(e+2.7*a,i+2.2*a,.6*a,.6*a);break;case"üíß":t.fillStyle="#4682B4",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillRect(e+2.5*a,i+1.5*a,a,a),t.fillStyle="#FFFFFF",t.fillRect(e+2.8*a,i+2.3*a,.5*a,.5*a),t.fillStyle="#87CEEB",t.fillRect(e+1.8*a,i+2.5*a,.4*a,.4*a),t.fillRect(e+4*a,i+2.8*a,.4*a,.4*a);break;case"ü¶ë":t.fillStyle="#DB7093",t.fillRect(e+2*a,i+1.5*a,2*a,1.5*a),t.fillRect(e+2.3*a,i+a,1.4*a,.7*a),t.fillStyle="#000000",t.fillRect(e+2.5*a,i+1.7*a,.4*a,.4*a),t.fillRect(e+3.1*a,i+1.7*a,.4*a,.4*a),t.fillStyle="#C71585",t.fillRect(e+2*a,i+3*a,.4*a,1.5*a),t.fillRect(e+2.5*a,i+3*a,.4*a,1.8*a),t.fillRect(e+3*a,i+3*a,.4*a,1.8*a),t.fillRect(e+3.5*a,i+3*a,.4*a,1.5*a),t.fillStyle="#8B4789",t.fillRect(e+1.6*a,i+3*a,.3*a,a),t.fillRect(e+2.2*a,i+3.2*a,.3*a,1.2*a),t.fillRect(e+3.3*a,i+3.2*a,.3*a,1.2*a),t.fillRect(e+4*a,i+3*a,.3*a,a),t.fillStyle="#F8F8FF",t.fillRect(e+2.1*a,i+3.5*a,.2*a,.2*a),t.fillRect(e+2.6*a,i+3.8*a,.2*a,.2*a),t.fillRect(e+3.1*a,i+3.8*a,.2*a,.2*a),t.fillRect(e+3.6*a,i+3.5*a,.2*a,.2*a);break;case"‚öôÔ∏è":t.fillStyle="#708090",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillRect(e+2.5*a,i+1.5*a,a,a),t.fillRect(e+2.5*a,i+4*a,a,a),t.fillRect(e+1.5*a,i+2.5*a,a,a),t.fillRect(e+4*a,i+2.5*a,a,a),t.fillStyle="#556B2F",t.fillRect(e+2.5*a,i+.5*a,a,a),t.fillRect(e+2.5*a,i+4.5*a,a,a),t.fillRect(e+.5*a,i+2.5*a,a,a),t.fillRect(e+4.5*a,i+2.5*a,a,a),t.fillRect(e+1.2*a,i+1.2*a,.8*a,.8*a),t.fillRect(e+4*a,i+1.2*a,.8*a,.8*a),t.fillRect(e+1.2*a,i+4*a,.8*a,.8*a),t.fillRect(e+4*a,i+4*a,.8*a,.8*a),t.fillStyle="#2F4F4F",t.fillRect(e+2.7*a,i+2.7*a,.6*a,.6*a),t.fillStyle="#C0C0C0",t.fillRect(e+2.3*a,i+2.3*a,.4*a,.4*a),t.fillRect(e+3.5*a,i+3.5*a,.3*a,.3*a);break;case"üêã":t.fillStyle="#4169E1",t.fillRect(e+.5*a,i+2*a,5*a,2.5*a),t.fillRect(e+5*a,i+2.3*a,a,2*a),t.fillRect(e,i+1.5*a,1.5*a,a),t.fillRect(e,i+3.5*a,1.5*a,a),t.fillStyle="#1E90FF",t.fillRect(e+2.5*a,i+1.2*a,a,a),t.fillStyle="#F0F8FF",t.fillRect(e+1.5*a,i+3.5*a,3*a,a),t.fillStyle="#000000",t.fillRect(e+5*a,i+2.8*a,.4*a,.4*a),t.fillStyle="#87CEEB",t.fillRect(e+2.5*a,i+.5*a,.5*a,a);break;case"üëæ":t.fillStyle="#FFFF00",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillRect(e+2*a,i+a,2*a,a),t.fillRect(e+2*a,i+4.5*a,2*a,a),t.fillStyle="#000000",t.fillRect(e+4*a,i+2.5*a,a,a),t.fillStyle="#0000FF",t.fillRect(e+2.5*a,i+2*a,.5*a,.5*a),t.fillRect(e+3.5*a,i+2*a,.5*a,.5*a);break;case"üö¢":t.fillStyle="#0055A4",t.fillRect(e+.5*a,i+3*a,5*a,1.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+2*a,3*a,a),t.fillRect(e+2*a,i+1.5*a,2*a,.7*a),t.fillStyle="#DC143C",t.fillRect(e+2*a,i+.5*a,.7*a,a),t.fillRect(e+3.3*a,i+.8*a,.7*a,.7*a),t.fillStyle="#87CEEB",t.fillRect(e+2*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+3*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+4*a,i+2.3*a,.5*a,.5*a);break;case"ü§ñ":t.fillStyle="#C0C0C0",t.fillRect(e+2*a,i+2*a,2*a,2.5*a),t.fillRect(e+2.3*a,i+1*a,1.5*a,a),t.fillStyle="#FF0000",t.fillRect(e+2.5*a,i+1.3*a,.4*a,.4*a),t.fillRect(e+3.3*a,i+1.3*a,.4*a,.4*a),t.fillStyle="#FFD700",t.fillRect(e+3*a,i+.5*a,.3*a,.7*a),t.fillStyle="#A9A9A9",t.fillRect(e+1.3*a,i+2.5*a,.7*a,1.5*a),t.fillRect(e+4*a,i+2.5*a,.7*a,1.5*a),t.fillRect(e+2.3*a,i+4.5*a,.7*a,a),t.fillRect(e+3.3*a,i+4.5*a,.7*a,a);break;case"üëΩ":t.fillStyle="#00FF7F",t.fillRect(e+1.5*a,i+1.5*a,3*a,2*a),t.fillRect(e+2*a,i+a,2*a,a),t.fillStyle="#000000",t.fillRect(e+2*a,i+2*a,a,a),t.fillRect(e+3*a,i+2*a,a,a),t.fillStyle="#32CD32",t.fillRect(e+2.3*a,i+3.5*a,1.5*a,a),t.fillRect(e+1.5*a,i+3.8*a,.7*a,a),t.fillRect(e+3.8*a,i+3.8*a,.7*a,a);break;case"üëπ":t.fillStyle="#8B0000",t.fillRect(e+1.5*a,i+2*a,3*a,2.5*a),t.fillRect(e+2*a,i+a,2*a,a),t.fillStyle="#000000",t.fillRect(e+1.8*a,i+.5*a,.7*a,.7*a),t.fillRect(e+3.5*a,i+.5*a,.7*a,.7*a),t.fillStyle="#FFFF00",t.fillRect(e+2.3*a,i+1.5*a,.5*a,.5*a),t.fillRect(e+3.2*a,i+1.5*a,.5*a,.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.3*a,i+2.3*a,.4*a,.7*a),t.fillRect(e+3.3*a,i+2.3*a,.4*a,.7*a),t.fillStyle="#000000",t.fillRect(e+1.3*a,i+3*a,.5*a,a),t.fillRect(e+4.2*a,i+3*a,.5*a,a);break;case"üêç":t.fillStyle="#228B22",t.fillRect(e+3*a,i+2*a,2*a,1.5*a),t.fillRect(e+4*a,i+2.3*a,a,a),t.fillRect(e+1.5*a,i+2.3*a,2*a,a),t.fillRect(e+.5*a,i+2.5*a,1.5*a,.8*a),t.fillStyle="#32CD32",t.fillRect(e+a,i+2.6*a,.4*a,.4*a),t.fillRect(e+2*a,i+2.4*a,.4*a,.4*a),t.fillRect(e+3.3*a,i+2.2*a,.4*a,.4*a),t.fillStyle="#FF0000",t.fillRect(e+4.2*a,i+2.5*a,.3*a,.3*a),t.fillStyle="#DC143C",t.fillRect(e+5*a,i+2.6*a,.5*a,.2*a),t.fillRect(e+5.2*a,i+2.4*a,.2*a,.3*a),t.fillRect(e+5.2*a,i+2.8*a,.2*a,.3*a),t.fillStyle="#1a4d1a",t.fillRect(e+1.7*a,i+2.4*a,.5*a,.5*a),t.fillRect(e+2.8*a,i+2.5*a,.5*a,.5*a),t.fillRect(e+3.8*a,i+2.4*a,.5*a,.5*a);break;case"‚òÅÔ∏è":t.fillStyle="#F0F8FF",t.fillRect(e+a,i+2.5*a,4*a,a),t.fillRect(e+1.5*a,i+2*a,3*a,a),t.fillRect(e+2*a,i+1.5*a,2*a,a),t.fillStyle="#E0E0E0",t.fillRect(e+1.5*a,i+3.3*a,3*a,.3*a);break;case"üí®":t.fillStyle="#C0C0C0",t.fillRect(e+a,i+2*a,3*a,.5*a),t.fillRect(e+1.5*a,i+2.7*a,3*a,.5*a),t.fillRect(e+.5*a,i+3.4*a,3*a,.5*a);break;case"‚ùì":t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+a,a,.7*a),t.fillRect(e+3*a,i+1.7*a,.7*a,a),t.fillRect(e+2.5*a,i+2.7*a,a,a),t.fillRect(e+2.5*a,i+4*a,a,.7*a);break;case"üëª":t.fillStyle="#F0F8FF",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillRect(e+2*a,i+a,2*a,a),t.fillStyle="#000000",t.fillRect(e+2.3*a,i+2*a,.5*a,.7*a),t.fillRect(e+3.2*a,i+2*a,.5*a,.7*a),t.fillStyle="#E0E0E0",t.fillRect(e+2*a,i+4.5*a,.7*a,.7*a),t.fillRect(e+3.3*a,i+4.5*a,.7*a,.7*a);break;case"ü¶Ö":t.fillStyle="#8B4513",t.fillRect(e+2*a,i+2*a,2*a,1.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+3.5*a,i+1.8*a,a,a),t.fillStyle="#FFD700",t.fillRect(e+4.5*a,i+2.3*a,.5*a,.5*a),t.fillStyle="#654321",t.fillRect(e+.5*a,i+2.3*a,2*a,a),t.fillRect(e+4*a,i+2.3*a,2*a,a),t.fillStyle="#000000",t.fillRect(e+4*a,i+2.2*a,.3*a,.3*a);break;case"‚öîÔ∏è":t.fillStyle="#C0C0C0",t.fillRect(e+2.8*a,i+.5*a,.5*a,4*a),t.fillStyle="#FFD700",t.fillRect(e+2*a,i+3.5*a,2*a,.5*a),t.fillStyle="#8B4513",t.fillRect(e+2.8*a,i+4*a,.5*a,1.5*a),t.fillStyle="#FFD700",t.fillRect(e+2.5*a,i+5.5*a,a,.5*a);break;case"üî´":t.fillStyle="#000000",t.fillRect(e+1.5*a,i+2.5*a,3*a,a),t.fillRect(e+4.5*a,i+2.7*a,a,.7*a),t.fillStyle="#00FF00",t.fillRect(e+2*a,i+2.7*a,.5*a,.5*a),t.fillRect(e+3*a,i+2.7*a,.5*a,.5*a),t.fillStyle="#696969",t.fillRect(e+2*a,i+3.5*a,a,a);break;case"ü•Ö":t.fillStyle="#4169E1",t.fillRect(e+a,i+a,.3*a,4*a),t.fillRect(e+4.7*a,i+a,.3*a,4*a),t.fillRect(e+a,i+a,4*a,.3*a),t.fillRect(e+a,i+4.7*a,4*a,.3*a),t.fillStyle="#87CEEB";for(let l=0;l<4;l++)t.fillRect(e+(1.5+l)*a,i+1.5*a,.2*a,3*a),t.fillRect(e+1.5*a,i+(1.5+l)*a,3*a,.2*a);break;case"üõ°Ô∏è":t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+a,3*a,4*a),t.fillRect(e+2.5*a,i+5*a,a,a),t.fillStyle="#C0C0C0",t.fillRect(e+2.8*a,i+1.5*a,.5*a,3*a),t.fillRect(e+2*a,i+2.8*a,2*a,.5*a);break;case"üî®":t.fillStyle="#696969",t.fillRect(e+1.5*a,i+a,3*a,1.5*a),t.fillStyle="#8B4513",t.fillRect(e+2.8*a,i+2.5*a,.5*a,3*a);break;case"üî¶":t.fillStyle="#FFD700",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillStyle="#FFFFFF",t.fillRect(e+4*a,i+2.5*a,a,a),t.fillStyle="rgba(255, 255, 0, 0.3)",t.fillRect(e+5*a,i+2.7*a,1.5*a,.7*a);break;case"üëë":t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+2*a,3*a,1.5*a),t.fillRect(e+1.7*a,i+1.3*a,.7*a,.7*a),t.fillRect(e+2.8*a,i+a,.7*a,a),t.fillRect(e+3.8*a,i+1.3*a,.7*a,.7*a),t.fillStyle="#DC143C",t.fillRect(e+2*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+3*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+4*a,i+2.3*a,.5*a,.5*a);break;case"üíã":t.fillStyle="#FF1493",t.fillRect(e+a,i+2.5*a,4*a,a),t.fillRect(e+1.5*a,i+2*a,a,.7*a),t.fillRect(e+3.5*a,i+2*a,a,.7*a),t.fillRect(e+1.5*a,i+3.5*a,a,.7*a),t.fillRect(e+3.5*a,i+3.5*a,a,.7*a),t.fillStyle="#FFB6C1",t.fillRect(e+2*a,i+2.7*a,.5*a,.5*a);break;case"üëÅÔ∏è":t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+2*a,3*a,2*a),t.fillStyle="#32CD32",t.fillRect(e+2.5*a,i+2.3*a,a,1.5*a),t.fillStyle="#000000",t.fillRect(e+2.7*a,i+2.7*a,.7*a,.7*a),t.strokeStyle="#000000",t.lineWidth=2,t.strokeRect(e+1.5*a,i+2*a,3*a,2*a);break;case"üçñ":t.fillStyle="#F5DEB3",t.fillRect(e+2*a,i+a,a,.7*a),t.fillRect(e+2*a,i+4.3*a,a,.7*a),t.fillStyle="#DC143C",t.fillRect(e+1.5*a,i+1.7*a,3*a,2.7*a),t.fillStyle="#FFFFFF",t.fillRect(e+2*a,i+2.5*a,.5*a,.5*a),t.fillRect(e+3.5*a,i+3*a,.5*a,.5*a);break;case"üí¢":t.fillStyle="#DC143C",t.fillRect(e+2.5*a,i+1.5*a,a,3*a),t.fillRect(e+1.5*a,i+2.5*a,3*a,a),t.strokeStyle="#000000",t.lineWidth=3,t.strokeRect(e+2.5*a,i+1.5*a,a,3*a),t.strokeRect(e+1.5*a,i+2.5*a,3*a,a);break;case"üò¥":t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillStyle="#000000",t.fillRect(e+2*a,i+2.5*a,a,.3*a),t.fillRect(e+3.5*a,i+2.5*a,a,.3*a),t.fillRect(e+2.5*a,i+3.5*a,a,.5*a),t.fillStyle="#4169E1",t.fillRect(e+4.5*a,i+a,.7*a,.3*a),t.fillRect(e+5*a,i+1.5*a,.5*a,.3*a);break;case"ü™©":t.fillStyle="#C0C0C0",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillStyle="#FF69B4",t.fillRect(e+2*a,i+2*a,.7*a,.7*a),t.fillStyle="#00FF00",t.fillRect(e+3.3*a,i+2*a,.7*a,.7*a),t.fillStyle="#4169E1",t.fillRect(e+2*a,i+3.3*a,.7*a,.7*a),t.fillStyle="#FFD700",t.fillRect(e+3.3*a,i+3.3*a,.7*a,.7*a);break;case"üçï":t.fillStyle="#F5DEB3",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillRect(e+2*a,i+a,2*a,a),t.fillRect(e+2*a,i+4.5*a,2*a,a),t.fillStyle="#DC143C",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillStyle="#FFD700",t.fillRect(e+2.3*a,i+2.3*a,.5*a,.5*a),t.fillRect(e+3.2*a,i+2.8*a,.5*a,.5*a),t.fillRect(e+2.7*a,i+3.5*a,.5*a,.5*a);break;case"üé™":t.fillStyle="#DC143C",t.fillRect(e+a,i+2*a,4*a,a),t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+2*a,a,a),t.fillRect(e+3.5*a,i+2*a,a,a),t.fillStyle="#FFD700",t.fillRect(e+2*a,i+a,2*a,a),t.fillRect(e+2.5*a,i+.5*a,a,.7*a);break;case"üçå":t.fillStyle="#FFFF00",t.fillRect(e+2*a,i+1.5*a,2*a,.7*a),t.fillRect(e+2.3*a,i+2.2*a,1.7*a,.7*a),t.fillRect(e+2.7*a,i+2.9*a,1.3*a,.7*a),t.fillRect(e+3*a,i+3.6*a,a,.7*a),t.fillStyle="#228B22",t.fillRect(e+2*a,i+1.3*a,.5*a,.5*a);break;case"üß≤":t.fillStyle="#DC143C",t.fillRect(e+1.5*a,i+2*a,a,2.5*a),t.fillRect(e+3.5*a,i+2*a,a,2.5*a),t.fillRect(e+1.5*a,i+2*a,3*a,a),t.fillStyle="#696969",t.fillRect(e+1.5*a,i+4.5*a,a,.5*a),t.fillRect(e+3.5*a,i+4.5*a,a,.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+1.8*a,i+4.7*a,.3*a,.3*a),t.fillRect(e+3.8*a,i+4.7*a,.3*a,.3*a);break;case"üéà":t.fillStyle="#FF69B4",t.fillRect(e+2*a,i+a,2*a,2.5*a),t.fillRect(e+2.5*a,i+.5*a,a,a),t.fillStyle="#8B4513",t.fillRect(e+2.8*a,i+3.5*a,.3*a,2*a);break;case"üå™Ô∏è":t.fillStyle="#708090",t.fillRect(e+2*a,i+.5*a,2*a,a),t.fillRect(e+2.3*a,i+1.5*a,1.5*a,a),t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillRect(e+2.7*a,i+3.5*a,.7*a,a),t.fillRect(e+2.8*a,i+4.5*a,.5*a,a);break;case"üöÄ":t.fillStyle="#FFFFFF",t.fillRect(e+2.5*a,i+1.5*a,a,3*a),t.fillStyle="#DC143C",t.fillRect(e+2.5*a,i+.5*a,a,a),t.fillRect(e+2.7*a,i,.7*a,.5*a),t.fillStyle="#FFD700",t.fillRect(e+2*a,i+4*a,.7*a,a),t.fillRect(e+3.3*a,i+4*a,.7*a,a),t.fillStyle="#FF4500",t.fillRect(e+2.7*a,i+4.5*a,.7*a,a);break;case"üåä":t.fillStyle="#4169E1",t.fillRect(e+a,i+3*a,4*a,a),t.fillRect(e+1.5*a,i+2.5*a,3*a,.7*a),t.fillRect(e+2*a,i+2*a,2*a,.7*a),t.fillStyle="#FFFFFF",t.fillRect(e+2*a,i+1.8*a,.5*a,.5*a),t.fillRect(e+3.5*a,i+2.3*a,.5*a,.5*a);break;case"ü™®":t.fillStyle="#696969",t.fillRect(e+1.5*a,i+2*a,3*a,2*a),t.fillRect(e+2*a,i+1.5*a,2*a,.7*a),t.fillStyle="#4B4B4B",t.fillRect(e+2*a,i+3.5*a,2.5*a,.5*a);break;case"ü™º":t.fillStyle="#FFB6C1",t.fillRect(e+2*a,i+1.5*a,2*a,1.5*a),t.fillStyle="#FF69B4",t.fillRect(e+2*a,i+3*a,.3*a,2*a),t.fillRect(e+2.5*a,i+3*a,.3*a,2.5*a),t.fillRect(e+3*a,i+3*a,.3*a,2*a),t.fillRect(e+3.7*a,i+3*a,.3*a,2.3*a);break;case"üßú‚Äç‚ôÄÔ∏è":t.fillStyle="#FFDAB9",t.fillRect(e+2.5*a,i+2*a,a,1.5*a),t.fillRect(e+2.5*a,i+1.3*a,a,.7*a),t.fillStyle="#FFD700",t.fillRect(e+2.3*a,i+a,1.5*a,.7*a),t.fillStyle="#32CD32",t.fillRect(e+2.5*a,i+3.5*a,a,1.5*a),t.fillRect(e+2*a,i+5*a,2*a,.7*a);break;case"üí≥":t.fillStyle="#4169E1",t.fillRect(e+1.5*a,i+2*a,3*a,2*a),t.fillStyle="#000000",t.fillRect(e+1.5*a,i+2.5*a,3*a,.5*a),t.fillStyle="#FFD700",t.fillRect(e+2*a,i+3.3*a,.7*a,.5*a);break;case"üó°Ô∏è":t.fillStyle="#C0C0C0",t.fillRect(e+2.8*a,i+.5*a,.5*a,3.5*a),t.fillRect(e+2.8*a,i,.5*a,.5*a),t.fillStyle="#000000",t.fillRect(e+2*a,i+4*a,2*a,.3*a),t.fillStyle="#8B4513",t.fillRect(e+2.8*a,i+4.3*a,.5*a,1.5*a);break;case"üì¶":t.fillStyle="#8B4513",t.fillRect(e+1.5*a,i+2*a,3*a,2.5*a),t.fillStyle="#F5DEB3",t.fillRect(e+2.8*a,i+2*a,.5*a,2.5*a),t.fillRect(e+1.5*a,i+3*a,3*a,.5*a),t.fillStyle="#654321",t.fillRect(e+1.5*a,i+4*a,3*a,.5*a);break;case"üí™":t.fillStyle="#FFDAB9",t.fillRect(e+1*a,i+3*a,2.5*a,1.2*a),t.fillStyle="#F5DEB3",t.fillRect(e+1.5*a,i+1.8*a,2*a,1.8*a),t.fillStyle="#DEB887",t.fillRect(e+2*a,i+2.2*a,.3*a,1*a),t.fillStyle="#FFDAB9",t.fillRect(e+3.5*a,i+2.8*a,1.8*a,1.5*a),t.fillStyle="#DEB887",t.fillRect(e+3.8*a,i+3*a,.3*a,.4*a),t.fillRect(e+4.3*a,i+3*a,.3*a,.4*a),t.fillRect(e+4.8*a,i+3*a,.3*a,.4*a),t.fillStyle="#F5DEB3",t.fillRect(e+4.5*a,i+2*a,.6*a,1*a),t.fillRect(e+4.6*a,i+1.5*a,.5*a,.6*a),t.fillStyle="#FFD700",t.fillRect(e+.8*a,i+1.5*a,.5*a,.5*a),t.fillRect(e+.6*a,i+1.7*a,.3*a,.3*a),t.fillRect(e+1.1*a,i+1.7*a,.3*a,.3*a),t.fillRect(e+5.5*a,i+1.8*a,.5*a,.5*a),t.fillRect(e+5.3*a,i+2*a,.3*a,.3*a),t.fillRect(e+5.8*a,i+2*a,.3*a,.3*a);break;case"‚ö°":t.fillStyle="#FFD700",t.fillRect(e+2.8*a,i+.5*a,.6*a,a),t.fillRect(e+2.3*a,i+1.5*a,a,.5*a),t.fillRect(e+2.8*a,i+2*a,.8*a,.8*a),t.fillRect(e+2*a,i+2.8*a,1.2*a,.6*a),t.fillRect(e+2.5*a,i+3.4*a,.7*a,1.2*a),t.fillRect(e+2.7*a,i+4.6*a,.5*a,a),t.fillStyle="#FFFFFF",t.fillRect(e+2.9*a,i+.7*a,.4*a,.6*a),t.fillRect(e+2.6*a,i+2.2*a,.5*a,.4*a),t.fillRect(e+2.7*a,i+3.8*a,.4*a,.6*a),t.fillStyle="#FFFF00",t.fillRect(e+1.5*a,i+1.8*a,.3*a,.3*a),t.fillRect(e+3.8*a,i+2.5*a,.3*a,.3*a),t.fillRect(e+1.8*a,i+3.5*a,.3*a,.3*a),t.fillRect(e+3.5*a,i+4.2*a,.3*a,.3*a),t.fillStyle="rgba(135, 206, 250, 0.3)",t.fillRect(e+1.5*a,i+.3*a,3*a,5.5*a);break;case"üõ°Ô∏è":t.fillStyle="#4169E1",t.fillRect(e+1.8*a,i+1.5*a,2.5*a,3*a),t.fillRect(e+2.2*a,i+a,1.7*a,.5*a),t.fillRect(e+2.5*a,i+4.5*a,1.2*a,.8*a),t.fillStyle="#C0C0C0",t.fillRect(e+1.8*a,i+1.5*a,.3*a,3*a),t.fillRect(e+4*a,i+1.5*a,.3*a,3*a),t.fillRect(e+1.8*a,i+1.5*a,2.5*a,.3*a),t.fillStyle="#FFD700",t.fillRect(e+2.9*a,i+2*a,.4*a,2*a),t.fillRect(e+2.2*a,i+2.8*a,1.8*a,.4*a),t.fillStyle="#696969",t.fillRect(e+2.3*a,i+2*a,.3*a,.3*a),t.fillRect(e+3.5*a,i+2*a,.3*a,.3*a),t.fillRect(e+2.3*a,i+3.8*a,.3*a,.3*a),t.fillRect(e+3.5*a,i+3.8*a,.3*a,.3*a),t.fillStyle="rgba(255, 255, 255, 0.4)",t.fillRect(e+2.2*a,i+1.8*a,.6*a,1.5*a);break;case"üëë":t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+3.5*a,3*a,.8*a),t.fillStyle="#DAA520",t.fillRect(e+1.8*a,i+3.7*a,2.4*a,.4*a),t.fillStyle="#FFD700",t.fillRect(e+2.8*a,i+1*a,.6*a,2.5*a),t.fillRect(e+2.9*a,i+.7*a,.4*a,.4*a),t.fillRect(e+1.8*a,i+1.8*a,.6*a,1.7*a),t.fillRect(e+1.9*a,i+1.5*a,.4*a,.4*a),t.fillRect(e+2.3*a,i+1.4*a,.5*a,2.1*a),t.fillRect(e+2.4*a,i+1.1*a,.3*a,.4*a),t.fillRect(e+3.4*a,i+1.4*a,.5*a,2.1*a),t.fillRect(e+3.5*a,i+1.1*a,.3*a,.4*a),t.fillRect(e+3.8*a,i+1.8*a,.6*a,1.7*a),t.fillRect(e+3.9*a,i+1.5*a,.4*a,.4*a),t.fillStyle="#DC143C",t.fillRect(e+2.1*a,i+2.2*a,.4*a,.4*a),t.fillRect(e+2.6*a,i+1.8*a,.4*a,.4*a),t.fillRect(e+3.1*a,i+1.5*a,.4*a,.4*a),t.fillRect(e+3.6*a,i+1.8*a,.4*a,.4*a),t.fillRect(e+4.1*a,i+2.2*a,.4*a,.4*a),t.fillStyle="rgba(147, 112, 219, 0.3)",t.fillRect(e+1.2*a,i+.5*a,3.6*a,3.5*a);break;case"üöÄ":t.fillStyle="#F0F0F0",t.fillRect(e+2.8*a,i+.8*a,.6*a,.8*a),t.fillRect(e+2.6*a,i+1.6*a,a,.6*a),t.fillRect(e+2.3*a,i+2.2*a,1.6*a,2.5*a),t.fillStyle="#1E90FF",t.fillRect(e+2.7*a,i+2.8*a,.8*a,.8*a),t.fillStyle="#87CEEF",t.fillRect(e+2.8*a,i+2.9*a,.4*a,.4*a),t.fillStyle="#FF0000",t.fillRect(e+2.3*a,i+3.8*a,1.6*a,.3*a),t.fillStyle="#DC143C",t.fillRect(e+1.5*a,i+3.5*a,.8*a,1.2*a),t.fillRect(e+3.9*a,i+3.5*a,.8*a,1.2*a),t.fillStyle="#FFA500",t.fillRect(e+2.5*a,i+4.7*a,.5*a,.8*a),t.fillRect(e+3.2*a,i+4.7*a,.5*a,.8*a),t.fillStyle="#FFD700",t.fillRect(e+2.6*a,i+5.5*a,.3*a,.5*a),t.fillRect(e+3.3*a,i+5.5*a,.3*a,.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+2*a,i+5.2*a,.3*a,.3*a),t.fillRect(e+4*a,i+5.2*a,.3*a,.3*a);break;case"‚öîÔ∏è":t.fillStyle="#C0C0C0",t.fillRect(e+2.9*a,i+.5*a,.4*a,3*a),t.fillStyle="#E8E8E8",t.fillRect(e+2.8*a,i+.8*a,.2*a,2.5*a),t.fillStyle="#FFD700",t.fillRect(e+1.8*a,i+3.5*a,2.6*a,.5*a),t.fillRect(e+1.6*a,i+3.6*a,.4*a,.3*a),t.fillRect(e+4.2*a,i+3.6*a,.4*a,.3*a),t.fillStyle="#8B4513",t.fillRect(e+2.7*a,i+4*a,.8*a,1.2*a),t.fillStyle="#654321",t.fillRect(e+2.7*a,i+4.3*a,.8*a,.15*a),t.fillRect(e+2.7*a,i+4.7*a,.8*a,.15*a),t.fillStyle="#FFD700",t.fillRect(e+2.6*a,i+5.2*a,a,.6*a),t.fillRect(e+2.7*a,i+5.8*a,.8*a,.2*a),t.fillStyle="#4169E1",t.fillRect(e+3*a,i+1.2*a,.2*a,.3*a),t.fillRect(e+3*a,i+1.8*a,.2*a,.3*a),t.fillRect(e+3*a,i+2.4*a,.2*a,.3*a),t.fillStyle="rgba(220, 20, 60, 0.3)",t.fillRect(e+2.2*a,i+.3*a,1.8*a,5.5*a);break;case"üï∞Ô∏è":t.fillStyle="#B8860B",t.fillRect(e+2.5*a,i+.8*a,a,.5*a),t.fillStyle="#DAA520",t.fillRect(e+1.5*a,i+1.3*a,3*a,4*a),t.fillStyle="#B8860B",t.fillRect(e+1.5*a,i+1.3*a,.3*a,4*a),t.fillRect(e+4.2*a,i+1.3*a,.3*a,4*a),t.fillRect(e+1.5*a,i+1.3*a,3*a,.3*a),t.fillRect(e+1.5*a,i+5*a,3*a,.3*a),t.fillStyle="#FFFFFF",t.fillRect(e+2*a,i+2*a,2*a,2.5*a),t.fillStyle="#000000",t.fillRect(e+2.9*a,i+2.2*a,.2*a,.4*a),t.fillRect(e+3.2*a,i+2.2*a,.2*a,.4*a),t.fillRect(e+3.7*a,i+3.3*a,.5*a,.2*a),t.fillRect(e+2.9*a,i+4.1*a,.5*a,.2*a),t.fillRect(e+2.1*a,i+3.3*a,.5*a,.2*a),t.fillRect(e+2.9*a,i+3.2*a,.3*a,.8*a),t.fillRect(e+3.05*a,i+2.5*a,.2*a,1.3*a),t.fillStyle="#FFD700",t.fillRect(e+2.85*a,i+3.2*a,.4*a,.4*a),t.fillStyle="#B8860B",t.fillRect(e+2.8*a,i+4.8*a,.5*a,.8*a);break;case"üïäÔ∏è":const s=Date.now()/200,o=1.5*(.5*Math.sin(s)+.5);t.fillStyle="#FFFFFF",t.fillRect(e+2.5*a,i+2*a,a,2*a),t.fillRect(e+2.2*a,i+1*a,1.6*a,1.5*a),t.fillStyle="#000000",t.fillRect(e+2.5*a,i+1.5*a,.4*a,.4*a),t.fillRect(e+3.1*a,i+1.5*a,.4*a,.4*a),t.fillStyle="#FFA500",t.fillRect(e+2.8*a,i+2.2*a,.4*a,.3*a),t.fillStyle="#FFFFFF";const n=i+2*a-o*a,r=1.5*a+.5*o*a;t.fillRect(e+1*a,n,1.5*a,r),t.fillRect(e+.5*a,n+.2*a,.4*a,.6*r),t.fillRect(e+.8*a,n,.4*a,.7*r),t.fillRect(e+1.2*a,n+.1*a,.4*a,.65*r),t.fillStyle="#F0F0F0",t.fillRect(e+1.5*a,n+.4*r,.8*a,.4*r),t.fillStyle="#FFFFFF";const h=i+2*a-o*a,c=1.5*a+.5*o*a;t.fillRect(e+3.5*a,h,1.5*a,c),t.fillRect(e+5.1*a,h+.2*a,.4*a,.6*c),t.fillRect(e+4.8*a,h,.4*a,.7*c),t.fillRect(e+4.4*a,h+.1*a,.4*a,.65*c),t.fillStyle="#F0F0F0",t.fillRect(e+3.7*a,h+.4*c,.8*a,.4*c),t.fillStyle="#FFFFFF",t.fillRect(e+2.3*a,i+4*a,.4*a,.7*a),t.fillRect(e+2.8*a,i+4.1*a,.4*a,.6*a),t.fillRect(e+3.3*a,i+4*a,.4*a,.7*a),t.fillRect(e+3.3*a,i+4*a,.4*a,.8*a),t.fillStyle="#FFA500",t.fillRect(e+2.7*a,i+4*a,.2*a,.4*a),t.fillRect(e+3.3*a,i+4*a,.2*a,.4*a);break;case"üéØ":t.fillStyle="#DC143C",t.fillRect(e+a,i+a,4*a,4*a),t.fillRect(e+.5*a,i+2*a,5*a,2*a),t.fillRect(e+2*a,i+.5*a,2*a,5*a),t.fillStyle="#FFFFFF",t.fillRect(e+1.5*a,i+1.5*a,3*a,3*a),t.fillRect(e+1.2*a,i+2.3*a,3.6*a,1.4*a),t.fillRect(e+2.3*a,i+1.2*a,1.4*a,3.6*a),t.fillStyle="#DC143C",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillRect(e+1.8*a,i+2.5*a,2.4*a,a),t.fillRect(e+2.5*a,i+1.8*a,a,2.4*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.5*a,i+2.5*a,a,a),t.fillStyle="#000000",t.fillRect(e+2.7*a,i+2.7*a,.6*a,.6*a),t.fillStyle="#000000",t.fillRect(e+1.5*a,i+2.95*a,a,.2*a),t.fillRect(e+3.5*a,i+2.95*a,a,.2*a),t.fillRect(e+2.95*a,i+1.5*a,.2*a,a),t.fillRect(e+2.95*a,i+3.5*a,.2*a,a);break;case"ü¶â":t.fillStyle="#8B4513",t.fillRect(e+1.8*a,i+2.5*a,2.5*a,2.8*a),t.fillStyle="#A0522D",t.fillRect(e+2.2*a,i+3*a,1.7*a,2*a),t.fillStyle="#8B4513",t.fillRect(e+1.5*a,i+1*a,3*a,2*a),t.fillRect(e+1.8*a,i+.8*a,2.4*a,.5*a),t.fillRect(e+1.3*a,i+.5*a,.5*a,.8*a),t.fillRect(e+4.2*a,i+.5*a,.5*a,.8*a),t.fillStyle="#FFD700",t.fillRect(e+1.9*a,i+1.5*a,1*a,1*a),t.fillRect(e+3.1*a,i+1.5*a,1*a,1*a),t.fillStyle="#654321",t.fillRect(e+1.8*a,i+1.4*a,1.2*a,.2*a),t.fillRect(e+3*a,i+1.4*a,1.2*a,.2*a),t.fillStyle="#000000",t.fillRect(e+2.2*a,i+1.8*a,.5*a,.5*a),t.fillRect(e+3.4*a,i+1.8*a,.5*a,.5*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.3*a,i+1.9*a,.2*a,.2*a),t.fillRect(e+3.5*a,i+1.9*a,.2*a,.2*a),t.fillStyle="#FFA500",t.fillRect(e+2.7*a,i+2.5*a,.7*a,.5*a),t.fillRect(e+2.8*a,i+3*a,.5*a,.3*a),t.fillStyle="#654321",t.fillRect(e+1.3*a,i+3*a,.7*a,1.5*a),t.fillRect(e+4*a,i+3*a,.7*a,1.5*a),t.fillStyle="#2F4F4F",t.fillRect(e+2.2*a,i+5*a,.4*a,.5*a),t.fillRect(e+3.5*a,i+5*a,.4*a,.5*a);break;case"‚öñÔ∏è":t.fillStyle="#B8860B",t.fillRect(e+2.5*a,i+4.5*a,1.2*a,.8*a),t.fillRect(e+2.8*a,i+2*a,.6*a,2.5*a),t.fillStyle="#DAA520",t.fillRect(e+.8*a,i+2*a,4.5*a,.4*a),t.fillStyle="#696969",t.fillRect(e+1.2*a,i+2.4*a,.2*a,.8*a),t.fillRect(e+1.8*a,i+2.4*a,.2*a,.8*a),t.fillRect(e+4*a,i+2.4*a,.2*a,.8*a),t.fillRect(e+4.6*a,i+2.4*a,.2*a,.8*a),t.fillStyle="#FFD700",t.fillRect(e+.8*a,i+3.2*a,1.5*a,.3*a),t.fillRect(e+.8*a,i+3*a,.2*a,.5*a),t.fillRect(e+2.1*a,i+3*a,.2*a,.5*a),t.fillRect(e+3.7*a,i+3.2*a,1.5*a,.3*a),t.fillRect(e+3.7*a,i+3*a,.2*a,.5*a),t.fillRect(e+5*a,i+3*a,.2*a,.5*a),t.fillStyle="#8B4513",t.fillRect(e+1.3*a,i+2.7*a,.5*a,.5*a),t.fillRect(e+4.2*a,i+2.7*a,.5*a,.5*a);break;case"üîí":t.fillStyle="#C0C0C0",t.fillRect(e+1.8*a,i+1.2*a,.6*a,1.5*a),t.fillRect(e+3.6*a,i+1.2*a,.6*a,1.5*a),t.fillRect(e+1.8*a,i+1.2*a,2.4*a,.6*a),t.fillStyle="#87CEEB",t.fillRect(e+2.4*a,i+1.8*a,1.2*a,.9*a),t.fillStyle="#FFD700",t.fillRect(e+1.5*a,i+2.7*a,3*a,2.5*a),t.fillStyle="#FFA500",t.fillRect(e+1.5*a,i+2.7*a,.5*a,2.5*a),t.fillRect(e+4*a,i+2.7*a,.5*a,2.5*a),t.fillStyle="#000000",t.fillRect(e+2.7*a,i+3.2*a,.7*a,.7*a),t.fillRect(e+2.9*a,i+3.9*a,.3*a,1*a),t.fillRect(e+2.7*a,i+4.7*a,.7*a,.3*a),t.fillStyle="#8B4513",t.fillRect(e+1.8*a,i+3*a,.3*a,.3*a),t.fillRect(e+3.9*a,i+3*a,.3*a,.3*a),t.fillRect(e+1.8*a,i+4.9*a,.3*a,.3*a),t.fillRect(e+3.9*a,i+4.9*a,.3*a,.3*a);break;case"üèîÔ∏è":t.fillStyle="#696969",t.fillRect(e+.5*a,i+4.5*a,5*a,a),t.fillRect(e+a,i+3.8*a,4*a,.7*a),t.fillRect(e+1.5*a,i+3*a,3*a,.8*a),t.fillStyle="#808080",t.fillRect(e+2.5*a,i+1.5*a,a,1.5*a),t.fillRect(e+2.2*a,i+2.2*a,1.6*a,.8*a),t.fillRect(e+1.5*a,i+2*a,.8*a,a),t.fillRect(e+1.3*a,i+2.5*a,1.2*a,.5*a),t.fillRect(e+3.7*a,i+2.3*a,.8*a,.7*a),t.fillRect(e+3.5*a,i+2.7*a,1.2*a,.3*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.5*a,i+1.5*a,a,.6*a),t.fillRect(e+2.3*a,i+2.1*a,1.4*a,.4*a),t.fillRect(e+1.5*a,i+2*a,.8*a,.5*a),t.fillRect(e+1.4*a,i+2.5*a,1*a,.3*a),t.fillRect(e+3.7*a,i+2.3*a,.8*a,.4*a),t.fillStyle="#E0F6FF",t.fillRect(e+2.7*a,i+2.5*a,.4*a,.5*a),t.fillRect(e+1.7*a,i+2.8*a,.3*a,.3*a),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(e+3.5*a,i+2*a,.3*a,a),t.fillRect(e+2*a,i+2.5*a,.3*a,.8*a);break;case"üï∫":t.fillStyle="#C0C0C0",t.fillRect(e+2.2*a,i+.5*a,1.6*a,1.6*a),t.fillStyle="#FF1493",t.fillRect(e+2.4*a,i+.7*a,.5*a,.5*a),t.fillStyle="#00FFFF",t.fillRect(e+3.1*a,i+.7*a,.5*a,.5*a),t.fillStyle="#FFD700",t.fillRect(e+2.4*a,i+1.4*a,.5*a,.5*a),t.fillStyle="#00FF00",t.fillRect(e+3.1*a,i+1.4*a,.5*a,.5*a),t.fillStyle="#FF1493",t.fillRect(e+2.6*a,i+2.5*a,.8*a,.8*a),t.fillRect(e+2.3*a,i+3.3*a,1.4*a,1.2*a),t.fillRect(e+1.5*a,i+3*a,.8*a,.4*a),t.fillRect(e+1.2*a,i+2.3*a,.4*a,.8*a),t.fillRect(e+3.7*a,i+3.2*a,.8*a,.4*a),t.fillRect(e+4.4*a,i+2.7*a,.4*a,.6*a),t.fillRect(e+2*a,i+4.5*a,.5*a,1*a),t.fillRect(e+3.5*a,i+4.5*a,.5*a,1*a),t.fillStyle="#FFD700",t.fillRect(e+.8*a,i+a,.4*a,.4*a),t.fillRect(e+4.8*a,i+1.5*a,.4*a,.4*a),t.fillRect(e+1.2*a,i+4.5*a,.4*a,.4*a),t.fillStyle="#FF69B4",t.fillRect(e+5*a,i+3.5*a,.4*a,.4*a),t.fillRect(e+.6*a,i+2.8*a,.4*a,.4*a);break;case"ü¶£":t.fillStyle="#8B7355",t.fillRect(e+a,i+2.5*a,3.5*a,2.8*a),t.fillStyle="#6F5943",t.fillRect(e+a,i+3*a,.4*a,2*a),t.fillRect(e+1.8*a,i+3.2*a,.4*a,1.8*a),t.fillRect(e+2.6*a,i+3*a,.4*a,2*a),t.fillRect(e+3.4*a,i+3.2*a,.4*a,1.8*a),t.fillStyle="#8B7355",t.fillRect(e+1.2*a,i+5.3*a,.8*a,.7*a),t.fillRect(e+2.2*a,i+5.3*a,.8*a,.7*a),t.fillRect(e+3.2*a,i+5.3*a,.8*a,.7*a),t.fillRect(e+4*a,i+2*a,1.5*a,2*a),t.fillRect(e+4.8*a,i+2.3*a,.7*a,a),t.fillRect(e+5.5*a,i+2.5*a,.5*a,1.2*a),t.fillRect(e+5.3*a,i+3.7*a,.7*a,.5*a),t.fillRect(e+4.8*a,i+4.2*a,.5*a,.6*a),t.fillStyle="#FFFFFF",t.fillRect(e+4.8*a,i+3.5*a,.4*a,1.5*a),t.fillRect(e+4.5*a,i+4.8*a,.4*a,.5*a),t.fillRect(e+5.7*a,i+3.5*a,.4*a,1.5*a),t.fillRect(e+5.8*a,i+4.8*a,.4*a,.5*a),t.fillStyle="#000000",t.fillRect(e+4.5*a,i+2.5*a,.3*a,.3*a);break;case"üê≠":t.fillStyle="#C0C0C0",t.fillRect(e+2.5*a,i+2.8*a,1.5*a,.7*a),t.fillRect(e+3.8*a,i+2.5*a,.7*a,.7*a),t.fillRect(e+3.8*a,i+2.2*a,.3*a,.3*a),t.fillRect(e+4.4*a,i+2.2*a,.3*a,.3*a),t.fillRect(e+2*a,i+3*a,.7*a,.3*a);break;case"üåà":t.fillStyle="#FF0000",t.fillRect(e+a,i+3*a,4*a,.4*a),t.fillStyle="#FFA500",t.fillRect(e+1.2*a,i+2.6*a,3.6*a,.4*a),t.fillStyle="#FFFF00",t.fillRect(e+1.4*a,i+2.2*a,3.2*a,.4*a),t.fillStyle="#00FF00",t.fillRect(e+1.6*a,i+1.8*a,2.8*a,.4*a),t.fillStyle="#0000FF",t.fillRect(e+1.8*a,i+1.4*a,2.4*a,.4*a),t.fillStyle="#9400D3",t.fillRect(e+2*a,i+a,2*a,.4*a);break;case"ü¶ò":t.fillStyle="#DEB887",t.fillRect(e+2*a,i+2*a,2*a,2*a),t.fillRect(e+2.5*a,i+1.3*a,a,a),t.fillRect(e+2.3*a,i+a,.5*a,.5*a),t.fillRect(e+3.2*a,i+a,.5*a,.5*a),t.fillRect(e+1.3*a,i+3*a,a,a),t.fillRect(e+2.3*a,i+4*a,.7*a,a),t.fillRect(e+3*a,i+4*a,.7*a,a);break;case"üéí":t.fillStyle="#00CED1",t.fillRect(e+2*a,i+2*a,2*a,2.5*a),t.fillStyle="#008B8B",t.fillRect(e+2.3*a,i+1.5*a,.5*a,a),t.fillRect(e+3.2*a,i+1.5*a,.5*a,a),t.fillStyle="#696969",t.fillRect(e+2.3*a,i+4.5*a,.7*a,.7*a),t.fillRect(e+3*a,i+4.5*a,.7*a,.7*a),t.fillStyle="#FF4500",t.fillRect(e+2.5*a,i+5.2*a,.3*a,.5*a),t.fillRect(e+3.2*a,i+5.2*a,.3*a,.5*a);break;case"ü•∑":t.fillStyle="#2F4F4F",t.fillRect(e+2.6*a,i+1.8*a,.9*a,.9*a),t.fillStyle="#DC143C",t.fillRect(e+2.3*a,i+2*a,1.5*a,.4*a),t.fillRect(e+3.8*a,i+1.9*a,.5*a,.6*a),t.fillStyle="#FFFFFF",t.fillRect(e+2.7*a,i+2.1*a,.4*a,.2*a),t.fillRect(e+3.2*a,i+2.1*a,.4*a,.2*a),t.fillStyle="#2F4F4F",t.fillRect(e+2.3*a,i+2.7*a,1.5*a,2*a),t.fillRect(e+1.5*a,i+3*a,.8*a,.5*a),t.fillStyle="#C0C0C0",t.fillRect(e+.5*a,i+2.3*a,a,.3*a),t.fillRect(e+.8*a,i+1.8*a,.7*a,.3*a),t.fillStyle="#000000",t.fillRect(e+1.5*a,i+2.5*a,.5*a,.3*a),t.fillStyle="#2F4F4F",t.fillRect(e+3.8*a,i+3.3*a,.8*a,.5*a),t.fillStyle="#DC143C",t.fillRect(e+2.3*a,i+3.8*a,1.5*a,.3*a),t.fillStyle="#2F4F4F",t.fillRect(e+2.5*a,i+4.7*a,.6*a,1.3*a),t.fillRect(e+3.2*a,i+4.7*a,.6*a,1.3*a),t.fillStyle="#696969",t.fillRect(e+4.5*a,i+3.5*a,.5*a,.5*a),t.fillRect(e+4.3*a,i+3.7*a,.9*a,.2*a);break;case"üéâ":t.fillStyle="#FF0000",t.fillRect(e+.8*a,i+.8*a,.6*a,.6*a),t.fillRect(e+4.5*a,i+1.5*a,.5*a,.8*a),t.fillStyle="#FFD700",t.fillRect(e+1.8*a,i+a,.7*a,.5*a),t.fillRect(e+4*a,i+4.2*a,.8*a,.6*a),t.fillStyle="#00FF00",t.fillRect(e+3.2*a,i+1.2*a,.6*a,.7*a),t.fillRect(e+1.2*a,i+4*a,.7*a,.5*a),t.fillStyle="#0000FF",t.fillRect(e+4.8*a,i+3*a,.5*a,.6*a),t.fillRect(e+2.8*a,i+5*a,.6*a,.5*a),t.fillStyle="#FF69B4",t.fillRect(e+.5*a,i+3*a,.7*a,.6*a),t.fillRect(e+3.8*a,i+5.2*a,.6*a,.5*a),t.fillStyle="#9400D3",t.fillRect(e+2*a,i+3.5*a,.5*a,.7*a),t.fillRect(e+5.2*a,i+2*a,.6*a,.5*a),t.fillStyle="#FFA500",t.fillRect(e+1.5*a,i+2*a,1.5*a,.3*a),t.fillRect(e+2*a,i+2.3*a,a,.3*a),t.fillRect(e+2.5*a,i+2.6*a,1.2*a,.3*a),t.fillStyle="#FF1493",t.fillRect(e+3.5*a,i+3.2*a,1.3*a,.3*a),t.fillRect(e+3.8*a,i+3.5*a,.8*a,.3*a),t.fillRect(e+3.3*a,i+3.8*a,a,.3*a),t.fillStyle="#FFD700",t.fillRect(e+2.8*a,i+1.8*a,.5*a,.5*a),t.fillRect(e+2.6*a,i+2*a,.3*a,.2*a),t.fillRect(e+3.2*a,i+2*a,.3*a,.2*a);break;case"‚òï":t.fillStyle="#F5F5F5",t.fillRect(e+1.2*a,i+4.5*a,3.6*a,.5*a),t.fillRect(e+.8*a,i+5*a,4.4*a,.4*a),t.fillStyle="#6F4E37",t.fillRect(e+1.8*a,i+2.8*a,2.5*a,1.7*a),t.fillStyle="#8B6F47",t.fillRect(e+1.9*a,i+2.9*a,.5*a,1.5*a),t.fillStyle="#6F4E37",t.fillRect(e+4.3*a,i+3.2*a,.5*a,1.2*a),t.fillStyle="#87CEEB",t.fillRect(e+4.5*a,i+3.5*a,.3*a,.6*a),t.fillStyle="#2F1B0F",t.fillRect(e+2*a,i+3*a,2.1*a,a),t.fillStyle="#4A2F1F",t.fillRect(e+2.2*a,i+3.1*a,.8*a,.3*a),t.fillStyle="#E0E0E0",t.fillRect(e+2.2*a,i+2*a,.4*a,.8*a),t.fillRect(e+2*a,i+1.5*a,.4*a,.5*a),t.fillRect(e+2.2*a,i+1.2*a,.3*a,.3*a),t.fillRect(e+3*a,i+1.5*a,.4*a,a),t.fillRect(e+3.2*a,i+.8*a,.4*a,.7*a),t.fillRect(e+3*a,i+.5*a,.3*a,.3*a),t.fillRect(e+3.8*a,i+2.2*a,.4*a,.6*a),t.fillRect(e+4*a,i+1.7*a,.4*a,.5*a),t.fillRect(e+3.8*a,i+1.3*a,.3*a,.4*a),t.fillStyle="#8B4513",t.fillRect(e+2.8*a,i+3.8*a,.5*a,.4*a);break;default:t.fillStyle=l,t.fillRect(e+a,i+a,4*a,4*a),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(e+a,i+4*a,4*a,a),t.strokeStyle="#000000",t.lineWidth=2,t.strokeRect(e+a,i+a,4*a,4*a)}}drawVoxelParticle(t,e,i,s){this.ctx.fillStyle=s,this.ctx.fillRect(t,e,i,i),this.ctx.fillStyle=this.darkenColor(s,.3),this.ctx.fillRect(t,e+.7*i,i,.3*i),this.ctx.strokeStyle="rgba(0,0,0,0.5)",this.ctx.lineWidth=1,this.ctx.strokeRect(t,e,i,i)}drawVoxelExplosion(t,e,i,s){const l=.5*this.blockSize;for(let a=0;a<12;a++){const o=a/12*Math.PI*2,n=i*s,r=t+Math.cos(o)*n,h=e+Math.sin(o)*n,c=["#FF6B00","#FFD700","#FF0000","#FFA500"],d=c[a%c.length];this.drawVoxelParticle(r,h,l*(1-.5*s),d)}}drawVoxelBubble(t,e,i,s,l){const a=`${i}_${s}_${l}`;if(!this.bubbleCache.has(a)){const t=document.createElement("canvas");t.width=i,t.height=s;const e=t.getContext("2d");this.drawBubbleToCanvas(e,0,0,i,s,l),this.bubbleCache.set(a,t)}const o=this.bubbleCache.get(a);this.ctx.drawImage(o,t,e)}drawBubbleToCanvas(t,e,i,s,l,a){const o=t.createLinearGradient(e,i,e,i+l);o.addColorStop(0,"#FFFFFF"),o.addColorStop(1,"#F0F8FF"),t.fillStyle=o,t.fillRect(e,i,s,l),t.strokeStyle="#000000",t.lineWidth=4,t.strokeRect(e+2,i+2,s-4,l-4),t.strokeStyle="#FFD700",t.lineWidth=2,t.strokeRect(e+5,i+5,s-10,l-10),t.fillStyle="#4169E1",t.fillRect(e+8,i+8,4,4),t.fillRect(e+8+4,i+8,4,4),t.fillRect(e+8,i+8+4,4,4),t.fillRect(e+s-8-8,i+8,4,4),t.fillRect(e+s-8-4,i+8,4,4),t.fillRect(e+s-8-8,i+8+4,4,4),t.fillRect(e+8,i+l-8-8,4,4),t.fillRect(e+8+4,i+l-8-8,4,4),t.fillRect(e+8,i+l-8-4,4,4),t.fillRect(e+s-8-8,i+l-8-8,4,4),t.fillRect(e+s-8-4,i+l-8-8,4,4),t.fillRect(e+s-8-8,i+l-8-4,4,4),t.fillStyle="#FFD700",t.fillRect(e+15,i+l/2-4,4,4),t.fillRect(e+15-4,i+l/2,4,4),t.fillRect(e+15+4,i+l/2,4,4),t.fillRect(e+s-15-4,i+l/2-4,4,4),t.fillRect(e+s-15-8,i+l/2,4,4),t.fillRect(e+s-15,i+l/2,4,4);const n=t.createLinearGradient(e,i+.8*l,e,i+l);n.addColorStop(0,"rgba(0, 0, 0, 0)"),n.addColorStop(1,"rgba(0, 0, 0, 0.1)"),t.fillStyle=n,t.fillRect(e,i+.8*l,s,.2*l),t.fillStyle="#000000",t.font="bold 14px Arial, sans-serif",t.textAlign="center",t.textBaseline="middle";const r=a.split(" "),h=[];let c="";r.forEach(e=>{const i=c+e+" ";t.measureText(i).width>s-20&&""!==c?(h.push(c),c=e+" "):c=i}),h.push(c);const d=i+l/2-16*h.length/2;h.forEach((i,l)=>{t.fillText(i.trim(),e+s/2,d+16*l)})}drawVoxelBackground(t){const e=2*this.blockSize,l=this.ctx.createLinearGradient(0,0,0,s);l.addColorStop(0,"#87CEEB"),l.addColorStop(1,"#E0F6FF"),this.ctx.fillStyle=l,this.ctx.fillRect(0,0,i,s);for(let s=0;s<5;s++){const l=(.3*t+200*s)%(i+200)-100,a=50+40*s;this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(l+e,a,3*e,e),this.ctx.fillRect(l,a+.3*e,4*e,.7*e),this.ctx.fillRect(l+.5*e,a+.6*e,3*e,.5*e),this.ctx.strokeStyle="rgba(0, 0, 0, 0.1)",this.ctx.lineWidth=1,this.ctx.strokeRect(l,a+.3*e,4*e,.7*e)}const a=s-80,o=e;for(let s=0;s<i/o+1;s++)this.ctx.fillStyle="#7CFC00",this.ctx.fillRect(s*o,a,o,o),this.ctx.fillStyle="#5DA800",this.ctx.fillRect(s*o,a+.7*o,o,.3*o),this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)",this.ctx.lineWidth=1,this.ctx.strokeRect(s*o,a,o,o),this.ctx.fillStyle="#8B4513",this.ctx.fillRect(s*o,a+o,o,o),this.ctx.fillStyle="#654321",this.ctx.fillRect(s*o,a+o+.7*o,o,.3*o),this.ctx.strokeStyle="rgba(0, 0, 0, 0.2)",this.ctx.strokeRect(s*o,a+o,o,o)}drawVoxelSpeechBubble(t,e,i,s,l,a,o="#000000"){const n=this.ctx,r=12;n.fillStyle="#FFFFFF",n.fillRect(t+r,e,i-24,s),n.fillRect(t,e+r,i,s-24),n.fillRect(t+4,e+4,8,4),n.fillRect(t+4,e+8,4,4),n.fillRect(t+i-12,e+4,8,4),n.fillRect(t+i-8,e+8,4,4),n.fillRect(t+4,e+s-8,8,4),n.fillRect(t+4,e+s-12,4,4),n.fillRect(t+i-12,e+s-8,8,4),n.fillRect(t+i-8,e+s-12,4,4),n.fillStyle=o,n.fillRect(t+r,e,i-24,4),n.fillRect(t+r,e+s-4,i-24,4),n.fillRect(t,e+r,4,s-24),n.fillRect(t+i-4,e+r,4,s-24),n.fillRect(t+8,e,4,4),n.fillRect(t+4,e+4,4,4),n.fillRect(t,e+8,4,4),n.fillRect(t+i-12,e,4,4),n.fillRect(t+i-8,e+4,4,4),n.fillRect(t+i-4,e+8,4,4),n.fillRect(t+8,e+s-4,4,4),n.fillRect(t+4,e+s-8,4,4),n.fillRect(t,e+s-12,4,4),n.fillRect(t+i-12,e+s-4,4,4),n.fillRect(t+i-8,e+s-8,4,4),n.fillRect(t+i-4,e+s-12,4,4);const h=t+i/2,c=e+s;if(n.fillStyle="#FFFFFF",n.fillRect(h-8,c,16,4),n.fillRect(h-4,c+4,8,4),n.fillRect(h-4,c+8,4,4),n.fillStyle=o,n.fillRect(h-12,c,4,4),n.fillRect(h-8,c+4,4,4),n.fillRect(h-8,c+8,4,4),n.fillRect(h-4,c+12,4,4),n.fillRect(h+8,c,4,4),n.fillRect(h+4,c+4,4,4),n.fillRect(h+4,c+8,4,4),n.fillRect(h,c+12,4,4),l&&(n.font="bold 36px Arial",n.textAlign="center",n.textBaseline="top",n.fillStyle="#000000",n.fillText(l,t+i/2+2,e+12),n.fillStyle=o,n.fillText(l,t+i/2,e+10)),a){n.font="bold 16px monospace",n.textAlign="center",n.textBaseline="top",n.fillStyle="#000000";const s=i-20,o=a.split(" "),r=[];let h="";for(const t of o){const e=h?`${h} ${t}`:t;n.measureText(e).width>s&&h?(r.push(h),h=t):h=e}h&&r.push(h);const c=20,d=e+(l?55:15);r.forEach((e,s)=>{n.fillText(e,t+i/2,d+s*c)})}n.fillStyle="#FFD700",n.fillRect(t+8,e+8,4,4),n.fillRect(t+i-12,e+8,4,4),n.fillStyle="#FFEB3B";n.fillRect(t+16,e+12,4,4),n.fillRect(t+12,e+16,4,4),n.fillRect(t+20,e+16,4,4),n.fillRect(t+16,e+20,4,4),n.fillRect(t+i-20,e+12,4,4),n.fillRect(t+i-24,e+16,4,4),n.fillRect(t+i-16,e+16,4,4),n.fillRect(t+i-20,e+20,4,4)}drawVoxelProverb(t,e,i){const s=this.ctx,l=32;s.fillStyle="#F4E8D0",s.fillRect(t-16,e-16+4,l,24),s.fillRect(t-16+4,e-16,24,l),s.strokeStyle="#8B4513",s.lineWidth=3,s.strokeRect(t-16+2,e-16+2,28,28),s.strokeStyle="#A0826D",s.lineWidth=2,[e-8,e,e+8].forEach(e=>{s.beginPath(),s.moveTo(t-16+6,e),s.lineTo(t+16-6,e),s.stroke()}),s.fillStyle="rgba(0, 0, 0, 0.2)",s.fillRect(t-16+2,e+16-4,28,2),s.fillStyle="#FFF8E7",s.fillRect(t-16+4,e-16+4,8,4),s.fillRect(t+16-4-8,e-16+4,8,4);const a=44;s.strokeStyle="rgba(74, 144, 164, 0.5)",s.lineWidth=4,s.strokeRect(t-22,e-22,a,a),s.fillStyle="#87CEEB";[[t-22-2,e-22-2],[t+22-2,e-22-2],[t-22-2,e+22-2],[t+22-2,e+22-2]].forEach(([t,e])=>{s.fillRect(t,e,4,4),s.fillRect(t+4,e+4,4,4)})}drawVoxelNarrativeBubble(t,e,i,s=300){const l=this.ctx,a=15;l.font="bold 14px monospace";const o=i.split(" "),n=[];let r="";for(const x of o){const t=r?`${r} ${x}`:x;l.measureText(t).width>s-30&&r?(n.push(r),r=x):r=t}r&&n.push(r);let h=0;n.forEach(t=>{const e=l.measureText(t);h=Math.max(h,e.width)});const c=h+30,d=18*n.length+30;l.fillStyle="#FFFFFF",l.fillRect(t+6,e,c-12,d),l.fillRect(t,e+6,c,d-12),l.fillRect(t+3,e+3,3,3),l.fillRect(t+c-6,e+3,3,3),l.fillRect(t+3,e+d-6,3,3),l.fillRect(t+c-6,e+d-6,3,3),l.fillStyle="#333333",l.fillRect(t+6,e,c-12,3),l.fillRect(t+6,e+d-3,c-12,3),l.fillRect(t,e+6,3,d-12),l.fillRect(t+c-3,e+6,3,d-12),l.fillRect(t+3,e,3,3),l.fillRect(t,e+3,3,3),l.fillRect(t+c-6,e,3,3),l.fillRect(t+c-3,e+3,3,3),l.fillRect(t+3,e+d-3,3,3),l.fillRect(t,e+d-6,3,3),l.fillRect(t+c-6,e+d-3,3,3),l.fillRect(t+c-3,e+d-6,3,3),l.fillStyle="#666666";const u=t+a,f=e+a;l.font="16px Arial",l.textAlign="left",l.textBaseline="top",l.fillText("üí≠",u,f),l.fillStyle="#333333",l.font="bold 14px monospace",l.textAlign="left",n.forEach((i,s)=>{l.fillText(i,t+a+20,e+a+18*s)});const g=t+c/2,m=e+d;l.fillStyle="#FFFFFF",l.fillRect(g-6,m,12,3),l.fillRect(g-3,m+3,6,3),l.fillRect(g,m+6,3,3),l.fillStyle="#333333",l.fillRect(g-9,m,3,3),l.fillRect(g-6,m+3,3,3),l.fillRect(g-3,m+6,3,3),l.fillRect(g+6,m,3,3),l.fillRect(g+3,m+3,3,3),l.fillRect(g,m+6,3,3)}drawVoxelWaterTank(t,e,i,s){const l=this.ctx;l.fillStyle="#00BFFF",l.fillRect(t+6,e+6,i-12,s-12),l.fillStyle="#0099CC",l.fillRect(t+i-12,e+9,6,s-18),l.fillRect(t+9,e+s-15,i-18,6),l.fillStyle="#666666",l.fillRect(t+6,e+9,i-12,3),l.fillRect(t+6,e+s/2-3,i-12,3),l.fillRect(t+6,e+s-12,i-12,3),l.fillStyle="#000000",l.fillRect(t+6,e+3,i-12,3),l.fillRect(t+6,e+s-6,i-12,3),l.fillRect(t+3,e+6,3,s-12),l.fillRect(t+i-6,e+6,3,s-12),l.fillRect(t+6,e+6,3,3),l.fillRect(t+i-9,e+6,3,3),l.fillRect(t+6,e+s-9,3,3),l.fillRect(t+i-9,e+s-9,3,3);const a=t+i/2,o=e+s/2;l.fillStyle="#FFFFFF",l.fillRect(a-3,o-9,6,3),l.fillRect(a-6,o-6,12,9),l.fillRect(a-4.5,o+3,9,3),l.fillRect(a-3,o+6,6,3),l.fillStyle="#0080FF",l.fillRect(a-3,o-12,6,3),l.fillRect(a-9,o-6,3,9),l.fillRect(a+6,o-6,3,9),l.fillRect(a-6,o+6,12,3),l.fillStyle="#87CEEB",l.fillRect(a-3,o-3,3,3)}darkenColor(t,e){return this.adjustColor(t,-e)}lightenColor(t,e){return this.adjustColor(t,e)}adjustColor(t,e){const i=t.replace("#","");let s=parseInt(i.substring(0,2),16),l=parseInt(i.substring(2,4),16),a=parseInt(i.substring(4,6),16);return s=Math.max(0,Math.min(255,s+255*e)),l=Math.max(0,Math.min(255,l+255*e)),a=Math.max(0,Math.min(255,a+255*e)),"#"+Math.round(s).toString(16).padStart(2,"0")+Math.round(l).toString(16).padStart(2,"0")+Math.round(a).toString(16).padStart(2,"0")}}class V{constructor(t){this.canvas=t,this.clouds=[],this.skyGradient=null,this.initSky(),this.spawnClouds()}initSky(){const t=this.canvas.getContext("2d");this.skyGradient=t.createLinearGradient(0,0,0,this.canvas.height),this.skyGradient.addColorStop(0,"#87CEEB"),this.skyGradient.addColorStop(1,"#E0F6FF")}spawnClouds(){for(let t=0;t<8;t++)this.clouds.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height*.7,width:80+120*Math.random(),height:40+60*Math.random(),speed:.5+1.5*Math.random(),opacity:.6+.3*Math.random()})}update(){this.clouds.forEach(t=>{t.x-=t.speed,t.x+t.width<0&&(t.x=this.canvas.width+50,t.y=Math.random()*this.canvas.height*.7,t.width=80+120*Math.random(),t.height=40+60*Math.random(),t.speed=.5+1.5*Math.random(),t.opacity=.6+.3*Math.random())})}render(t){t.fillStyle=this.skyGradient,t.fillRect(0,0,this.canvas.width,this.canvas.height),this.clouds.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.fillStyle="#FFFFFF";const i=e.x+e.width/2,s=e.y+e.height/2,l=e.height/2;t.beginPath(),t.arc(i-.25*e.width,s,.8*l,0,2*Math.PI),t.arc(i,s-.3*l,l,0,2*Math.PI),t.arc(i+.25*e.width,s,.8*l,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(i,s+.3*l,.45*e.width,.6*l,0,0,2*Math.PI),t.fill(),t.restore()})}}class q{constructor(t){this.canvas=t,this.waves=[],this.stars=[],this.moonX=.2*t.width,this.moonY=80,this.time=0,this.initStars(),this.initWaves()}initStars(){for(let t=0;t<100;t++)this.stars.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height*.4,size:1+2*Math.random(),opacity:.3+.7*Math.random(),twinkleSpeed:.01+.02*Math.random(),twinklePhase:Math.random()*Math.PI*2})}initWaves(){for(let t=0;t<3;t++)this.waves.push({offset:0,amplitude:10+5*t,frequency:.02-.005*t,speed:1+.5*t,y:.5*this.canvas.height+30*t,opacity:.3-.1*t})}update(){this.time+=.02,this.waves.forEach(t=>{t.offset+=t.speed}),this.stars.forEach(t=>{t.twinklePhase+=t.twinkleSpeed,t.opacity=.3+.4*Math.sin(t.twinklePhase)})}render(t){const e=t.createLinearGradient(0,0,0,.5*this.canvas.height);e.addColorStop(0,"#0a0e27"),e.addColorStop(1,"#1a2a4e"),t.fillStyle=e,t.fillRect(0,0,this.canvas.width,.5*this.canvas.height),this.stars.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.fillStyle="#FFFFFF",t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill(),e.size>1.5&&(t.fillStyle="#FFE6A0",t.beginPath(),t.arc(e.x,e.y,.5*e.size,0,2*Math.PI),t.fill()),t.restore()}),t.save(),t.fillStyle="#FFF8DC",t.shadowColor="#FFE6A0",t.shadowBlur=30,t.beginPath(),t.arc(this.moonX,this.moonY,40,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.globalAlpha=.2,t.fillStyle="#D3D3D3",t.beginPath(),t.arc(this.moonX-10,this.moonY-8,8,0,2*Math.PI),t.arc(this.moonX+12,this.moonY+5,6,0,2*Math.PI),t.arc(this.moonX-5,this.moonY+15,5,0,2*Math.PI),t.fill(),t.restore();const i=t.createLinearGradient(0,.5*this.canvas.height,0,this.canvas.height);i.addColorStop(0,"#1a3a52"),i.addColorStop(.5,"#0d2535"),i.addColorStop(1,"#051219"),t.fillStyle=i,t.fillRect(0,.5*this.canvas.height,this.canvas.width,.5*this.canvas.height),t.save(),t.globalAlpha=.15;const s=t.createLinearGradient(this.moonX,.5*this.canvas.height,this.moonX,this.canvas.height);s.addColorStop(0,"#FFE6A0"),s.addColorStop(1,"transparent"),t.fillStyle=s,t.fillRect(this.moonX-30,.5*this.canvas.height,60,.5*this.canvas.height),t.restore(),this.waves.forEach(e=>{t.save(),t.globalAlpha=e.opacity,t.strokeStyle="#4A90A4",t.lineWidth=2,t.beginPath();for(let i=0;i<this.canvas.width;i+=5){const s=e.y+Math.sin((i+e.offset)*e.frequency)*e.amplitude;0===i?t.moveTo(i,s):t.lineTo(i,s)}t.stroke(),t.restore()}),t.strokeStyle="#2a4a5e",t.lineWidth=2,t.beginPath(),t.moveTo(0,.5*this.canvas.height),t.lineTo(this.canvas.width,.5*this.canvas.height),t.stroke()}}class W{constructor(t){this.game=t,this.ctx=t.ctx,this.canvas=t.canvas,this.sheepAnimator=new u,this.particleSystem=new D,this.renderMode=localStorage.getItem("xsheep_renderMode")||"pixel",console.log(`üé® Moteur de rendu: ${this.renderMode}`),z.setupContext(this.ctx),"voxel"===this.renderMode&&(this.voxelRenderer=new O(this.ctx)),this.cloudOffset=0,this.starOpacity=[.6,.5,.4],this.starDirection=[1,1,1],this.refuelEffects=[],this.useBackgroundImage=!1,this.backgroundImage=null,this.loadBackgroundImage(),this.cloudBackground=new V(this.canvas),this.waterBackground=new q(this.canvas)}loadBackgroundImage(){this.backgroundImage=new Image,this.backgroundImage.onload=()=>{this.useBackgroundImage=!0,console.log("‚úÖ Background image loaded - Performance mode")},this.backgroundImage.onerror=()=>{console.log("‚ö†Ô∏è Background image not found - Using canvas rendering")};const t=window.location.pathname.split("/").filter(Boolean),e=t.length>0&&"index.html"!==t[0]?`/${t[0]}/`:"/";this.backgroundImage.src=`${e}assets/background.png`}render(){var t;let e=!1;if(this.game.screenShake>0){const t=(Math.random()-.5)*this.game.screenShakeIntensity,i=(Math.random()-.5)*this.game.screenShakeIntensity;this.ctx.save(),this.ctx.translate(t,i),e=!0}if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.game.level3Active||this.game.level3Entering)this.waterBackground.update(),this.waterBackground.render(this.ctx),this.game.lighthouse&&this.game.lighthouse.render(this.ctx),this.game.heavenGate&&this.game.heavenGate.visible&&this.game.heavenGate.render(this.ctx),this.game.level3Obstacles.forEach(t=>{this.drawSeaObstacle(t)}),this.game.level3Projectiles.forEach(t=>{this.ctx.save(),this.ctx.font="28px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="#4A90A4",this.ctx.shadowBlur=10,this.ctx.fillText(t.icon,t.x,t.y),this.ctx.restore()}),this.game.leviathan&&this.game.leviathan.isActive&&this.game.leviathan.render(this.ctx),this.game.level3Proverbs.forEach(t=>{t.collected||("voxel"===this.renderMode&&this.voxelRenderer?this.voxelRenderer.drawVoxelProverb(t.x,t.y,t.icon):(this.ctx.save(),this.ctx.shadowColor="#4A90A4",this.ctx.shadowBlur=15,this.ctx.font="32px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.icon,t.x,t.y),this.ctx.strokeStyle="#4A90A4",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,25,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore()))});else if(this.game.level2Active)this.cloudBackground.update(),this.cloudBackground.render(this.ctx);else if(this.useBackgroundImage&&this.backgroundImage.complete)this.drawBackgroundImage();else if("voxel"===this.renderMode&&this.voxelRenderer){const t=this.game.obstacleManager?2*this.game.obstacleManager.timer:0;this.voxelRenderer.drawVoxelBackground(t)}else this.drawBackgroundCanvas();if("endless"===this.game.mode&&this.game.endlessMode?this.game.endlessMode.render(this.ctx):(this.game.obstacleManager.getAll().forEach(t=>{this.drawObstacle(t)}),this.game.obstacleManager.getWeapons().forEach(t=>{this.drawObstacle(t)}),this.game.obstacleManager.getFallingObjects().forEach(t=>{this.drawFallingObject(t)}),this.game.obstacleManager.explosions.forEach(t=>{this.drawExplosion(t)})),null==(t=this.game.powerUpManager)||t.getAll().forEach(t=>{this.drawPowerUp(t)}),this.game.waterTankSystem&&this.game.waterTankSystem.render(this.ctx),this.game.goldSystem&&this.game.goldSystem.render(this.ctx),this.drawProjectiles(),this.drawPlayer(),"endless"===this.game.mode&&this.game.laserSystem&&this.game.laserSystem.render(this.ctx),this.updateRefuelEffects(),this.drawRefuelEffects(),this.particleSystem.render(this.ctx),this.drawUnifiedUI(),this.game.icebergSinking){const t=this.game.sinkingTimer;if(this.ctx.fillStyle=`rgba(0, 30, 60, ${Math.min(t/240,.5)})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.font="bold 36px Arial",this.ctx.strokeStyle="#000",this.ctx.lineWidth=3,t>=40&&t<120){const e=t<55?(t-40)/15:t>105?(120-t)/15:1;this.ctx.fillStyle=`rgba(255, 255, 255, ${e})`,this.ctx.strokeText("TOUIK",120,120),this.ctx.fillText("TOUIK",120,120)}if(t>=70&&t<150){const e=t<85?(t-70)/15:t>135?(150-t)/15:1;this.ctx.fillStyle=`rgba(255, 255, 255, ${e})`,this.ctx.strokeText("TOUIK",this.canvas.width-200,160),this.ctx.fillText("TOUIK",this.canvas.width-200,160)}if(t>=100&&t<180){const e=t<115?(t-100)/15:t>165?(180-t)/15:1;this.ctx.fillStyle=`rgba(255, 255, 255, ${e})`,this.ctx.strokeText("TOUIK",this.canvas.width/2-60,280),this.ctx.fillText("TOUIK",this.canvas.width/2-60,280)}if(this.ctx.restore(),t>50){this.ctx.strokeStyle="rgba(255, 255, 255, 0.25)",this.ctx.lineWidth=1.5;for(let t=0;t<6;t++){const e=t/6*Math.PI*2,i=this.game.player.x+60*Math.cos(e),s=this.game.player.y+40*Math.sin(e),l=i+30*Math.cos(e),a=s+15*Math.sin(e);this.ctx.beginPath(),this.ctx.moveTo(i,s),this.ctx.lineTo(l,a),this.ctx.stroke()}}}this.game.heavenGate&&this.game.heavenGate.render(this.ctx),this.game.rejectionBubble&&this.drawRejectionBubble(this.game.rejectionBubble),this.game.introSequence&&this.game.introSequence.isActive()&&this.game.introSequence.render(this.ctx),"endless"===this.game.mode&&this.game.endlessMode&&(this.game.endlessMode.renderOnomatopoeia(this.ctx),this.game.endlessMode.renderBossComment(this.ctx)),this.game.notificationSystem&&(this.game.notificationSystem.updateCanvasBubbles(),this.game.notificationSystem.drawCanvasBubbles(this.ctx,this)),this.game.obstacleManager&&this.game.obstacleManager.trophySystem&&this.game.obstacleManager.trophySystem.renderNotifications(this.ctx,this.canvas.width),e&&this.ctx.restore()}drawBackgroundImage(){this.ctx.drawImage(this.backgroundImage,0,0,this.canvas.width,this.canvas.height)}drawBackgroundCanvas(){const t=this.ctx.createLinearGradient(0,0,0,this.canvas.height-80);t.addColorStop(0,"#87CEEB"),t.addColorStop(.4,"#B0E0E6"),t.addColorStop(.7,"#98FB98"),t.addColorStop(1,"#90EE90"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height-80),this.drawDivineRays(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=2,this.ctx.setLineDash([10,10]),this.ctx.beginPath(),this.ctx.moveTo(0,150),this.ctx.lineTo(this.canvas.width,150),this.ctx.moveTo(0,300),this.ctx.lineTo(this.canvas.width,300),this.ctx.stroke(),this.ctx.setLineDash([]),this.drawAnimatedClouds(),this.drawTwinklingStars(),this.drawStainedGlassGround(),this.drawDivineParticles()}drawDivineRays(){this.ctx.globalAlpha=.15;[150,350,550].forEach(t=>{const e=this.ctx.createLinearGradient(t,0,t,this.canvas.height-80);e.addColorStop(0,"rgba(255, 215, 0, 0.3)"),e.addColorStop(.5,"rgba(255, 165, 0, 0.1)"),e.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=e,this.ctx.fillRect(t-15,0,30,this.canvas.height-80)}),this.ctx.globalAlpha=1}drawAnimatedClouds(){this.cloudOffset+=.02;const t=[{x:100,y:80+5*Math.sin(this.cloudOffset)},{x:350,y:120+6*Math.sin(this.cloudOffset+1)},{x:600,y:90+4*Math.sin(this.cloudOffset+2)}];this.ctx.globalAlpha=.8,t.forEach(t=>{this.drawCloud(t.x,t.y)}),this.ctx.globalAlpha=1}drawCloud(t,e){const i=this.ctx.createRadialGradient(t+30,e,10,t+30,e,30);i.addColorStop(0,"#FFFFFF"),i.addColorStop(.7,"#F8F8F8"),i.addColorStop(1,"rgba(232, 232, 232, 0.7)"),this.ctx.fillStyle=i,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t,e,25,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(t+30,e-5,30,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(t+60,e,25,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke()}drawTwinklingStars(){[{x:200,y:50,speed:.02},{x:450,y:100,speed:.015},{x:700,y:60,speed:.025}].forEach((t,e)=>{this.starOpacity[e]+=this.starDirection[e]*t.speed,this.starOpacity[e]>=1?(this.starOpacity[e]=1,this.starDirection[e]=-1):this.starOpacity[e]<=.4&&(this.starOpacity[e]=.4,this.starDirection[e]=1),this.ctx.globalAlpha=this.starOpacity[e],this.drawStar(t.x,t.y)}),this.ctx.globalAlpha=1}drawStar(t,e){this.ctx.fillStyle="#FFD700",this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.beginPath();for(let i=0;i<5;i++){const s=2*i*Math.PI/5-Math.PI/2,l=t+10*Math.cos(s),a=e+10*Math.sin(s),o=(2*i+1)*Math.PI/5-Math.PI/2,n=t+5*Math.cos(o),r=e+5*Math.sin(o);0===i?this.ctx.moveTo(l,a):this.ctx.lineTo(l,a),this.ctx.lineTo(n,r)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.shadowBlur=10,this.ctx.shadowColor="#FFD700",this.ctx.fill(),this.ctx.shadowBlur=0}drawStainedGlassGround(){const t=this.ctx.createLinearGradient(0,this.canvas.height-80,0,this.canvas.height);t.addColorStop(0,"#98FB98"),t.addColorStop(.5,"#90EE90"),t.addColorStop(1,"#7CCD7C"),this.ctx.fillStyle=t,this.ctx.fillRect(0,this.canvas.height-80,this.canvas.width,80),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=4,this.ctx.shadowBlur=5,this.ctx.shadowColor="#FFFFFF",this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height-80),this.ctx.lineTo(this.canvas.width,this.canvas.height-80),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=.6,this.ctx.strokeStyle="#7CCD7C",this.ctx.lineWidth=2;for(let e=20;e<this.canvas.width;e+=50)this.ctx.beginPath(),this.ctx.moveTo(e,this.canvas.height-100),this.ctx.quadraticCurveTo(e+2,this.canvas.height-90,e,this.canvas.height-75),this.ctx.stroke(),this.ctx.strokeStyle="#66BB66",this.ctx.beginPath(),this.ctx.moveTo(e+5,this.canvas.height-105),this.ctx.quadraticCurveTo(e+7,this.canvas.height-93,e+5,this.canvas.height-78),this.ctx.stroke(),this.ctx.strokeStyle="#7CCD7C",this.ctx.beginPath(),this.ctx.moveTo(e+10,this.canvas.height-95),this.ctx.quadraticCurveTo(e+8,this.canvas.height-87,e+10,this.canvas.height-75),this.ctx.stroke();this.ctx.globalAlpha=1,this.drawFlowers()}drawFlowers(){const t=[{x:150,y:this.canvas.height-65,color:"#FFD700"},{x:400,y:this.canvas.height-60,color:"#FF69B4"},{x:650,y:this.canvas.height-62,color:"#FFD700"}];this.ctx.globalAlpha=.7,t.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke();const e="#FFD700"===t.color?"#FFA500":"#FF1493";this.ctx.fillStyle=e;for(let i=0;i<5;i++){const e=i*Math.PI*2/5,s=t.x+6*Math.cos(e),l=t.y+6*Math.sin(e);this.ctx.beginPath(),this.ctx.arc(s,l,3,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke()}}),this.ctx.globalAlpha=1}drawDivineParticles(){this.ctx.globalAlpha=.4,this.ctx.fillStyle="#FFD700",this.ctx.shadowBlur=5,this.ctx.shadowColor="#FFD700",[{x:250,y:200},{x:480,y:250},{x:320,y:180},{x:580,y:220},{x:150,y:280}].forEach(t=>{this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,2*Math.PI),this.ctx.fill()}),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}drawObstacle(t){if("boss"===t.type&&t.targetIndicator>0){this.ctx.save();const e=t.x+t.width/2,i=t.y+t.height/2,s=Math.max(t.width,t.height)/2+20,l=5*Math.sin(.01*Date.now());this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=4,this.ctx.setLineDash([10,5]),this.ctx.beginPath(),this.ctx.arc(e,i,s+l,0,2*Math.PI),this.ctx.stroke(),this.ctx.strokeStyle="#FFA500",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(e,i,s-10+l/2,0,2*Math.PI),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(e-s-10,i),this.ctx.lineTo(e+s+10,i),this.ctx.moveTo(e,i-s-10),this.ctx.lineTo(e,i+s+10),this.ctx.stroke(),this.ctx.restore()}"voxel"===this.renderMode&&this.voxelRenderer?this.voxelRenderer.drawVoxelObstacle(t):("boss"===t.type&&t.cloudEffect>0&&this.drawCloudEffect(t),z.renderObstacle(this.ctx,t))}drawFallingObject(t){this.ctx.save(),this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.beginPath(),this.ctx.arc(t.x+2,t.y+2,t.width/2,0,2*Math.PI),this.ctx.fill();const e=t.width/2,i=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,e+8);t.isDangerous?(i.addColorStop(0,"rgba(255,0,0,0.6)"),i.addColorStop(1,"rgba(255,0,0,0)")):(i.addColorStop(0,"rgba(0,200,255,0.6)"),i.addColorStop(1,"rgba(0,200,255,0)")),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e+8,0,2*Math.PI),this.ctx.fill(),t.isDangerous?this.ctx.fillStyle="#FF0000":this.ctx.fillStyle="#00BFFF",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.font="18px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="#FFF",this.ctx.fillText(t.icon,t.x,t.y),this.ctx.strokeStyle=t.isDangerous?"#FF0000":"#00BFFF",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y-e-2),this.ctx.lineTo(t.x,t.y-e-12),this.ctx.stroke(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y-e-2),this.ctx.lineTo(t.x,t.y-e-12),this.ctx.stroke(),this.ctx.restore()}drawExplosion(t){if("voxel"===this.renderMode&&this.voxelRenderer){const e=1-t.opacity;return void this.voxelRenderer.drawVoxelExplosion(t.x,t.y,t.radius,e)}this.ctx.save();const e=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);e.addColorStop(0,`rgba(255, 200, 0, ${t.opacity})`),e.addColorStop(.4,`rgba(255, 100, 0, ${.7*t.opacity})`),e.addColorStop(.7,`rgba(255, 50, 0, ${.4*t.opacity})`),e.addColorStop(1,"rgba(255, 0, 0, 0)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fill(),t.particles.forEach(e=>{const i=t.x+Math.cos(e.angle)*e.distance,s=t.y+Math.sin(e.angle)*e.distance;this.ctx.fillStyle=`rgba(255, ${150-3*e.distance}, 0, ${t.opacity})`,this.ctx.beginPath(),this.ctx.arc(i,s,e.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.strokeStyle=`rgba(255, 255, 255, ${.8*t.opacity})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore()}drawSeaObstacle(t){if(this.ctx.save(),t.sharkBoss&&t.sharkBoss.active){const e=t.sharkBoss;console.log("ü¶à RENDU BOSS:",e.x,e.y,"frame:",e.frame),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.beginPath(),this.ctx.ellipse(e.x,e.y+40,.7*e.width,.4*e.height,0,0,2*Math.PI),this.ctx.fill();const i=this.ctx.createLinearGradient(e.x-e.width/2,e.y-e.height/2,e.x+e.width/2,e.y+e.height/2);i.addColorStop(0,"#2A5A7A"),i.addColorStop(.5,"#1E3A5A"),i.addColorStop(1,"#0D1F3A"),this.ctx.fillStyle=i,this.ctx.strokeStyle="#000000",this.ctx.lineWidth=6,this.ctx.beginPath(),this.ctx.ellipse(e.x,e.y-.25*e.height,.45*e.width,.25*e.height,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.ellipse(e.x,e.y,.5*e.width,.35*e.height,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y+.25*e.height),this.ctx.lineTo(e.x-.25*e.width,e.y+.45*e.height),this.ctx.lineTo(e.x+.25*e.width,e.y+.45*e.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x-.35*e.width,e.y),this.ctx.lineTo(e.x-.55*e.width,e.y-.12*e.height),this.ctx.lineTo(e.x-.3*e.width,e.y+.08*e.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e.x+.35*e.width,e.y),this.ctx.lineTo(e.x+.55*e.width,e.y-.12*e.height),this.ctx.lineTo(e.x+.3*e.width,e.y+.08*e.height),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="#FF0000",this.ctx.beginPath(),this.ctx.arc(e.x-.18*e.width,e.y-.28*e.height,20,0,2*Math.PI),this.ctx.arc(e.x+.18*e.width,e.y-.28*e.height,20,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="#000000",this.ctx.beginPath(),this.ctx.arc(e.x-.18*e.width,e.y-.28*e.height,10,0,2*Math.PI),this.ctx.arc(e.x+.18*e.width,e.y-.28*e.height,10,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=5,this.ctx.lineCap="round";for(let t=0;t<10;t++){const i=e.x-.25*e.width+t*(.05*e.width);this.ctx.beginPath(),this.ctx.moveTo(i,e.y-.12*e.height),this.ctx.lineTo(i,e.y-.02*e.height),this.ctx.stroke()}this.ctx.fillStyle="rgba(135, 206, 235, 0.5)";for(let t=0;t<12;t++){const i=t/12*Math.PI*2+.15*e.frame,s=.4*e.width+25*Math.sin(.2*e.frame+t),l=e.x+Math.cos(i)*s,a=e.y+Math.sin(i)*s;this.ctx.beginPath(),this.ctx.arc(l,a,12,0,2*Math.PI),this.ctx.fill()}this.ctx.restore()}if("wave"===t.type){const e=t.width;return this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x-e/2,t.y),this.ctx.quadraticCurveTo(t.x-e/4,t.y-8,t.x,t.y),this.ctx.quadraticCurveTo(t.x+e/4,t.y+8,t.x+e/2,t.y),this.ctx.stroke(),this.ctx.lineWidth=2.5,this.ctx.globalAlpha=.7,this.ctx.beginPath(),this.ctx.moveTo(t.x-e/3,t.y+10),this.ctx.quadraticCurveTo(t.x-e/6,t.y+4,t.x,t.y+10),this.ctx.quadraticCurveTo(t.x+e/6,t.y+16,t.x+e/3,t.y+10),this.ctx.stroke(),void this.ctx.restore()}if("whirlpool"===t.type){this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation);const e=this.ctx.createRadialGradient(0,0,0,0,0,15);e.addColorStop(0,"rgba(0, 20, 40, 0.8)"),e.addColorStop(1,"rgba(30, 144, 255, 0.3)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(0,0,15,0,2*Math.PI),this.ctx.fill();for(let t=0;t<3;t++){const e=18*(t+1),i=.5-.15*t;this.ctx.strokeStyle=`rgba(30, 144, 255, ${i})`,this.ctx.lineWidth=5-t,this.ctx.beginPath(),this.ctx.arc(0,0,e,0,1.7*Math.PI),this.ctx.stroke()}return void this.ctx.restore()}if("rock"===t.type){const e=this.ctx.createRadialGradient(t.x-8,t.y-8,5,t.x,t.y,28);e.addColorStop(0,"#FFFFFF"),e.addColorStop(.4,"#E8F8FF"),e.addColorStop(.7,"#D0EFFF"),e.addColorStop(1,"#A8D8E8"),this.ctx.fillStyle=e,this.ctx.strokeStyle="#90C8D8",this.ctx.lineWidth=2.5,this.ctx.beginPath();for(let i=0;i<6;i++){const e=Math.PI/3*i-Math.PI/6,s=20+i%2*4,l=t.x+Math.cos(e)*s,a=t.y+Math.sin(e)*s;0===i?this.ctx.moveTo(l,a):this.ctx.lineTo(l,a)}return this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.strokeStyle="rgba(150, 200, 220, 0.6)",this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.moveTo(t.x-8,t.y-5),this.ctx.lineTo(t.x+5,t.y+8),this.ctx.moveTo(t.x+6,t.y-10),this.ctx.lineTo(t.x-3,t.y+6),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.beginPath(),this.ctx.arc(t.x-6,t.y-8,4,0,2*Math.PI),this.ctx.arc(t.x+8,t.y-3,3,0,2*Math.PI),this.ctx.fill(),void this.ctx.restore()}if("shark"===t.type||"siren"===t.type){const e=56,i=36;this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=2,this.ctx.lineCap="round";for(let l=0;l<4;l++){const e=15*l,i=.6-.15*l;this.ctx.globalAlpha=i,this.ctx.beginPath(),this.ctx.moveTo(t.x+e,t.y-8),this.ctx.lineTo(t.x+e+10,t.y-8),this.ctx.stroke()}for(let l=0;l<4;l++){const e=15*l,i=.6-.15*l;this.ctx.globalAlpha=i,this.ctx.beginPath(),this.ctx.moveTo(t.x+e,t.y+8),this.ctx.lineTo(t.x+e+10,t.y+8),this.ctx.stroke()}this.ctx.globalAlpha=1;const s=this.ctx.createLinearGradient(t.x-i/2,t.y-e,t.x+i/2,t.y);return s.addColorStop(0,"#2a2a2a"),s.addColorStop(.5,"#1a1a1a"),s.addColorStop(1,"#0a0a0a"),this.ctx.fillStyle=s,this.ctx.strokeStyle="#000000",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y-e),this.ctx.quadraticCurveTo(t.x-i/2.5,t.y-.7*e,t.x-i/2,t.y),this.ctx.lineTo(t.x+i/2,t.y),this.ctx.quadraticCurveTo(t.x+i/3,t.y-.4*e,t.x,t.y-e),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.strokeStyle="rgba(50, 50, 50, 0.5)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(t.x-2,t.y-.3*e),this.ctx.lineTo(t.x-i/3,t.y-2),this.ctx.stroke(),"siren"===t.type&&t.singing&&(this.ctx.shadowBlur=0,this.ctx.font="14px Arial",this.ctx.fillStyle="#FFD700",this.ctx.fillText("‚ô™",t.x-15,t.y-35),this.ctx.fillText("‚ô´",t.x+15,t.y-30)),void this.ctx.restore()}if("jellyfish"===t.type){const e=this.ctx.createRadialGradient(t.x,t.y-5,5,t.x,t.y,20);e.addColorStop(0,"rgba(255, 100, 200, 0.8)"),e.addColorStop(.6,"rgba(255, 20, 147, 0.6)"),e.addColorStop(1,"rgba(199, 21, 133, 0.4)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,18,Math.PI,0),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 20, 147, 0.8)",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 20, 147, 0.6)",this.ctx.lineWidth=2.5;const i=.005*Date.now();for(let s=0;s<3;s++){const e=t.x-8+8*s,l=4*Math.sin(i+1.2*s),a=3*Math.cos(i+1.5*s);this.ctx.beginPath(),this.ctx.moveTo(e,t.y+15),this.ctx.quadraticCurveTo(e+l,t.y+22,e+a,t.y+30),this.ctx.stroke()}return void this.ctx.restore()}this.ctx.font=`${t.width}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",t.damage>0&&(this.ctx.shadowColor="#FF0000",this.ctx.shadowBlur=8),this.ctx.fillText(t.icon,t.x,t.y),this.ctx.restore()}drawPowerUp(t){if("voxel"===this.renderMode&&this.voxelRenderer){const e=48;this.voxelRenderer.drawVoxelObstacle({x:t.x-e/2,y:t.y-e/2,width:e,height:e,icon:t.icon||"üí™"});const i=.01*Date.now();for(let s=0;s<6;s++){const e=s*Math.PI/3+i,l=t.x+30*Math.cos(e),a=t.y+30*Math.sin(e);this.ctx.fillStyle="rgba(255,215,0,0.6)",this.ctx.beginPath(),this.ctx.arc(l,a,3,0,2*Math.PI),this.ctx.fill()}return}z.renderPowerUp(this.ctx,t);const e=.01*Date.now();for(let i=0;i<6;i++){const s=i*Math.PI/3+e,l=t.x+30*Math.cos(s),a=t.y+30*Math.sin(s);this.ctx.fillStyle="rgba(255,215,0,0.6)",this.ctx.beginPath(),this.ctx.arc(l,a,3,0,2*Math.PI),this.ctx.fill()}}drawJumpTrajectory(){const t=this.game.player.getJumpTrajectory();if(!t)return;const e=this.game.player,i=e.x+e.width/2,s=e.y+e.height/2;this.ctx.save(),this.ctx.strokeStyle=`rgba(0, 0, 0, ${.6+.4*t.chargePercent})`,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(i,s);let a=i,o=s,n=t.velX,r=t.velY;for(let d=0;d<50&&(r+=l.GRAVITY,n*=l.FRICTION,a+=n,o+=r,this.ctx.lineTo(a,o),!(o>=e.groundY));d++);this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle=`rgba(255, 0, 0, ${.7+.3*t.chargePercent})`,this.ctx.beginPath(),this.ctx.arc(a,e.groundY,8,0,2*Math.PI),this.ctx.fill();const h=e.x+e.width/2-30,c=e.y-20;this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(h,c,60,8),this.ctx.fillStyle=`rgba(255, 215, 0, ${.7+.3*t.chargePercent})`,this.ctx.fillRect(h+1,c+1,58*t.chargePercent,6),this.ctx.restore()}drawPlayer(){const t=this.game.player;if("voxel"===this.renderMode&&this.voxelRenderer)return void(this.game.boatMode?this.voxelRenderer.drawVoxelBoat(t.x,t.y,t.flying,t.rotation||0,void 0!==t.whirlpoolScale?t.whirlpoolScale:1):this.voxelRenderer.drawVoxelSheep(t.x,t.y,t.flying,t.goldCount>0));if(this.ctx.save(),this.game.boatMode){const e=80,i=30,s=256,l=t.y<s,a=void 0!==t.whirlpoolScale?t.whirlpoolScale:1;if(this.ctx.save(),this.ctx.translate(t.x+e/2,t.y+i/2),this.ctx.rotate(t.rotation||0),this.ctx.scale(a,a),this.ctx.translate(-(t.x+e/2),-(t.y+i/2)),l){const s=.01*Date.now();this.ctx.save();const l=this.ctx.createLinearGradient(t.x+10,t.y+i+20,t.x+20,t.y+i+20);l.addColorStop(0,"#666666"),l.addColorStop(.5,"#999999"),l.addColorStop(1,"#666666"),this.ctx.fillStyle=l,this.ctx.fillRect(t.x+12,t.y+i+15,8,15),this.ctx.fillStyle="#FF6600",this.ctx.beginPath(),this.ctx.moveTo(t.x+16,t.y+i+15),this.ctx.lineTo(t.x+12,t.y+i+20),this.ctx.lineTo(t.x+20,t.y+i+20),this.ctx.closePath(),this.ctx.fill();for(let e=0;e<3;e++){const l=t.y+i+30+8*e+3*Math.sin(s+e),a=12-3*e,o=this.ctx.createRadialGradient(t.x+16,l,0,t.x+16,l,a);o.addColorStop(0,"rgba(255, 255, 100, 0.9)"),o.addColorStop(.4,"rgba(255, 150, 0, 0.7)"),o.addColorStop(1,"rgba(255, 50, 0, 0)"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(t.x+16,l,a,0,2*Math.PI),this.ctx.fill()}for(let e=0;e<3;e++){const e=t.y+i+35+15*Math.random(),s=t.x+16+8*(Math.random()-.5);this.ctx.fillStyle="rgba(255, 200, 50, 0.8)",this.ctx.beginPath(),this.ctx.arc(s,e,2,0,2*Math.PI),this.ctx.fill()}this.ctx.restore(),this.ctx.save();const a=this.ctx.createLinearGradient(t.x+e-20,t.y+i+20,t.x+e-10,t.y+i+20);a.addColorStop(0,"#666666"),a.addColorStop(.5,"#999999"),a.addColorStop(1,"#666666"),this.ctx.fillStyle=a,this.ctx.fillRect(t.x+e-20,t.y+i+15,8,15),this.ctx.fillStyle="#FF6600",this.ctx.beginPath(),this.ctx.moveTo(t.x+e-16,t.y+i+15),this.ctx.lineTo(t.x+e-20,t.y+i+20),this.ctx.lineTo(t.x+e-12,t.y+i+20),this.ctx.closePath(),this.ctx.fill();for(let o=0;o<3;o++){const l=t.y+i+30+8*o+3*Math.sin(s+o+1),a=12-3*o,n=this.ctx.createRadialGradient(t.x+e-16,l,0,t.x+e-16,l,a);n.addColorStop(0,"rgba(255, 255, 100, 0.9)"),n.addColorStop(.4,"rgba(255, 150, 0, 0.7)"),n.addColorStop(1,"rgba(255, 50, 0, 0)"),this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(t.x+e-16,l,a,0,2*Math.PI),this.ctx.fill()}for(let o=0;o<3;o++){const s=t.y+i+35+15*Math.random(),l=t.x+e-16+8*(Math.random()-.5);this.ctx.fillStyle="rgba(255, 200, 50, 0.8)",this.ctx.beginPath(),this.ctx.arc(l,s,2,0,2*Math.PI),this.ctx.fill()}this.ctx.restore()}this.ctx.fillStyle="#8B4513",this.ctx.beginPath(),this.ctx.moveTo(t.x-10,t.y+20),this.ctx.lineTo(t.x+e+10,t.y+20),this.ctx.quadraticCurveTo(t.x+e+5,t.y+i+25,t.x+e,t.y+i+20),this.ctx.lineTo(t.x,t.y+i+20),this.ctx.quadraticCurveTo(t.x-5,t.y+i+25,t.x-10,t.y+20),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(t.x-5,t.y+22),this.ctx.lineTo(t.x+e+5,t.y+22),this.ctx.lineTo(t.x+e,t.y+i+18),this.ctx.lineTo(t.x,t.y+i+18),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#654321",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(t.x-10,t.y+20),this.ctx.lineTo(t.x+e+10,t.y+20),this.ctx.quadraticCurveTo(t.x+e+5,t.y+i+25,t.x+e,t.y+i+20),this.ctx.lineTo(t.x,t.y+i+20),this.ctx.quadraticCurveTo(t.x-5,t.y+i+25,t.x-10,t.y+20),this.ctx.stroke(),this.ctx.fillStyle="#A0522D",this.ctx.fillRect(t.x+10,t.y+25,e-20,3),this.ctx.fillRect(t.x+10,t.y+35,e-20,3),this.ctx.strokeStyle="#8B4513",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(t.x+e/2,t.y+20),this.ctx.lineTo(t.x+e/2,t.y-35),this.ctx.stroke(),this.ctx.fillStyle="#654321",this.ctx.beginPath(),this.ctx.arc(t.x+e/2,t.y-35,3,0,2*Math.PI),this.ctx.fill();const o=this.ctx.createLinearGradient(t.x+e/2,t.y-30,t.x+e/2+35,t.y);o.addColorStop(0,"#FFFFFF"),o.addColorStop(.5,"#F5F5F5"),o.addColorStop(1,"#E8E8E8"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.moveTo(t.x+e/2,t.y-30),this.ctx.quadraticCurveTo(t.x+e/2+25,t.y-10,t.x+e/2+35,t.y+5),this.ctx.lineTo(t.x+e/2,t.y+18),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="#CCCCCC",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.save();const n=.5;return this.sheepAnimator.draw(this.ctx,t.x+e-30,t.y+10,n,0,l?"flying":"normal",!1,0),this.ctx.restore(),void this.ctx.restore()}if(t.invincible&&Math.floor(t.invincibleTimer/5)%2==0&&(this.ctx.globalAlpha=.5),t.rotation){const e=t.x+t.width/2,i=t.y+t.height/2;this.ctx.translate(e,i),this.ctx.rotate(t.rotation),this.ctx.translate(-e,-i)}if(-1===t.facingDirection&&(this.ctx.translate(t.x+t.width,0),this.ctx.scale(-1,1),this.ctx.translate(-t.x,0)),t.frozen)if(t.tentacleGrab){this.ctx.save(),this.ctx.strokeStyle="#FF1493",this.ctx.lineWidth=4,this.ctx.lineCap="round";const e=.01*Date.now(),i=t.x+40,s=t.y+15;for(let l=0;l<4;l++){const a=8*Math.sin(e+1.5*l),o=6*Math.cos(e+2*l);this.ctx.beginPath(),this.ctx.moveTo(t.jellyfishX,t.jellyfishY+20);const n=(t.jellyfishX+i)/2+a,r=(t.jellyfishY+s)/2+o;this.ctx.quadraticCurveTo(n,r,i+30*(Math.random()-.5),s+20*(Math.random()-.5)),this.ctx.stroke();for(let e=0;e<3;e++){const l=e/3,n=t.jellyfishX+(i-t.jellyfishX)*l+a*(1-l),r=t.jellyfishY+20+(s-t.jellyfishY-20)*l+o*(1-l);this.ctx.fillStyle="rgba(255, 20, 147, 0.6)",this.ctx.beginPath(),this.ctx.arc(n,r,3,0,2*Math.PI),this.ctx.fill()}}this.ctx.restore()}else{const e=this.ctx.createRadialGradient(t.x+t.width/2,t.y+t.height/2,0,t.x+t.width/2,t.y+t.height/2,t.width);e.addColorStop(0,"rgba(135, 206, 235, 0.6)"),e.addColorStop(1,"rgba(173, 216, 230, 0.3)"),this.ctx.fillStyle=e,this.ctx.fillRect(t.x-5,t.y-5,t.width+10,t.height+10),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.font="20px Arial",this.ctx.fillText("‚ùÑÔ∏è",t.x-10,t.y),this.ctx.fillText("‚ùÑÔ∏è",t.x+t.width,t.y),this.ctx.fillText("‚ùÑÔ∏è",t.x+t.width/2-10,t.y+t.height+10)}const e=t.flying||t.isRich?"flying":"normal";if(this.sheepAnimator.draw(this.ctx,t.x,t.y,t.size,t.hairLength,e,t.rolling,t.hairEffect),t.equippedWeapon&&(this.ctx.save(),this.ctx.font="bold 28px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="#000000",this.ctx.shadowBlur=4,this.ctx.fillText(t.equippedWeapon.icon,t.x+t.width/2,t.y-15),this.ctx.restore()),t.exclamationMark&&t.exclamationTimer>0){this.ctx.save();const e=t.x+t.width/2,i=t.y-50,s=3*Math.sin(.01*Date.now());this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=5,this.ctx.shadowOffsetY=2,this.ctx.font="bold 40px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.fillStyle="#FF0000",this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=3,this.ctx.strokeText("!",e,i+s),this.ctx.fillText("!",e,i+s),this.ctx.restore()}if("endless"===this.game.mode){this.ctx.save();const e=t.y+.75*t.height;this.ctx.fillStyle="#888888",this.ctx.fillRect(t.x+t.width,e-3,15,6),this.ctx.fillStyle="#AAAAAA",this.ctx.fillRect(t.x+t.width,e-2,15,4),this.ctx.shadowColor="#00FF00",this.ctx.shadowBlur=10,this.ctx.fillStyle="#00FF00",this.ctx.fillRect(t.x+t.width+13,e-2,3,4),this.ctx.restore()}this.ctx.restore()}drawConcentrationAura(t){this.ctx.save();const e=t.x+t.width/2,i=t.y+t.height/2,s=.003*Date.now(),l=30+5*Math.sin(2*s),a=this.ctx.createRadialGradient(e,i,0,e,i,l);a.addColorStop(0,`rgba(135, 206, 235, ${.3*t.concentrationLevel})`),a.addColorStop(.5,`rgba(100, 149, 237, ${.2*t.concentrationLevel})`),a.addColorStop(1,"rgba(100, 149, 237, 0)"),this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(e,i,l,0,2*Math.PI),this.ctx.fill();const o=Math.floor(6*t.concentrationLevel);for(let n=0;n<o;n++){const l=n/o*Math.PI*2+s,a=25+5*Math.sin(s+n),r=e+Math.cos(l)*a,h=i+Math.sin(l)*a;this.ctx.fillStyle=`rgba(173, 216, 230, ${.6*t.concentrationLevel})`,this.ctx.beginPath(),this.ctx.arc(r,h,3,0,2*Math.PI),this.ctx.fill()}for(let n=1;n<=2;n++){const l=20*n+3*Math.sin(s+n);this.ctx.strokeStyle=`rgba(135, 206, 235, ${.4*t.concentrationLevel})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(e,i,l,0,2*Math.PI),this.ctx.stroke()}t.concentrationLevel>.5&&(this.ctx.fillStyle=`rgba(255, 255, 255, ${t.concentrationLevel})`,this.ctx.font="bold 14px Arial",this.ctx.textAlign="center",this.ctx.fillText("üßò CONCENTRATION",e,t.y-30)),this.ctx.restore()}drawJumpRockets(t){this.ctx.save();const e=t.x+10,i=t.x+t.width-10,s=t.y+t.height,l=20+10*Math.random(),a=.003*Date.now();this.drawRocketFlame(e,s,l,a),this.drawRocketFlame(i,s,l,a+.5),this.ctx.restore()}drawRocketFlame(t,e,i,s){const l=this.ctx.createLinearGradient(t,e,t,e+i);l.addColorStop(0,"rgba(255, 255, 0, 0.9)"),l.addColorStop(.3,"rgba(255, 140, 0, 0.8)"),l.addColorStop(.7,"rgba(255, 69, 0, 0.6)"),l.addColorStop(1,"rgba(255, 0, 0, 0)"),this.ctx.fillStyle=l,this.ctx.beginPath(),this.ctx.moveTo(t,e);const a=3*Math.sin(s);this.ctx.lineTo(t-4+a,e+.3*i),this.ctx.lineTo(t+a,e+i),this.ctx.lineTo(t+4+a,e+.3*i),this.ctx.closePath(),this.ctx.fill();for(let o=0;o<3;o++){const s=e+i+10*Math.random(),l=t+8*(Math.random()-.5),a=2+2*Math.random();this.ctx.fillStyle=`rgba(255, ${100+100*Math.random()}, 0, ${.5+.5*Math.random()})`,this.ctx.beginPath(),this.ctx.arc(l,s,a,0,2*Math.PI),this.ctx.fill()}}drawEndlessUI(){const t=this.game.endlessMode;if(!t)return;if(this.canvas.width<=1024||this.canvas.height<=768){const e=150,i=80,s=this.canvas.width-e-10,l=this.canvas.height-i-35;this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillRect(s,l,e,i),this.ctx.textAlign="left",this.ctx.font="bold 11px monospace",this.ctx.fillStyle="#FFD700",this.ctx.fillText(`üéØ ${this.game.score.toLocaleString()}`,s+5,l+15),this.ctx.fillStyle="#87CEEB",this.ctx.fillText(`üìè ${Math.floor(t.distance)}m`,s+5,l+32),this.ctx.fillStyle="#FF4500",this.ctx.fillText(`üî• V${t.waveLevel}`,s+5,l+49),this.ctx.fillStyle="#32CD32",this.ctx.fillText(`‚ö° x${t.multiplier.toFixed(1)}`,s+5,l+66)}else this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillRect(this.canvas.width-250,10,240,180),this.ctx.textAlign="left",this.ctx.fillStyle=d.GOLD_LIGHT,this.ctx.font="bold 18px Arial",this.ctx.fillText(`ÔøΩ SCORE: ${this.game.score.toLocaleString()}`,this.canvas.width-240,35),this.ctx.fillStyle=d.SKY_BLUE,this.ctx.fillText(`üìè ${Math.floor(t.distance)}m`,this.canvas.width-240,60),this.ctx.fillStyle="#FF4500",this.ctx.fillText(`üî• Vague ${t.waveLevel}`,this.canvas.width-240,130),this.ctx.fillStyle="#32CD32",this.ctx.fillText(`‚ö° x${t.multiplier.toFixed(1)}`,this.canvas.width-240,155),this.ctx.fillStyle="#DDA0DD",this.ctx.font="bold 14px Arial",this.ctx.fillText(`üèÜ Record: ${t.highScore.toLocaleString()}`,this.canvas.width-240,175)}drawUnifiedUI(){this.game.player;const t=this.canvas.width<=1024||this.canvas.height<=768;this.drawBottomBar(t),"endless"===this.game.mode&&this.game.endlessMode&&this.drawTopInfo(t)}drawBottomBar(t){var e,i;const s=this.game.player,l=t?35:45,a=this.canvas.height-l;this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.85)",this.ctx.fillRect(0,a,this.canvas.width,l),this.ctx.strokeStyle="#333",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,a),this.ctx.lineTo(this.canvas.width,a),this.ctx.stroke();const o=t?10:12,n=t?14:18,r=t?8:12,h=a+l/2;this.ctx.font=`bold ${o}px monospace`,this.ctx.textBaseline="middle";let c=r;this.ctx.font=`${n}px Arial`,this.ctx.fillStyle="#FF0000",this.ctx.fillText("‚ù§Ô∏è",c,h),c+=n+4,this.ctx.font=`bold ${o+2}px monospace`,this.ctx.fillStyle="#FFFFFF",this.ctx.textAlign="left",this.ctx.fillText(`${s.lives}`,c,h),c+=this.ctx.measureText(`${s.lives}`).width+2*r,this.ctx.fillStyle="#444",this.ctx.fillRect(c,a+8,2,l-16),c+=2*r;const d=t?.3*this.canvas.width:200,u=t?16:20,f=h-u/2,g=Math.max(0,Math.floor(s.fuel+s.bonusFuel)),m=Math.min(1,g/100);let x;this.ctx.fillStyle="#1a1a1a",this.ctx.fillRect(c,f,d,u),x=m>.5?"#00FF00":m>.25?"#FFD700":"#FF0000",this.ctx.fillStyle=x,this.ctx.fillRect(c+1,f+1,(d-2)*m,u-2),this.ctx.font=`bold ${o}px monospace`,this.ctx.fillStyle=m>.3?"#000":"#FFF",this.ctx.textAlign="center",this.ctx.fillText(`üíß${g}%`,c+d/2,h),this.ctx.strokeStyle="#666",this.ctx.lineWidth=1,this.ctx.strokeRect(c,f,d,u),c+=d+2*r,this.game.level3Active&&(this.ctx.fillStyle="#444",this.ctx.fillRect(c,a+8,2,l-16),c+=2*r,this.ctx.font=`${n}px Arial`,this.ctx.fillStyle="#FFD700",this.ctx.fillText("ü¶â",c,h),c+=n+4,this.ctx.font=`bold ${o+2}px monospace`,this.ctx.fillStyle="#FFD700",this.ctx.textAlign="left",this.ctx.fillText(`${this.game.level3Wisdom}/777`,c,h),c+=this.ctx.measureText(`${this.game.level3Wisdom}/777`).width+2*r),this.ctx.textAlign="right";let y=this.canvas.width-r;if("adventure"===this.game.mode){const t=(null==(e=this.game.obstacleManager)?void 0:e.totalXP)||0,i=this.game.score+t;this.ctx.font=`bold ${o+2}px monospace`,this.ctx.fillStyle="#00FF00",this.ctx.fillText(`${i.toLocaleString("fr-FR")}`,y,h),y-=this.ctx.measureText(`${i.toLocaleString("fr-FR")}`).width+4,this.ctx.font=`bold ${o}px monospace`,this.ctx.fillStyle="#888";const s=p.t("game.ui.total");this.ctx.fillText(s,y,h),y-=this.ctx.measureText(s).width+r,this.ctx.font=o-2+"px monospace",this.ctx.fillStyle="#666";const l=`(${this.game.score}+${t})`;this.ctx.fillText(l,y,h),y-=this.ctx.measureText(l).width+2*r}else{const t=(null==(i=this.game.obstacleManager)?void 0:i.totalXP)||0;this.ctx.font=`bold ${o+2}px monospace`,this.ctx.fillStyle="#FFD700",this.ctx.fillText(`${t}`,y,h),y-=this.ctx.measureText(`${t}`).width+4,this.ctx.font=`bold ${o}px monospace`,this.ctx.fillStyle="#888";const e=p.t("game.ui.xp");this.ctx.fillText(e,y,h),y-=this.ctx.measureText(e).width+2*r,this.ctx.fillStyle="#444",this.ctx.fillRect(y,a+8,2,l-16),y-=2*r,this.ctx.font=`bold ${o+2}px monospace`,this.ctx.fillStyle="#FFFFFF";const s=this.game.score.toLocaleString("fr-FR");this.ctx.fillText(s,y,h),y-=this.ctx.measureText(s).width+4}this.ctx.font=`bold ${o}px monospace`,this.ctx.fillStyle="#888",this.ctx.fillText("üéØ",y,h),this.ctx.restore()}drawTopInfo(t){const e=this.game.endlessMode;if(!e)return;this.ctx.save();const i=t?60:75,s=t?140:200,l=this.canvas.width-s-(t?8:15),a=t?8:15,o=t?10:12,n=t?14:18;this.ctx.fillStyle="rgba(0, 0, 0, 0.75)",this.ctx.fillRect(l,a,s,i),this.ctx.strokeStyle="#333",this.ctx.lineWidth=2,this.ctx.strokeRect(l,a,s,i),this.ctx.font=`bold ${o}px monospace`,this.ctx.textAlign="left";let r=a+n;this.ctx.fillStyle="#87CEEB",this.ctx.fillText(`üìè ${Math.floor(e.distance)}m`,l+8,r),r+=n,this.ctx.fillStyle="#FF4500",this.ctx.fillText(`ÔøΩ Vague ${e.waveLevel}`,l+8,r),r+=n,this.ctx.fillStyle="#32CD32",this.ctx.fillText(`‚ö° x${e.multiplier.toFixed(1)}`,l+8,r),t||(r+=n,this.ctx.fillStyle="#DDA0DD",this.ctx.font=`bold ${o-1}px monospace`,this.ctx.fillText(`üèÜ ${e.highScore.toLocaleString("fr-FR")}`,l+8,r)),this.ctx.restore()}drawHealthBar(){const t=this.game.player,e=this.canvas.width<=1024||this.canvas.height<=768,i=e?18:25,s=e?3:5,l=e?10:20,a=e?8:20;for(let o=0;o<t.maxLives;o++){const n=l+o*(i+s),r=o<t.lives;this.ctx.save(),this.ctx.fillStyle=r?"#FF0000":"#444444",this.ctx.beginPath(),this.ctx.moveTo(n+i/2,a+i),this.ctx.bezierCurveTo(n,a+.6*i,n,a+.2*i,n+i/2,a+.2*i),this.ctx.bezierCurveTo(n+i,a+.2*i,n+i,a+.6*i,n+i/2,a+i),this.ctx.fill(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=e?2:3,this.ctx.lineJoin="round",this.ctx.stroke(),r&&(this.ctx.fillStyle="rgba(255, 255, 255, 0.5)",this.ctx.beginPath(),this.ctx.arc(n+.35*i,a+.35*i,.15*i,0,2*Math.PI),this.ctx.fill()),this.ctx.restore()}}drawFuelGauge(){const t=this.game.player,e=t.fuel/t.maxFuel,i=this.canvas.width<=1024||this.canvas.height<=768,s=i?10:20,l=i?this.canvas.height-32:110,a=i?this.canvas.width-20:200,o=i?20:25,n=Math.min(t.bonusFuel/t.maxFuel,.5),r=i?0:a*n,h=a+r;this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillRect(s,l,h,o),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(s,l,h,o);const c=this.ctx.createLinearGradient(s,0,s+a*e,0);if(e>.5?(c.addColorStop(0,"#00BFFF"),c.addColorStop(1,"#87CEEB")):e>.25?(c.addColorStop(0,"#FFD700"),c.addColorStop(1,"#FFA500")):(c.addColorStop(0,"#FF4500"),c.addColorStop(1,"#FF0000")),this.ctx.fillStyle=c,this.ctx.fillRect(s+2,l+2,(a-4)*e,o-4),t.bonusFuel>0&&!i){const t=18,e=Math.ceil(r/t),i=.2*Math.sin(.005*Date.now())+.8;this.ctx.save();for(let n=0;n<e;n++){const e=s+a+n*t;this.ctx.fillStyle=`rgba(255, 215, 0, ${i})`,this.ctx.fillRect(e+2,l+2,t-2,o-4),this.ctx.strokeStyle=`rgba(255, 255, 255, ${i})`,this.ctx.lineWidth=2,this.ctx.strokeRect(e+2,l+2,t-2,o-4),this.ctx.fillStyle=`rgba(255, 255, 255, ${.8*i})`,this.ctx.beginPath(),this.ctx.arc(e+t/2,l+o/2,3,0,2*Math.PI),this.ctx.fill()}this.ctx.restore()}this.ctx.fillStyle="#FFFFFF",this.ctx.font=i?"bold 10px monospace":"bold 14px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const d=Math.floor(t.fuel+t.bonusFuel),u=i?`üíß ${d}%`:`üíß CARBURANT ${d}%`;this.ctx.fillText(u,s+a/2,l+o/2),e<.25&&t.bonusFuel<=0&&Math.floor(Date.now()/500)%2==0&&(this.ctx.fillStyle="#FF0000",this.ctx.font="bold 12px Arial",this.ctx.fillText("‚ö†Ô∏è CARBURANT FAIBLE",s+a/2,l-10))}addParticle(t,e,i,s="#FFD700"){this.particleSystem.add(t,e,i,s)}triggerRefuelEffect(t,e){this.refuelEffects.push({x:t,y:e,radius:0,maxRadius:60,opacity:1,duration:30})}updateRefuelEffects(){for(let t=this.refuelEffects.length-1;t>=0;t--){const e=this.refuelEffects[t];e.radius+=3,e.opacity-=.033,e.duration--,(e.duration<=0||e.opacity<=0)&&this.refuelEffects.splice(t,1)}}drawRefuelEffects(){this.refuelEffects.forEach(t=>{this.ctx.save();const e=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);e.addColorStop(0,`rgba(0, 191, 255, ${.6*t.opacity})`),e.addColorStop(.5,`rgba(135, 206, 235, ${.4*t.opacity})`),e.addColorStop(1,"rgba(135, 206, 235, 0)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle=`rgba(255, 255, 255, ${t.opacity})`,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,.7*t.radius,0,2*Math.PI),this.ctx.stroke();for(let i=0;i<8;i++){const e=i/8*Math.PI*2,s=.5*t.radius,l=Math.cos(e)*s,a=Math.sin(e)*s;this.ctx.fillStyle=`rgba(0, 191, 255, ${t.opacity})`,this.ctx.beginPath(),this.ctx.arc(t.x+l,t.y+a,4,0,2*Math.PI),this.ctx.fill()}this.ctx.restore()})}triggerRefuelEffect(t,e){this.refuelEffects.push({x:t,y:e,radius:0,maxRadius:60,opacity:1,duration:30})}updateRefuelEffects(){for(let t=this.refuelEffects.length-1;t>=0;t--){const e=this.refuelEffects[t];e.radius+=3,e.opacity-=.033,e.duration--,(e.duration<=0||e.opacity<=0)&&this.refuelEffects.splice(t,1)}}drawRejectionBubble(t){var e;const i=380,s=100;if("voxel"===this.renderMode&&this.voxelRenderer){const l=t.x-190,a=t.y;this.ctx.save(),this.ctx.globalAlpha=t.opacity;const o=(null==(e=this.game.i18n)?void 0:e.t("endless.gameOver.rebirth"))||"endless.gameOver.rebirth";return this.voxelRenderer.drawVoxelBubble(l,a,i,s,o),void this.ctx.restore()}this.ctx.save();const l=t.x-190,a=t.y,o=5*Math.sin(Date.now()/200);this.ctx.shadowColor=`rgba(255, 0, 0, ${.8*t.opacity})`,this.ctx.shadowBlur=30+o;const n=this.ctx.createLinearGradient(l,a,l,a+s);n.addColorStop(0,`rgba(139, 0, 0, ${.95*t.opacity})`),n.addColorStop(.5,`rgba(178, 34, 34, ${.95*t.opacity})`),n.addColorStop(1,`rgba(220, 20, 60, ${.95*t.opacity})`),this.ctx.fillStyle=n;const r=this.ctx.createLinearGradient(l,a,l+i,a);r.addColorStop(0,`rgba(255, 215, 0, ${t.opacity})`),r.addColorStop(.5,`rgba(255, 255, 255, ${t.opacity})`),r.addColorStop(1,`rgba(255, 215, 0, ${t.opacity})`),this.ctx.strokeStyle=r,this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.roundRect(l,a,i,s,15),this.ctx.fill(),this.ctx.stroke(),this.ctx.strokeStyle=`rgba(0, 0, 0, ${.6*t.opacity})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.roundRect(l+5,a+5,370,90,12),this.ctx.stroke();const h=this.ctx.createLinearGradient(t.x,a+s,t.x,a+s+15);h.addColorStop(0,`rgba(220, 20, 60, ${.95*t.opacity})`),h.addColorStop(1,`rgba(139, 0, 0, ${.95*t.opacity})`),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.moveTo(t.x,a+s),this.ctx.lineTo(t.x-15,a+s+15),this.ctx.lineTo(t.x+15,a+s+15),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle=`rgba(255, 215, 0, ${t.opacity})`,this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.font="24px Arial",this.ctx.textBaseline="middle",this.ctx.fillStyle=`rgba(255, 215, 0, ${t.opacity})`,this.ctx.fillText("‚ö†Ô∏è",l+15,a+20),this.ctx.fillText("‚ö†Ô∏è",l+i-15,a+20),this.ctx.fillText("üîÑ",l+15,a+s-20),this.ctx.fillText("‚ö°",l+i-15,a+s-20),this.ctx.shadowColor=`rgba(0, 0, 0, ${t.opacity})`,this.ctx.shadowBlur=8,this.ctx.fillStyle=`rgba(255, 255, 255, ${t.opacity})`,this.ctx.font='bold 20px "Arial Black", Arial',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(p.t("game.messages.quickVictoryLine1"),t.x,a+30),this.ctx.font='bold 24px "Arial Black", Arial';const c=this.ctx.createLinearGradient(t.x-100,0,t.x+100,0);c.addColorStop(0,`rgba(255, 255, 0, ${t.opacity})`),c.addColorStop(.5,`rgba(255, 255, 255, ${t.opacity})`),c.addColorStop(1,`rgba(255, 255, 0, ${t.opacity})`),this.ctx.fillStyle=c,this.ctx.fillText(p.t("game.messages.quickVictoryLine2"),t.x,a+65),this.ctx.restore()}drawProjectiles(){this.game.obstacleManager.getProjectiles().forEach(t=>{this.ctx.save(),this.ctx.shadowColor="rgba(0, 0, 0, 0.4)",this.ctx.shadowBlur=10,this.ctx.shadowOffsetY=5,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=15,this.ctx.font=`${t.height}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.icon,t.x+t.width/2,t.y+t.height/2),this.ctx.restore()})}drawCloudEffect(t){this.ctx.save();let e;e=t.cloudEffect>90?(120-t.cloudEffect)/30:.8;const i=t.x+t.width/2,s=t.y+t.height/2,l=Math.max(t.width,t.height)+40;for(let a=0;a<5;a++){const t=a*Math.PI*2/5+Date.now()/1e3,o=15*Math.cos(t),n=10*Math.sin(t),r=this.ctx.createRadialGradient(i+o,s+n,0,i+o,s+n,l/2);r.addColorStop(0,`rgba(255, 255, 255, ${.9*e})`),r.addColorStop(.5,`rgba(240, 240, 255, ${.6*e})`),r.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.arc(i+o,s+n,l/2,0,2*Math.PI),this.ctx.fill()}if(t.cloudEffect>60){this.ctx.fillStyle=`rgba(255, 255, 200, ${e})`;for(let t=0;t<8;t++){const e=t*Math.PI*2/8,a=l/2+10,o=i+Math.cos(e)*a,n=s+Math.sin(e)*a,r=2+1*Math.sin(Date.now()/100+t);this.ctx.beginPath(),this.ctx.arc(o,n,r,0,2*Math.PI),this.ctx.fill()}}this.ctx.restore()}drawLEDPanel(){}drawLEDNumber(t,e,i,s,l){this.ctx.save(),this.ctx.font=`bold ${l}px "Courier New", monospace`,this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.shadowBlur=10,this.ctx.shadowColor=s,this.ctx.fillStyle=s;for(let a=0;a<t.length;a++){const o=t[a],n=e+a*(.7*l);this.ctx.shadowBlur=0,this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(n-3,i-l/2,.65*l,l),this.ctx.shadowBlur=10,this.ctx.shadowColor=s,this.ctx.fillStyle=s,this.ctx.fillText(o,n,i),this.ctx.shadowBlur=15,this.ctx.fillText(o,n,i)}this.ctx.restore()}}class ${constructor(t){this.game=t,this.onKeyDown=this.handleKeyDown.bind(this),this.onKeyUp=this.handleKeyUp.bind(this),this.lastSpaceTime=0,this.doubleClickThreshold=300,this.spaceDownTime=0,this.spaceIsDown=!1,this.xKeyDown=!1,document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}handleKeyDown(t){var e;if(this.game.introSequence&&this.game.introSequence.isActive())this.game.introSequence.handleInput(t.key);else if(this.game.running&&!this.game.paused){if("1"===t.key)return console.log("üéÆ CHEAT: Victoire niveau 1 (impatience)"),void this.game.showVictoryScreen();if("2"===t.key)return console.log("üéÆ CHEAT: Passage au niveau 2"),this.game.level2Active=!1,this.game.level3Active=!1,void this.game.startLevel2();if("3"===t.key)return console.log("üéÆ CHEAT: Victoire niveau 3 (tous les boss d√©truits)"),void this.game.showLevel3Victory();if("/"===t.key)return console.log("üéÆ CHEAT: Passage au niveau 2"),void this.game.victory();if(":"===t.key)return console.log("üéÆ CHEAT: Passage au niveau 3"),this.game.level2Active=!1,this.game.level3Active=!1,void this.game.startLevel3();switch(t.code){case"Space":if(t.preventDefault(),!this.spaceIsDown){this.spaceDownTime=Date.now(),this.spaceIsDown=!0;const t=Date.now(),e=t-this.lastSpaceTime<this.doubleClickThreshold;this.lastSpaceTime=t,e?(this.game.player.jump(!0,0),this.game.renderer.addParticle(this.game.player.x,this.game.player.y,"üöÄüöÄ","#FFD700")):this.game.player.startChargingJump()}break;case"KeyW":this.game.player.startFlying()?this.game.renderer.addParticle(this.game.player.x,this.game.player.y,"üïäÔ∏è","#FFD700"):(null==(e=this.game.powerUpManager)?void 0:e.hasPower("liberte"))||this.game.renderer.addParticle(this.game.player.x,this.game.player.y,"üö´","#FF0000");break;case"ArrowLeft":this.game.player.moveLeft();break;case"ArrowRight":this.game.player.moveRight();break;case"ArrowUp":this.game.boatMode&&this.game.player.moveUp();break;case"ArrowDown":this.game.boatMode&&this.game.player.moveDown();break;case"KeyX":"endless"===this.game.mode?(!this.xKeyDown&&this.game.laserSystem&&this.game.laserSystem.fire(),this.xKeyDown=!0):this.game.level3Active&&this.game.leviathan&&this.game.leviathan.isActive&&(this.xKeyDown||this.game.fireBulletAtLeviathan(),this.xKeyDown=!0)}}}handleKeyUp(t){var e;switch(t.code){case"KeyX":this.xKeyDown=!1;break;case"Space":if(this.spaceIsDown){const t=Date.now(),e=t-this.spaceDownTime,i=t-this.lastSpaceTime<this.doubleClickThreshold;this.lastSpaceTime=t,this.game.player.jump(i,e);const s=e>300?"‚¨ÜÔ∏è‚¨ÜÔ∏è":i?"üöÄüí®":"üöÄ";this.game.renderer.addParticle(this.game.player.x,this.game.player.y,s,"#87CEEB"),this.spaceIsDown=!1}break;case"KeyW":(null==(e=this.game.powerUpManager)?void 0:e.hasPower("liberte"))||this.game.player.stopFlying()}}isFiring(){return this.xKeyDown}destroy(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}}class G{constructor(t){this.game=t,this.mouseDown=!1,this.mouseDownTime=0,this.clickStartPos=null,this.currentMousePos=null,this.lastClickTime=0,this.doubleClickDelay=300,this.onMouseDown=this.handleMouseDown.bind(this),this.onMouseMove=this.handleMouseMove.bind(this),this.onMouseUp=this.handleMouseUp.bind(this);const e=t.canvas;e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mouseup",this.onMouseUp)}handleMouseDown(t){if(this.game.introSequence&&this.game.introSequence.isActive())return void this.game.introSequence.handleInput(" ");if(!this.game.running||this.game.paused)return;this.mouseDown=!0;const e=this.game.canvas.getBoundingClientRect(),i=(t.clientX-e.left)*this.game.canvas.width/e.width,s=(t.clientY-e.top)*this.game.canvas.height/e.height;this.currentMousePos={x:i,y:s};const l=Date.now();l-this.lastClickTime<this.doubleClickDelay?("endless"===this.game.mode&&this.game.laserSystem&&this.game.laserSystem.fireSpecialBomb(),this.lastClickTime=0):(this.lastClickTime=l,"endless"===this.game.mode&&this.game.laserSystem&&this.game.laserSystem.fire())}handleMouseMove(t){if(!this.game.running||this.game.paused)return;const e=this.game.canvas.getBoundingClientRect(),i=(t.clientX-e.left)*this.game.canvas.width/e.width,s=(t.clientY-e.top)*this.game.canvas.height/e.height;if(this.currentMousePos={x:i,y:s},this.mouseDown)if("endless"===this.game.mode){const t=this.game.player,e=i-t.x-t.width/2,l=s-t.y-t.height/2,a=.3;t.velX+=e*a*.01,t.velY+=l*a*.01;const o=8,n=Math.sqrt(t.velX**2+t.velY**2);n>o&&(t.velX=t.velX/n*o,t.velY=t.velY/n*o)}else this.game.player.flying||this.game.player.startFlying(),this.game.player.flyTowards(i,s)}handleMouseUp(t){this.mouseDown=!1,"endless"!==this.game.mode&&this.game.player.stopFlying()}isFiring(){return this.mouseDown}destroy(){const t=this.game.canvas;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseup",this.onMouseUp)}}class j{constructor(t){this.game=t,this.touchDown=!1,this.currentTouchPos=null,this.onTouchStart=this.handleTouchStart.bind(this),this.onTouchMove=this.handleTouchMove.bind(this),this.onTouchEnd=this.handleTouchEnd.bind(this);const e=t.canvas;e.addEventListener("touchstart",this.onTouchStart),e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd)}handleTouchStart(t){if(t.preventDefault(),!this.game.running||this.game.paused)return;this.touchDown=!0;const e=this.game.canvas.getBoundingClientRect(),i=t.touches[0],s=(i.clientX-e.left)*this.game.canvas.width/e.width,l=(i.clientY-e.top)*this.game.canvas.height/e.height;this.currentTouchPos={x:s,y:l},"endless"===this.game.mode&&this.game.laserSystem&&this.game.laserSystem.fire()}handleTouchMove(t){if(t.preventDefault(),!this.game.running||this.game.paused)return;const e=this.game.canvas.getBoundingClientRect(),i=t.touches[0],s=(i.clientX-e.left)*this.game.canvas.width/e.width,l=(i.clientY-e.top)*this.game.canvas.height/e.height;if(this.currentTouchPos={x:s,y:l},this.touchDown)if("endless"===this.game.mode){const t=this.game.player,e=s-t.x-t.width/2,i=l-t.y-t.height/2,a=.3;t.velX+=e*a*.01,t.velY+=i*a*.01;const o=8,n=Math.sqrt(t.velX**2+t.velY**2);n>o&&(t.velX=t.velX/n*o,t.velY=t.velY/n*o)}else this.game.player.flying||this.game.player.startFlying(),this.game.player.flyTowards(s,l)}handleTouchEnd(t){this.touchDown=!1,"endless"!==this.game.mode&&this.game.player.stopFlying()}isFiring(){return this.touchDown}destroy(){const t=this.game.canvas;t.removeEventListener("touchstart",this.onTouchStart),t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd)}}class N{constructor(t){this.game=t,this.keyboard=new $(t),this.mouse=new G(t),this.touch=new j(t)}destroy(){this.keyboard.destroy(),this.mouse.destroy(),this.touch.destroy()}}class _{constructor(){this.animationTime=0}update(){this.animationTime+=.05}render(t,e){t.save();const i=.1*Math.sin(2*this.animationTime)+1;switch(e.id){case"whale":this.drawWhale(t,e,i);break;case"pacman":this.drawPacman(t,e,i);break;case"dragon":this.drawDragon(t,e,i);break;case"ufo":this.drawUFO(t,e,i);break;case"shark":this.drawShark(t,e,i);break;case"robot":this.drawRobot(t,e,i)}t.restore()}drawWhale(t,e,i){t.fillStyle="#000000",t.strokeStyle="#00FF00",t.lineWidth=3,t.beginPath(),t.ellipse(e.x,e.y,.6*e.size*i,.4*e.size,0,0,2*Math.PI),t.fill(),t.stroke(),t.save(),t.fillStyle="#FFFF00",t.shadowColor="#FFFF00",t.shadowBlur=15,t.beginPath(),t.arc(e.x-.2*e.size,e.y,.15*e.size,0,2*Math.PI),t.fill(),t.fillStyle="#000000",t.beginPath(),t.arc(e.x-.2*e.size,e.y,.05*e.size,0,2*Math.PI),t.fill();for(let a=0;a<3;a++){const i=a*Math.PI*2/3+this.animationTime;t.fillStyle="#000000",t.beginPath(),t.moveTo(e.x-.2*e.size,e.y),t.arc(e.x-.2*e.size,e.y,.12*e.size,i-.3,i+.3),t.closePath(),t.fill()}t.restore();const s=10*Math.sin(3*this.animationTime);t.fillStyle="#000000",t.strokeStyle="#00FF00",t.beginPath(),t.moveTo(e.x-.5*e.size,e.y),t.lineTo(e.x-.7*e.size,e.y+s),t.lineTo(e.x-.5*e.size,e.y+20),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#FF0000",t.shadowColor="#FF0000",t.shadowBlur=20,t.beginPath(),t.arc(e.x+.3*e.size,e.y-.1*e.size,10*i,0,2*Math.PI),t.fill(),t.fillStyle="#8B0000",t.beginPath(),t.arc(e.x+.3*e.size,e.y-.1*e.size,5,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.strokeStyle="#FFFFFF",t.lineWidth=2,t.beginPath(),t.arc(e.x+.4*e.size,e.y+.1*e.size,.15*e.size,0,Math.PI),t.stroke(),t.fillStyle="#00FF00",t.shadowColor="#00FF00",t.shadowBlur=10;const l=5*Math.sin(2*this.animationTime);for(let a=0;a<3;a++)t.beginPath(),t.ellipse(e.x+.35*e.size+10*a,e.y+.25*e.size+l,3,8,0,0,2*Math.PI),t.fill();if(t.shadowBlur=0,i>1.02){t.strokeStyle="#000000",t.lineWidth=8,t.shadowColor="#00FF00",t.shadowBlur=10,t.beginPath(),t.moveTo(e.x-.1*e.size,e.y-.4*e.size),t.lineTo(e.x-.1*e.size,e.y-.8*e.size),t.stroke(),t.fillStyle="#000000";for(let i=0;i<5;i++){const s=(2*this.animationTime+i)%3;t.beginPath(),t.arc(e.x-.1*e.size+10*(Math.random()-.5),e.y-.4*e.size-20*s,4,0,2*Math.PI),t.fill()}t.shadowBlur=0}}drawPacman(t,e,i){const s=t.createRadialGradient(e.x,e.y-.2*e.size,0,e.x,e.y-.2*e.size,.5*e.size);s.addColorStop(0,"#CC66FF"),s.addColorStop(.5,e.color),s.addColorStop(1,"#6600CC"),t.fillStyle=s,t.strokeStyle="#00FFFF",t.lineWidth=3,t.beginPath(),t.ellipse(e.x,e.y-.15*e.size,.4*e.size*i,.3*e.size*i,0,Math.PI,0,!0),t.fill(),t.stroke(),t.strokeStyle="#00FFFF",t.lineWidth=2,t.shadowColor="#00FFFF",t.shadowBlur=10;for(let o=0;o<5;o++){const i=e.y-.35*e.size+o*e.size*.15;t.beginPath(),t.moveTo(e.x-.3*e.size,i),t.lineTo(e.x+.3*e.size,i),t.stroke()}t.shadowBlur=0;[{angle:-.3,phase:0},{angle:0,phase:2},{angle:.3,phase:4}].forEach(i=>{t.strokeStyle=e.color,t.lineWidth=8,t.lineCap="round";for(let s=0;s<15;s++){const l=s/15,a=.1*e.size*s,o=15*Math.sin(4*this.animationTime+i.phase+.3*s),n=e.x-a*Math.cos(i.angle),r=e.y+.1*e.size+a*Math.sin(i.angle)+o,h=1-.7*l;if(t.strokeStyle=`rgba(153, 51, 255, ${h})`,s>0){const a=.1*e.size*(s-1),o=15*Math.sin(4*this.animationTime+i.phase+.3*(s-1)),h=e.x-a*Math.cos(i.angle),c=e.y+.1*e.size+a*Math.sin(i.angle)+o;t.lineWidth=8*(1-.6*l),t.beginPath(),t.moveTo(h,c),t.lineTo(n,r),t.stroke()}s%3==0&&s>0&&(t.fillStyle="#00FFFF",t.shadowColor="#00FFFF",t.shadowBlur=8,t.beginPath(),t.arc(n,r,4*(1-.5*l),0,2*Math.PI),t.fill(),t.shadowBlur=0)}});[{x:-.15,y:-.2,size:12},{x:.15,y:-.2,size:12},{x:-.08,y:-.1,size:8},{x:.08,y:-.1,size:8}].forEach(i=>{t.fillStyle="#FFFFFF",t.beginPath(),t.arc(e.x+e.size*i.x,e.y+e.size*i.y,i.size,0,2*Math.PI),t.fill();const s=.2*Math.sin(3*this.animationTime)+.8;t.fillStyle=`rgba(0, 255, 100, ${s})`,t.shadowColor="#00FF64",t.shadowBlur=15,t.beginPath(),t.arc(e.x+e.size*i.x,e.y+e.size*i.y,.6*i.size,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle="#000000",t.beginPath(),t.arc(e.x+e.size*i.x,e.y+e.size*i.y,.3*i.size,0,2*Math.PI),t.fill()}),t.strokeStyle="#00FFFF",t.lineWidth=3;const l=5*Math.sin(2*this.animationTime);t.beginPath(),t.moveTo(e.x-.1*e.size,e.y+.05*e.size),t.quadraticCurveTo(e.x,e.y+.1*e.size+l,e.x+.1*e.size,e.y+.05*e.size),t.stroke(),t.strokeStyle="#00FFFF",t.lineWidth=2,t.shadowColor="#00FFFF",t.shadowBlur=15;const a=10*Math.sin(3*this.animationTime);t.beginPath(),t.moveTo(e.x-.25*e.size,e.y-.35*e.size),t.lineTo(e.x-.3*e.size,e.y-.5*e.size+a),t.stroke(),t.beginPath(),t.moveTo(e.x+.25*e.size,e.y-.35*e.size),t.lineTo(e.x+.3*e.size,e.y-.5*e.size-a),t.stroke(),t.fillStyle="#00FFFF",t.beginPath(),t.arc(e.x-.3*e.size,e.y-.5*e.size+a,5,0,2*Math.PI),t.arc(e.x+.3*e.size,e.y-.5*e.size-a,5,0,2*Math.PI),t.fill(),t.shadowBlur=0}drawDragon(t,e,i){const s=.15*e.size,l=20*Math.sin(2*this.animationTime);t.fillStyle=e.color,t.strokeStyle="#000000",t.lineWidth=2;for(let h=12;h>=0;h--){const a=e.x-h*s,o=e.y+Math.sin(3*this.animationTime+.5*h)*l,n=.15*e.size*(1-h/12*.3);t.fillStyle=h%2==0?e.color:"#2B1810",t.beginPath(),t.arc(a,o,n*i,0,2*Math.PI),t.fill(),t.stroke(),h%3==0&&h>0&&(t.fillStyle="#1A0F0A",t.beginPath(),t.arc(a-.3*n,o-.3*n,.3*n,0,2*Math.PI),t.fill())}const a=e.x,o=e.y+Math.sin(3*this.animationTime)*l;t.fillStyle=e.color,t.beginPath(),t.ellipse(a,o,.25*e.size*i,.18*e.size*i,0,0,2*Math.PI),t.fill(),t.stroke();const n=.3*Math.sin(4*this.animationTime)+.7;t.fillStyle=`rgba(0, 255, 0, ${n})`,t.shadowColor="#00FF00",t.shadowBlur=20,t.beginPath(),t.ellipse(a+.08*e.size,o-.08*e.size,8,12,0,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(a+.08*e.size,o+.08*e.size,8,12,0,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle="#000000",t.fillRect(a+.08*e.size-1,o-.08*e.size-8,2,16),t.fillRect(a+.08*e.size-1,o+.08*e.size-8,2,16),t.fillStyle="#000000",t.beginPath(),t.arc(a+.2*e.size,o-.05*e.size,3,0,2*Math.PI),t.arc(a+.2*e.size,o+.05*e.size,3,0,2*Math.PI),t.fill();const r=Math.abs(Math.sin(5*this.animationTime));if(r>.3){t.strokeStyle="#FF0000",t.lineWidth=3;const i=.3*e.size*r;t.beginPath(),t.moveTo(a+.25*e.size,o),t.lineTo(a+.25*e.size+i,o),t.stroke(),t.lineWidth=2;const s=a+.25*e.size+i;t.beginPath(),t.moveTo(s,o),t.lineTo(s+10,o-8),t.moveTo(s,o),t.lineTo(s+10,o+8),t.stroke()}t.strokeStyle="#FFFFFF",t.lineWidth=2,t.beginPath(),t.moveTo(a+.15*e.size,o-.02*e.size),t.lineTo(a+.18*e.size,o+.08*e.size),t.moveTo(a+.15*e.size,o+.02*e.size),t.lineTo(a+.18*e.size,o-.08*e.size),t.stroke(),r>.7&&(t.fillStyle="#00FF00",t.shadowColor="#00FF00",t.shadowBlur=10,t.beginPath(),t.arc(a+.18*e.size,o+.12*e.size,3,0,2*Math.PI),t.fill(),t.shadowBlur=0)}drawUFO(t,e,i){const s=10*Math.sin(2*this.animationTime);t.fillStyle=e.color,t.beginPath(),t.ellipse(e.x,e.y+s,.4*e.size,.2*e.size,0,Math.PI,0,!0),t.fill(),t.fillStyle="#C0C0C0",t.beginPath(),t.ellipse(e.x,e.y+.1*e.size+s,.5*e.size*i,.15*e.size,0,0,2*Math.PI),t.fill();[-.3,0,.3].forEach((i,l)=>{(5*this.animationTime+l)%2<1&&(t.fillStyle=l%2==0?"#FF0000":"#00FF00",t.beginPath(),t.arc(e.x+e.size*i,e.y+.1*e.size+s,5,0,2*Math.PI),t.fill())}),i>1.05&&(t.strokeStyle="rgba(0, 255, 0, 0.3)",t.lineWidth=20,t.beginPath(),t.moveTo(e.x,e.y+.2*e.size+s),t.lineTo(e.x,e.y+.5*e.size+s),t.stroke())}drawShark(t,e,i){t.fillStyle=e.color,t.beginPath(),t.moveTo(e.x+.4*e.size,e.y),t.lineTo(e.x-.4*e.size,e.y-.2*e.size),t.lineTo(e.x-.5*e.size,e.y),t.lineTo(e.x-.4*e.size,e.y+.2*e.size),t.closePath(),t.fill(),t.beginPath(),t.moveTo(e.x,e.y-.2*e.size),t.lineTo(e.x-.1*e.size,e.y-.4*e.size),t.lineTo(e.x+.1*e.size,e.y-.2*e.size),t.closePath(),t.fill();const s=15*Math.sin(4*this.animationTime);t.beginPath(),t.moveTo(e.x-.5*e.size,e.y),t.lineTo(e.x-.7*e.size,e.y+s),t.lineTo(e.x-.6*e.size,e.y),t.closePath(),t.fill(),t.fillStyle="#FFFFFF",t.beginPath(),t.arc(e.x+.2*e.size,e.y-.05*e.size,6,0,2*Math.PI),t.fill(),t.fillStyle="#000000",t.beginPath(),t.arc(e.x+.2*e.size,e.y-.05*e.size,3,0,2*Math.PI),t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2;for(let l=0;l<5;l++){const i=e.x+.3*e.size-8*l;t.beginPath(),t.moveTo(i,e.y),t.lineTo(i-3,e.y+5),t.lineTo(i+3,e.y+5),t.closePath(),t.stroke()}}drawRobot(t,e,i){t.fillStyle=e.color;const s=.4*e.size*i;t.fillRect(e.x-s/2,e.y-s/2,s,s),t.strokeStyle="#808080",t.lineWidth=3,t.strokeRect(e.x-s/2,e.y-s/2,s,s);Math.sin(3*this.animationTime)>.9||(t.fillStyle="#00FF00",t.shadowColor="#00FF00",t.shadowBlur=10,t.fillRect(e.x-.3*s,e.y-.2*s,.2*s,.15*s),t.fillRect(e.x+.1*s,e.y-.2*s,.2*s,.15*s),t.shadowBlur=0),t.strokeStyle="#808080",t.lineWidth=3,t.beginPath(),t.moveTo(e.x,e.y-s/2),t.lineTo(e.x,e.y-s/2-15),t.stroke();const l=Math.sin(4*this.animationTime)>0?"#FF0000":"#FF6600";t.fillStyle=l,t.beginPath(),t.arc(e.x,e.y-s/2-20,5,0,2*Math.PI),t.fill(),t.fillStyle="#404040",t.fillRect(e.x-.3*s,e.y+.1*s,.6*s,.15*s),t.save(),t.translate(e.x+.4*s,e.y+.4*s),t.rotate(this.animationTime),t.strokeStyle="#606060",t.lineWidth=2;for(let a=0;a<6;a++)t.beginPath(),t.moveTo(0,0),t.lineTo(10*Math.cos(a*Math.PI/3),10*Math.sin(a*Math.PI/3)),t.stroke();t.restore()}}class X{constructor(){this.config={segments:12,headSize:200,tailSize:30,baseColor:"#1a4d1a",alternateColor:"#0d260d",accentColor:"#CCFF00",warningColor:"#000000",eyeColor:"#00ff41",tongueColor:"#ff0000",fangColor:"#FFD700",venomColor:"#00ff41",rattleColor:"#FFD700",scaleSize:25,animationSpeed:.05,waveAmplitude:50,waveFrequency:.1},this.octagonCache={outer:[],inner:[]};for(let t=0;t<=8;t++){const e=t*Math.PI*2/8-Math.PI/2;this.octagonCache.outer.push({x:Math.cos(e),y:Math.sin(e)}),this.octagonCache.inner.push({x:.6*Math.cos(e),y:.6*Math.sin(e)})}this.segments=[],this.animationTime=0,this.mode="traverse",this.previousBossX=0,this.previousBossY=0,this.tongueExtension=0,this.blinkTimer=0,this.isBlinking=!1,this.venomDrop=0,this.eyeGlow=0}init(t,e,i,s="traverse"){if(this.segments=[],this.mode=s,"boss"===s){const s=t,l=e,a=2*i;for(let t=0;t<this.config.segments;t++){const e=t/(this.config.segments-1),o=t/this.config.segments*Math.PI*4,n=a*(1-.5*e);this.segments.push({x:s+Math.cos(o)*n,y:l+Math.sin(o)*n,index:t,size:i*(1.5-1.2*e),rotation:o,offsetX:0,offsetY:0,pulseOffset:.5*t,pulsePhase:0,rattleShake:0,baseAngle:o,baseRadius:n})}}else{const s=1.2*i,l=.25*i,a=.8*i;for(let i=0;i<this.config.segments;i++){const o=s-(s-l)*(i/(this.config.segments-1));this.segments.push({x:t+i*a,y:e,index:i,size:o,rotation:Math.PI,offsetX:0,offsetY:0,pulseOffset:.5*i,pulsePhase:0,rattleShake:0})}}}update(t,e){if(this.animationTime+=.05,0===this.segments.length&&this.init(e.x,e.y,e.size,this.mode),"boss"===this.mode)for(let i=0;i<this.segments.length;i++){const t=this.segments[i],s=.05*Math.sin(this.animationTime+t.pulseOffset),l=t.baseAngle+.1*this.animationTime,a=t.baseRadius*(1+s);t.x=e.x+Math.cos(l)*a,t.y=e.y+Math.sin(l)*a,t.rotation=l+Math.PI/2,t.pulsePhase=this.animationTime+t.pulseOffset,t.rattleShake=2*Math.sin(2*this.animationTime)}else{const t=e.x-this.previousBossX,i=e.y-this.previousBossY;this.previousBossX=e.x,this.previousBossY=e.y;for(let s=0;s<this.segments.length;s++){const l=this.segments[s];if(0===s){const s=e.x-l.x,a=e.y-l.y;l.x+=.7*s,l.y+=.7*a,(Math.abs(t)>.1||Math.abs(i)>.1)&&(l.rotation=Math.atan2(i,t))}else{const t=this.segments[s-1],e=t.x-l.x,i=t.y-l.y,a=Math.sqrt(e*e+i*i),o=.4*(t.size+l.size);if(a>0){const s=o/a;l.x=t.x-e*s,l.y=t.y-i*s}l.rotation=Math.atan2(i,e)}l.offsetX=0,l.offsetY=0,l.pulsePhase=this.animationTime+l.pulseOffset,l.rattleShake=1*Math.sin(2*this.animationTime)}}this.tongueExtension=.5*Math.sin(.15*this.animationTime)+.5,this.venomDrop=.5*Math.sin(.5*this.animationTime)+.5,this.eyeGlow=.5+.3*Math.sin(.2*this.animationTime),this.blinkTimer++,this.blinkTimer>180&&Math.random()<.02&&(this.isBlinking=!0,this.blinkTimer=0),this.blinkTimer>10&&(this.isBlinking=!1)}getHeadPosition(){return this.segments.length>0?{x:this.segments[0].x,y:this.segments[0].y}:null}render(t,e,i="traverse"){if(this.mode!==i&&(this.mode=i,this.segments=[],this.init(e.x,e.y,e.size,i)),0!==this.segments.length){for(let e=this.segments.length-1;e>=0;e--)this.drawSegment(t,this.segments[e]);this.drawHead(t,this.segments[0])}}drawSegment(t,e){t.save(),t.translate(e.x+e.offsetX,e.y+e.offsetY),t.rotate(e.rotation);const i=e.index%2==0?this.config.baseColor:this.config.alternateColor;t.fillStyle=i,t.beginPath(),t.ellipse(0,0,e.size,.7*e.size,0,0,2*Math.PI),t.fill(),e.index%3==1&&(t.fillStyle=this.config.accentColor,t.globalAlpha=.6,t.fillRect(.3*-e.size,.7*-e.size,.6*e.size,1.4*e.size),t.globalAlpha=1);const s=.4+.3*Math.sin(e.pulsePhase);if(t.strokeStyle=`rgba(204, 255, 0, ${s})`,t.lineWidth=3,t.beginPath(),t.ellipse(0,0,e.size,.7*e.size,0,0,2*Math.PI),t.stroke(),e.size>15){const i=Math.min(Math.floor(e.size/15),5);for(let s=0;s<i;s++){const l=s*Math.PI*2/i,a=Math.cos(l)*e.size*.5,o=Math.sin(l)*e.size*.35;this.drawOctagonalScale(t,a,o,.15*e.size)}}e.index===this.config.segments-1&&this.drawRattle(t,e),t.restore()}drawOctagonalScale(t,e,i,s){t.save(),t.translate(e,i),t.fillStyle=this.config.warningColor,t.beginPath();for(let l=0;l<this.octagonCache.outer.length;l++){const e=this.octagonCache.outer[l].x*s,i=this.octagonCache.outer[l].y*s;0===l?t.moveTo(e,i):t.lineTo(e,i)}t.closePath(),t.fill(),t.fillStyle=this.config.accentColor,t.beginPath();for(let l=0;l<this.octagonCache.inner.length;l++){const e=this.octagonCache.inner[l].x*s,i=this.octagonCache.inner[l].y*s;0===l?t.moveTo(e,i):t.lineTo(e,i)}t.closePath(),t.fill(),t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath();for(let l=0;l<this.octagonCache.outer.length;l++){const e=this.octagonCache.outer[l].x*s,i=this.octagonCache.outer[l].y*s;0===l?t.moveTo(e,i):t.lineTo(e,i)}t.closePath(),t.stroke(),t.restore()}drawRattle(t,e){const i=.3*e.size,s=e.rattleShake;for(let l=0;l<3;l++){const a=-e.size-10-l*(.4*i),o=s*(l+1)*.3,n=i-l*(.2*i);t.fillStyle=this.config.rattleColor,t.strokeStyle="#B8860B",t.lineWidth=2,t.beginPath(),t.arc(a,o,n,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#FFF4A3",t.globalAlpha=.5,t.beginPath(),t.arc(a-.3*n,o-.3*n,.3*n,0,2*Math.PI),t.fill(),t.globalAlpha=1}t.fillStyle=this.config.rattleColor,t.strokeStyle="#B8860B",t.lineWidth=2,t.beginPath(),t.moveTo(-e.size-20,10-i),t.lineTo(-e.size-35,-i-5),t.lineTo(-e.size-25,-i-5),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(-e.size-20,i-10),t.lineTo(-e.size-35,i+5),t.lineTo(-e.size-25,i+5),t.closePath(),t.fill(),t.stroke()}drawHead(t,e){t.save(),t.translate(e.x+e.offsetX,e.y+e.offsetY),t.rotate(e.rotation);const i=e.size;this.drawFangs(t,i),t.fillStyle=this.config.baseColor,t.beginPath(),t.moveTo(i,0),t.lineTo(.5*-i,.6*-i),t.lineTo(.5*-i,.6*i),t.closePath(),t.fill(),t.fillStyle=this.config.accentColor,t.globalAlpha=.7,t.beginPath(),t.moveTo(.5*i,.2*-i),t.lineTo(0,.15*-i),t.lineTo(0,.15*i),t.lineTo(.5*i,.2*i),t.closePath(),t.fill();for(let s=0;s<3;s++){const e=s*i*.2;t.beginPath(),t.moveTo(-e,.4*-i),t.lineTo(-e-.1*i,.5*-i),t.lineTo(-e-.15*i,.35*-i),t.closePath(),t.fill(),t.beginPath(),t.moveTo(-e,.4*i),t.lineTo(-e-.1*i,.5*i),t.lineTo(-e-.15*i,.35*i),t.closePath(),t.fill()}t.globalAlpha=1,t.strokeStyle=this.config.accentColor,t.lineWidth=4,t.beginPath(),t.moveTo(i,0),t.lineTo(.5*-i,.6*-i),t.lineTo(.5*-i,.6*i),t.closePath(),t.stroke(),t.fillStyle="#000000",t.beginPath(),t.arc(.6*i,.2*-i,8,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(.6*i,.2*i,8,0,2*Math.PI),t.fill(),this.drawEye(t,.2*i,.4*-i,i),this.drawEye(t,.2*i,.4*i,i),this.isBlinking||this.drawTongue(t,i),t.restore()}drawEye(t,e,i,s){const l=.18*s;t.save(),t.shadowColor=this.config.eyeColor,t.shadowBlur=.8*l,t.fillStyle="#1a1a1a",t.beginPath(),t.arc(e,i,l,0,2*Math.PI),t.fill(),this.isBlinking?(t.strokeStyle=this.config.baseColor,t.lineWidth=8,t.beginPath(),t.moveTo(e-l,i),t.lineTo(e+l,i),t.stroke()):(t.fillStyle=this.config.eyeColor,t.beginPath(),t.arc(e,i,.7*l,0,2*Math.PI),t.fill(),t.fillStyle="#000000",t.fillRect(e-4,i-.6*l,8,1.2*l),t.fillStyle=`rgba(255, 255, 255, ${this.eyeGlow})`,t.beginPath(),t.arc(e-8,i-10,8,0,2*Math.PI),t.fill()),t.restore()}drawTongue(t,e){const i=.4*e*this.tongueExtension,s=.08*e;t.save(),t.strokeStyle=this.config.tongueColor,t.lineWidth=6,t.lineCap="round",t.beginPath(),t.moveTo(e,0),t.lineTo(e+i,0),t.stroke(),i>20&&(t.beginPath(),t.moveTo(e+i,0),t.lineTo(e+i+s,-s),t.stroke(),t.beginPath(),t.moveTo(e+i,0),t.lineTo(e+i+s,s),t.stroke(),i>40&&(t.fillStyle="#ffffff",t.strokeStyle="#cccccc",t.lineWidth=1,t.beginPath(),t.moveTo(e+i+s-5,-s-3),t.lineTo(e+i+s+8,-s-8),t.lineTo(e+i+s+5,-s-2),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e+i+s-5,3-s),t.lineTo(e+i+s+8,8-s),t.lineTo(e+i+s+5,2-s),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e+i+s-5,s-3),t.lineTo(e+i+s+8,s-8),t.lineTo(e+i+s+5,s-2),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e+i+s-5,s+3),t.lineTo(e+i+s+8,s+8),t.lineTo(e+i+s+5,s+2),t.closePath(),t.fill(),t.stroke())),t.restore()}drawFangs(t,e){t.save(),t.fillStyle="#FFFFFF",t.strokeStyle="#CCCCCC",t.lineWidth=Math.max(1,.01*e);const i=.6*e;t.beginPath(),t.moveTo(i-20,.12*-e),t.lineTo(i+40,.05*-e),t.lineTo(i+30,0),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(i-20,.02*-e),t.lineTo(i+40,.05*e),t.lineTo(i+30,0),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(i-20,.02*e),t.lineTo(i+40,.05*-e),t.lineTo(i+30,0),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(i-20,.12*e),t.lineTo(i+40,.05*e),t.lineTo(i+30,0),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.globalAlpha=.9,t.beginPath(),t.arc(i+20,.04*-e,3,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(i+20,.04*e,3,0,2*Math.PI),t.fill(),t.globalAlpha=1,t.fillStyle=this.config.venomColor,t.shadowColor=this.config.venomColor,t.shadowBlur=10,t.globalAlpha=.8,t.beginPath(),t.arc(i+40,.05*-e+15*this.venomDrop,5,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(i+40,.05*e+15*this.venomDrop,5,0,2*Math.PI),t.fill(),t.globalAlpha=1,t.shadowBlur=0,t.restore()}}class Y{constructor(){this.config={segments:12,headSize:200,tailSize:30,baseColor:"#8B0000",alternateColor:"#000000",accentColor:"#FF4500",eyeColor:"#FFD700",tongueColor:"#ff0000",fangColor:"#FFD700",flameColor:"#FF6600",clawColor:"#333333",hornColor:"#1a1a1a",scaleSize:20,animationSpeed:.05,waveAmplitude:50,waveFrequency:.1},this.triangleCache=[];for(let t=0;t<3;t++){const e=t*Math.PI*2/3-Math.PI/2;this.triangleCache.push({x:Math.cos(e),y:Math.sin(e)})}this.segments=[],this.animationTime=0,this.mode="traverse",this.previousBossX=0,this.previousBossY=0,this.tongueExtension=0,this.blinkTimer=0,this.isBlinking=!1,this.flameParticles=[],this.eyeGlow=0}init(t,e,i,s="traverse"){if(this.segments=[],this.mode=s,"boss"===s){const s=t,l=e,a=2*i;for(let t=0;t<this.config.segments;t++){const e=t/(this.config.segments-1),o=t/this.config.segments*Math.PI*4,n=a*(1-.5*e);this.segments.push({x:s+Math.cos(o)*n,y:l+Math.sin(o)*n,index:t,size:i*(1.5-1.2*e),rotation:o,offsetX:0,offsetY:0,pulseOffset:.5*t,pulsePhase:0,hasLegs:(3===t||6===t||9===t)&&i>30,baseAngle:o,baseRadius:n})}}else{const s=1.2*i,l=.25*i,a=.8*i;for(let i=0;i<this.config.segments;i++){const o=s-(s-l)*(i/(this.config.segments-1));this.segments.push({x:t+i*a,y:e,index:i,size:o,rotation:Math.PI,offsetX:0,offsetY:0,pulseOffset:.5*i,pulsePhase:0,hasLegs:!1})}}}update(t,e){if(this.animationTime+=.05,0===this.segments.length&&this.init(e.x,e.y,e.size,this.mode),"boss"===this.mode)for(let i=0;i<this.segments.length;i++){const t=this.segments[i],s=.05*Math.sin(this.animationTime+t.pulseOffset),l=t.baseAngle+.1*this.animationTime,a=t.baseRadius*(1+s);t.x=e.x+Math.cos(l)*a,t.y=e.y+Math.sin(l)*a,t.rotation=l+Math.PI/2,t.pulsePhase=this.animationTime+t.pulseOffset}else{const t=e.x-this.previousBossX,i=e.y-this.previousBossY;this.previousBossX=e.x,this.previousBossY=e.y;for(let s=0;s<this.segments.length;s++){const l=this.segments[s];if(0===s){const s=e.x-l.x,a=e.y-l.y;l.x+=.7*s,l.y+=.7*a,(Math.abs(t)>.1||Math.abs(i)>.1)&&(l.rotation=Math.atan2(i,t))}else{const t=this.segments[s-1],e=t.x-l.x,i=t.y-l.y,a=Math.sqrt(e*e+i*i),o=.4*(t.size+l.size);if(a>0){const s=o/a;l.x=t.x-e*s,l.y=t.y-i*s}l.rotation=Math.atan2(i,e)}l.offsetX=0,l.offsetY=0,l.pulsePhase=this.animationTime+l.pulseOffset}}this.tongueExtension=.5*Math.sin(.15*this.animationTime)+.5,this.eyeGlow=.5+.3*Math.sin(.2*this.animationTime),this.blinkTimer++,this.blinkTimer>180&&Math.random()<.02&&(this.isBlinking=!0,this.blinkTimer=0),this.blinkTimer>10&&(this.isBlinking=!1),Math.random()<.3&&this.flameParticles.push({x:0,y:0,vx:5+5*Math.random(),vy:3*(Math.random()-.5),life:1,size:5+10*Math.random()}),this.flameParticles=this.flameParticles.filter(t=>(t.x+=t.vx,t.y+=t.vy,t.life-=.02,t.size*=.98,t.life>0))}getHeadPosition(){return this.segments.length>0?{x:this.segments[0].x,y:this.segments[0].y}:null}render(t,e,i="traverse"){if(this.mode!==i&&(this.mode=i,this.segments=[],this.init(e.x,e.y,e.size,i)),0!==this.segments.length){for(let e=this.segments.length-1;e>=0;e--)this.drawSegment(t,this.segments[e]);this.drawHead(t,this.segments[0])}}drawSegment(t,e){t.save(),t.translate(e.x+e.offsetX,e.y+e.offsetY),t.rotate(e.rotation),2!==e.index&&4!==e.index||this.drawWings(t,e);const i=e.index%2==0?this.config.baseColor:this.config.alternateColor;t.fillStyle=i,t.beginPath(),t.ellipse(0,0,e.size,.7*e.size,0,0,2*Math.PI),t.fill();const s=.4+.3*Math.sin(e.pulsePhase);if(t.strokeStyle=`rgba(255, 69, 0, ${s})`,t.lineWidth=3,t.beginPath(),t.ellipse(0,0,e.size,.7*e.size,0,0,2*Math.PI),t.stroke(),e.size>15){const i=Math.min(Math.floor(e.size/15),6);for(let s=0;s<i;s++){const l=s*Math.PI*2/i,a=Math.cos(l)*e.size*.5,o=Math.sin(l)*e.size*.35;this.drawTriangleScale(t,e,a,o,l,.15*e.size)}}e.hasLegs&&this.drawLegs(t,e),t.restore()}drawWings(t,e){const i=1.5*e.size,s=.3*Math.sin(2*e.pulsePhase);t.save(),t.globalAlpha=.8,t.fillStyle=this.config.baseColor,t.strokeStyle=this.config.alternateColor,t.lineWidth=3,t.beginPath(),t.moveTo(0,.5*-e.size),t.quadraticCurveTo(.7*-i,-i*(1+s),-i,.3*-i),t.lineTo(.8*-i,.3*-e.size),t.closePath(),t.fill(),t.stroke(),t.strokeStyle=this.config.alternateColor,t.lineWidth=4,t.beginPath(),t.moveTo(0,.5*-e.size),t.lineTo(.7*-i,-i*(1+s)),t.stroke(),t.fillStyle=this.config.clawColor,t.beginPath(),t.moveTo(-i,.3*-i),t.lineTo(-i-20,.4*-i),t.lineTo(-i-15,.25*-i),t.closePath(),t.fill(),t.restore(),t.save(),t.globalAlpha=.8,t.fillStyle=this.config.baseColor,t.strokeStyle=this.config.alternateColor,t.lineWidth=3,t.beginPath(),t.moveTo(0,.5*e.size),t.quadraticCurveTo(.7*-i,i*(1+s),-i,.3*i),t.lineTo(.8*-i,.3*e.size),t.closePath(),t.fill(),t.stroke(),t.strokeStyle=this.config.alternateColor,t.lineWidth=4,t.beginPath(),t.moveTo(0,.5*e.size),t.lineTo(.7*-i,i*(1+s)),t.stroke(),t.fillStyle=this.config.clawColor,t.beginPath(),t.moveTo(-i,.3*i),t.lineTo(-i-20,.4*i),t.lineTo(-i-15,.25*i),t.closePath(),t.fill(),t.restore()}drawLegs(t,e){const i=.8*e.size;e.size,t.fillStyle=this.config.alternateColor,t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath(),t.moveTo(.2*-e.size,.5*-e.size),t.lineTo(.3*-e.size,.5*-e.size-.6*i),t.lineTo(.4*-e.size,.5*-e.size-.6*i),t.lineTo(.3*-e.size,.5*-e.size),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(.3*-e.size,.5*-e.size-.6*i),t.lineTo(.2*-e.size,.5*-e.size-i),t.lineTo(.3*-e.size,.5*-e.size-i),t.lineTo(.4*-e.size,.5*-e.size-.6*i),t.closePath(),t.fill(),t.stroke(),t.fillStyle=this.config.clawColor;for(let s=0;s<3;s++){const l=8*(s-1);t.beginPath(),t.moveTo(.25*-e.size+l,.5*-e.size-i),t.lineTo(.25*-e.size+l-5,.5*-e.size-i-15),t.lineTo(.25*-e.size+l+5,.5*-e.size-i-12),t.closePath(),t.fill()}t.fillStyle=this.config.alternateColor,t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath(),t.moveTo(.2*-e.size,.5*e.size),t.lineTo(.3*-e.size,.5*e.size+.6*i),t.lineTo(.4*-e.size,.5*e.size+.6*i),t.lineTo(.3*-e.size,.5*e.size),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(.3*-e.size,.5*e.size+.6*i),t.lineTo(.2*-e.size,.5*e.size+i),t.lineTo(.3*-e.size,.5*e.size+i),t.lineTo(.4*-e.size,.5*e.size+.6*i),t.closePath(),t.fill(),t.stroke(),t.fillStyle=this.config.clawColor;for(let s=0;s<3;s++){const l=8*(s-1);t.beginPath(),t.moveTo(.25*-e.size+l,.5*e.size+i),t.lineTo(.25*-e.size+l-5,.5*e.size+i+15),t.lineTo(.25*-e.size+l+5,.5*e.size+i+12),t.closePath(),t.fill()}}drawTriangleScale(t,e,i,s,l,a){t.save(),t.translate(i,s),t.rotate(l),t.fillStyle=e.index%2==0?this.config.accentColor:this.config.alternateColor,t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath();for(let o=0;o<=3;o++){const e=this.triangleCache[o%3],i=e.x*a,s=e.y*a;0===o?t.moveTo(i,s):t.lineTo(i,s)}t.closePath(),t.fill(),t.stroke(),t.restore()}drawHead(t,e){t.save(),t.translate(e.x+e.offsetX,e.y+e.offsetY),t.rotate(e.rotation);const i=e.size;this.drawFlames(t,i),this.drawFangs(t,i),t.fillStyle=this.config.baseColor,t.beginPath(),t.moveTo(i,0),t.lineTo(.5*-i,.6*-i),t.lineTo(.5*-i,.6*i),t.closePath(),t.fill(),t.fillStyle=this.config.alternateColor,t.globalAlpha=.7;for(let s=0;s<3;s++){const e=s*i*.2;t.beginPath(),t.moveTo(-e,.4*-i),t.lineTo(-e-.1*i,.5*-i),t.lineTo(-e-.15*i,.35*-i),t.closePath(),t.fill(),t.beginPath(),t.moveTo(-e,.4*i),t.lineTo(-e-.1*i,.5*i),t.lineTo(-e-.15*i,.35*i),t.closePath(),t.fill()}t.globalAlpha=1,t.strokeStyle=this.config.accentColor,t.lineWidth=4,t.beginPath(),t.moveTo(i,0),t.lineTo(.5*-i,.6*-i),t.lineTo(.5*-i,.6*i),t.closePath(),t.stroke(),this.drawHorns(t,i),t.fillStyle="#000000",t.beginPath(),t.arc(.6*i,.2*-i,10,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(.6*i,.2*i,10,0,2*Math.PI),t.fill(),this.drawEye(t,.2*i,.4*-i,i),this.drawEye(t,.2*i,.4*i,i),this.isBlinking||this.drawTongue(t,i),t.restore()}drawHorns(t,e){t.fillStyle=this.config.hornColor,t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath(),t.moveTo(.3*-e,.7*-e),t.lineTo(.4*-e,1.2*-e),t.lineTo(.35*-e,1.15*-e),t.lineTo(.25*-e,.7*-e),t.closePath(),t.fill(),t.stroke();for(let i=0;i<3;i++){const s=.8*-e-i*e*.12;t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath(),t.moveTo(.38*-e,s),t.lineTo(.32*-e,s),t.stroke()}t.fillStyle=this.config.hornColor,t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath(),t.moveTo(.3*-e,.7*e),t.lineTo(.4*-e,1.2*e),t.lineTo(.35*-e,1.15*e),t.lineTo(.25*-e,.7*e),t.closePath(),t.fill(),t.stroke();for(let i=0;i<3;i++){const s=.8*e+i*e*.12;t.strokeStyle=this.config.accentColor,t.lineWidth=2,t.beginPath(),t.moveTo(.38*-e,s),t.lineTo(.32*-e,s),t.stroke()}}drawFlames(t,e){this.flameParticles.forEach(i=>{t.save(),t.globalAlpha=i.life;const s=t.createRadialGradient(e+i.x,i.y,0,e+i.x,i.y,i.size);s.addColorStop(0,"#FFD700"),s.addColorStop(.5,this.config.flameColor),s.addColorStop(1,"rgba(255, 0, 0, 0)"),t.fillStyle=s,t.beginPath(),t.arc(e+i.x,i.y,i.size,0,2*Math.PI),t.fill(),t.restore()})}drawEye(t,e,i,s){const l=.18*s;t.save(),t.shadowColor=this.config.eyeColor,t.shadowBlur=.8*l,t.fillStyle="#1a0000",t.beginPath(),t.arc(e,i,l,0,2*Math.PI),t.fill(),this.isBlinking?(t.strokeStyle=this.config.baseColor,t.lineWidth=8,t.beginPath(),t.moveTo(e-l,i),t.lineTo(e+l,i),t.stroke()):(t.fillStyle=this.config.eyeColor,t.beginPath(),t.arc(e,i,.7*l,0,2*Math.PI),t.fill(),t.fillStyle="#000000",t.fillRect(e-4,i-.6*l,8,1.2*l),t.fillStyle=`rgba(255, 215, 0, ${this.eyeGlow})`,t.beginPath(),t.arc(e-8,i-10,8,0,2*Math.PI),t.fill()),t.restore()}drawTongue(t,e){const i=.4*e*this.tongueExtension,s=.08*e;t.save(),t.strokeStyle=this.config.tongueColor,t.lineWidth=6,t.lineCap="round",t.beginPath(),t.moveTo(e,0),t.lineTo(e+i,0),t.stroke(),i>20&&(t.beginPath(),t.moveTo(e+i,0),t.lineTo(e+i+s,-s),t.stroke(),t.beginPath(),t.moveTo(e+i,0),t.lineTo(e+i+s,s),t.stroke()),t.restore()}drawFangs(t,e){const i=.7*e;t.save();const s=t.createLinearGradient(.3*e,0,.7*e,0);s.addColorStop(0,"#B8860B"),s.addColorStop(.5,this.config.fangColor),s.addColorStop(1,"#FFF4A3"),t.fillStyle=s,t.strokeStyle="#B8860B",t.lineWidth=2,t.beginPath(),t.moveTo(i-20,.12*-e),t.lineTo(i+40,.05*-e),t.lineTo(i+30,0),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(i-20,.12*e),t.lineTo(i+40,.05*e),t.lineTo(i+30,0),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.globalAlpha=.9,t.beginPath(),t.arc(i+20,.04*-e,3,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(i+20,.04*e,3,0,2*Math.PI),t.fill(),t.restore()}}class U{constructor(){this.config={bodyColor:"#0a1a2e",bellyColor:"#1e3a5f",finColor:"#0d2847",glowColor:"#00ff41",trailColor:"#00ff41"},this.contaminationTrail=[],this.maxTrailParticles=8,this.trailTimer=0,this.animationTime=0,this.tailFlap=0}update(t,e){this.animationTime+=.05,this.tailFlap=.3*Math.sin(2*this.animationTime),this.trailTimer++,this.trailTimer>5&&this.contaminationTrail.length<this.maxTrailParticles&&(this.contaminationTrail.push({x:e.x+1.8*e.size,y:e.y+(Math.random()-.5)*e.size*.4,life:1,size:.3*e.size}),this.trailTimer=0);for(let i=this.contaminationTrail.length-1;i>=0;i--){const t=this.contaminationTrail[i];t.life-=.02,t.size*=.98,t.life<=0&&this.contaminationTrail.splice(i,1)}}getHeadPosition(){return null}render(t,e){const i=e.size;this.drawContaminationTrail(t),t.save(),t.translate(e.x,e.y),this.drawBody(t,i),this.drawPectoralFins(t,i),this.drawTailFin(t,i),this.drawHead(t,i),this.drawRadioactiveGlow(t,i),t.restore()}drawBody(t,e){t.fillStyle=this.config.bodyColor,t.beginPath(),t.moveTo(1.2*-e,.5*-e),t.lineTo(.2*-e,.7*-e),t.lineTo(1*e,.4*-e),t.lineTo(1.5*e,0),t.lineTo(.8*e,.8*e),t.quadraticCurveTo(0,1.2*e,1*-e,.6*e),t.lineTo(1.2*-e,.5*-e),t.closePath(),t.fill(),t.fillStyle=this.config.bellyColor,t.beginPath(),t.moveTo(.8*-e,.5*e),t.quadraticCurveTo(0,1*e,.6*e,.7*e),t.lineTo(.5*e,.3*e),t.quadraticCurveTo(0,.5*e,.8*-e,.3*e),t.closePath(),t.fill(),t.strokeStyle=this.config.glowColor,t.lineWidth=3,t.globalAlpha=.5,t.beginPath(),t.moveTo(.8*-e,.4*-e),t.lineTo(.8*e,.2*-e),t.stroke(),t.beginPath(),t.moveTo(.6*-e,0),t.lineTo(1*e,.1),t.stroke(),t.beginPath(),t.moveTo(.5*-e,.5*e),t.lineTo(.6*e,.6*e),t.stroke(),t.globalAlpha=1}drawHead(t,e){t.strokeStyle="#000000",t.lineWidth=4,t.globalAlpha=.6,t.beginPath(),t.moveTo(1.2*-e,.2*e),t.lineTo(.8*-e,.4*e),t.stroke(),t.globalAlpha=1,t.fillStyle=this.config.glowColor,t.shadowColor=this.config.glowColor,t.shadowBlur=15,t.beginPath(),t.arc(.9*-e,.3*-e,.2*e,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle="#000000",t.beginPath(),t.ellipse(.9*-e,.3*-e,.04*e,.15*e,0,0,2*Math.PI),t.fill()}drawPectoralFins(t,e){t.fillStyle=this.config.finColor,t.beginPath(),t.moveTo(.3*-e,.6*e),t.lineTo(.1*-e,1.4*e),t.lineTo(.3*e,.9*e),t.lineTo(.2*e,.5*e),t.closePath(),t.fill()}drawTailFin(t,e){t.fillStyle=this.config.finColor;const i=1.5*e,s=this.tailFlap*e*.3;t.beginPath(),t.moveTo(i,0),t.quadraticCurveTo(i+.3*e,1*-e+s,i+.5*e,1.6*-e+s),t.quadraticCurveTo(i-.1*e,1.2*-e+s,i-.2*e,.2*-e),t.closePath(),t.fill(),t.beginPath(),t.moveTo(i,0),t.quadraticCurveTo(i+.3*e,1*e-s,i+.5*e,1.6*e-s),t.quadraticCurveTo(i-.1*e,1.2*e-s,i-.2*e,.2*e),t.closePath(),t.fill(),t.strokeStyle=this.config.bodyColor,t.lineWidth=2,t.globalAlpha=.5;for(let l=0;l<3;l++)t.beginPath(),t.moveTo(i,.1*-e),t.lineTo(i+.3*e,-e*(.6+.3*l)+s),t.stroke();for(let l=0;l<3;l++)t.beginPath(),t.moveTo(i,.1*e),t.lineTo(i+.3*e,e*(.6+.3*l)-s),t.stroke();t.globalAlpha=1}drawRadioactiveGlow(t,e){t.shadowColor=this.config.glowColor,t.shadowBlur=20,t.globalAlpha=.3+.1*Math.sin(this.animationTime),t.strokeStyle=this.config.glowColor,t.lineWidth=3,t.beginPath(),t.ellipse(0,0,1.5*e,.8*e,0,0,2*Math.PI),t.stroke(),t.shadowBlur=0,t.globalAlpha=1}drawContaminationTrail(t){for(const e of this.contaminationTrail)t.save(),t.globalAlpha=.4*e.life,t.fillStyle=this.config.trailColor,t.shadowColor=this.config.trailColor,t.shadowBlur=15,t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill(),t.restore()}}class H{constructor(){this.config={bodyColor:"#2c3e50",headColor:"#34495e",eyeColor:"#ff3333",jointColor:"#1a252f",sparkColor:"#00d4ff",glowColor:"#00d4ff"},this.animationTime=0,this.headRotation=0,this.headRotationSpeed=.02,this.eyeOffset1={x:0,y:0},this.eyeOffset2={x:0,y:0},this.eyeChangeTimer=0,this.sparks=[],this.maxSparks=6,this.sparkTimer=0}update(t,e){if(this.animationTime+=.05,this.headRotation+=this.headRotationSpeed,this.eyeChangeTimer++,this.eyeChangeTimer>8&&(this.eyeOffset1.x=.3*(Math.random()-.5),this.eyeOffset1.y=.3*(Math.random()-.5),this.eyeOffset2.x=.3*(Math.random()-.5),this.eyeOffset2.y=.3*(Math.random()-.5),this.eyeChangeTimer=0),this.sparkTimer++,this.sparkTimer>4&&this.sparks.length<this.maxSparks){const t=Math.random()*Math.PI*2,i=.6*e.size;this.sparks.push({x:e.x+Math.cos(t)*i,y:e.y+Math.sin(t)*i,vx:4*(Math.random()-.5),vy:4*(Math.random()-.5),life:1,size:3*Math.random()+2}),this.sparkTimer=0}for(let i=this.sparks.length-1;i>=0;i--){const t=this.sparks[i];t.x+=t.vx,t.y+=t.vy,t.life-=.05,t.size*=.95,t.life<=0&&this.sparks.splice(i,1)}}getHeadPosition(){return null}render(t,e){const i=e.size;this.drawSparks(t),t.save(),t.translate(e.x,e.y),this.drawLegs(t,i),this.drawBody(t,i),this.drawArms(t,i),this.drawHead(t,i),this.drawElectricGlow(t,i),t.restore()}drawBody(t,e){t.fillStyle=this.config.bodyColor,t.strokeStyle=this.config.jointColor,t.lineWidth=3,t.fillRect(.4*-e,.3*-e,.8*e,.9*e),t.strokeRect(.4*-e,.3*-e,.8*e,.9*e),t.fillStyle=this.config.jointColor,t.fillRect(.25*-e,.1*-e,.5*e,.15*e),t.fillStyle=this.config.glowColor;const i=Math.sin(3*this.animationTime)>0?1:.3;t.globalAlpha=i,t.beginPath(),t.arc(.15*-e,0,.05*e,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(.15*e,0,.05*e,0,2*Math.PI),t.fill(),t.globalAlpha=1}drawHead(t,e){t.save(),t.rotate(this.headRotation),t.fillStyle=this.config.headColor,t.strokeStyle=this.config.jointColor,t.lineWidth=3;const i=.7*-e;t.fillRect(.35*-e,i-.4*e,.7*e,.5*e),t.strokeRect(.35*-e,i-.4*e,.7*e,.5*e),t.strokeStyle=this.config.jointColor,t.lineWidth=2,t.beginPath(),t.moveTo(0,i-.4*e),t.lineTo(0,i-.6*e),t.stroke(),t.fillStyle=this.config.sparkColor,t.shadowColor=this.config.sparkColor,t.shadowBlur=10,t.beginPath(),t.arc(0,i-.65*e,.08*e,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle=this.config.eyeColor,t.shadowColor=this.config.eyeColor,t.shadowBlur=8,t.beginPath(),t.arc(.15*-e+this.eyeOffset1.x*e,i-.15*e+this.eyeOffset1.y*e,.1*e,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(.15*e+this.eyeOffset2.x*e,i-.15*e+this.eyeOffset2.y*e,.1*e,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle="#000000",t.beginPath(),t.arc(.15*-e+this.eyeOffset1.x*e,i-.15*e+this.eyeOffset1.y*e,.04*e,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(.15*e+this.eyeOffset2.x*e,i-.15*e+this.eyeOffset2.y*e,.04*e,0,2*Math.PI),t.fill(),t.restore()}drawArms(t,e){t.strokeStyle=this.config.bodyColor,t.lineWidth=.15*e,t.lineCap="round";const i=.2*Math.sin(2*this.animationTime);t.beginPath(),t.moveTo(.4*-e,.1*-e),t.lineTo(.7*-e,.2*e+i),t.lineTo(.75*-e,.5*e+i),t.stroke(),t.fillStyle=this.config.jointColor,t.beginPath(),t.arc(.75*-e,.5*e+i,.12*e,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(.4*e,.1*-e),t.lineTo(.7*e,.2*e-i),t.lineTo(.75*e,.5*e-i),t.stroke(),t.fillStyle=this.config.jointColor,t.beginPath(),t.arc(.75*e,.5*e-i,.12*e,0,2*Math.PI),t.fill()}drawLegs(t,e){t.strokeStyle=this.config.bodyColor,t.lineWidth=.18*e,t.lineCap="round";const i=.1*Math.sin(1.5*this.animationTime);t.beginPath(),t.moveTo(.2*-e,.6*e),t.lineTo(.25*-e,1*e+i),t.stroke(),t.fillStyle=this.config.jointColor,t.fillRect(.4*-e,1*e+i,.3*e,.15*e),t.beginPath(),t.moveTo(.2*e,.6*e),t.lineTo(.25*e,1*e-i),t.stroke(),t.fillStyle=this.config.jointColor,t.fillRect(.1*e,1*e-i,.3*e,.15*e)}drawElectricGlow(t,e){t.shadowColor=this.config.glowColor,t.shadowBlur=25,t.globalAlpha=.3+.15*Math.sin(4*this.animationTime),t.strokeStyle=this.config.glowColor,t.lineWidth=2,t.strokeRect(.5*-e,.8*-e,e,2*e),t.shadowBlur=0,t.globalAlpha=1}drawSparks(t){t.fillStyle=this.config.sparkColor,t.shadowColor=this.config.sparkColor,t.shadowBlur=8;for(const e of this.sparks)t.globalAlpha=e.life,t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill(),t.strokeStyle=this.config.sparkColor,t.lineWidth=.5*e.size,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x-2*e.vx,e.y-2*e.vy),t.stroke();t.globalAlpha=1,t.shadowBlur=0}}class K{constructor(){this.config={bodyColor:"#2d3436",domeColor:"#636e72",glowColor:"#00ff00",laserColor:"#00ff00",alertColor:"#ff0000",lightColor:"#ffff00"},this.animationTime=0,this.hoverOffset=0,this.rotation=0,this.lasers=[],this.maxLasers=4,this.laserTimer=0,this.lightBlink=0,this.alertPulse=0}update(t,e){this.animationTime+=.05,this.rotation+=.02,this.hoverOffset=.2*Math.sin(2*this.animationTime),this.lightBlink=Math.sin(5*this.animationTime),this.alertPulse=Math.abs(Math.sin(3*this.animationTime)),this.laserTimer++,this.laserTimer>15&&this.lasers.length<this.maxLasers&&(this.lasers.push({x:e.x+(Math.random()-.5)*e.size*.8,y:e.y+.5*e.size,length:0,maxLength:100+100*Math.random(),growing:!0,life:1}),this.laserTimer=0);for(let i=this.lasers.length-1;i>=0;i--){const t=this.lasers[i];t.growing?(t.length+=15,t.length>=t.maxLength&&(t.growing=!1)):(t.life-=.05,t.life<=0&&this.lasers.splice(i,1))}}getHeadPosition(){return null}render(t,e){const i=e.size;this.drawLasers(t),t.save(),t.translate(e.x,e.y+this.hoverOffset*i),this.drawBeam(t,i),t.save(),t.rotate(this.rotation),this.drawSaucer(t,i),t.restore(),this.drawDome(t,i),this.drawLights(t,i),this.drawAlert(t,i),t.restore()}drawSaucer(t,e){t.fillStyle=this.config.bodyColor,t.strokeStyle="#000000",t.lineWidth=3,t.beginPath(),t.ellipse(0,.2*e,.9*e,.3*e,0,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#1a1a1a",t.lineWidth=2,t.beginPath(),t.ellipse(0,.2*e,.7*e,.22*e,0,0,2*Math.PI),t.stroke(),t.beginPath(),t.ellipse(0,.2*e,.5*e,.15*e,0,0,2*Math.PI),t.stroke()}drawDome(t,e){t.fillStyle=this.config.domeColor,t.globalAlpha=.6,t.beginPath(),t.ellipse(0,.1*-e,.5*e,.35*e,0,0,Math.PI,!0),t.fill(),t.globalAlpha=1,t.fillStyle="#ffffff",t.globalAlpha=.3,t.beginPath(),t.ellipse(.15*-e,.25*-e,.15*e,.1*e,-.3,0,2*Math.PI),t.fill(),t.globalAlpha=1}drawLights(t,e){for(let i=0;i<8;i++){const s=i/8*Math.PI*2,l=Math.cos(s)*e*.8,a=.2*e+Math.sin(s)*e*.25,o=Math.floor(2*this.lightBlink+i)%2==0;t.fillStyle=o?this.config.lightColor:this.config.glowColor,t.shadowColor=o?this.config.lightColor:this.config.glowColor,t.shadowBlur=o?15:8,t.beginPath(),t.arc(l,a,.08*e,0,2*Math.PI),t.fill()}t.shadowBlur=0}drawBeam(t,e){const i=t.createLinearGradient(0,.4*e,0,2.5*e);i.addColorStop(0,`rgba(0, 255, 0, ${.3*this.alertPulse})`),i.addColorStop(1,"rgba(0, 255, 0, 0)"),t.fillStyle=i,t.beginPath(),t.moveTo(.3*-e,.4*e),t.lineTo(.8*-e,2.5*e),t.lineTo(.8*e,2.5*e),t.lineTo(.3*e,.4*e),t.closePath(),t.fill(),t.fillStyle=`rgba(255, 255, 255, ${.5*this.alertPulse})`;for(let s=0;s<5;s++){const i=.6*e+(30*this.animationTime+40*s)%(1.8*e),l=Math.sin(s+this.animationTime)*e*.4;t.beginPath(),t.arc(l,i,.05*e,0,2*Math.PI),t.fill()}}drawAlert(t,e){const i=.4*e*(1+.2*this.alertPulse),s=.8*-e;t.fillStyle=this.config.alertColor,t.strokeStyle="#ffffff",t.lineWidth=3,t.shadowColor=this.config.alertColor,t.shadowBlur=20*this.alertPulse,t.fillRect(.2*-i,s-.8*i,.4*i,.6*i),t.strokeRect(.2*-i,s-.8*i,.4*i,.6*i),t.beginPath(),t.arc(0,s,.25*i,0,2*Math.PI),t.fill(),t.stroke(),t.shadowBlur=0}drawLasers(t){t.strokeStyle=this.config.laserColor,t.shadowColor=this.config.laserColor,t.shadowBlur=15;for(const e of this.lasers)t.globalAlpha=e.life,t.lineWidth=4,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x,e.y+e.length),t.stroke(),t.fillStyle=this.config.laserColor,t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.fill(),e.growing||(t.beginPath(),t.arc(e.x,e.y+e.length,8,0,2*Math.PI),t.fill());t.globalAlpha=1,t.shadowBlur=0}}class J{constructor(){this.config={bodyColor:"#4a1a4a",tentacleColor:"#6b2d6b",eyeColor:"#ff0000",missileColor:"#2c2c2c",flameColor:"#ff4400",glowColor:"#9933ff",laserColor:"#00ff00"},this.animationTime=0,this.tentacles=[],this.numTentacles=6,this.initTentacles(),this.rocketPulse=0,this.rocketFlame=0,this.eyeBlink=0}initTentacles(){for(let t=0;t<this.numTentacles;t++){const e=t/this.numTentacles*Math.PI*2;this.tentacles.push({baseAngle:e,segments:5,length:.8,waveOffset:Math.random()*Math.PI*2})}}update(t,e){this.animationTime+=.05,this.rocketPulse=Math.abs(Math.sin(4*this.animationTime)),this.rocketFlame=.5*Math.sin(8*this.animationTime)+.5,this.eyeBlink=Math.sin(2*this.animationTime)>.9?0:1}getHeadPosition(){return null}render(t,e){const i=e.size;t.save(),t.translate(e.x,e.y),this.drawTentacles(t,i),this.drawBody(t,i),this.drawRocket(t,i),this.drawEyes(t,i),this.drawGlow(t,i),t.restore()}drawBody(t,e){t.fillStyle=this.config.bodyColor,t.strokeStyle="#000000",t.lineWidth=3,t.beginPath(),t.ellipse(0,0,.6*e,.9*e,0,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle=this.config.tentacleColor;for(let i=0;i<6;i++){const s=.5*-e+i*e*.2,l=i%2==0?.25*-e:.25*e;t.beginPath(),t.arc(l,s,.08*e,0,2*Math.PI),t.fill()}t.strokeStyle="#ff0000",t.lineWidth=2,t.globalAlpha=.4,t.beginPath(),t.moveTo(.3*-e,.6*-e),t.lineTo(.1*-e,.3*-e),t.stroke(),t.beginPath(),t.moveTo(.3*e,.4*-e),t.lineTo(.15*e,.1*-e),t.stroke(),t.globalAlpha=1}drawTentacles(t,e){for(let i=0;i<this.tentacles.length;i++){const s=this.tentacles[i],l=s.baseAngle;t.strokeStyle=this.config.tentacleColor,t.lineWidth=.15*e,t.lineCap="round";const a=Math.cos(l)*e*.5,o=.7*e;let n=a,r=o,h=n,c=r;t.beginPath(),t.moveTo(n,r);for(let i=1;i<=s.segments;i++){const d=i/s.segments,u=Math.sin(2*this.animationTime+s.waveOffset+.5*i)*e*.2,f=e*s.length*d;n=a+Math.cos(l)*u,r=o+f,h=n,c=r,t.lineTo(n,r),t.lineWidth=.15*e*(1-.5*d)}t.stroke(),t.fillStyle=this.config.bodyColor;for(let i=1;i<s.segments;i++){const n=i/s.segments,r=Math.sin(2*this.animationTime+s.waveOffset+.5*i)*e*.2,h=e*s.length*n,c=a+Math.cos(l)*r,d=o+h;t.beginPath(),t.arc(c,d,.06*e*(1-.5*n),0,2*Math.PI),t.fill()}this.drawLaserClaw(t,h,c,.3*e,l)}}drawLaserClaw(t,e,i,s,l){t.save(),t.translate(e,i),t.rotate(l+Math.PI/2),t.shadowColor=this.config.laserColor,t.shadowBlur=15,t.fillStyle=this.config.missileColor,t.strokeStyle="#000000",t.lineWidth=2,t.beginPath(),t.arc(0,0,.3*s,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle=this.config.laserColor,t.lineWidth=4,t.lineCap="round";const a=.3*Math.sin(3*this.animationTime);t.beginPath(),t.moveTo(0,0),t.lineTo(Math.cos(-.5-a)*s,Math.sin(-.5-a)*s),t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(0,s),t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(Math.cos(.5+a)*s,Math.sin(.5+a)*s),t.stroke(),t.fillStyle=this.config.laserColor,t.globalAlpha=.8+.2*Math.sin(5*this.animationTime),t.beginPath(),t.arc(Math.cos(-.5-a)*s,Math.sin(-.5-a)*s,.15*s,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(0,s,.15*s,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(Math.cos(.5+a)*s,Math.sin(.5+a)*s,.15*s,0,2*Math.PI),t.fill(),t.globalAlpha=1,t.shadowBlur=0,t.restore()}drawRocket(t,e){const i=.5*e,s=.4*e;t.shadowColor=this.config.flameColor,t.shadowBlur=20*this.rocketPulse,t.fillStyle=this.config.missileColor,t.strokeStyle="#000000",t.lineWidth=2,t.fillRect(.3*-s,i-.2*s,.6*s,.8*s),t.strokeRect(.3*-s,i-.2*s,.6*s,.8*s),t.fillStyle="#ff0000",t.beginPath(),t.moveTo(0,i-.5*s),t.lineTo(.3*-s,i-.2*s),t.lineTo(.3*s,i-.2*s),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#1a1a1a",t.beginPath(),t.moveTo(.3*-s,i+.4*s),t.lineTo(.6*-s,i+.6*s),t.lineTo(.3*-s,i+.6*s),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(.3*s,i+.4*s),t.lineTo(.6*s,i+.6*s),t.lineTo(.3*s,i+.6*s),t.closePath(),t.fill(),t.stroke(),t.shadowBlur=0,this.drawRocketFlame(t,s,i+.6*s),t.fillStyle="#ffff00",t.font=`bold ${.15*e}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("‚ö†",0,i+.1*s)}drawRocketFlame(t,e,i){const s=.4*e*this.rocketFlame,l=t.createLinearGradient(0,i,0,i+s);l.addColorStop(0,"#ff4400"),l.addColorStop(.5,"#ff8800"),l.addColorStop(1,"rgba(255, 136, 0, 0)"),t.fillStyle=l,t.beginPath(),t.moveTo(.2*-e,i),t.lineTo(.1*-e,i+s),t.lineTo(0,i+1.2*s),t.lineTo(.1*e,i+s),t.lineTo(.2*e,i),t.closePath(),t.fill(),t.fillStyle="#ffff00",t.globalAlpha=this.rocketFlame,t.beginPath(),t.arc(0,i+.3*s,.08*e,0,2*Math.PI),t.fill(),t.globalAlpha=1}drawEyes(t,e){0!==this.eyeBlink&&(t.fillStyle=this.config.eyeColor,t.shadowColor=this.config.eyeColor,t.shadowBlur=15,t.beginPath(),t.arc(.25*-e,.15*-e,.15*e,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(.25*e,.15*-e,.15*e,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle="#000000",t.beginPath(),t.ellipse(.25*-e,.15*-e,.04*e,.12*e,0,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(.25*e,.15*-e,.04*e,.12*e,0,0,2*Math.PI),t.fill())}drawGlow(t,e){t.strokeStyle=this.config.glowColor,t.shadowColor=this.config.glowColor,t.shadowBlur=20,t.globalAlpha=.3+.1*Math.sin(3*this.animationTime),t.lineWidth=3,t.beginPath(),t.arc(0,0,.9*e,0,2*Math.PI),t.stroke(),t.shadowBlur=0,t.globalAlpha=1}}class Q{constructor(){this.config={bodyColor:"#2c3e50",bellyColor:"#95a5a6",finColor:"#1a252f",eyeColor:"#ff0000",teethColor:"#ffffff",bloodColor:"#8b0000",cyberColor:"#00d4ff",rocketColor:"#ff4400"},this.animationTime=0,this.swimWave=0,this.tailSwing=0,this.jawOpen=0,this.jawSpeed=.15,this.bloodDrops=[],this.maxBloodDrops=6,this.bloodTimer=0,this.rocketFlame=0,this.cyberPulse=0}update(t,e){this.animationTime+=.05,this.swimWave=.1*Math.sin(2*this.animationTime),this.tailSwing=.3*Math.sin(3*this.animationTime),this.jawOpen=.4*Math.abs(Math.sin(2*this.animationTime)),this.rocketFlame=.5*Math.sin(8*this.animationTime)+.5,this.cyberPulse=Math.abs(Math.sin(4*this.animationTime)),this.bloodTimer++,this.bloodTimer>10&&this.bloodDrops.length<this.maxBloodDrops&&(this.bloodDrops.push({x:e.x-1.2*e.size+(Math.random()-.5)*e.size*.3,y:e.y+.2*e.size,vy:2+2*Math.random(),vx:2*(Math.random()-.5),life:1,size:3+4*Math.random()}),this.bloodTimer=0);for(let i=this.bloodDrops.length-1;i>=0;i--){const t=this.bloodDrops[i];t.x+=t.vx,t.y+=t.vy,t.vy+=.2,t.life-=.02,t.life<=0&&this.bloodDrops.splice(i,1)}}getHeadPosition(){return null}render(t,e){const i=e.size;this.drawBlood(t),t.save(),t.translate(e.x,e.y),this.drawTail(t,i),this.drawCaudalFin(t,i),this.drawBody(t,i),this.drawRocketFin(t,i),this.drawPectoralFins(t,i),this.drawHead(t,i),this.drawCyberImplants(t,i),t.restore()}drawBody(t,e){t.fillStyle=this.config.bodyColor,t.strokeStyle="#000000",t.lineWidth=3,t.beginPath(),t.moveTo(1.5*-e,0),t.quadraticCurveTo(.8*-e,.4*-e,.2*e,.5*-e),t.lineTo(.8*e,.3*-e),t.lineTo(1.2*e,0),t.lineTo(.8*e,.3*e),t.quadraticCurveTo(0,.6*e,1.2*-e,.3*e),t.lineTo(1.5*-e,0),t.closePath(),t.fill(),t.stroke(),t.fillStyle=this.config.bellyColor,t.beginPath(),t.moveTo(1.2*-e,.2*e),t.quadraticCurveTo(0,.5*e,.6*e,.25*e),t.lineTo(.5*e,.1*e),t.quadraticCurveTo(0,.2*e,1*-e,.1*e),t.closePath(),t.fill(),t.strokeStyle=this.config.cyberColor,t.lineWidth=2,t.globalAlpha=.6;for(let i=0;i<5;i++){const s=.5*-e+i*e*.15;t.beginPath(),t.moveTo(s,.2*-e),t.lineTo(s+.1*e,.35*-e),t.stroke()}t.globalAlpha=1}drawHead(t,e){const i=this.jawOpen;t.fillStyle=this.config.bodyColor,t.strokeStyle="#000000",t.lineWidth=3,t.beginPath(),t.moveTo(1.5*-e,0),t.quadraticCurveTo(1.6*-e,.15*-e,1.4*-e,.2*-e),t.lineTo(1.2*-e,.1*-e),t.closePath(),t.fill(),t.stroke(),t.fillStyle=this.config.teethColor;for(let s=0;s<8;s++){const i=1.5*-e+s*e*.08;t.beginPath(),t.moveTo(i,.05*-e),t.lineTo(i-.03*e,.05*e),t.lineTo(i+.03*e,.05*e),t.closePath(),t.fill(),t.stroke()}t.save(),t.translate(1.3*-e,.1*e),t.rotate(i),t.fillStyle=this.config.bodyColor,t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(.2*-e,.15*e,.1*-e,.25*e),t.lineTo(.1*e,.15*e),t.closePath(),t.fill(),t.stroke(),t.fillStyle=this.config.teethColor;for(let s=0;s<6;s++){const i=.15*-e+s*e*.08;t.beginPath(),t.moveTo(i,0),t.lineTo(i-.03*e,.08*e),t.lineTo(i+.03*e,.08*e),t.closePath(),t.fill(),s%2==0&&(t.fillStyle=this.config.bloodColor,t.globalAlpha=.7,t.fillRect(i-.02*e,.02*e,.04*e,.04*e),t.globalAlpha=1,t.fillStyle=this.config.teethColor)}t.restore(),t.fillStyle=this.config.eyeColor,t.shadowColor=this.config.eyeColor,t.shadowBlur=15,t.beginPath(),t.arc(1.1*-e,.25*-e,.12*e,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.fillStyle="#000000",t.beginPath(),t.arc(1.1*-e,.25*-e,.05*e,0,2*Math.PI),t.fill(),t.strokeStyle=this.config.cyberColor,t.lineWidth=2,t.globalAlpha=this.cyberPulse,t.beginPath(),t.arc(1.1*-e,.25*-e,.18*e,0,2*Math.PI),t.stroke(),t.globalAlpha=1}drawRocketFin(t,e){const i=.2*e,s=.5*-e;t.fillStyle=this.config.finColor,t.strokeStyle="#000000",t.lineWidth=3,t.beginPath(),t.moveTo(i-.2*e,s),t.lineTo(i,s-.8*e),t.lineTo(i+.3*e,s),t.closePath(),t.fill(),t.stroke();const l=s-.5*e;t.fillStyle=this.config.bodyColor,t.fillRect(i-.08*e,l,.16*e,.3*e),t.strokeRect(i-.08*e,l,.16*e,.3*e),t.fillStyle="#ffff00",t.font=`bold ${.12*e}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText("!",i,l+.15*e),t.fillStyle="#1a1a1a",t.fillRect(i-.1*e,s-.2*e,.2*e,.1*e),this.drawRocketFlame(t,i,s-.15*e),t.strokeStyle=this.config.cyberColor,t.lineWidth=2,t.globalAlpha=.8,t.beginPath(),t.moveTo(i-.1*e,l),t.lineTo(i-.15*e,s-.25*e),t.stroke(),t.beginPath(),t.moveTo(i+.1*e,l),t.lineTo(i+.15*e,s-.25*e),t.stroke(),t.globalAlpha=1}drawRocketFlame(t,e,i){const s=.3+.2*this.rocketFlame,l=t.createLinearGradient(e,i,e,i+30*s);l.addColorStop(0,this.config.rocketColor),l.addColorStop(.5,"#ff8800"),l.addColorStop(1,"rgba(255, 136, 0, 0)"),t.fillStyle=l,t.beginPath(),t.moveTo(e-8,i),t.lineTo(e-4,i+25*s),t.lineTo(e,i+30*s),t.lineTo(e+4,i+25*s),t.lineTo(e+8,i),t.closePath(),t.fill()}drawPectoralFins(t,e){t.fillStyle=this.config.finColor,t.strokeStyle="#000000",t.lineWidth=2,t.beginPath(),t.moveTo(.3*-e,.4*e),t.lineTo(.2*-e,.9*e),t.lineTo(.1*e,.6*e),t.closePath(),t.fill(),t.stroke()}drawTail(t,e){t.strokeStyle=this.config.bodyColor,t.lineWidth=.3*e,t.lineCap="round";const i=this.tailSwing*e*.2;t.beginPath(),t.moveTo(1.2*e,0),t.quadraticCurveTo(1.5*e,i,1.8*e,1.5*i),t.stroke()}drawCaudalFin(t,e){const i=this.tailSwing*e*.2;t.fillStyle=this.config.finColor,t.strokeStyle="#000000",t.lineWidth=2,t.save(),t.translate(1.8*e,1.5*i),t.rotate(.3*this.tailSwing),t.beginPath(),t.moveTo(0,0),t.lineTo(.3*e,.6*-e),t.lineTo(.1*e,.3*-e),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(.3*e,.4*e),t.lineTo(.1*e,.2*e),t.closePath(),t.fill(),t.stroke(),t.restore()}drawCyberImplants(t,e){t.fillStyle=this.config.cyberColor,t.shadowColor=this.config.cyberColor,t.shadowBlur=10*this.cyberPulse,t.globalAlpha=.7,t.fillRect(.6*-e,.35*-e,.3*e,.1*e),t.fillRect(.1*e,.4*-e,.25*e,.08*e),t.globalAlpha=this.cyberPulse,t.strokeStyle=this.config.cyberColor,t.lineWidth=3,t.beginPath(),t.moveTo(.4*-e,.3*-e),t.lineTo(0,.2*-e),t.lineTo(.3*e,.35*-e),t.stroke(),t.globalAlpha=1,t.shadowBlur=0}drawBlood(t){t.fillStyle=this.config.bloodColor,t.shadowColor=this.config.bloodColor,t.shadowBlur=5;for(const e of this.bloodDrops)t.globalAlpha=e.life,t.beginPath(),t.arc(e.x,e.y,e.size,0,2*Math.PI),t.fill();t.globalAlpha=1,t.shadowBlur=0}}class Z{constructor(t){this.game=t,this.active=!0,this.distance=0,this.previousDistance=0,this.highScore=this.loadHighScore(),this.multiplier=1,this.waveLevel=1,this.comboCount=0,console.log("‚ôæÔ∏è Mode Infini: Score par addition progressive de tous les bonus"),this.visualBoss=new _,this.serpentBoss=new X,this.dragonBoss=new Y,this.whaleBoss=new U,this.robotBoss=new H,this.ufoBoss=new K,this.krakenBoss=new J,this.sharkBoss=new Q,this.bossDefinitions=[{id:"whale",emoji:"üêã",text:"FUKUSHIMA",color:"#000000",size:40,obstacleEmoji:"üíß",fuelEmoji:"üêü"},{id:"pacman",emoji:"üëæ",text:"KRAKEN",color:"#9933FF",size:120,obstacleEmoji:"üëª",fuelEmoji:"üçí"},{id:"dragon",emoji:"üêâ",text:"DRAGON DE FEU",color:"#8B0000",size:45,obstacleEmoji:"üî•",fuelEmoji:"üíé"},{id:"serpent",emoji:"üêç",text:"SERPENT VENIMEUX",color:"#1a4d1a",size:40,obstacleEmoji:"‚ò†Ô∏è",fuelEmoji:"üçÉ"},{id:"ufo",emoji:"üõ∏",text:"OVNI",color:"#00FF00",size:95,obstacleEmoji:"üëΩ",fuelEmoji:"üåü"},{id:"shark",emoji:"ü¶à",text:"REQUIN",color:"#4682B4",size:85,obstacleEmoji:"ü¶ë",fuelEmoji:"üê†"},{id:"robot",emoji:"ü§ñ",text:"ROBOT",color:"#C0C0C0",size:100,obstacleEmoji:"‚öôÔ∏è",fuelEmoji:"üîã"}],this.stageBosses=[{id:"serpent",emoji:"üêç",text:"SERPENT DE PALIER",color:"#1a4d1a",size:90,obstacleEmoji:"‚ò†Ô∏è",fuelEmoji:"üçÉ",health:200,maxHealth:200},{id:"dragon",emoji:"üêâ",text:"DRAGON DE PALIER",color:"#8B0000",size:90,obstacleEmoji:"üî•",fuelEmoji:"‚ú®",health:200,maxHealth:200}],this.stageBossIndex=0,this.currentBossIndex=0,this.currentBoss=null,this.bossCount=0,this.isStageBoss=!1,this.stageBossTimer=0,this.stageBossInitialY=0,this.stageBossPhase="arriving",this.resetBoss(),this.obstacles=[],this.fuels=[],this.spawnTimer=0,this.fuelTimer=0,this.currentPattern="top",this.gameOverAnimation=!1,this.rocketY=0,this.explosionPhase=0,this.bossComment=null,this.bossCommentTimer=0,this.bossCommentDuration=180,this.onomatopoeia=null,this.onomatopoeiaTimer=0}getTranslatedBossText(t,e=!1){var i,s,l;const a=e?`${t}_stage`:t;return null==(l=null==(s=null==(i=p.translations)?void 0:i.endless)?void 0:s.bosses)?void 0:l[a]}resetBoss(){if(this.bossCount++,this.bossCount%10==0){this.isStageBoss=!0,this.stageBossTimer=0,this.stageBossPhase="arriving";const t=s/2;this.stageBossInitialY=t;const e=this.stageBosses[this.stageBossIndex];this.stageBossIndex=(this.stageBossIndex+1)%this.stageBosses.length,this.currentBoss={...e,x:i+200,y:t,speed:3,visible:!0,health:200,maxHealth:200,shield:100,maxShield:100,hasShield:!0,size:30,initialSize:30,targetSize:90};const l="serpent"===e.id?"stageSerpent":"stageDragon";this.showBossComment(l,"appearance")}else{this.isStageBoss=!1;const t=this.bossDefinitions[this.currentBossIndex],e=[150,250,350],s=e[Math.floor(Math.random()*e.length)];this.currentBoss={...t,x:i+100,y:s,speed:.5+.05*this.waveLevel,visible:!0,health:4,maxHealth:4},this.showBossComment(this.currentBoss.id,"appearance")}}update(){if(this.gameOverAnimation)return void this.updateGameOverAnimation();if(!this.active)return;this.bossCommentTimer>0&&(this.bossCommentTimer--,0===this.bossCommentTimer&&(this.bossComment=null)),this.onomatopoeiaTimer>0&&(this.onomatopoeiaTimer--,0===this.onomatopoeiaTimer&&(this.onomatopoeia=null)),this.visualBoss.update(),"dragon"===this.currentBoss.id?this.dragonBoss.update(this.game.gameTime,this.currentBoss):"serpent"===this.currentBoss.id?this.serpentBoss.update(this.game.gameTime,this.currentBoss):"whale"===this.currentBoss.id?this.whaleBoss.update(this.game.gameTime,this.currentBoss):"robot"===this.currentBoss.id?this.robotBoss.update(this.game.gameTime,this.currentBoss):"ufo"===this.currentBoss.id?this.ufoBoss.update(this.game.gameTime,this.currentBoss):"pacman"===this.currentBoss.id?this.krakenBoss.update(this.game.gameTime,this.currentBoss):"shark"===this.currentBoss.id&&this.sharkBoss.update(this.game.gameTime,this.currentBoss),this.distance,this.distance+=.1*this.game.gameSpeed;const t=this.distance-this.previousDistance;if(t>=1){const e=Math.floor(t*h.POINTS_PER_METER);this.game.score+=e,this.previousDistance=Math.floor(this.distance)}if(this.isStageBoss)switch(this.stageBossTimer++,this.stageBossPhase,this.stageBossPhase){case"arriving":this.currentBoss.x-=this.currentBoss.speed,this.currentBoss.x<=i-150&&(this.currentBoss.x=i-150,this.stageBossPhase="coiling",this.stageBossTimer=0,this.serpentBoss.segments=[]);break;case"coiling":const t=Math.min(this.stageBossTimer/180,1);this.currentBoss.size=this.currentBoss.initialSize+(this.currentBoss.targetSize-this.currentBoss.initialSize)*t,this.stageBossTimer>=180&&(this.currentBoss.size=this.currentBoss.targetSize,this.stageBossPhase="advancing",this.stageBossTimer=0,this.currentBoss.speed=1,this.serpentBoss.segments=[]);break;case"advancing":this.currentBoss.x-=this.currentBoss.speed;const e=40,s=.03;this.currentBoss.y=this.stageBossInitialY+Math.sin(this.stageBossTimer*s)*e}else this.currentBoss.x-=this.currentBoss.speed;const e=this.currentBoss.size/2,s=this.currentBoss.x-(this.game.player.x+this.game.player.width/2),l=this.currentBoss.y-(this.game.player.y+this.game.player.height/2),a=e+20;if(s*s+l*l<a*a){this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playBossHitSound(),navigator.vibrate&&(this.isStageBoss?navigator.vibrate([100,50,100,50,100]):navigator.vibrate(100));let t=!0;if(this.isStageBoss)for(let e=0;e<3&&(t=this.game.player.loseLife(),t);e++);else t=this.game.player.loseLife();t||this.game.gameOver(),this.game.player.velX=-5,this.game.player.velY=-3}if(this.isStageBoss&&this.currentBoss.health<=0||this.currentBoss.x<-this.currentBoss.size){if(this.isStageBoss&&this.currentBoss.health<=0){this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPameSound(),navigator.vibrate&&navigator.vibrate([200,100,200,100,200,100,300]);for(let t=0;t<20;t++){const e=2*Math.PI*t/20;this.obstacles.push({x:this.currentBoss.x,y:this.currentBoss.y,velX:5*Math.cos(e),velY:5*Math.sin(e),emoji:this.currentBoss.obstacleEmoji})}}this.isStageBoss||(this.currentBossIndex=(this.currentBossIndex+1)%this.bossDefinitions.length),this.dragonBoss.segments=[],this.serpentBoss.segments=[],this.resetBoss(),this.currentPattern="top"===this.currentPattern?"bottom":"top",this.waveLevel++}if(this.spawnTimer++,this.spawnTimer>300&&this.obstacles.length<10){this.spawnTimer=0;const t={x:this.currentBoss.x,y:"top"===this.currentPattern?100:400,width:60,height:80,speed:.5,emoji:this.currentBoss.obstacleEmoji,pattern:this.currentPattern};this.obstacles.push(t)}if(this.fuelTimer++,this.fuelTimer>360&&this.fuels.length<3){this.fuelTimer=0;const t={x:i+50,y:250,size:40,speed:.8,emoji:this.currentBoss.fuelEmoji};this.fuels.push(t)}for(let i=this.obstacles.length-1;i>=0;i--){const t=this.obstacles[i];t.x-=t.speed;const e=t.x-this.game.player.x,s=t.y-this.game.player.y;if(e*e+s*s<1600){const t=this.game.player.loseLife();this.obstacles.splice(i,1),t||this.game.gameOver()}else if(t.x<-t.width){this.obstacles.splice(i,1),this.game.obstaclesCleared++;const t=Math.floor(h.POINTS_PER_OBSTACLE*this.multiplier);this.game.score+=t}}for(let o=this.fuels.length-1;o>=0;o--){const t=this.fuels[o];t.x-=t.speed;const e=t.x-this.game.player.x,s=t.y-this.game.player.y;if(e*e+s*s<1600){this.game.audioManager&&this.game.audioManager.initialized?(this.game.audioManager.playPingSound(),console.log("üîä Son ping jou√© !")):console.log("‚ùå AudioManager non disponible:",this.game.audioManager?"non initialis√©":"absent"),this.game.player.fuel=Math.min(this.game.player.maxFuel,this.game.player.fuel+30);const e={"üêü":0,"üçí":1,"üíé":2,"üåü":3,"üê†":4,"üîã":5}[t.emoji];if(void 0!==e&&this.game.laserSystem){this.game.laserSystem.currentWeaponIndex=e;const s=this.game.laserSystem.getCurrentWeapon().name;this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playWeaponSound(),this.game.renderer.addParticle(i/2,100,`‚öîÔ∏è ${s} ‚öîÔ∏è`,"#FFD700"),console.log(`‚öîÔ∏è Arme chang√©e: ${s} (${t.emoji})`)}const s=50;this.game.score+=s,this.fuels.splice(o,1)}else t.x<-t.size&&this.fuels.splice(o,1)}}render(t){const e=this.game.renderer&&"voxel"===this.game.renderer.renderMode,l=e?this.game.renderer.voxelRenderer:null;if(this.gameOverAnimation&&0===this.explosionPhase)return t.save(),t.font="120px Arial",t.textAlign="center",t.textBaseline="middle",t.shadowColor="#FF6600",t.shadowBlur=40,t.fillText("üî•",i/2,this.rocketY+60),t.shadowColor="#FFD700",t.shadowBlur=50,t.fillText("üöÄ",i/2,this.rocketY),void t.restore();if(this.gameOverAnimation&&1===this.explosionPhase){const e=Math.max(0,1-this.explosionTimer/80);return t.fillStyle=`rgba(255, 255, 255, ${e})`,void t.fillRect(0,0,i,s)}if(t.save(),this.currentBoss.health>0){let e=this.currentBoss.x,i=this.currentBoss.y;if("dragon"===this.currentBoss.id){const t=this.dragonBoss.getHeadPosition();t&&(e=t.x,i=t.y)}else if("serpent"===this.currentBoss.id){const t=this.serpentBoss.getHeadPosition();t&&(e=t.x,i=t.y)}const s=80,l=10,a=e-s/2,o=i-this.currentBoss.size/2-20;t.fillStyle="#FF0000",t.fillRect(a,o,s,l);const n=this.currentBoss.health/this.currentBoss.maxHealth;t.fillStyle="#00FF00",t.fillRect(a,o,s*n,l),t.strokeStyle="#000000",t.lineWidth=2,t.strokeRect(a,o,s,l),t.fillStyle="#FFFFFF",t.font="10px Arial",t.textAlign="center",t.fillText(`${this.currentBoss.health}/${this.currentBoss.maxHealth}`,e,o+l/2)}if(e&&l){const e=this.isStageBoss?2*this.currentBoss.size:1.5*this.currentBoss.size,i=Math.max(100,e),s=Date.now()/1e3,a=1+.1*Math.sin(3*s),o=5*Math.sin(2*s),n=this.isStageBoss?2*Math.sin(10*s):0;if(t.save(),t.shadowColor=this.currentBoss.color,t.shadowBlur=30+15*Math.sin(4*s),this.isStageBoss){for(let e=0;e<8;e++){const l=2*s+e*Math.PI*2/8,a=.7*i,n=this.currentBoss.x+Math.cos(l)*a,r=this.currentBoss.y+Math.sin(l)*a+o;t.fillStyle=this.currentBoss.color,t.globalAlpha=.6+.3*Math.sin(5*s+e),t.beginPath(),t.arc(n,r,4,0,2*Math.PI),t.fill()}t.globalAlpha=1}t.translate(this.currentBoss.x+n,this.currentBoss.y+o),t.scale(-1,1);const r=i*a;l.drawCachedIcon(t,this.currentBoss.emoji,-r/2,-r/2,r,r),this.currentBoss.health<.3*this.currentBoss.maxHealth&&(t.strokeStyle="#FF0000",t.lineWidth=3,t.globalAlpha=.5+.3*Math.sin(8*s),t.strokeRect(this.currentBoss.x-r/2,this.currentBoss.y-r/2,r,r),t.globalAlpha=1),t.restore()}else if("dragon"===this.currentBoss.id){let e="traverse";this.isStageBoss&&"coiling"===this.stageBossPhase&&(e="boss"),this.dragonBoss.render(t,this.currentBoss,e)}else if("serpent"===this.currentBoss.id){let e="traverse";this.isStageBoss&&"coiling"===this.stageBossPhase&&(e="boss"),this.serpentBoss.render(t,this.currentBoss,e)}else"whale"===this.currentBoss.id?this.whaleBoss.render(t,this.currentBoss):"robot"===this.currentBoss.id?this.robotBoss.render(t,this.currentBoss):"ufo"===this.currentBoss.id?this.ufoBoss.render(t,this.currentBoss):"pacman"===this.currentBoss.id?this.krakenBoss.render(t,this.currentBoss):"shark"===this.currentBoss.id?this.sharkBoss.render(t,this.currentBoss):this.visualBoss.render(t,this.currentBoss);t.shadowBlur=0,t.fillStyle=this.currentBoss.color,t.font="bold 16px Arial",t.textAlign="center";const a=this.getTranslatedBossText(this.currentBoss.id,this.isStageBoss)||this.currentBoss.text;if(t.fillText(a,this.currentBoss.x,this.currentBoss.y+this.currentBoss.size/2+15),this.isStageBoss&&this.currentBoss.hasShield&&this.currentBoss.shield>0){const e=this.currentBoss.size/2+15,i=.3+this.currentBoss.shield/this.currentBoss.maxShield*.4,s=5*Math.sin(Date.now()/200);t.save(),t.globalAlpha=i;const l=t.createRadialGradient(this.currentBoss.x,this.currentBoss.y,e-10,this.currentBoss.x,this.currentBoss.y,e+s);l.addColorStop(0,"rgba(0, 191, 255, 0)"),l.addColorStop(.7,"rgba(0, 191, 255, 0.6)"),l.addColorStop(1,"rgba(135, 206, 250, 0.9)"),t.fillStyle=l,t.beginPath(),t.arc(this.currentBoss.x,this.currentBoss.y,e+s,0,2*Math.PI),t.fill(),t.strokeStyle="#00BFFF",t.lineWidth=3,t.shadowColor="#00BFFF",t.shadowBlur=15,t.stroke();for(let c=0;c<6;c++){const i=2*Math.PI/6*c+Date.now()/1e3,s=this.currentBoss.x+Math.cos(i)*e,l=this.currentBoss.y+Math.sin(i)*e;t.fillStyle="rgba(0, 191, 255, 0.8)",t.beginPath();for(let e=0;e<6;e++){const i=2*Math.PI/6*e,a=s+8*Math.cos(i),o=l+8*Math.sin(i);0===e?t.moveTo(a,o):t.lineTo(a,o)}t.closePath(),t.fill()}t.restore();const a=80,o=8,n=this.currentBoss.x-a/2,r=this.currentBoss.y-this.currentBoss.size/2-30,h=this.currentBoss.shield/this.currentBoss.maxShield;t.fillStyle="rgba(0, 0, 0, 0.6)",t.fillRect(n,r,a,o),t.fillStyle="#00BFFF",t.fillRect(n,r,a*h,o),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.strokeRect(n,r,a,o),t.font="16px Arial",t.fillText("üõ°Ô∏è",n-15,r+4)}t.restore();for(const i of this.obstacles)if(e&&l){const e=45,s=Date.now()/1e3,a=this.obstacles.indexOf(i);t.save();const o=3*Math.sin(3*s+a);t.shadowColor=this.currentBoss.color,t.shadowBlur=15+10*Math.sin(4*s+a),t.globalAlpha=.3;for(let n=1;n<=2;n++)l.drawCachedIcon(t,i.emoji,i.x-e/2+8*n,i.y-e/2+o,.8*e,.8*e);t.globalAlpha=1,t.shadowBlur=20+10*Math.sin(4*s+a),l.drawCachedIcon(t,i.emoji,i.x-e/2,i.y-e/2+o,e,e),t.restore()}else t.save(),t.font="60px Arial",t.textAlign="center",t.textBaseline="middle",t.shadowColor=this.currentBoss.color,t.shadowBlur=15,t.fillText(i.emoji,i.x,i.y),t.restore();for(const i of this.fuels)if(e&&l){const e=35,s=Date.now()/1e3,a=this.fuels.indexOf(i);t.save();const o=8*Math.abs(Math.sin(4*s+a)),n=1+.15*Math.sin(5*s+a);for(let l=0;l<4;l++){const e=3*s+a+l*Math.PI/2,n=20+5*Math.sin(6*s+l),r=i.x+Math.cos(e)*n,h=i.y+Math.sin(e)*n-o;t.fillStyle="#FFD700",t.globalAlpha=.6+.4*Math.sin(8*s+l),t.beginPath(),t.arc(r,h,2,0,2*Math.PI),t.fill(),t.fillRect(r-1,h-3,2,6),t.fillRect(r-3,h-1,6,2)}t.shadowColor="#FFD700",t.shadowBlur=25+15*Math.sin(6*s+a),t.globalAlpha=.3;const r=15+(8*s+a)%1*20;t.strokeStyle="#FFD700",t.lineWidth=2,t.beginPath(),t.arc(i.x,i.y-o,r,0,2*Math.PI),t.stroke(),t.globalAlpha=1;const h=e*n;l.drawCachedIcon(t,i.emoji,i.x-h/2,i.y-h/2-o,h,h),t.restore()}else t.save(),t.font="40px Arial",t.textAlign="center",t.textBaseline="middle",t.shadowColor="#FFD700",t.shadowBlur=20,t.fillText(i.emoji,i.x,i.y),t.restore()}showGameOver(){this.game.score>this.highScore?(this.highScore=this.game.score,this.saveHighScore(this.game.score),console.log("üíæ Nouveau record Infini sauvegard√©:",this.game.score)):console.log("üìä Score Infini:",this.game.score,"| Record:",this.highScore),this.gameOverAnimation=!0,this.rocketY=s,this.explosionPhase=0,this.active=!1}updateGameOverAnimation(){if(!this.gameOverAnimation)return!1;if(0===this.explosionPhase)this.rocketY-=15,Math.random()>.5&&this.game.renderer.addParticle(i/2+30*(Math.random()-.5),this.rocketY+40,"üí®","#AAAAAA"),this.rocketY<-50&&(this.explosionPhase=1,this.explosionTimer=0);else if(1===this.explosionPhase){if(this.explosionTimer++,this.explosionTimer<60)for(let t=0;t<3;t++)this.game.renderer.addParticle(Math.random()*i,Math.random()*s,["üí•","üî•","üí£","‚ö°"][Math.floor(4*Math.random())],["#FF0000","#FF6600","#FFAA00","#FF00FF"][Math.floor(4*Math.random())]);this.explosionTimer>80&&(this.explosionPhase=2,this.showSimpleGameOver())}return!0}showSimpleGameOver(){var t;const e=this.game.score>this.highScore,i=(null==(t=this.game.i18n)?void 0:t.t.bind(this.game.i18n))||(t=>t),s=document.createElement("div");s.innerHTML=`\n            <div style="position:fixed;top:0;left:0;width:100%;height:100%;\n                        background:rgba(0,0,0,0.95);display:flex;align-items:center;\n                        justify-content:center;z-index:9999">\n                <div style="text-align:center">\n                    <h1 style="color:#FF0000;font-size:80px;margin:0;\n                               text-shadow:0 0 30px #FF0000, 0 0 60px #FF0000;\n                               animation:pulse 2s ease-in-out infinite">\n                        ${i("endless.gameOver.title")}\n                    </h1>\n                    <div style="font-size:50px;margin:25px 0">${i("endless.gameOver.skull")}</div>\n                    <p style="color:#FFD700;font-size:32px;margin:15px 0">\n                        ${i("endless.gameOver.score")}: ${this.game.score.toLocaleString()}\n                    </p>\n                    ${e?`<p style="color:#FFD700;font-size:26px;margin:10px 0">${i("endless.gameOver.newRecord")}</p>`:`<p style="color:#999;font-size:22px;margin:10px 0">${i("endless.gameOver.record")}: ${this.highScore.toLocaleString()}</p>`}\n                    <br>\n                    <button id="endless-replay-btn"\n                            style="background:#FF0000;color:white;border:none;\n                                   padding:15px 40px;border-radius:10px;font-size:20px;\n                                   font-weight:bold;cursor:pointer;\n                                   box-shadow:0 5px 20px rgba(255,0,0,0.5);\n                                   transition:transform 0.2s"\n                            onmouseover="this.style.transform='scale(1.1)'"\n                            onmouseout="this.style.transform='scale(1)'">\n                        ${i("endless.gameOver.replay")}\n                    </button>\n                </div>\n            </div>\n            <style>\n                @keyframes pulse {\n                    0%, 100% { transform: scale(1); }\n                    50% { transform: scale(1.1); }\n                }\n            </style>\n        `,document.body.appendChild(s),document.getElementById("endless-replay-btn").addEventListener("click",()=>{document.querySelectorAll('[style*="position: fixed"], [style*="position:fixed"]').forEach(t=>t.style.display="none"),setTimeout(()=>{location.reload()},50)})}loadHighScore(){const t=localStorage.getItem("xsheep_maxScore");return t?parseInt(t):0}saveHighScore(t){localStorage.setItem("xsheep_maxScore",t.toString())}showBossComment(t,e="appearance"){this.bossComment=function(t,e="appearance"){const i=p.translations;if(!i||!i.endless||!i.endless.bossComments)return"...";const s=i.endless.bossComments[t];if(!s||!s[e]||!Array.isArray(s[e]))return"...";const l=s[e];return l[Math.floor(Math.random()*l.length)]}(t,e),this.bossCommentTimer=this.bossCommentDuration,"appearance"===e&&Math.random()>.5&&(this.onomatopoeia=function(t){const e=p.translations;if(!e||!e.endless||!e.endless.bossComments)return"BOOM!";const i=e.endless.bossComments[t];if(!i||!i.onomatopoeia||!Array.isArray(i.onomatopoeia))return"BOOM!";const s=i.onomatopoeia;return s[Math.floor(Math.random()*s.length)]}(t),this.onomatopoeiaTimer=60)}renderBossComment(t){if(!this.bossComment)return;const e=this.game.player.x,i=this.game.player.y;t.font="bold 18px Arial";const s=t.measureText(this.bossComment).width+30,l=45,a=e-s/2,o=i-80;t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.roundRect(a+3,o+3,s,l,10),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.95)",t.strokeStyle="#333333",t.lineWidth=3,t.beginPath(),t.roundRect(a,o,s,l,10),t.fill(),t.stroke(),t.beginPath(),t.moveTo(e-10,i-80+l),t.lineTo(e+10,i-80+l),t.lineTo(e,i-60+l),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.fillText(this.bossComment,e,o+22.5)}renderOnomatopoeia(t){if(!this.onomatopoeia)return;const e=1-this.onomatopoeiaTimer/60,i=1-e,s=1+2*e;t.save(),t.globalAlpha=i,t.font=`bold ${40*s}px Arial`,t.fillStyle="#ff4400",t.strokeStyle="#ffffff",t.lineWidth=4,t.textAlign="center",t.textBaseline="middle";const l=this.game.canvas.width/2,a=100+50*e;t.strokeText(this.onomatopoeia,l,a),t.fillText(this.onomatopoeia,l,a),t.restore()}}class tt{constructor(t){this.game=t,this.visible=!1,this.x=i-c.POSITION_X_OFFSET,this.y=(s-c.HEIGHT)/2,this.width=c.WIDTH,this.height=c.HEIGHT,this.triggered=!1,this.victoryScreenActive=!1,this.continueButton=null,this.shrinkAnimation=!1,this.shrinkTimer=0,this.handleClick=this.handleClick.bind(this)}update(){if(this.shrinkAnimation)return this.shrinkTimer++,this.game.player.size>.5&&(this.game.player.size-=.05,this.game.player.x+=2),this.shrinkTimer%2==0&&this.game.renderer.addParticle(this.game.player.x,this.game.player.y,["‚ú®","üåü","üëº","üïäÔ∏è","üíñ"][Math.floor(5*Math.random())],"#FFD700"),void(this.shrinkTimer>90&&(this.shrinkAnimation=!1,this.showVictoryScreen()));this.game.obstaclesCleared>=30&&!this.visible&&(this.visible=!0,console.log("üö™ La Porte du Paradis appara√Æt !"),this.game.notificationSystem&&this.game.notificationSystem.showNarrative({text:p.t("game.messages.watchYourLife"),duration:3e3})),this.visible&&!this.triggered&&this.checkVictory()}checkVictory(){const t=this.game.player;if(t.x>=this.x-50){this.triggered=!0;t.size*t.width<=this.width?this.victoryShrink():this.gameOverRich()}}victoryShrink(){console.log("‚ú® VICTOIRE ! Le mouton entre au Paradis !"),this.shrinkAnimation=!0,this.shrinkTimer=0}gameOverRich(){console.log("üí• BONK ! Trop riche pour le Paradis !"),this.game.paused=!0,this.game.renderer.addParticle(this.game.player.x,this.game.player.y,"üí• BONK!","#FF0000");let t=0;const e=setInterval(()=>{this.game.player.x-=5,this.game.player.y+=10*Math.sin(.5*t),this.game.renderer.addParticle(this.game.player.x+30*Math.cos(.2*t),this.game.player.y-20+30*Math.sin(.2*t),"‚≠ê","#FFD700"),t++,t>20&&(clearInterval(e),this.showGameOverRich())},50)}showVictoryScreen(){var t;(null==(t=this.game.obstacleManager)?void 0:t.trophySystem)&&(this.game.obstacleManager.trophySystem.unlockTrophy("impatient"),console.log("‚è∞üíî Troph√©e Horloge bris√©e d√©bloqu√© (victoire impatiente)!")),this.victoryScreenActive=!0,this.game.paused=!0;const e=this.game.canvas;this.continueButton={x:e.width/2-100,y:e.height/2+180,width:200,height:40,text:"‚è∞ Victoire rapide !"},e.addEventListener("click",this.handleClick)}handleClick(t){if(!this.victoryScreenActive||!this.continueButton)return;const e=this.game.canvas,i=e.getBoundingClientRect(),s=e.width/i.width,l=e.height/i.height,a=(t.clientX-i.left)*s,o=(t.clientY-i.top)*l;if(a>=this.continueButton.x&&a<=this.continueButton.x+this.continueButton.width&&o>=this.continueButton.y&&o<=this.continueButton.y+this.continueButton.height){this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playTokeSound();document.querySelectorAll('[style*="position: fixed"], [style*="position:fixed"]').forEach(t=>t.style.display="none"),e.removeEventListener("click",this.handleClick),setTimeout(()=>{location.reload()},50)}}renderVictoryScreen(t){if(!this.victoryScreenActive)return;const e=this.game.canvas;t.fillStyle="rgba(0, 0, 0, 0.92)",t.fillRect(0,0,e.width,e.height);const i=550,s=(e.width-i)/2,l=(e.height-450)/2-10;t.fillStyle="rgba(255, 255, 255, 0.98)",t.strokeStyle="#FFD700",t.lineWidth=4,t.fillRect(s,l,i,450),t.strokeRect(s,l,i,450),t.fillStyle="#FFD700",t.font="bold 22px Arial",t.textAlign="center",t.fillText("‚è∞üíî IMPATIENCE ! ‚è∞üíî",e.width/2,l+32),t.font="36px Arial",t.fillText("üêë‚ú®‚è∞",e.width/2,l+75),t.fillStyle="#FF8C00",t.font="bold 16px Arial",t.fillText(p.t("game.ui.brokenClock"),e.width/2,l+105),t.textAlign="left",t.fillStyle="#333",t.font="12px Arial";let a=l+135;const o=s+60,n=430;t.font="bold 12px Arial",t.fillText("‚è∞ Le Temps :",o,a),t.font="12px Arial",this.wrapText(t,'"Trop press√© d\'arriver, tu as voulu tout rapidement !"',o,a+16,n,15),a+=45,t.font="bold 12px Arial",t.fillText("üêë Le Mouton :",o,a),t.font="12px Arial",this.wrapText(t,"\"Je n'avais pas le temps d'attendre... La porte √©tait l√† !\"",o,a+16,n,15),a+=45,t.font="bold 12px Arial",t.fillText("üëº Un Ange :",o,a),t.font="12px Arial",this.wrapText(t,'"Quand on veut tout rapidement, on rate l\'essentiel du moment pr√©sent. Prends le temps et profite de chaque instant."',o,a+16,n,15),a+=65,t.font="bold 12px Arial",t.fillText("‚úùÔ∏è Le√ßon :",o,a),t.font="12px Arial",this.wrapText(t,'"Le temps est un alli√©, pas un ennemi. As-tu vraiment v√©cu le voyage ?"',o,a+16,n,15),a+=55,t.textAlign="center",t.font="bold 14px Arial",t.fillStyle="#333",t.fillText(`${p.t("game.ui.score")} : ${this.game.score.toLocaleString("fr-FR")} ${p.t("game.ui.souls")} üíñ`,e.width/2,a),t.font="bold 13px Arial",t.fillStyle="#FF8C00",t.fillText("üèÜ Horloge bris√©e - Ma√Ætre du temps",e.width/2,a+22),t.font="italic 11px Arial",t.fillStyle="#888",t.fillText("- Emmanuel Payet",e.width/2,a+40);const r=this.continueButton,h=t.createLinearGradient(r.x,r.y,r.x+r.width,r.y);h.addColorStop(0,"#FF8C00"),h.addColorStop(1,"#FFA500"),t.fillStyle=h,t.fillRect(r.x,r.y,r.width,r.height),t.strokeStyle="#FFA500",t.lineWidth=2,t.strokeRect(r.x,r.y,r.width,r.height),t.fillStyle="#FFF",t.font="bold 14px Arial",t.textAlign="center",t.fillText(r.text,r.x+r.width/2,r.y+r.height/2+5)}wrapText(t,e,i,s,l,a){const o=e.split(" ");let n="",r=s;for(let h=0;h<o.length;h++){const e=n+o[h]+" ";t.measureText(e).width>l&&h>0?(t.fillText(n,i,r),n=o[h]+" ",r+=a):n=e}t.fillText(n,i,r)}showGameOverRich(){const t=document.createElement("div");t.innerHTML=`\n            <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);\n                        background:rgba(255,255,255,0.98);padding:20px 30px;border-radius:15px;\n                        text-align:center;z-index:9999;border:3px solid #FF0000;\n                        box-shadow:0 10px 40px rgba(0,0,0,0.5);max-width:700px;max-height:90vh;overflow-y:auto">\n                <h2 style="color:#FF0000;font-size:26px;margin:10px 0">üí• GAME OVER - TROP LOURD ! üí•</h2>\n                <div style="font-size:50px;margin:15px 0">üêëüí∞üòµ</div>\n                <p style="font-size:18px;color:#DC143C;margin:10px 0">*BONK!* Tu t'es cogn√© sur la porte !</p>\n                <div style="text-align:left;max-width:500px;margin:15px auto;font-size:14px;line-height:1.4">\n                    <p style="margin:8px 0"><strong>üö™ La Porte :</strong><br>\n                    "D√©sol√©, tu es trop gros avec tous ces sacs d'or !"</p>\n                    \n                    <p style="margin:8px 0"><strong>üêë Le Mouton (avec m√®che) :</strong><br>\n                    "Mais... mais... j'ai tant de richesses !"</p>\n                    \n                    <p style="margin:8px 0"><strong>üëº Un Ange :</strong><br>\n                    "Tu ne peux pas emporter tes richesses au Paradis. L√¢che prise et recommence !"</p>\n                    \n                    <p style="margin:8px 0"><strong>‚úùÔ∏è Le√ßon :</strong><br>\n                    "La cupidit√© t'a alourdi. Le Paradis n'est pas pour ceux qui accumulent, \n                    mais pour ceux qui donnent. Essaie encore, mais voyage L√âGER !"</p>\n                </div>\n                <p style="margin:8px 0;font-size:15px"><strong>Or collect√© : ${this.game.player.goldCollected} üí∞ (Trop !)</strong></p>\n                <p style="margin:8px 0;font-size:15px"><strong>Taille : ${(100*this.game.player.size).toFixed(0)}% (Trop gros !)</strong></p>\n                <p style="font-style:italic;color:#888;font-size:13px;margin:8px 0">- Emmanuel Payet</p>\n                <button id="heaven-retry-btn" style="background:linear-gradient(45deg,#FFD700,#FFA500);\n                        border:none;padding:12px 30px;border-radius:20px;font-size:16px;\n                        font-weight:bold;cursor:pointer;margin-top:10px">üîÑ Recommencer Plus Humble</button>\n            </div>\n        `,document.body.appendChild(t),document.getElementById("heaven-retry-btn").addEventListener("click",()=>{this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playTokeSound(),document.querySelectorAll("[style*='position: fixed']").forEach(t=>t.style.display="none"),setTimeout(()=>location.reload(),50)})}render(t){if(!this.visible||this.victoryScreenActive)return;const e=t.createRadialGradient(this.x+this.width/2,this.y+this.height/2,10,this.x+this.width/2,this.y+this.height/2,100);e.addColorStop(0,"rgba(255, 255, 255, 0.8)"),e.addColorStop(1,"rgba(255, 215, 0, 0)"),t.fillStyle=e,t.fillRect(this.x-50,this.y-50,this.width+100,this.height+100),t.fillStyle="#FFD700",t.strokeStyle="#FFA500",t.lineWidth=4,t.fillRect(this.x,this.y,this.width,this.height),t.strokeRect(this.x,this.y,this.width,this.height),t.strokeStyle="#FFF",t.lineWidth=5,t.beginPath(),t.moveTo(this.x+this.width/2,this.y+20),t.lineTo(this.x+this.width/2,this.y+60),t.moveTo(this.x+15,this.y+35),t.lineTo(this.x+this.width-15,this.y+35),t.stroke(),t.fillStyle="#FFF",t.font="bold 12px Arial",t.textAlign="center",t.fillText("‚òÅÔ∏è",this.x+this.width/2,this.y-10),t.font="bold 10px Arial",t.fillText(p.t("game.ui.paradise"),this.x+this.width/2,this.y+this.height+20);const i=.001*Date.now();for(let s=0;s<8;s++){const e=s*Math.PI/4+i,l=this.x+this.width/2,a=this.y+this.height/2,o=l+80*Math.cos(e),n=a+80*Math.sin(e);t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2,t.beginPath(),t.moveTo(l,a),t.lineTo(o,n),t.stroke()}}}class et{constructor(t){this.game=t,this.tanks=[],this.spawnTimer=0,this.spawnInterval=900}update(){this.spawnTimer++,this.spawnTimer>=this.spawnInterval&&(this.spawnTank(),this.spawnTimer=0);for(let t=this.tanks.length-1;t>=0;t--){const e=this.tanks[t];e.x-=this.game.gameSpeed,e.bobOffset=5*Math.sin(.003*Date.now()+e.id),this.checkCollision(e)?(this.game.player.refillFuel(60),this.tanks.splice(t,1),this.game.score+=100,this.game.renderer.addParticle(e.x,e.y,"üíß","#00BFFF")):e.x+e.width<0&&this.tanks.splice(t,1)}}spawnTank(){const t=this.game.canvas.height-80;this.tanks.push({id:Math.random(),x:this.game.canvas.width+50,y:t-100,width:30,height:40,bobOffset:0})}checkCollision(t){const e=this.game.player.getHitbox();return y.checkCollision(e,{x:t.x,y:t.y+t.bobOffset,width:t.width,height:t.height})}render(t){this.tanks.forEach(e=>{var i,s;const l=e.y+e.bobOffset;if(t.save(),"voxel"===(null==(i=this.game.renderer)?void 0:i.renderMode)&&(null==(s=this.game.renderer)?void 0:s.voxelRenderer))return this.game.renderer.voxelRenderer.drawVoxelWaterTank(e.x,l,e.width,e.height),void t.restore();t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(e.x+e.width/2,l+e.height+5,e.width/2,8,0,0,2*Math.PI),t.fill();const a=t.createLinearGradient(e.x,l,e.x+e.width,l);a.addColorStop(0,"#00BFFF"),a.addColorStop(.5,"#87CEEB"),a.addColorStop(1,"#00BFFF"),t.fillStyle=a,t.fillRect(e.x,l+5,e.width,e.height-10),t.beginPath(),t.ellipse(e.x+e.width/2,l+5,e.width/2,5,0,0,2*Math.PI),t.fill(),t.beginPath(),t.ellipse(e.x+e.width/2,l+e.height-5,e.width/2,5,0,0,2*Math.PI),t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.strokeRect(e.x,l+5,e.width,e.height-10),t.beginPath(),t.ellipse(e.x+e.width/2,l+5,e.width/2,5,0,0,2*Math.PI),t.stroke(),t.beginPath(),t.ellipse(e.x+e.width/2,l+e.height-5,e.width/2,5,0,0,2*Math.PI),t.stroke(),t.fillStyle="#FFFFFF",t.strokeStyle="#0080FF",t.lineWidth=2,t.beginPath(),t.moveTo(e.x+e.width/2,l+e.height/2-8),t.quadraticCurveTo(e.x+e.width/2+5,l+e.height/2-3,e.x+e.width/2+5,l+e.height/2+3),t.arc(e.x+e.width/2,l+e.height/2+3,5,0,Math.PI),t.quadraticCurveTo(e.x+e.width/2-5,l+e.height/2-3,e.x+e.width/2,l+e.height/2-8),t.closePath(),t.fill(),t.stroke(),t.fillStyle="rgba(255,255,255,0.6)",t.strokeStyle="#FFF",t.lineWidth=1,t.beginPath(),t.arc(e.x+10,l+12,4,0,2*Math.PI),t.fill(),t.stroke();const o=.005*Date.now();for(let n=0;n<3;n++){const i=n*Math.PI*2/3+o,s=e.x+e.width/2+25*Math.cos(i),a=l+e.height/2+20*Math.sin(i);t.fillStyle="rgba(0,191,255,0.7)",t.strokeStyle="#FFF",t.lineWidth=1,t.beginPath(),t.arc(s,a,3,0,2*Math.PI),t.fill(),t.stroke()}t.restore()})}getAll(){return this.tanks}}class it{constructor(t){this.game=t,this.lasers=[],this.fireRate=60,this.lastFireTime=0,this.maxLasers=15,this.bossHitCounter=0,this.weaponTypes=[{id:"laser",name:"LASER",emoji:"‚ö°",color:"#00FF00",glowColor:"#88FF88",count:1,spread:0,speed:12,size:{width:40,height:4},damage:1},{id:"triple",name:"TRIPLE",emoji:"‚ö°‚ö°‚ö°",color:"#00FFFF",glowColor:"#88FFFF",count:3,spread:20,speed:12,size:{width:35,height:4},damage:1},{id:"mega",name:"MEGA",emoji:"üí•",color:"#FF6600",glowColor:"#FFAA66",count:1,spread:0,speed:10,size:{width:60,height:10},damage:3},{id:"bombe",name:"BOMBE",emoji:"üí£",color:"#FF0000",glowColor:"#FF6666",count:1,spread:0,speed:8,size:{width:20,height:20},damage:5,explosive:!0},{id:"multiple",name:"MULTIPLE",emoji:"‚ú®",color:"#FFFF00",glowColor:"#FFFF88",count:5,spread:15,speed:11,size:{width:25,height:3},damage:1},{id:"wave",name:"WAVE",emoji:"„Ä∞Ô∏è",color:"#FF00FF",glowColor:"#FF88FF",count:1,spread:0,speed:10,size:{width:50,height:6},damage:2,wave:!0}],this.currentWeaponIndex=0,this.weaponSwitchTimer=0,this.weaponSwitchInterval=300,this.megaPistolActive=!1,this.megaPistolTimer=0,this.megaPistolDuration=180,this.specialBombs=[]}getCurrentWeapon(){return this.weaponTypes[this.currentWeaponIndex]}fireSpecialBomb(){const t=this.game.player,e=this.getCurrentWeapon(),s={x:t.x+t.width,y:t.y+t.height/2,width:50,height:50,speed:6,color:e.color,glowColor:e.glowColor,weaponType:e.id,weaponName:e.name,lifetime:180,age:0,damage:5*e.damage,rotation:0,scale:1};this.specialBombs.push(s),this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playBombSound(),this.game.renderer.addParticle(i/2,100,`üí£ ${e.name} BOMB üí£`,e.color),console.log(`üí£ Bombe sp√©ciale ${e.name} lanc√©e! D√©g√¢ts: ${s.damage}`)}fire(){const t=this.game.frameCount||0;if(t-this.lastFireTime<this.fireRate)return;if(this.lasers.length>=this.maxLasers)return;const e=this.game.player;let i=this.getCurrentWeapon();this.megaPistolActive&&(i={id:"mega_pistol",name:"MEGA PISTOL",emoji:"üî´üí•",color:"#FF00FF",glowColor:"#FF88FF",count:3,spread:30,speed:15,size:{width:80,height:12},damage:10});for(let s=0;s<i.count;s++){const t=i.spread*(s-(i.count-1)/2),l={x:e.x+e.width,y:e.y+e.height/2+t,width:i.size.width,height:i.size.height,speed:i.speed,color:i.color,glowColor:i.glowColor,lifetime:120,age:0,damage:i.damage,explosive:i.explosive||!1,wave:i.wave||!1,wavePhase:Math.random()*Math.PI*2,spreadOffset:t};this.lasers.push(l)}this.lastFireTime=t,this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playLaserSound()}update(){this.megaPistolActive&&(this.megaPistolTimer--,this.megaPistolTimer<=0&&(this.megaPistolActive=!1,this.game.renderer.addParticle(i/2,100,"‚ö° MEGA PISTOL TERMIN√â","#FF00FF"))),this.megaPistolActive||(this.weaponSwitchTimer++,this.weaponSwitchTimer>=this.weaponSwitchInterval&&(this.weaponSwitchTimer=0,this.currentWeaponIndex=(this.currentWeaponIndex+1)%this.weaponTypes.length));for(let t=this.specialBombs.length-1;t>=0;t--){const e=this.specialBombs[t];e.x+=e.speed,e.age++,e.rotation+=.1,e.scale=1+.2*Math.sin(.2*e.age),e.x>i||e.age>=e.lifetime?this.specialBombs.splice(t,1):"endless"===this.game.mode&&this.game.endlessMode&&this.checkSpecialBombCollisions(e,t)}for(let t=this.lasers.length-1;t>=0;t--){const e=this.lasers[t];e.x+=e.speed,e.age++,e.wave&&(e.wavePhase+=.2,e.y+=2*Math.sin(e.wavePhase)),e.x>i||e.age>=e.lifetime?this.lasers.splice(t,1):"endless"===this.game.mode&&this.game.endlessMode&&this.checkEndlessCollisions(e,t)}}checkSpecialBombCollisions(t,e){const i=this.game.endlessMode;let s=!1;if(i.currentBoss&&i.currentBoss.health>0){const e=i.currentBoss,l=e.size/2;if(t.x<e.x+l&&t.x+t.width>e.x-l&&t.y<e.y+l&&t.y+t.height>e.y-l){if(s=!0,this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPafSound(),i.isStageBoss&&e.hasShield&&e.shield>0){if(e.shield-=t.damage,console.log(`üí£ Bombe sur bouclier! Shield: ${e.shield}/${e.maxShield}`),e.shield<=0){e.shield=0,e.hasShield=!1;for(let t=0;t<12;t++){const i=2*Math.PI*t/12,s=.8*e.size;this.game.renderer.addParticle(e.x+Math.cos(i)*s,e.y+Math.sin(i)*s,"üí•","#00BFFF")}this.game.renderer.addParticle(e.x,e.y-80,"üõ°Ô∏è BOUCLIER ANNIHIL√â !","#FFD700")}}else if(e.health-=t.damage,console.log(`üí£ Bombe sur boss! HP: ${e.health}/${e.maxHealth}`),e.health<=0){this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPoufSound();for(let t=0;t<20;t++){const t=Math.random()*Math.PI*2,i=Math.random()*e.size;this.game.renderer.addParticle(e.x+Math.cos(t)*i,e.y+Math.sin(t)*i,["üí•","üî•","üí£"][Math.floor(3*Math.random())],"#FFD700")}this.game.score+=5e3,console.log("üéØ Boss annihil√© par bombe! +5000 points!"),e.x=2*-e.size}this.game.score+=500*t.damage}}if(s){const s=150;for(let e=i.obstacles.length-1;e>=0;e--){const l=i.obstacles[e],a=t.x-l.x,o=t.y-l.y;Math.sqrt(a*a+o*o)<s&&(i.obstacles.splice(e,1),this.game.renderer.addParticle(l.x,l.y,"üí•",t.color))}for(let e=0;e<15;e++){const i=2*Math.PI*e/15,l=.8*s;this.game.renderer.addParticle(t.x+Math.cos(i)*l,t.y+Math.sin(i)*l,["üí•","üî•","üí£","‚ú®"][Math.floor(4*Math.random())],t.color)}this.specialBombs.splice(e,1)}}checkEndlessCollisions(t,e){const i=this.game.endlessMode;if(i.currentBoss&&i.currentBoss.health>0){const s=i.currentBoss,l=s.size/2;if(t.x<s.x+l&&t.x+t.width>s.x-l&&t.y<s.y+l&&t.y+t.height>s.y-l){if(t.explosive||this.lasers.splice(e,1),i.isStageBoss&&s.hasShield&&s.shield>0){if(s.shield-=t.damage,this.game.renderer.addParticle(s.x+(Math.random()-.5)*s.size,s.y+(Math.random()-.5)*s.size,"üõ°Ô∏è","#00BFFF"),this.game.score+=50*t.damage,console.log(`üõ°Ô∏è Bouclier touch√©! Shield: ${s.shield}/${s.maxShield}`),s.shield<=0){s.shield=0,s.hasShield=!1;for(let t=0;t<8;t++){const e=2*Math.PI*t/8,i=.8*s.size;this.game.renderer.addParticle(s.x+Math.cos(e)*i,s.y+Math.sin(e)*i,"üí•","#00BFFF")}this.game.renderer.addParticle(s.x,s.y-80,"üõ°Ô∏è BOUCLIER D√âTRUIT !","#FFD700"),console.log("üéØ Bouclier du boss d√©truit!")}}else{s.health-=t.damage,this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playFuzzeSound();const e=["PAF!","POF!","PIF!"][this.bossHitCounter%3];this.bossHitCounter++,this.game.renderer.addParticle(s.x+40*(Math.random()-.5),s.y+40*(Math.random()-.5),e,"#FFFF00"),this.game.renderer.addParticle(s.x,s.y,"üí•","#FF0000"),this.game.score+=100*t.damage,console.log(`üí• Boss touch√©! HP: ${s.health}/${s.maxHealth}`),s.health<=0&&(this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPoufSound(),this.game.renderer.addParticle(s.x,s.y,"üí•üí•üí•","#FFD700"),this.game.score+=2e3,this.activateMegaPistol(),console.log("üéØ Boss d√©truit! +2000 points + Mega Pistol!"),s.x=2*-s.size)}return}}for(let s=i.obstacles.length-1;s>=0;s--){const l=i.obstacles[s];if(t.x<l.x+30&&t.x+t.width>l.x-30&&t.y<l.y+40&&t.y+t.height>l.y-40){if(this.game.audioManager&&this.game.audioManager.initialized&&this.game.audioManager.playPingSound(),i.obstacles.splice(s,1),t.explosive||this.lasers.splice(e,1),t.explosive){const t=80;for(let e=i.obstacles.length-1;e>=0;e--){const s=i.obstacles[e],a=l.x-s.x,o=l.y-s.y;Math.sqrt(a*a+o*o)<t&&(i.obstacles.splice(e,1),this.game.score+=100,this.game.obstaclesCleared++)}this.lasers.splice(e,1)}this.game.score+=100*t.damage,this.game.obstaclesCleared++;break}}for(let s=i.fuels.length-1;s>=0;s--){const e=i.fuels[s];if(t.x<e.x+20&&t.x+t.width>e.x-20&&t.y<e.y+20&&t.y+t.height>e.y-20){i.fuels.splice(s,1),this.game.renderer.addParticle(e.x,e.y,"‚ú®+1000‚ú®","#FFD700"),this.game.score+=1e3;break}}}render(t){for(const e of this.specialBombs){t.save();const i=e.x+e.width/2,s=e.y+e.height/2,l=40*e.scale,a=t.createRadialGradient(i,s,0,i,s,l);a.addColorStop(0,`${e.color}AA`),a.addColorStop(.5,`${e.color}44`),a.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=a,t.beginPath(),t.arc(i,s,l,0,2*Math.PI),t.fill(),t.translate(i,s),t.rotate(e.rotation),t.scale(e.scale,e.scale),t.shadowColor=e.glowColor,t.shadowBlur=30,t.fillStyle=e.color,t.beginPath(),t.arc(0,0,25,0,2*Math.PI),t.fill(),t.strokeStyle=e.glowColor,t.lineWidth=4,t.stroke(),t.shadowBlur=10,t.font="bold 30px Arial",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#FFFFFF",t.fillText("üí£",0,0);for(let o=1;o<=5;o++){const i=10*-o,s=(6-o)/6;t.globalAlpha=.6*s,t.fillStyle=e.color,t.beginPath(),t.arc(i,0,15*(1-o/5),0,2*Math.PI),t.fill()}t.restore()}for(const e of this.lasers){if(t.save(),t.shadowColor=e.glowColor,t.shadowBlur=15,e.explosive){const i=1+.2*Math.sin(.3*e.age);t.fillStyle=e.color,t.beginPath(),t.arc(e.x+e.width/2,e.y,e.height*i,0,2*Math.PI),t.fill(),t.strokeStyle="#FF8800",t.lineWidth=2,t.beginPath(),t.moveTo(e.x+e.width/2,e.y-e.height),t.lineTo(e.x+e.width/2,e.y-e.height-5),t.stroke()}else{t.fillStyle=e.color,t.fillRect(e.x,e.y-e.height/2,e.width,e.height),t.shadowBlur=25,t.fillStyle="#FFFFFF";const i=Math.max(2,e.height/2);t.fillRect(e.x,e.y-i/2,e.width,i)}t.restore()}}activateMegaPistol(){this.megaPistolActive=!0,this.megaPistolTimer=this.megaPistolDuration,this.game.renderer.addParticle(i/2,s/2,"üî´üí• MEGA PISTOL ACTIV√â! üí•üî´","#FF00FF")}}class st{constructor(t){this.game=t,this.canvasBubbles=[],this.narrativeQueue=[],this.isShowingNarrative=!1,this.maxSplashBubbles=3,this.lastNarrativeTime=0,this.narrativeCooldown=5e3}updateCanvasBubbles(){for(let t=this.canvasBubbles.length-1;t>=0;t--){const e=this.canvasBubbles[t];e.age+=16,e.age<300?e.opacity=e.age/300:e.age>e.duration-300?e.opacity=(e.duration-e.age)/300:e.opacity=1,e.age>=e.duration&&(e.onClose&&e.onClose(),this.canvasBubbles.splice(t,1))}}drawCanvasBubbles(t,e){const i="voxel"===(null==e?void 0:e.renderMode),s=null==e?void 0:e.voxelRenderer;this.canvasBubbles.forEach(e=>{t.save(),t.globalAlpha=e.opacity,"splash"===e.type?i&&s?s.drawVoxelSpeechBubble(e.x-e.width/2,e.y,e.width,e.height,e.icon,e.text,e.borderColor||"#000000"):this.drawComicBubble(t,e):"narrative"===e.type&&(i&&s?s.drawVoxelNarrativeBubble(e.x,e.y,e.text,e.maxWidth):this.drawComicNarrative(t,e)),t.restore()})}drawComicBubble(t,e){const i=e.x,s=e.y,l=e.width,a=e.height;t.fillStyle="rgba(0, 0, 0, 0.3)",this.drawRoundRect(t,i-l/2+5,s+5,l,a,20),t.fill(),t.fillStyle="#FFFFFF",this.drawRoundRect(t,i-l/2,s,l,a,20),t.fill(),t.strokeStyle="#000000",t.lineWidth=4,t.lineJoin="round",this.drawRoundRect(t,i-l/2,s,l,a,20),t.stroke(),t.strokeStyle=e.borderColor||"#FFD700",t.lineWidth=2,this.drawRoundRect(t,i-l/2+4,s+4,l-8,a-8,16),t.stroke(),t.fillStyle="#FFD700";[[i-l/2+15,s+10],[i+l/2-15,s+10],[i-l/2+15,s+a-10],[i+l/2-15,s+a-10]].forEach(([e,i])=>{this.drawStar(t,e,i,4,5,2)}),e.icon&&(t.font="bold 42px Arial",t.textAlign="center",t.textBaseline="top",t.fillStyle="#000000",t.fillText(e.icon,i,s+15)),e.text&&(t.font='bold 16px "Arial Black", Arial, sans-serif',t.textAlign="center",t.textBaseline="top",t.fillStyle="#000000",t.strokeStyle="#FFFFFF",t.lineWidth=3,t.strokeText(e.text.toUpperCase(),i,s+(e.icon?65:15)),t.fillText(e.text.toUpperCase(),i,s+(e.icon?65:15)))}drawComicNarrative(t,e){const i=e.x,s=e.y,l=e.maxWidth||280;t.font="bold 14px Arial";const a=e.text.split(" "),o=[];let n="";for(const f of a){const e=n?`${n} ${f}`:f;t.measureText(e).width>l-30&&n?(o.push(n),n=f):n=e}n&&o.push(n);let r=0;o.forEach(e=>{const i=t.measureText(e);r=Math.max(r,i.width)});const h=r+30+30,c=20*o.length+30;t.fillStyle="rgba(0, 0, 0, 0.25)",this.drawRoundRect(t,i+4,s+4,h,c,15),t.fill(),t.fillStyle="#FFFEF5",this.drawRoundRect(t,i,s,h,c,15),t.fill(),t.strokeStyle="#000000",t.lineWidth=3,this.drawRoundRect(t,i,s,h,c,15),t.stroke();const d=i+h/2,u=s+c;t.fillStyle="#FFFEF5",t.beginPath(),t.moveTo(d,u),t.lineTo(d-10,u+15),t.lineTo(d+10,u+15),t.closePath(),t.fill(),t.strokeStyle="#000000",t.lineWidth=3,t.stroke(),t.font="20px Arial",t.textAlign="left",t.textBaseline="top",t.fillStyle="#666",t.fillText("üí≠",i+10,s+15-2),t.font="bold 14px Arial",t.fillStyle="#333",t.textAlign="left",o.forEach((e,l)=>{t.fillText(e,i+40,s+15+20*l)})}drawRoundRect(t,e,i,s,l,a){t.beginPath(),t.moveTo(e+a,i),t.lineTo(e+s-a,i),t.quadraticCurveTo(e+s,i,e+s,i+a),t.lineTo(e+s,i+l-a),t.quadraticCurveTo(e+s,i+l,e+s-a,i+l),t.lineTo(e+a,i+l),t.quadraticCurveTo(e,i+l,e,i+l-a),t.lineTo(e,i+a),t.quadraticCurveTo(e,i,e+a,i),t.closePath()}drawStar(t,e,i,s,l,a){let o=Math.PI/2*3,n=Math.PI/s;t.beginPath(),t.moveTo(e,i-l);for(let r=0;r<s;r++)t.lineTo(e+Math.cos(o)*l,i+Math.sin(o)*l),o+=n,t.lineTo(e+Math.cos(o)*a,i+Math.sin(o)*a),o+=n;t.lineTo(e,i-l),t.closePath(),t.fill()}showSplash({x:t,y:e,icon:i,text:s,color:l="#FFD700",duration:a=2e3,onClose:o=null}){const n=this.canvasBubbles.filter(t=>"splash"===t.type);if(n.length>=this.maxSplashBubbles){const t=n[0];t.onClose&&t.onClose();const e=this.canvasBubbles.indexOf(t);e>-1&&this.canvasBubbles.splice(e,1)}this.canvasBubbles.push({type:"splash",x:this.game.canvas.width/2,y:80,width:350,height:120,icon:i,text:s,borderColor:l,age:0,duration:a,opacity:0,onClose:o})}showNarrative({text:t,duration:e=5e3,onClose:i=null}){const s=Date.now();if(s-this.lastNarrativeTime<this.narrativeCooldown)return console.log("üö´ Bulle narrative bloqu√©e (anti-spam)"),void(i&&i());this.lastNarrativeTime=s,this.narrativeQueue.push({text:t,duration:e,onClose:i}),this.isShowingNarrative||this.processNarrativeQueue()}processNarrativeQueue(){if(0===this.narrativeQueue.length)return void(this.isShowingNarrative=!1);this.isShowingNarrative=!0;const{text:t,duration:e,onClose:i}=this.narrativeQueue.shift();this.canvasBubbles.push({type:"narrative",x:this.game.canvas.width-320,y:20,text:t,maxWidth:280,age:0,duration:e,opacity:0,onClose:()=>{i&&i(),this.processNarrativeQueue()}})}clearAll(){this.canvasBubbles=[]}}class lt{static getTranslatedText(t){var e,i,s;return(null==(s=null==(i=null==(e=p.translations)?void 0:e.obstacles)?void 0:i.sins)?void 0:s[t])||""}static getRandom(){const t=this.definitions[Math.floor(Math.random()*this.definitions.length)],e=s-100,l=80+Math.random()*(e-80);return{...t,text:this.getTranslatedText(t.id)||t.text,x:i,y:Math.max(80,Math.min(e,l)),type:"sin",dangerous:!0}}}e(lt,"definitions",[{id:"pride",icon:"üëë",text:"ORGUEIL",color:"#9370DB",width:60,height:60,damage:3},{id:"greed",icon:"üí∞",text:"AVARICE",color:"#FFD700",width:55,height:55,damage:3},{id:"lust",icon:"üíã",text:"LUXURE",color:"#FF1493",width:50,height:50,damage:3},{id:"envy",icon:"üëÅÔ∏è",text:"ENVIE",color:"#32CD32",width:55,height:55,damage:3},{id:"gluttony",icon:"üçñ",text:"GOURMANDISE",color:"#FF6347",width:55,height:55,damage:3},{id:"wrath",icon:"üí¢",text:"COL√àRE",color:"#DC143C",width:60,height:60,damage:3},{id:"sloth",icon:"üò¥",text:"PARESSE",color:"#708090",width:55,height:55,damage:3}]);class at{static getFirstProverbText(){return p.t("proverbs.firstProverb")}static getProverbText(t){var e,i;return((null==(i=null==(e=p.translations)?void 0:e.proverbs)?void 0:i.proverbs)||[])[t]||"Sagesse..."}static getFirst(){return{text:this.getFirstProverbText(),wisdom:10,icon:"üïäÔ∏è",x:1050,y:350,width:40,height:40,type:"proverb",speed:.5,bobPhase:0,collected:!1}}static getRandom(){const t=Math.floor(Math.random()*this.proverbs.length),e=this.proverbs[t],i=[200,320,400],s=i[Math.floor(Math.random()*i.length)];return{text:this.getProverbText(t),wisdom:e.wisdom,icon:e.icon,x:1050,y:s,width:40,height:40,type:"proverb",speed:.4+.2*Math.random(),bobPhase:Math.random()*Math.PI*2,collected:!1}}}e(at,"firstProverb",{text:"La libert√© est le pouvoir de voler",wisdom:10,icon:"üïäÔ∏è"}),e(at,"proverbs",[{text:"L'eau qui coule ne revient jamais",wisdom:5,icon:"üåä"},{text:"Calme comme l'eau dormante",wisdom:3,icon:"üíß"},{text:"Une goutte d'eau dans l'oc√©an",wisdom:4,icon:"üí¶"},{text:"Apr√®s la temp√™te vient le calme",wisdom:6,icon:"‚õàÔ∏è"},{text:"L'eau prend la forme du vase",wisdom:7,icon:"üè∫"},{text:"La patience est am√®re mais ses fruits sont doux",wisdom:8,icon:"üçØ"},{text:"Le silence est d'or",wisdom:5,icon:"üîá"},{text:"Tout vient √† point √† qui sait attendre",wisdom:6,icon:"‚è≥"},{text:"La nuit porte conseil",wisdom:4,icon:"üåô"},{text:"Les √©toiles brillent pour tous",wisdom:5,icon:"‚ú®"},{text:"L'oc√©an est fait de gouttes",wisdom:7,icon:"üåä"},{text:"Le plus long voyage commence par un pas",wisdom:8,icon:"üë£"},{text:"La sagesse commence dans l'√©merveillement",wisdom:9,icon:"üåü"},{text:"Connais-toi toi-m√™me",wisdom:10,icon:"ü™û"},{text:"La v√©rit√© est au fond du puits",wisdom:8,icon:"üï≥Ô∏è"},{text:"Le sage apprend de ses erreurs",wisdom:7,icon:"üìö"},{text:"Un sourire est la plus belle courbe",wisdom:5,icon:"üòä"},{text:"Le temps gu√©rit toutes les blessures",wisdom:6,icon:"‚è∞"},{text:"La paix int√©rieure vaut tous les tr√©sors",wisdom:9,icon:"‚òÆÔ∏è"},{text:"Chaque fin est un nouveau commencement",wisdom:7,icon:"üîÑ"}]);class ot{constructor(t){this.game=t,this.active=!1,this.phase=0,this.phaseTimer=0,this.skipRequested=!1,this.sheepAnimator=new u,this.phases=[{duration:240,textKey:"intro.phases.paradise",action:null},{duration:90,textKey:null,action:"showChest"},{duration:180,textKey:"intro.phases.shield",action:"showItem1"},{duration:180,textKey:"intro.phases.sword",action:"showItem2"},{duration:180,textKey:"intro.phases.bomb",action:"showItem3"},{duration:210,textKey:"intro.phases.wtf",action:null},{duration:150,textKey:"intro.phases.boom",action:"explosion"},{duration:120,textKey:"intro.phases.no",action:"gameStart"}],this.chestVisible=!1,this.chestOpenProgress=0,this.chestShake=0,this.itemsVisible={shield:!1,sword:!1,bomb:!1},this.itemFloatY={shield:0,sword:0,bomb:0},this.itemSparkles={shield:[],sword:[],bomb:[]},this.explosionProgress=0,this.sheepX=0,this.sheepY=0,this.sheepBounce=0}start(){this.active=!0,this.phase=0,this.phaseTimer=0,this.skipRequested=!1,this.chestVisible=!1,this.chestOpenProgress=0,this.chestShake=0,this.itemsVisible={shield:!1,sword:!1,bomb:!1},this.itemFloatY={shield:0,sword:0,bomb:0},this.itemSparkles={shield:[],sword:[],bomb:[]},this.explosionProgress=0,this.sheepX=this.game.canvas.width/2-150,this.sheepY=this.game.canvas.height/2}update(){if(!this.active)return;if(this.skipRequested)return void this.complete();this.phaseTimer++,this.sheepBounce=3*Math.sin(.08*this.phaseTimer);const t=this.phases[this.phase];"showChest"===t.action&&this.phaseTimer>10&&(this.chestVisible=!0,this.chestOpenProgress=Math.min(1,this.chestOpenProgress+.03),this.chestOpenProgress<.9&&(this.chestShake=2*Math.sin(.5*this.phaseTimer))),"showItem1"===t.action&&this.phaseTimer>20&&(this.itemsVisible.shield=!0,this.itemFloatY.shield=Math.min(0,this.itemFloatY.shield+2),Math.random()>.8&&this.itemSparkles.shield.push({x:40*(Math.random()-.5),y:40*(Math.random()-.5),life:30})),"showItem2"===t.action&&this.phaseTimer>20&&(this.itemsVisible.sword=!0,this.itemFloatY.sword=Math.min(0,this.itemFloatY.sword+2),Math.random()>.8&&this.itemSparkles.sword.push({x:40*(Math.random()-.5),y:40*(Math.random()-.5),life:30})),"showItem3"===t.action&&this.phaseTimer>20&&(this.itemsVisible.bomb=!0,this.itemFloatY.bomb=Math.min(0,this.itemFloatY.bomb+2),Math.random()>.8&&this.itemSparkles.bomb.push({x:40*(Math.random()-.5),y:40*(Math.random()-.5),life:30}));for(const e in this.itemSparkles)this.itemSparkles[e]=this.itemSparkles[e].filter(t=>(t.life--,t.y-=1,t.life>0));"explosion"===t.action&&(this.explosionProgress=Math.min(1,this.explosionProgress+.02)),this.phaseTimer>=t.duration&&(this.phase++,this.phaseTimer=0,this.phase>=this.phases.length&&this.complete())}render(t){if(!this.active)return;const e=this.game.canvas.width,i=this.game.canvas.height;t.fillStyle="rgba(0, 0, 0, 0.9)",t.fillRect(0,0,e,i),this.drawParadiseClouds(t);const s=this.phases[this.phase];if(this.drawSheep(t,this.sheepX,this.sheepY+this.sheepBounce),s.textKey){const e=p.t(s.textKey);this.drawDialogue(t,e,this.sheepX+20,this.sheepY-80)}this.chestVisible&&this.drawChest(t,e/2+100,i/2),"explosion"===s.action&&this.drawExplosion(t),this.phase<this.phases.length-1&&(t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="14px Arial",t.textAlign="center",t.fillText("[ESPACE] pour passer",e/2,i-30))}drawParadiseClouds(t){const e=this.game.canvas.width;this.game.canvas.height,t.fillStyle="rgba(255, 255, 255, 0.1)";for(let i=0;i<5;i++){const s=(200*i+this.phaseTimer)%e,l=100*i;t.beginPath(),t.arc(s,l,60,0,2*Math.PI),t.arc(s+50,l,50,0,2*Math.PI),t.arc(s+100,l,60,0,2*Math.PI),t.fill()}}drawSheep(t,e,i){this.sheepAnimator.draw(t,e,i,1.5,0,"normal",!1,0)}drawChest(t,e,i){t.save(),t.translate(this.chestShake,0);const s=this.chestOpenProgress*(Math.PI/3);t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.ellipse(e,i+55,50,10,0,0,2*Math.PI),t.fill();const l=t.createLinearGradient(e-50,i,e+50,i);l.addColorStop(0,"#654321"),l.addColorStop(.5,"#8B4513"),l.addColorStop(1,"#654321"),t.fillStyle=l,t.strokeStyle="#3E2723",t.lineWidth=3,t.fillRect(e-50,i,100,60),t.strokeRect(e-50,i,100,60),t.fillStyle="#8B7355",t.fillRect(e-50,i+10,100,6),t.fillRect(e-50,i+44,100,6),t.fillStyle="#C9A068";for(let o of[[e-45,i+5],[e+35,i+5],[e-45,i+49],[e+35,i+49]])t.fillRect(o[0],o[1],10,10);t.fillStyle="#FFD700",t.strokeStyle="#B8860B",t.lineWidth=2,t.beginPath(),t.arc(e,i+30,12,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle="#3E2723",t.beginPath(),t.arc(e,i+28,4,0,2*Math.PI),t.fill(),t.fillRect(e-2,i+28,4,8),t.save(),t.translate(e,i),t.rotate(-s);const a=t.createLinearGradient(-50,-50,50,-50);if(a.addColorStop(0,"#7A5230"),a.addColorStop(.5,"#A0522D"),a.addColorStop(1,"#7A5230"),t.fillStyle=a,t.strokeStyle="#3E2723",t.lineWidth=3,t.beginPath(),t.moveTo(-50,0),t.lineTo(-50,-40),t.quadraticCurveTo(0,-55,50,-40),t.lineTo(50,0),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#8B7355",t.fillRect(-50,-10,100,6),this.chestOpenProgress>.2){const e=Math.min(1,2*(this.chestOpenProgress-.2));t.globalAlpha=.6*e;const i=t.createRadialGradient(0,-20,0,0,-20,40);i.addColorStop(0,"#FFD700"),i.addColorStop(.5,"#FFA500"),i.addColorStop(1,"rgba(255, 165, 0, 0)"),t.fillStyle=i,t.beginPath(),t.arc(0,-20,40,0,2*Math.PI),t.fill(),t.globalAlpha=1}if(t.restore(),this.chestOpenProgress>.4){const s=i-20;if(this.itemsVisible.shield){const i=s+this.itemFloatY.shield-80;this.drawShield(t,e-70,i),this.drawSparkles(t,e-70,i,this.itemSparkles.shield)}if(this.itemsVisible.sword){const i=s+this.itemFloatY.sword-100;this.drawSword(t,e,i),this.drawSparkles(t,e,i,this.itemSparkles.sword)}if(this.itemsVisible.bomb){const i=s+this.itemFloatY.bomb-80;this.drawBomb(t,e+70,i),this.drawSparkles(t,e+70,i,this.itemSparkles.bomb)}}t.restore()}drawSparkles(t,e,i,s){for(const l of s){const s=l.life/30;t.fillStyle=`rgba(255, 215, 0, ${s})`,t.beginPath(),t.arc(e+l.x,i+l.y,3,0,2*Math.PI),t.fill()}}drawShield(t,e,i){t.fillStyle="#00d4ff",t.strokeStyle="#000000",t.lineWidth=2,t.beginPath(),t.moveTo(e,i-25),t.lineTo(e+20,i),t.lineTo(e+15,i+30),t.lineTo(e-15,i+30),t.lineTo(e-20,i),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#ffffff",t.globalAlpha=.5,t.fillRect(e-5,i,10,15),t.globalAlpha=1}drawSword(t,e,i){t.strokeStyle="#00ff00",t.lineWidth=6,t.shadowColor="#00ff00",t.shadowBlur=15,t.beginPath(),t.moveTo(e,i-30),t.lineTo(e,i+30),t.stroke(),t.shadowBlur=0,t.strokeStyle="#808080",t.lineWidth=4,t.beginPath(),t.moveTo(e-15,i+25),t.lineTo(e+15,i+25),t.stroke(),t.fillStyle="#404040",t.fillRect(e-3,i+25,6,15)}drawBomb(t,e,i){t.fillStyle="#2c3e50",t.strokeStyle="#000000",t.lineWidth=2,t.beginPath(),t.arc(e,i,20,0,2*Math.PI),t.fill(),t.stroke(),t.strokeStyle="#ff4400",t.lineWidth=3,t.beginPath(),t.moveTo(e,i-20),t.lineTo(e+5,i-35),t.stroke(),t.fillStyle="#ffff00";(Math.sin(.3*this.phaseTimer)>0?1:0)&&(t.beginPath(),t.arc(e+5,i-35,4,0,2*Math.PI),t.fill()),t.fillStyle="#ffff00",t.font="bold 16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("‚ò¢",e,i)}drawDialogue(t,e,i,s){t.font="bold 18px Arial";const l=e.split(" "),a=[];let o="";for(const f of l){const e=o+(o?" ":"")+f;t.measureText(e).width>350&&o?(a.push(o),o=f):o=e}o&&a.push(o);const n=24*a.length+40;let r=0;for(const f of a){const e=t.measureText(f);r=Math.max(r,e.width)}const h=r+40,c=i-h/2,d=s-n-10,u=t.createLinearGradient(c,d,c,d+n);u.addColorStop(0,"#FFFFFF"),u.addColorStop(1,"#F0F8FF"),t.fillStyle=u,t.fillRect(c,d,h,n),t.strokeStyle="#000000",t.lineWidth=4,t.strokeRect(c,d,h,n),t.strokeStyle="#FFD700",t.lineWidth=2,t.strokeRect(c+3,d+3,h-6,n-6);t.fillStyle="#4169E1",t.fillRect(c+8,d+8,4,4),t.fillRect(c+8+4,d+8,4,4),t.fillRect(c+8,d+8+4,4,4),t.fillRect(c+h-8-8,d+8,4,4),t.fillRect(c+h-8-4,d+8,4,4),t.fillRect(c+h-8-8,d+8+4,4,4),t.fillRect(c+8,d+n-8-8,4,4),t.fillRect(c+8+4,d+n-8-8,4,4),t.fillRect(c+8,d+n-8-4,4,4),t.fillRect(c+h-8-8,d+n-8-8,4,4),t.fillRect(c+h-8-4,d+n-8-8,4,4),t.fillRect(c+h-8-8,d+n-8-4,4,4),t.fillStyle="#FFFFFF",t.fillRect(c+h/2-10,d+n,20,10),t.fillRect(c+h/2-5,d+n+10,10,5),t.strokeStyle="#000000",t.lineWidth=2,t.strokeRect(c+h/2-10,d+n,20,10),t.fillStyle="#000000",t.textAlign="center",t.textBaseline="top";for(let f=0;f<a.length;f++)t.fillText(a[f],i,s-n-5+20+24*f)}drawExplosion(t){const e=this.game.canvas.width,i=this.game.canvas.height,s=this.explosionProgress;t.fillStyle=`rgba(255, 255, 255, ${.9*(1-s)})`,t.fillRect(0,0,e,i);for(let l=0;l<5;l++){const a=s*(e/2+100*l),o=.3*(1-s);t.strokeStyle=`rgba(255, 100, 0, ${o})`,t.lineWidth=10,t.beginPath(),t.arc(e/2,i/2,a,0,2*Math.PI),t.stroke()}}handleInput(t){" "!==t&&"Enter"!==t&&"Escape"!==t||(this.skipRequested=!0)}complete(){this.active=!1,this.game.startGame&&this.game.startGame()}isActive(){return this.active}}let nt=class{constructor(){this.audioContext=null,this.masterVolume=.3,this.initialized=!1,this.activeOscillators=[],this.rocketSound=null,this.backgroundMusic=null,this.musicVolume=.5,this.currentTrack=null;const t=window.location.pathname.split("/").filter(Boolean),e=t.length>0&&"index.html"!==t[0]?`/${t[0]}/`:"/";this.musicTracks=[`${e}music/Ilsuffitpas.mp3`,`${e}music/LavoixducielmurmurelAmour.mp3`,`${e}music/Jojo-notre-beau-Petit-mouton.mp3`,`${e}music/DansQuelMondeOnVit.mp3`,`${e}music/Nabandonnejamais.mp3`,`${e}music/forteresses_de_peur_xT.mp3`],this.currentTrackIndex=0}init(){if(!this.initialized)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.initialized=!0,console.log("üîä AudioManager initialis√©")}catch(t){console.error("Erreur initialisation audio:",t)}}startBackgroundMusic(){this.backgroundMusic?this.backgroundMusic.paused&&(this.backgroundMusic.play().catch(t=>{console.log("‚ö†Ô∏è Erreur reprise musique:",t.message)}),console.log("üéµ Musique reprise")):(this.backgroundMusic=new Audio,this.backgroundMusic.volume=this.musicVolume,this.backgroundMusic.loop=!1,this.backgroundMusic.preload="auto",this.playNextTrack(),this.backgroundMusic.addEventListener("ended",()=>{this.playNextTrack()}),console.log("üéµ Musique de fond d√©marr√©e en autoplay"))}playNextTrack(){this.backgroundMusic&&(this.currentTrack=this.musicTracks[this.currentTrackIndex],this.backgroundMusic.pause(),this.backgroundMusic.src=this.currentTrack,this.backgroundMusic.load(),this.backgroundMusic.play().catch(t=>{console.log("‚ö†Ô∏è Autoplay bloqu√©, en attente interaction utilisateur:",t.message)}),console.log(`üéµ Lecture: ${this.currentTrack}`),this.currentTrackIndex=(this.currentTrackIndex+1)%this.musicTracks.length)}pauseMusic(){this.backgroundMusic&&this.backgroundMusic.pause()}resumeMusic(){this.backgroundMusic&&this.backgroundMusic.play().catch(t=>{console.log("Erreur reprise musique:",t)})}setMusicVolume(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.backgroundMusic&&(this.backgroundMusic.volume=this.musicVolume)}playFlyingSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();return t.type="sine",t.frequency.setValueAtTime(80,this.audioContext.currentTime),e.gain.setValueAtTime(0,this.audioContext.currentTime),e.gain.linearRampToValueAtTime(.1*this.masterVolume,this.audioContext.currentTime+.1),t.connect(e),e.connect(this.audioContext.destination),t.start(),{oscillator:t,gainNode:e,stop:()=>{e.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.2),setTimeout(()=>t.stop(),200)}}}startRocketSound(){if(!this.initialized)return null;if(this.rocketSound)return this.rocketSound;const t=2*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);for(let h=0;h<t;h++)i[h]=2*Math.random()-1;const s=this.audioContext.createBufferSource();s.buffer=e,s.loop=!0;const l=this.audioContext.createBiquadFilter();l.type="bandpass",l.frequency.setValueAtTime(150,this.audioContext.currentTime),l.Q.setValueAtTime(2,this.audioContext.currentTime);const a=this.audioContext.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(400,this.audioContext.currentTime);const o=this.audioContext.createOscillator();o.type="sine",o.frequency.setValueAtTime(3,this.audioContext.currentTime);const n=this.audioContext.createGain();n.gain.setValueAtTime(30,this.audioContext.currentTime),o.connect(n),n.connect(l.frequency);const r=this.audioContext.createGain();return r.gain.setValueAtTime(0,this.audioContext.currentTime),r.gain.linearRampToValueAtTime(.25*this.masterVolume,this.audioContext.currentTime+.2),s.connect(l),l.connect(a),a.connect(r),r.connect(this.audioContext.destination),s.start(),o.start(),this.rocketSound={source:s,modulator:o,gainNode:r,stop:()=>{this.rocketSound&&(r.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.3),setTimeout(()=>{try{s.stop(),o.stop()}catch(t){}this.rocketSound=null},300))}},this.rocketSound}stopRocketSound(){this.rocketSound&&this.rocketSound.stop()}playCollisionSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sawtooth",t.frequency.setValueAtTime(60,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(30,this.audioContext.currentTime+.3),e.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.3)}playBlockSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="square",t.frequency.setValueAtTime(200,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(80,this.audioContext.currentTime+.08),e.gain.setValueAtTime(.25*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.08),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.08);const i=.05*this.audioContext.sampleRate,s=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),l=s.getChannelData(0);for(let r=0;r<i;r++)l[r]=(2*Math.random()-1)*Math.exp(-r/(.3*i));const a=this.audioContext.createBufferSource();a.buffer=s;const o=this.audioContext.createBiquadFilter();o.type="highpass",o.frequency.setValueAtTime(800,this.audioContext.currentTime);const n=this.audioContext.createGain();n.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),a.connect(o),o.connect(n),n.connect(this.audioContext.destination),a.start()}playLaserSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(1400,this.audioContext.currentTime+.04),t.frequency.exponentialRampToValueAtTime(600,this.audioContext.currentTime+.1),e.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.1)}playBombSound(){if(!this.initialized)return;const t=.6*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);for(let n=0;n<t;n++)i[n]=(2*Math.random()-1)*Math.exp(-n/(.15*t));const s=this.audioContext.createBufferSource();s.buffer=e;const l=this.audioContext.createOscillator();l.type="sine",l.frequency.setValueAtTime(80,this.audioContext.currentTime),l.frequency.exponentialRampToValueAtTime(25,this.audioContext.currentTime+.6);const a=this.audioContext.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(180,this.audioContext.currentTime),a.frequency.linearRampToValueAtTime(60,this.audioContext.currentTime+.6),a.Q.setValueAtTime(1,this.audioContext.currentTime);const o=this.audioContext.createGain();o.gain.setValueAtTime(.35*this.masterVolume,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(.25*this.masterVolume,this.audioContext.currentTime+.2),o.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.6),l.connect(a),s.connect(a),a.connect(o),o.connect(this.audioContext.destination),l.start(),s.start(),l.stop(this.audioContext.currentTime+.6)}playPowerUpSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(100,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.4),e.gain.setValueAtTime(0,this.audioContext.currentTime),e.gain.linearRampToValueAtTime(.12*this.masterVolume,this.audioContext.currentTime+.1),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.4),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.4)}playGlineSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createOscillator(),i=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(1600,this.audioContext.currentTime+.2),e.type="sine",e.frequency.setValueAtTime(1200,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(2400,this.audioContext.currentTime+.2),i.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),t.connect(i),e.connect(i),i.connect(this.audioContext.destination),t.start(),e.start(),t.stop(this.audioContext.currentTime+.2),e.stop(this.audioContext.currentTime+.2)}playWeaponSound(){if(!this.initialized)return;const t=this.audioContext.currentTime,e=this.audioContext.createOscillator();e.type="square",e.frequency.setValueAtTime(200,t),e.frequency.exponentialRampToValueAtTime(150,t+.3);const i=this.audioContext.createOscillator();i.type="triangle",i.frequency.setValueAtTime(400,t),i.frequency.exponentialRampToValueAtTime(100,t+.3);const s=.1*this.audioContext.sampleRate,l=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),a=l.getChannelData(0);for(let d=0;d<s;d++)a[d]=2*Math.random()-1;const o=this.audioContext.createBufferSource();o.buffer=l;const n=this.audioContext.createBiquadFilter();n.type="bandpass",n.frequency.setValueAtTime(2e3,t),n.Q.setValueAtTime(5,t);const r=this.audioContext.createGain();r.gain.setValueAtTime(.2*this.masterVolume,t),r.gain.exponentialRampToValueAtTime(.01,t+.3);const h=this.audioContext.createGain();h.gain.setValueAtTime(.15*this.masterVolume,t),h.gain.exponentialRampToValueAtTime(.01,t+.3);const c=this.audioContext.createGain();c.gain.setValueAtTime(.3*this.masterVolume,t),c.gain.exponentialRampToValueAtTime(.01,t+.1),e.connect(r),i.connect(h),o.connect(n),n.connect(c),r.connect(this.audioContext.destination),h.connect(this.audioContext.destination),c.connect(this.audioContext.destination),e.start(t),i.start(t),o.start(t),e.stop(t+.3),i.stop(t+.3)}playPocSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(600,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(400,this.audioContext.currentTime+.05),e.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.05),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.05)}playFuelSound(){if(!this.initialized)return;const t=.15*this.audioContext.sampleRate,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),i=e.getChannelData(0);for(let n=0;n<t;n++)i[n]=(2*Math.random()-1)*Math.exp(-n/(.2*t));const s=this.audioContext.createBufferSource();s.buffer=e;const l=this.audioContext.createBiquadFilter();l.type="bandpass",l.frequency.setValueAtTime(400,this.audioContext.currentTime),l.frequency.linearRampToValueAtTime(250,this.audioContext.currentTime+.15),l.Q.setValueAtTime(3,this.audioContext.currentTime);const a=this.audioContext.createOscillator();a.type="sine",a.frequency.setValueAtTime(180,this.audioContext.currentTime),a.frequency.exponentialRampToValueAtTime(80,this.audioContext.currentTime+.15);const o=this.audioContext.createGain();o.gain.setValueAtTime(.18*this.masterVolume,this.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),s.connect(l),a.connect(l),l.connect(o),o.connect(this.audioContext.destination),s.start(),a.start(),a.stop(this.audioContext.currentTime+.15)}playPloufeuSound(){if(console.log("üéÆ playPloufeuSound called, initialized:",this.initialized),this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(300,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(150,this.audioContext.currentTime+.15);const e=this.audioContext.createOscillator();e.type="triangle",e.frequency.setValueAtTime(1200,this.audioContext.currentTime+.1),e.frequency.exponentialRampToValueAtTime(1800,this.audioContext.currentTime+.3);const i=this.audioContext.createGain();i.gain.setValueAtTime(.25*this.masterVolume,this.audioContext.currentTime),i.gain.linearRampToValueAtTime(.2*this.masterVolume,this.audioContext.currentTime+.1),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),t.connect(i),e.connect(i),i.connect(this.audioContext.destination),t.start(),e.start(this.audioContext.currentTime+.1),t.stop(this.audioContext.currentTime+.15),e.stop(this.audioContext.currentTime+.3),console.log("üéµ Ploufeu sound started successfully")}catch(t){console.error("‚ùå Error playing ploufeu sound:",t)}else console.log("‚ö†Ô∏è AudioManager not initialized!")}playWhirlpoolSound(){if(this.initialized)try{const t=this.audioContext.createBufferSource(),e=2*this.audioContext.sampleRate,i=this.audioContext.createBuffer(1,e,this.audioContext.sampleRate),s=i.getChannelData(0);for(let r=0;r<e;r++)s[r]=2*Math.random()-1;t.buffer=i,t.loop=!0;const l=this.audioContext.createBiquadFilter();l.type="bandpass",l.frequency.setValueAtTime(150,this.audioContext.currentTime),l.frequency.linearRampToValueAtTime(800,this.audioContext.currentTime+1.5),l.Q.value=3;const a=this.audioContext.createOscillator();a.frequency.value=5;const o=this.audioContext.createGain();o.gain.value=200,a.connect(o),o.connect(l.frequency);const n=this.audioContext.createGain();n.gain.setValueAtTime(.1*this.masterVolume,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(.3*this.masterVolume,this.audioContext.currentTime+2),t.connect(l),l.connect(n),n.connect(this.audioContext.destination),t.start(),a.start(),t.stop(this.audioContext.currentTime+2),a.stop(this.audioContext.currentTime+2)}catch(t){console.error("Error playing whirlpool sound:",t)}}playSharkAttackSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sawtooth",t.frequency.setValueAtTime(40,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(80,this.audioContext.currentTime+.3),t.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.8);const e=this.audioContext.createOscillator();e.type="sawtooth",e.frequency.setValueAtTime(42,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(83,this.audioContext.currentTime+.3),e.frequency.exponentialRampToValueAtTime(52,this.audioContext.currentTime+.8);const i=this.audioContext.createBufferSource(),s=.2*this.audioContext.sampleRate,l=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),a=l.getChannelData(0);for(let h=0;h<s;h++)a[h]=2*Math.random()-1;i.buffer=l;const o=this.audioContext.createBiquadFilter();o.type="bandpass",o.frequency.value=300,o.Q.value=2;const n=this.audioContext.createGain();n.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2);const r=this.audioContext.createGain();r.gain.setValueAtTime(.25*this.masterVolume,this.audioContext.currentTime),r.gain.linearRampToValueAtTime(.3*this.masterVolume,this.audioContext.currentTime+.3),r.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.8),t.connect(r),e.connect(r),i.connect(o),o.connect(n),n.connect(this.audioContext.destination),r.connect(this.audioContext.destination),t.start(),e.start(),i.start(),t.stop(this.audioContext.currentTime+.8),e.stop(this.audioContext.currentTime+.8)}catch(t){console.error("Error playing shark attack sound:",t)}}playSplashSound(){if(this.initialized)try{const t=this.audioContext.createBufferSource(),e=.3*this.audioContext.sampleRate,i=this.audioContext.createBuffer(1,e,this.audioContext.sampleRate),s=i.getChannelData(0);for(let o=0;o<e;o++)s[o]=2*Math.random()-1;t.buffer=i;const l=this.audioContext.createBiquadFilter();l.type="highpass",l.frequency.value=1e3,l.Q.value=1;const a=this.audioContext.createGain();a.gain.setValueAtTime(.25*this.masterVolume,this.audioContext.currentTime),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),t.connect(l),l.connect(a),a.connect(this.audioContext.destination),t.start()}catch(t){console.error("Error playing splash sound:",t)}}playWaveSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(60,this.audioContext.currentTime),t.frequency.linearRampToValueAtTime(80,this.audioContext.currentTime+.25),t.frequency.linearRampToValueAtTime(50,this.audioContext.currentTime+.5);const e=this.audioContext.createBufferSource(),i=.5*this.audioContext.sampleRate,s=this.audioContext.createBuffer(1,i,this.audioContext.sampleRate),l=s.getChannelData(0);for(let r=0;r<i;r++)l[r]=2*Math.random()-1;e.buffer=s;const a=this.audioContext.createBiquadFilter();a.type="lowpass",a.frequency.value=400,a.Q.value=2;const o=this.audioContext.createGain();o.gain.setValueAtTime(.1*this.masterVolume,this.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5);const n=this.audioContext.createGain();n.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),t.connect(n),e.connect(a),a.connect(o),n.connect(this.audioContext.destination),o.connect(this.audioContext.destination),t.start(),e.start(),t.stop(this.audioContext.currentTime+.5)}catch(t){console.error("Error playing wave sound:",t)}}playLeviathanRoarSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sawtooth",t.frequency.setValueAtTime(30,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.5),t.frequency.exponentialRampToValueAtTime(35,this.audioContext.currentTime+1.5);const e=this.audioContext.createOscillator();e.type="sawtooth",e.frequency.setValueAtTime(45,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(65,this.audioContext.currentTime+.5),e.frequency.exponentialRampToValueAtTime(48,this.audioContext.currentTime+1.5);const i=this.audioContext.createBufferSource(),s=1.5*this.audioContext.sampleRate,l=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),a=l.getChannelData(0);for(let h=0;h<s;h++)a[h]=2*Math.random()-1;i.buffer=l;const o=this.audioContext.createBiquadFilter();o.type="bandpass",o.frequency.setValueAtTime(200,this.audioContext.currentTime),o.frequency.linearRampToValueAtTime(600,this.audioContext.currentTime+.7),o.frequency.linearRampToValueAtTime(300,this.audioContext.currentTime+1.5),o.Q.value=3;const n=this.audioContext.createGain();n.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(.25*this.masterVolume,this.audioContext.currentTime+.5),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.5);const r=this.audioContext.createGain();r.gain.setValueAtTime(.3*this.masterVolume,this.audioContext.currentTime),r.gain.linearRampToValueAtTime(.35*this.masterVolume,this.audioContext.currentTime+.5),r.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.5),t.connect(r),e.connect(r),i.connect(o),o.connect(n),r.connect(this.audioContext.destination),n.connect(this.audioContext.destination),t.start(),e.start(),i.start(),t.stop(this.audioContext.currentTime+1.5),e.stop(this.audioContext.currentTime+1.5)}catch(t){console.error("Error playing leviathan roar sound:",t)}}playBubblePopSound(){if(this.initialized)try{const t=300+400*Math.random(),e=this.audioContext.createOscillator();e.type="sine",e.frequency.setValueAtTime(t,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(.5*t,this.audioContext.currentTime+.08);const i=this.audioContext.createGain();i.gain.setValueAtTime(.08*this.masterVolume,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.08),e.connect(i),i.connect(this.audioContext.destination),e.start(),e.stop(this.audioContext.currentTime+.08)}catch(t){console.error("Error playing bubble pop sound:",t)}}playMenuHoverSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(600,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.1);const e=this.audioContext.createGain();e.gain.setValueAtTime(.05*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.1)}catch(t){console.error("Error playing menu hover sound:",t)}}playMenuSelectSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.value=523.25;const e=this.audioContext.createOscillator();e.type="sine",e.frequency.value=659.25;const i=this.audioContext.createOscillator();i.type="sine",i.frequency.value=783.99;const s=this.audioContext.createGain();s.gain.setValueAtTime(.12*this.masterVolume,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.4),t.connect(s),e.connect(s),i.connect(s),s.connect(this.audioContext.destination),t.start(),e.start(),i.start(),t.stop(this.audioContext.currentTime+.4),e.stop(this.audioContext.currentTime+.4),i.stop(this.audioContext.currentTime+.4)}catch(t){console.error("Error playing menu select sound:",t)}}playTooksSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(300,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(250,this.audioContext.currentTime+.15);const e=this.audioContext.createGain();e.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15);const i=this.audioContext.createOscillator();i.type="square",i.frequency.setValueAtTime(1200,this.audioContext.currentTime+.12),i.frequency.exponentialRampToValueAtTime(2e3,this.audioContext.currentTime+.18);const s=this.audioContext.createGain();s.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime+.12),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.25);const l=this.audioContext.createBufferSource(),a=.1*this.audioContext.sampleRate,o=this.audioContext.createBuffer(1,a,this.audioContext.sampleRate),n=o.getChannelData(0);for(let c=0;c<a;c++)n[c]=2*Math.random()-1;l.buffer=o;const r=this.audioContext.createBiquadFilter();r.type="highpass",r.frequency.value=3e3;const h=this.audioContext.createGain();h.gain.setValueAtTime(.12*this.masterVolume,this.audioContext.currentTime+.15),h.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.25),t.connect(e),e.connect(this.audioContext.destination),i.connect(s),s.connect(this.audioContext.destination),l.connect(r),r.connect(h),h.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.15),i.start(this.audioContext.currentTime+.12),i.stop(this.audioContext.currentTime+.25),l.start(this.audioContext.currentTime+.15)}catch(t){console.error("Error playing tooks sound:",t)}}playPingSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(1800,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(1200,this.audioContext.currentTime+.3),e.gain.setValueAtTime(.18*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.3)}playChipeSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(1400,this.audioContext.currentTime+.08);const e=this.audioContext.createGain();e.gain.setValueAtTime(.12*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.08),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.08)}catch(t){console.error("Error playing chipe sound:",t)}}playChiouaSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(400,this.audioContext.currentTime),t.frequency.linearRampToValueAtTime(500,this.audioContext.currentTime+.05);const e=this.audioContext.createGain();e.gain.setValueAtTime(.08*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.05),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.05)}catch(t){console.error("Error playing chioua sound:",t)}}playClickThouSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(600,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(200,this.audioContext.currentTime+.3);const e=this.audioContext.createOscillator();e.type="triangle",e.frequency.setValueAtTime(400,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(150,this.audioContext.currentTime+.3);const i=this.audioContext.createGain();i.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),t.connect(i),e.connect(i),i.connect(this.audioContext.destination),t.start(),e.start(),t.stop(this.audioContext.currentTime+.3),e.stop(this.audioContext.currentTime+.3)}catch(t){console.error("Error playing click thouu sound:",t)}}play8BitGraphicsJingle(){if(this.initialized)try{const t=this.audioContext.currentTime,e=.15,i=[{freq:220,time:0,duration:2*e},{freq:196,time:2*e,duration:2*e},{freq:165,time:4*e,duration:2*e},{freq:220,time:6*e,duration:2*e},{freq:196,time:8*e,duration:2*e},{freq:165,time:10*e,duration:2*e}];[{freq:880,time:0,duration:.8*e},{freq:880,time:1*e,duration:.8*e},{freq:880,time:1.5*e,duration:.8*e},{freq:1047,time:2.5*e,duration:.6*e},{freq:880,time:3*e,duration:.8*e},{freq:523,time:4*e,duration:e},{freq:523,time:5*e,duration:e},{freq:880,time:6*e,duration:.8*e},{freq:880,time:6.5*e,duration:.8*e},{freq:880,time:7*e,duration:.8*e},{freq:880,time:7.5*e,duration:.8*e},{freq:698,time:8.5*e,duration:e},{freq:784,time:9.5*e,duration:.8*e},{freq:659,time:10.5*e,duration:1.5*e}].forEach(e=>{const i=this.audioContext.createOscillator();i.type="square",i.frequency.value=e.freq;const s=this.audioContext.createGain();s.gain.setValueAtTime(0,t+e.time),s.gain.linearRampToValueAtTime(.12*this.masterVolume,t+e.time+.01),s.gain.exponentialRampToValueAtTime(.01,t+e.time+e.duration),i.connect(s),s.connect(this.audioContext.destination),i.start(t+e.time),i.stop(t+e.time+e.duration)}),i.forEach(e=>{const i=this.audioContext.createOscillator();i.type="triangle",i.frequency.value=e.freq;const s=this.audioContext.createGain();s.gain.setValueAtTime(0,t+e.time),s.gain.linearRampToValueAtTime(.08*this.masterVolume,t+e.time+.01),s.gain.exponentialRampToValueAtTime(.01,t+e.time+e.duration),i.connect(s),s.connect(this.audioContext.destination),i.start(t+e.time),i.stop(t+e.time+e.duration)})}catch(t){console.error("Error playing 8bit jingle:",t)}}playTokeSound(){if(this.initialized)try{const t=this.audioContext.createOscillator();t.type="sine",t.frequency.setValueAtTime(900,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(700,this.audioContext.currentTime+.06);const e=this.audioContext.createGain();e.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.06),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.06)}catch(t){console.error("Error playing toke sound:",t)}}ploqueSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(220,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(120,this.audioContext.currentTime+.12),e.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.12),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.12)}playBossHitSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createOscillator(),i=this.audioContext.createGain();t.type="square",t.frequency.setValueAtTime(1200,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.12),e.type="square",e.frequency.setValueAtTime(1800,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(1200,this.audioContext.currentTime+.12),i.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.12),t.connect(i),e.connect(i),i.connect(this.audioContext.destination),t.start(),e.start(),t.stop(this.audioContext.currentTime+.12),e.stop(this.audioContext.currentTime+.12)}playPafSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="square",t.frequency.setValueAtTime(1500,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(1e3,this.audioContext.currentTime+.06),e.gain.setValueAtTime(.18*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.06),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.06)}playPofSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(400,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(200,this.audioContext.currentTime+.08),e.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.08),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.08)}playPifSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="triangle",t.frequency.setValueAtTime(1e3,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(700,this.audioContext.currentTime+.07),e.gain.setValueAtTime(.19*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.07),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.07)}playObstacleSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(900,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(600,this.audioContext.currentTime+.08),e.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.08),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.08)}playAmbientDrone(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();return t.type="sine",t.frequency.setValueAtTime(40,this.audioContext.currentTime),e.type="sine",e.frequency.setValueAtTime(40.5,this.audioContext.currentTime),s.type="lowpass",s.frequency.setValueAtTime(150,this.audioContext.currentTime),i.gain.setValueAtTime(0,this.audioContext.currentTime),i.gain.linearRampToValueAtTime(.08*this.masterVolume,this.audioContext.currentTime+2),t.connect(s),e.connect(s),s.connect(i),i.connect(this.audioContext.destination),t.start(),e.start(),{oscillators:[t,e],gainNode:i,stop:()=>{i.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+3),setTimeout(()=>{t.stop(),e.stop()},3e3)}}}playBossRoar(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.type="sawtooth",t.frequency.setValueAtTime(50,this.audioContext.currentTime),t.frequency.linearRampToValueAtTime(45,this.audioContext.currentTime+.5),t.frequency.linearRampToValueAtTime(55,this.audioContext.currentTime+1),i.type="lowpass",i.frequency.setValueAtTime(300,this.audioContext.currentTime),i.Q.setValueAtTime(2,this.audioContext.currentTime),e.gain.setValueAtTime(0,this.audioContext.currentTime),e.gain.linearRampToValueAtTime(.2*this.masterVolume,this.audioContext.currentTime+.2),e.gain.linearRampToValueAtTime(.15*this.masterVolume,this.audioContext.currentTime+.8),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.2),t.connect(i),i.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+1.2)}playDeathSound(){if(!this.initialized)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(200,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(30,this.audioContext.currentTime+1),e.gain.setValueAtTime(.18*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+1)}playPoufSound(){if(this.initialized)try{const t=this.audioContext.createOscillator(),e=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.type="sine",t.frequency.setValueAtTime(60,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(20,this.audioContext.currentTime+.8),i.type="lowpass",i.frequency.setValueAtTime(200,this.audioContext.currentTime),e.gain.setValueAtTime(.25*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.8),t.connect(i),i.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.8);const s=this.audioContext.createOscillator(),l=this.audioContext.createGain();s.type="triangle",s.frequency.setValueAtTime(40,this.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(15,this.audioContext.currentTime+.7),l.gain.setValueAtTime(.15*this.masterVolume,this.audioContext.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.7),s.connect(l),l.connect(this.audioContext.destination),s.start(),s.stop(this.audioContext.currentTime+.7)}catch(t){console.error("Erreur son pouf:",t)}}playPameSound(){if(this.initialized)try{const t=this.audioContext.createOscillator(),e=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.type="sine",t.frequency.setValueAtTime(40,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(15,this.audioContext.currentTime+1.2),i.type="lowpass",i.frequency.setValueAtTime(150,this.audioContext.currentTime),e.gain.setValueAtTime(.3*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.2),t.connect(i),i.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+1.2);const s=this.audioContext.createOscillator(),l=this.audioContext.createGain();s.type="triangle",s.frequency.setValueAtTime(25,this.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(10,this.audioContext.currentTime+1),l.gain.setValueAtTime(.2*this.masterVolume,this.audioContext.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1),s.connect(l),l.connect(this.audioContext.destination),s.start(),s.stop(this.audioContext.currentTime+1);const a=this.audioContext.createOscillator(),o=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();a.type="sawtooth",a.frequency.setValueAtTime(30,this.audioContext.currentTime),a.frequency.exponentialRampToValueAtTime(12,this.audioContext.currentTime+1.5),n.type="lowpass",n.frequency.setValueAtTime(100,this.audioContext.currentTime),n.Q.setValueAtTime(2,this.audioContext.currentTime),o.gain.setValueAtTime(.18*this.masterVolume,this.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.5),a.connect(n),n.connect(o),o.connect(this.audioContext.destination),a.start(),a.stop(this.audioContext.currentTime+1.5)}catch(t){console.error("Erreur son pame:",t)}}playFuzzeSound(){if(this.initialized)try{const t=this.audioContext.createOscillator(),e=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.type="sawtooth",t.frequency.setValueAtTime(180,this.audioContext.currentTime),t.frequency.linearRampToValueAtTime(120,this.audioContext.currentTime+.08),i.type="bandpass",i.frequency.setValueAtTime(400,this.audioContext.currentTime),i.Q.setValueAtTime(5,this.audioContext.currentTime),e.gain.setValueAtTime(.12*this.masterVolume,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.08),t.connect(i),i.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.08)}catch(t){console.error("Erreur son fuzze:",t)}}setMasterVolume(t){this.masterVolume=Math.max(0,Math.min(1,t))}stopAll(){this.activeOscillators.forEach(t=>{try{t.stop()}catch(e){}}),this.activeOscillators=[]}};new nt;class rt{constructor(){this.currentScore=0,this.highScores=this.loadHighScores(),this.maxScore=this.loadMaxScore(),this.totalXP=this.loadTotalXP()}addPoints(t,e=1){this.currentScore+=Math.floor(t*e),this.currentScore>this.maxScore&&(this.maxScore=this.currentScore,this.saveMaxScore(this.maxScore))}addXP(t){this.totalXP+=t,this.saveTotalXP(this.totalXP)}loadMaxScore(){const t=localStorage.getItem("xsheep_maxScore");return t?parseInt(t):0}saveMaxScore(t){localStorage.setItem("xsheep_maxScore",t.toString()),console.log("üíæ saveMaxScore:",t,"| localStorage:",localStorage.getItem("xsheep_maxScore"))}loadTotalXP(){const t=localStorage.getItem("xsheep_totalXP");return t?parseInt(t):0}saveTotalXP(t){localStorage.setItem("xsheep_totalXP",t.toString())}getMaxScore(){return this.maxScore}getTotalXP(){return this.totalXP}loadAdventureScore(){const t=localStorage.getItem("xsheep_adventureScore");return t?parseInt(t):0}saveAdventureScore(t){localStorage.setItem("xsheep_adventureScore",t.toString()),console.log("üíæ saveAdventureScore:",t,"| localStorage:",localStorage.getItem("xsheep_adventureScore"))}addAdventureScore(t){const e=this.loadAdventureScore(),i=e+t;return console.log("üéØ addAdventureScore: +",t,"| Avant:",e,"| Apr√®s:",i),this.saveAdventureScore(i),i}loadHighScores(){const t=localStorage.getItem("moutonCourageLeaderboard");return t?JSON.parse(t):[]}saveHighScore(t,e="Anonymous"){const i={score:t,name:e,date:(new Date).toISOString()};this.highScores.push(i),this.highScores.sort((t,e)=>e.score-t.score),this.highScores=this.highScores.slice(0,10),localStorage.setItem("moutonCourageLeaderboard",JSON.stringify(this.highScores))}getLeaderboard(){return this.highScores}}class ht{constructor(t,e){this.x=t,this.y=e,this.width=40,this.height=120,this.rotation=0,this.rotationSpeed=.02,this.beamActive=!0,this.blinkTimer=0,this.blinkDuration=120}update(){this.rotation+=this.rotationSpeed,this.rotation>2*Math.PI&&(this.rotation=0),this.blinkTimer++,this.blinkTimer>=this.blinkDuration&&(this.blinkTimer=0)}render(t){const e=this.blinkTimer<this.blinkDuration/2?1:.5;if(this.beamActive){t.save(),t.translate(this.x+this.width/2,this.y+30),t.rotate(this.rotation);const i=t.createLinearGradient(0,0,600,0);i.addColorStop(0,`rgba(255, 255, 200, ${.4*e})`),i.addColorStop(.5,`rgba(255, 255, 150, ${.2*e})`),i.addColorStop(1,"rgba(255, 255, 100, 0)"),t.fillStyle=i,t.beginPath(),t.moveTo(0,0),t.lineTo(600,-80),t.lineTo(600,80),t.closePath(),t.fill(),t.restore()}t.save(),t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.ellipse(this.x+this.width/2,this.y+this.height+35,this.width+25,8,0,0,2*Math.PI),t.fill(),t.fillStyle="#4A4A4A",t.beginPath(),t.moveTo(this.x-20,this.y+this.height+30),t.lineTo(this.x-15,this.y+this.height),t.lineTo(this.x-5,this.y+this.height-10),t.lineTo(this.x+10,this.y+this.height-5),t.lineTo(this.x+this.width-10,this.y+this.height-5),t.lineTo(this.x+this.width+5,this.y+this.height-10),t.lineTo(this.x+this.width+15,this.y+this.height),t.lineTo(this.x+this.width+20,this.y+this.height+30),t.closePath(),t.fill(),t.strokeStyle="#2A2A2A",t.lineWidth=2,t.beginPath(),t.moveTo(this.x-10,this.y+this.height+10),t.lineTo(this.x-5,this.y+this.height+20),t.stroke(),t.beginPath(),t.moveTo(this.x+this.width+10,this.y+this.height+15),t.lineTo(this.x+this.width+5,this.y+this.height+25),t.stroke(),t.fillStyle="#6A6A6A",t.beginPath(),t.moveTo(this.x+5,this.y+this.height),t.lineTo(this.x+15,this.y+this.height-5),t.lineTo(this.x+25,this.y+this.height+5),t.closePath(),t.fill(),t.restore(),t.fillStyle="#5A5A5A",t.fillRect(this.x-5,this.y+this.height-5,this.width+10,10);const i=this.height/6;for(let s=0;s<6;s++)t.fillStyle=s%2==0?"#FFFFFF":"#DC143C",t.fillRect(this.x,this.y+this.height-(s+1)*i,this.width,i);t.strokeStyle="#1C1C1C",t.lineWidth=2,t.strokeRect(this.x,this.y,this.width,this.height),t.fillStyle="#8B0000",t.beginPath(),t.moveTo(this.x-5,this.y),t.lineTo(this.x+this.width/2,this.y-15),t.lineTo(this.x+this.width+5,this.y),t.closePath(),t.fill(),t.stroke();t.fillStyle=this.blinkTimer<this.blinkDuration/2?"#FFFF88":"#FFCC66",t.fillRect(this.x+5,this.y+5,this.width-10,25),t.strokeStyle="#333333",t.lineWidth=1;for(let s=1;s<4;s++){const e=this.x+5+(this.width-10)*(s/4);t.beginPath(),t.moveTo(e,this.y+5),t.lineTo(e,this.y+5+25),t.stroke()}if(this.blinkTimer<this.blinkDuration/2){const e=t.createRadialGradient(this.x+this.width/2,this.y+15,10,this.x+this.width/2,this.y+15,60);e.addColorStop(0,"rgba(255, 255, 200, 0.6)"),e.addColorStop(1,"rgba(255, 255, 100, 0)"),t.fillStyle=e,t.fillRect(this.x-30,this.y-30,this.width+60,80)}}}class ct{static createWave(t,e){return{type:"wave",x:t,y:e,width:80,height:60,speed:.4,amplitude:15,phase:Math.random()*Math.PI*2,damage:0,icon:"üåä"}}static createRock(t,e){return{type:"rock",x:t,y:e,width:50,height:50,speed:.4,damage:1,icon:"ü™®",rotation:Math.random()*Math.PI*2}}static createJellyfish(t,e){return{type:"jellyfish",x:t,y:e,width:40,height:60,speed:.3,damage:0,icon:"ü™º",bobPhase:Math.random()*Math.PI*2,tentacles:!0}}static createShark(t,e){return{type:"shark",x:t,y:256,width:100,height:50,speed:.3,damage:0,icon:"ü¶à",aggressive:!0}}static createWhirlpool(t,e){return{type:"whirlpool",x:t,y:e,width:120,height:120,speed:.2,damage:0,rotation:0,pullForce:.5,icon:"üåÄ"}}static createSiren(t,e){return{type:"siren",x:t,y:e,width:40,height:60,speed:.3,damage:0,icon:"üßú‚Äç‚ôÄÔ∏è",singing:!1,charmRadius:100}}static getRandom(t,e){const i=t+50,s=200+200*Math.random(),l=Math.random();return l<.45?this.createWave(i,s):l<.7?this.createJellyfish(i,s):l<.8?this.createWhirlpool(i,s):l<.88?this.createSiren(i,s):l<.96?this.createRock(i,s):this.createShark(i,s)}}class dt{constructor(t,e){this.x=t,this.y=e/2,this.width=200,this.height=150,this.speed=.5,this.health=5,this.maxHealth=5,this.phase=0,this.attackTimer=0,this.attackCooldown=360,this.isActive=!1,this.defeated=!1}update(t){if(this.isActive&&!this.defeated){switch(this.phase){case 0:this.x-=this.speed,this.y+=2*Math.sin(.002*Date.now()),this.x<600&&(this.phase=1);break;case 1:if(this.attackTimer++,this.y+=3*Math.sin(.003*Date.now()),this.y=Math.max(200,Math.min(400,this.y)),this.x>500?this.x-=.5:this.x<400&&(this.x+=.5),this.attackTimer>=this.attackCooldown)return this.attackTimer=0,this.spawnProjectile();break;case 2:this.x+=2*this.speed,this.y+=4*Math.sin(.005*Date.now())}return null}}spawnProjectile(){return{type:"waterjet",x:this.x,y:this.y+this.height/2,width:30,height:30,speed:2,damage:1,icon:"üíß",velX:-2,velY:0}}takeDamage(t){return!this.defeated&&(this.health-=t,this.health<=0&&(this.health=0,this.defeated=!0,this.phase=2,!0))}checkCollision(t){const e=this.x+this.width/2-t.x,i=this.y+this.height/2-t.y;return Math.sqrt(e*e+i*i)<this.width/2+30}render(t){if(!this.isActive||this.defeated)return;t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(this.x-10,this.y+this.height-10,this.width+20,20),t.save();for(let a=0;a<5;a++){const e=this.x+40*a,i=10*Math.sin(.003*Date.now()+.5*a);t.fillStyle=a%2==0?"#1A5F7A":"#2C7A9B",t.beginPath(),t.arc(e,this.y+i,35,0,2*Math.PI),t.fill(),t.strokeStyle="#0D3B52",t.lineWidth=3,t.stroke()}t.fillStyle="#1A5F7A",t.beginPath(),t.ellipse(this.x,this.y,50,40,0,0,2*Math.PI),t.fill(),t.strokeStyle="#0D3B52",t.lineWidth=3,t.stroke(),t.fillStyle="#FF0000",t.beginPath(),t.arc(this.x-15,this.y-10,8,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(this.x-15,this.y+10,8,0,2*Math.PI),t.fill(),t.fillStyle="#000000",t.beginPath(),t.arc(this.x-15,this.y-10,4,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(this.x-15,this.y+10,4,0,2*Math.PI),t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.beginPath(),t.moveTo(this.x-40,this.y),t.lineTo(this.x-30,this.y-5),t.stroke(),t.fillStyle="#FFFFFF";for(let a=0;a<3;a++)t.beginPath(),t.moveTo(this.x-35+5*a,this.y-5),t.lineTo(this.x-33+5*a,this.y+5),t.lineTo(this.x-37+5*a,this.y-5),t.closePath(),t.fill();t.restore();const e=150,i=this.x+this.width/2-75,s=this.y-50;t.fillStyle="#333333",t.fillRect(i,s,e,10),t.fillStyle=this.health>3?"#00FF00":"#FF0000";const l=this.health/this.maxHealth*e;t.fillRect(i,s,l,10),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.strokeRect(i,s,e,10),t.fillStyle="#FFFFFF",t.font="bold 16px Arial",t.textAlign="center",t.fillText("üêâ L√âVIATHAN",this.x+this.width/2,s-10)}}class ut{constructor(t,e=null,i=null){this.mode=t,this.canvas=null,this.ctx=null,this.running=!1,this.paused=!1,this.currentLevel=parseInt(localStorage.getItem("xsheep_currentLevel")||"1"),this.audioManager=i||new AudioManager,this.player=null,this.obstacleManager=null,this.powerUpManager=null,this.narrativeEngine=null,this.trophySystem=e||new I,this.notificationSystem=null,this.renderer=null,this.inputManager=null,this.endlessMode=null,this.heavenGate=null,this.waterTankSystem=null,this.laserSystem=null,this.introSequence=null,this.bossCommentTimer=0,this.currentBossComment=null,this.bossCommentDuration=0,this.score=0,this.obstaclesCleared=0,this.gameSpeed=a,this.autoSaveInterval=null,this.lastAutoSave=Date.now(),this.AUTO_SAVE_DELAY=12e4,this.gameOverAnimation=!1,this.gameOverTimer=0,this.gameOverPhase="flying",this.rejectionBubble=null,this.victoryAnimation=!1,this.victoryTimer=0,this.victoryPhase="celebration",this.victoryScreenActive=!1,this.victoryScreenData=null,this.victoryButtons=null,this.victoryClickHandler=null,this.level2Active=!1,this.level2Timer=0,this.level2SpawnRate=120,this.level2Survived=0,this.level3Active=!1,this.level3Timer=0,this.level3Proverbs=[],this.level3Wisdom=0,this.level3SpawnRate=480,this.level3ObstacleSpawnRate=480,this.level3ObstacleTimer=0,this.level3Obstacles=[],this.level3Projectiles=[],this.boatMode=!1,this.level3Entering=!1,this.level3EnterTimer=0,this.lighthouse=null,this.leviathan=null,this.leviathanDefeated=!1,this.sharkBossPause=0,this.screenShake=0,this.screenShakeIntensity=0,this.icebergSinking=!1,this.sinkingTimer=0,this.sinkingIceberg=null,this.init()}init(){console.log(`üéÆ Initialisation du jeu - Mode: ${this.mode}`),this.audioManager.init(),this.setupCanvas(),this.player=new g(this),this.obstacleManager=new C(this),this.powerUpManager=new k(this),this.narrativeEngine=new E(this),this.notificationSystem=new st(this),this.renderer=new W(this),this.inputManager=new N(this),this.waterTankSystem=new et(this),this.laserSystem=new it(this),this.frameCount=0,"endless"===this.mode?(this.endlessMode=new Z(this),this.introSequence=new ot(this),this.player.y=s/2,this.player.flying=!0,this.player.fuel=this.player.maxFuel,this.audioManager&&setTimeout(()=>{this.audioManager.startRocketSound(),this.player.rocketSoundActive=!0},100)):(this.heavenGate=new tt(this),this.heavenGate.visible=!1),console.log("‚úÖ Jeu initialis√© !")}setupCanvas(){this.canvas=document.getElementById("game-canvas"),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="game-canvas",document.body.appendChild(this.canvas)),this.canvas.width=i,this.canvas.height=s,this.ctx=this.canvas.getContext("2d"),this.canvas.style.display="block",this.canvas.style.position="absolute",this.canvas.style.top="50%",this.canvas.style.left="50%",this.canvas.style.transform="translate(-50%, -50%)",this.canvas.style.maxWidth="100vw",this.canvas.style.maxHeight="100vh",this.canvas.style.width="auto",this.canvas.style.height="auto",this.canvas.style.objectFit="contain",this.canvas.style.border="2px solid #333",this.canvas.style.boxShadow="0 10px 30px rgba(0,0,0,0.3)",this.setupMobileFullscreen();const t=document.getElementById("molecular-canvas");t&&(t.style.display="none")}setupMobileFullscreen(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const t=async()=>{const t=document.documentElement;try{t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen(),setTimeout(()=>{screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape").catch(t=>{console.log("Orientation lock non support√©:",t)})},100)}catch(e){console.log("Fullscreen √©chou√©:",e)}},e=()=>{const t=window.innerWidth>window.innerHeight;!t&&document.fullscreenElement&&console.log("‚ö†Ô∏è Orientation portrait d√©tect√©e - Tournez votre appareil"),console.log(`üì± Orientation: ${t?"Paysage":"Portrait"} (${window.innerWidth}x${window.innerHeight})`)};screen.orientation&&screen.orientation.addEventListener("change",e),window.addEventListener("orientationchange",e),window.addEventListener("resize",e),document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(console.log("‚úÖ Plein √©cran activ√©"),e()):console.log("‚ùå Plein √©cran quitt√©")});const i=()=>{t()};document.addEventListener("touchstart",i,{once:!0}),document.addEventListener("click",i,{once:!0}),e(),console.log("üì± Mode mobile: Plein √©cran activ√© au prochain tap")}}start(){console.log("üöÄ D√©marrage du jeu..."),this.audioManager&&this.audioManager.initialized?(console.log("üéµ Tentative de d√©marrage de la musique niveau 1"),this.audioManager.startBackgroundMusic()):console.warn("‚ö†Ô∏è AudioManager non initialis√© au d√©marrage du niveau 1"),this.startAutoSave(),this.setupDebugKeys(),"endless"===this.mode&&this.introSequence?(this.introSequence.start(),this.running=!0,this.gameLoop()):(this.running=!0,this.gameLoop())}setupDebugKeys(){document.addEventListener("keydown",t=>{"("===t.key&&(console.log("üß™ TEST: Affichage victoire impatiente"),this.heavenGate&&(this.heavenGate.victoryScreenActive=!0,this.paused=!0,this.heavenGate.continueButton||(this.heavenGate.continueButton={x:this.canvas.width/2-100,y:this.canvas.height/2+180,width:200,height:40,text:p.t("game.messages.quickVictory")}),this.canvas.removeEventListener("click",this.heavenGate.handleClick),this.canvas.addEventListener("click",this.heavenGate.handleClick))),")"===t.key&&(console.log("üß™ TEST: Affichage victoire compl√®te"),this.victoryScreenActive=!0,this.victoryScreenData={score:this.score||12345,obstaclesCleared:this.obstaclesCleared||42},this.paused=!0,this.victoryButtons={continue:{x:this.canvas.width/2-100,y:this.canvas.height-120,width:200,height:40,text:p.t("game.buttons.continue")},menu:{x:this.canvas.width/2-100,y:this.canvas.height-70,width:200,height:40,text:p.t("game.buttons.menu")}},this.victoryClickHandler=this.handleVictoryClick.bind(this),this.canvas.addEventListener("click",this.victoryClickHandler))})}startGame(){console.log("üé¨ Intro termin√©e, jeu commence !"),this.running=!0}pause(){this.paused=!0}resume(){this.paused=!1,this.gameLoop()}startAutoSave(){this.autoSaveInterval=setInterval(()=>{this.autoSaveScore()},this.AUTO_SAVE_DELAY),console.log("üíæ Sauvegarde automatique activ√©e (toutes les 2min)")}stopAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null,console.log("‚èπÔ∏è Sauvegarde automatique arr√™t√©e"))}autoSaveScore(){const t=Date.now();t-this.lastAutoSave>=this.AUTO_SAVE_DELAY&&(this.saveCurrentScore(),this.lastAutoSave=t,console.log("üíæ Sauvegarde automatique effectu√©e"))}saveCurrentScore(){const t=new rt;if("adventure"===this.mode){const t=this.obstacleManager?this.obstacleManager.totalXP:0,e=this.score+t;localStorage.setItem("xsheep_lastAdventureScore",e.toString()),console.log("üíæ Score aventure sauvegard√©:",this.score,"+ XP:",t,"= Total:",e)}else if("endless"===this.mode){const e=t.loadMaxScore();this.score>e&&(t.saveMaxScore(this.score),console.log("üíæ Nouveau record infini sauvegard√©:",this.score))}}gameLoop(){const t=this.heavenGate&&this.heavenGate.victoryScreenActive;(this.running||this.gameOverAnimation||this.victoryAnimation||this.victoryScreenActive||t)&&(!this.paused||this.victoryScreenActive||t)&&(this.victoryScreenActive||t||this.update(),this.renderer.render(),this.victoryScreenActive&&this.renderVictoryScreen(this.ctx),t&&this.heavenGate.renderVictoryScreen(this.ctx),requestAnimationFrame(()=>this.gameLoop()))}update(){var t,e,i,s;if(this.introSequence&&this.introSequence.isActive())this.introSequence.update();else if(this.victoryAnimation)if(this.victoryTimer++,"celebration"===this.victoryPhase)this.victoryTimer%10==0&&this.renderer.addParticle(this.player.x+50*Math.random()-25,this.player.y+50*Math.random()-25,["‚ú®","üéâ","üéÜ","üåü","üíé"][Math.floor(5*Math.random())],"#FFD700"),this.player.y+=2*Math.sin(.2*this.victoryTimer),this.victoryTimer>120&&(this.victoryPhase="entering",this.victoryTimer=0);else if("entering"===this.victoryPhase){if(this.heavenGate){const t=this.heavenGate.x+this.heavenGate.width/2,e=this.heavenGate.y+this.heavenGate.height/2,i=t-this.player.x,s=e-this.player.y,l=Math.sqrt(i*i+s*s);l>20?(this.player.velX=i/l*6,this.player.velY=s/l*6):(this.player.velX*=.95,this.player.velY*=.95)}this.player.x+=this.player.velX,this.player.y+=this.player.velY,this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,this.player.y)),this.player.size=Math.max(.1,this.player.size-.015),this.victoryTimer%5==0&&this.renderer.addParticle(this.player.x,this.player.y,["‚ú®","üíé","ÔøΩ"][Math.floor(3*Math.random())],"#FFD700"),(this.victoryTimer>80||this.player.size<.15)&&(this.victoryPhase="heaven",this.victoryTimer=0)}else"heaven"===this.victoryPhase&&this.victoryTimer>60&&(this.running=!1,this.victoryAnimation=!1,this.showVictoryScreen());else if(this.gameOverAnimation){if(this.gameOverTimer++,"flying"===this.gameOverPhase){if(this.heavenGate){const t=this.heavenGate.x+this.heavenGate.width/2,e=this.heavenGate.y+this.heavenGate.height/2,i=t-this.player.x,s=e-this.player.y,l=Math.sqrt(i*i+s*s);l>50?(this.player.velX=i/l*5,this.player.velY=s/l*5):(this.player.velX*=.9,this.player.velY*=.9)}this.player.x+=this.player.velX,this.player.y+=this.player.velY,this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,this.player.y)),this.player.rotation=(this.player.rotation||0)+.05,this.gameOverTimer>120&&(this.gameOverPhase="entering",this.gameOverTimer=0,this.player.rotation=0)}else if("entering"===this.gameOverPhase){if(this.player.size=Math.max(.2,this.player.size-.03),this.heavenGate){const t=this.heavenGate.x+this.heavenGate.width/2;this.player.x+=.05*(t-this.player.x)}this.gameOverTimer%5==0&&this.renderer.addParticle(this.player.x,this.player.y,["‚ú®","‚≠ê","üí´"][Math.floor(3*Math.random())],"#FFD700"),this.gameOverTimer>40&&(this.gameOverPhase="rejected",this.gameOverTimer=0,this.rejectionBubble={x:this.player.x,y:this.player.y-60,text:p.t("game.messages.quickVictory"),opacity:1},console.log("üö´ Rejet√© du Paradis !"))}else if("rejected"===this.gameOverPhase)0===this.gameOverTimer&&(this.player.velX=-20,this.player.velY=-8),this.player.velY+=.5,this.player.x+=this.player.velX,this.player.y+=this.player.velY,this.player.velX*=.98,this.player.rotation=(this.player.rotation||0)+.2,this.player.size=Math.min(1,this.player.size+.04),this.player.y>=this.player.groundY&&(this.player.y=this.player.groundY,this.player.velY=0,this.player.velX=0,this.player.rotation=0,this.gameOverPhase="reading",this.gameOverTimer=0),this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.player.y<0&&(this.player.y=0),this.rejectionBubble&&(this.rejectionBubble.x=this.player.x,this.rejectionBubble.y=this.player.y-60),this.gameOverTimer<20&&this.gameOverTimer%3==0&&this.renderer.addParticle(this.player.x,this.player.y,"üí•","#FF0000");else if("reading"===this.gameOverPhase)this.rejectionBubble&&(this.rejectionBubble.x=this.player.x,this.rejectionBubble.y=this.player.y-60,this.rejectionBubble.opacity=1),this.gameOverTimer>180&&("endless"===this.mode?(this.gameOverPhase="refusing",this.gameOverTimer=0,this.rejectionBubble={x:this.player.x,y:this.player.y-60,text:p.t("game.messages.notFinished"),opacity:1}):(this.gameOverPhase="exiting",this.gameOverTimer=0));else if("refusing"===this.gameOverPhase)this.rejectionBubble&&(this.rejectionBubble.x=this.player.x,this.rejectionBubble.y=this.player.y-60,this.rejectionBubble.opacity=1),this.gameOverTimer>120&&(this.gameOverPhase="restarting",this.gameOverTimer=0);else if("restarting"===this.gameOverPhase){if(this.rejectionBubble&&(this.rejectionBubble.opacity=Math.max(0,this.rejectionBubble.opacity-.05)),0===this.gameOverTimer)for(let t=0;t<30;t++)this.renderer.addParticle(Math.random()*this.canvas.width,Math.random()*this.canvas.height,["‚ú®","üí´","‚≠ê"][Math.floor(3*Math.random())],"#FFFFFF");this.gameOverTimer>60&&this.restartEndlessMode()}else if("exiting"===this.gameOverPhase){if(this.heavenGate){const t=this.heavenGate.y+this.heavenGate.height/2;this.player.velY=.05*(t-this.player.y),this.player.y+=this.player.velY,this.player.velX=3,this.player.x+=this.player.velX}this.rejectionBubble&&(this.rejectionBubble.opacity=Math.max(0,this.rejectionBubble.opacity-.02)),this.player.x>this.canvas.width&&(this.gameOverPhase="done",this.running=!1,this.gameOverAnimation=!1,this.player.rotation=0,setTimeout(()=>{"endless"===this.mode?this.endlessMode.showGameOver():this.showAdventureGameOver()},500))}}else if(this.level3Entering){if(this.level3EnterTimer++,this.heavenGate){const t=this.heavenGate.x+this.heavenGate.width/2-40,e=this.heavenGate.y+this.heavenGate.height/2,i=t-this.player.x,s=e-this.player.y,l=Math.sqrt(i*i+s*s);l>10?(this.player.velX=i/l*4,this.player.velY=s/l*4,this.player.x+=this.player.velX,this.player.y+=this.player.velY):this.player.size=Math.max(.1,this.player.size-.02),this.level3EnterTimer%5==0&&this.renderer.addParticle(this.player.x,this.player.y,["‚ú®","‚≠ê","üí´"][Math.floor(3*Math.random())],"#FFD700"),(this.player.size<.2||this.level3EnterTimer>180)&&this.showLevel3Victory()}}else{if(this.level3Active){if(this.level3Timer++,this.level3ObstacleTimer++,this.lighthouse&&this.lighthouse.update(),this.level3FirstProverbSpawned){if(this.level3Timer>=this.level3SpawnRate){const t=at.getRandom();this.level3Proverbs.push(t),this.level3Timer=0}}else{const t=at.getFirst();this.level3Proverbs.push(t),this.level3FirstProverbSpawned=!0}if(this.level3ObstacleTimer>=this.level3ObstacleSpawnRate&&!this.leviathan){const t=ct.getRandom(this.canvas.width,this.canvas.height);this.level3Obstacles.push(t),this.level3ObstacleTimer=0}if(this.level3Timer>3600&&!this.leviathan&&!this.leviathanDefeated&&(this.leviathan=new dt(this.canvas.width,this.canvas.height),this.leviathan.isActive=!0,this.audioManager&&this.audioManager.initialized&&this.audioManager.playLeviathanRoarSound(),this.notificationSystem&&this.notificationSystem.showNarrative({text:p.t("game.messages.leviathan"),duration:4e3}),this.level3ObstacleSpawnRate=200),this.leviathan&&this.leviathan.isActive){const t=this.leviathan.update(this.player);if(t&&(this.level3Projectiles.push(t),this.audioManager&&this.audioManager.initialized&&this.audioManager.playWaveSound()),this.leviathan.checkCollision(this.player)&&!this.player.invincible&&(this.player.lives-=1,this.player.invincible=!0,this.player.invincibleTimer=180,this.audioManager&&this.audioManager.initialized&&this.audioManager.playCollisionSound(),this.player.lives<=0))return void this.gameOver()}if(this.level3Projectiles.forEach((t,e)=>{t.x+=t.velX,t.y+=t.velY;const i=t.x-this.player.x,s=t.y-this.player.y;Math.sqrt(i*i+s*s)<40&&!this.player.invincible&&(this.player.lives-=t.damage,this.player.invincible=!0,this.player.invincibleTimer=60,t.hit=!0,this.audioManager&&this.audioManager.initialized&&this.audioManager.playCollisionSound(),this.player.lives<=0)&&this.gameOver()}),this.level3Projectiles=this.level3Projectiles.filter(t=>!t.hit&&t.x>-50&&t.x<this.canvas.width+50),this.player.update(),this.screenShake>0&&this.screenShake--,this.sharkBossPause>0)return this.sharkBossPause--,void this.level3Obstacles.forEach(t=>{t.sharkBoss&&t.sharkBoss.active&&(t.sharkBoss.frame++,t.sharkBoss.y+=t.sharkBoss.velY)});if(this.icebergSinking){if(this.sinkingTimer++,this.sinkingTimer<240)this.player.y+=1.5,this.player.rotation=this.sinkingTimer/240*(Math.PI/6),this.sinkingTimer%10==0&&this.renderer.addParticle(this.player.x+80*Math.random(),this.player.y+30*Math.random(),"üíß","#87CEEB");else{if(this.icebergSinking=!1,this.player.rotation=0,this.player.lives<=0)return void this.gameOver();this.player.y=100,this.player.velY=-10,this.player.parachuting=!0,this.player.parachuteTimer=480}return}return this.boatMode&&(this.player.x=Math.max(10,Math.min(this.canvas.width-90,this.player.x)),this.player.y=Math.max(50,Math.min(480,this.player.y))),this.level3Obstacles.forEach((t,e)=>{if(t.x-=t.speed,"whirlpool"===t.type){t.rotation+=.1;const e=t.x-this.player.x,i=t.y-this.player.y,s=Math.sqrt(e*e+i*i);if(s<2*t.width){const l=e/s*t.pullForce,a=i/s*t.pullForce;if(this.player.x+=l,this.player.y+=a,t.trapTimer||(t.trapTimer=0,this.player.whirlpoolScale=1,this.audioManager.playWhirlpoolSound()),s<60){t.trapTimer++;const e=t.trapTimer/120;if(this.player.whirlpoolScale=Math.max(.1,1-.9*e),this.player.rotation+=.05*(1-this.player.whirlpoolScale),t.trapTimer>=120){this.player.lives-=3,t.hit=!0;for(let e=0;e<30;e++)this.renderer.addParticle(t.x+80*(Math.random()-.5),t.y+80*(Math.random()-.5),"üí¶","#4A90A4");if(this.renderer.addParticle(t.x,t.y,"üå™Ô∏è","#87CEEB"),this.renderer.addParticle(t.x,t.y,"üí•","#FFFFFF"),this.player.x=t.x,this.player.y=t.y-50,this.player.velY=-18,this.player.velX=6*(Math.random()-.5),this.player.rotationSpeed=.2,this.player.flying=!1,this.player.parachuting=!0,this.player.parachuteTimer=480,this.player.whirlpoolScale=1,this.audioManager&&this.audioManager.initialized&&this.audioManager.playCollisionSound(),console.log("üå™Ô∏è Aspir√© et rejet√© par le tourbillon!"),this.player.lives<=0)return void this.gameOver();t.trapTimer=0}}}else t.trapTimer=0,void 0!==this.player.whirlpoolScale&&this.player.whirlpoolScale<1&&(this.player.whirlpoolScale=Math.min(1,this.player.whirlpoolScale+.05))}if("shark"===t.type){const e=t.x-this.player.x,i=t.y-this.player.y;if(Math.sqrt(e*e+i*i)<70?(t.trapTimer||(t.trapTimer=0,console.log("ü¶à D√©tection requin - Timer d√©marr√©")),t.trapTimer++,t.trapTimer>=60&&!t.bossTriggered&&(t.bossTriggered=!0,console.log("ü¶à BOSS REQUIN D√âCLENCH√â! Position:",this.player.x,this.player.y),this.audioManager.playSharkAttackSound(),this.sharkBossPause=120,this.screenShake=60,this.screenShakeIntensity=8,navigator.vibrate&&navigator.vibrate([200,100,200,100,300]),t.sharkBoss={x:this.player.x,y:this.canvas.height+200,width:300,height:400,velY:-4,active:!0,captured:!1,frame:0},console.log("ü¶à Boss requin d√©clench√©!"))):t.trapTimer=0,t.sharkBoss&&t.sharkBoss.active){const e=t.sharkBoss;if(console.log("ü¶à UPDATE BOSS:",e.y,"velY:",e.velY,"captured:",e.captured),e.frame++,e.captured&&(this.player.x=e.x,this.player.y=e.y-80,this.player.velX=0,this.player.velY=e.velY,this.player.rotation=.3*Math.sin(.1*e.frame)),e.y+=e.velY,!e.captured){if(Math.sqrt(Math.pow(e.x-this.player.x,2)+Math.pow(e.y-this.player.y,2))<150&&e.y>100&&e.y<500){e.captured=!0,this.player.lives-=3;for(let t=0;t<30;t++)this.renderer.addParticle(e.x+100*(Math.random()-.5),e.y+120*(Math.random()-.5),"üíß","#4A90A4");this.renderer.addParticle(e.x,e.y,"ü¶à","#2A5A7A"),this.audioManager&&this.audioManager.initialized&&(this.audioManager.playCollisionSound(),this.audioManager.playSplashSound()),console.log("ü¶à BATEAU CAPTUR√â! Le requin l'emporte vers le haut...")}}if(e.y<-200&&e.captured){for(let t=0;t<40;t++)this.renderer.addParticle(this.player.x+120*(Math.random()-.5),this.player.y+140*(Math.random()-.5),"üí¶","#87CEEB");if(this.renderer.addParticle(this.player.x,this.player.y,"üåä","#1E90FF"),this.player.velY=-15,this.player.velX=4*(Math.random()-.5),this.player.rotationSpeed=.15,this.player.flying=!1,this.player.parachuting=!0,this.player.parachuteTimer=480,e.active=!1,t.hit=!0,console.log("ü¶à Bateau rel√¢ch√© et retombe en tournant!"),this.player.lives<=0)return void this.gameOver()}e.y<-400&&(e.active=!1)}}else if("jellyfish"===t.type){const e=t.x-this.player.x,i=t.y-this.player.y;if(Math.sqrt(e*e+i*i)<50&&!t.hit&&!this.player.frozen){t.hit=!0,this.player.frozen=!0,this.player.frozenTimer=180,this.player.tentacleGrab=!0,this.player.jellyfishX=t.x,this.player.jellyfishY=t.y;for(let e=0;e<20;e++)this.renderer.addParticle(t.x+80*(Math.random()-.5),t.y+80*(Math.random()-.5),"üí¶","#FF69B4");this.renderer.addParticle(t.x,t.y,"üêô","#FF1493"),this.audioManager&&this.audioManager.initialized&&(this.audioManager.playCollisionSound(),this.audioManager.playSplashSound()),console.log("üêô Bateau immobilis√© par la pieuvre!")}}else if("rock"===t.type){const e=t.x-this.player.x,i=t.y-this.player.y;Math.sqrt(e*e+i*i)<60&&!t.hit&&!this.player.invincible&&(t.hit=!0,this.player.lives-=13,this.icebergSinking=!0,this.sinkingTimer=0,this.sinkingIceberg={x:t.x,y:t.y},this.audioManager&&this.audioManager.initialized&&(this.audioManager.playCollisionSound(),this.audioManager.playSplashSound()),console.log("üßä ICEBERG! Le bateau coule..."))}else if("siren"===t.type){const e=t.x-this.player.x,i=t.y-this.player.y;Math.sqrt(e*e+i*i)<t.charmRadius&&(this.player.velX*=.95,t.singing=!0)}else if("wave"===t.type){const e=t.x-this.player.x,i=t.y-this.player.y;if(Math.sqrt(e*e+i*i)<60&&!t.hit&&!this.player.invincible){this.player.lives-=1,this.player.invincible=!0,this.player.invincibleTimer=90,t.hit=!0,this.player.tangageTimer=180,this.player.tangageIntensity=.4;for(let e=0;e<15;e++)this.renderer.addParticle(t.x+60*(Math.random()-.5),t.y+40*(Math.random()-.5),"üí¶","#87CEEB");if(this.renderer.addParticle(t.x,t.y,"üåä","#4A90A4"),this.audioManager&&this.audioManager.initialized&&this.audioManager.playCollisionSound(),console.log("üåä Bateau tangu√© par la vague!"),this.player.lives<=0)return void this.gameOver()}}const i=t.x-this.player.x,s=t.y-this.player.y;Math.sqrt(i*i+s*s)<50&&!t.hit&&!this.player.invincible&&t.damage>0&&(this.player.lives-=t.damage,this.player.invincible=!0,this.player.invincibleTimer=90,t.hit=!0,this.audioManager&&this.audioManager.initialized&&this.audioManager.playCollisionSound(),this.renderer.addParticle(t.x,t.y,"üí•","#FF0000"),this.player.lives<=0)&&this.gameOver()}),this.level3Obstacles=this.level3Obstacles.filter(t=>!t.hit&&t.x>-150),this.level3Proverbs.forEach((t,e)=>{t.x-=t.speed,t.bobPhase+=.05,t.y+=.5*Math.sin(t.bobPhase);const i=this.player.x-10,s=this.player.x+80+10,l=this.player.y+20,a=this.player.y+30+20,o=this.player.x+40,n=this.player.x+40+35,r=this.player.y-30,h=this.player.y+18,c=t.x+20>i&&t.x-20<s&&t.y+20>l&&t.y-20<a,d=t.x+20>o&&t.x-20<n&&t.y+20>r&&t.y-20<h;!c&&!d||t.collected||(t.collected=!0,this.level3Wisdom+=t.wisdom||0,console.log(`üìñ Sagesse accumul√©e: ${this.level3Wisdom}/777`),this.audioManager&&this.audioManager.initialized&&this.audioManager.playPocSound(),this.player.lives=Math.min(this.player.maxLives,this.player.lives+1),this.renderer.addParticle(t.x,t.y,"üí¶","#4A90A4"),this.renderer.addParticle(t.x-10,t.y-10,"üíß","#87CEEB"),this.renderer.addParticle(t.x+10,t.y-10,"üíß","#87CEEB"),this.renderer.addParticle(t.x,t.y+10,"‚ú®","#FFD700"),this.notificationSystem&&this.notificationSystem.showSplash({x:this.canvas.width/2,y:80,icon:t.icon,text:t.text,color:"#4A90A4",duration:3e3}),console.log(`üìñ Proverbe collect√©! Vies: ${this.player.lives}/${this.player.maxLives}`),this.level3Wisdom>=777&&!this.heavenGate.visible&&this.triggerLevel3Victory())}),void(this.level3Proverbs=this.level3Proverbs.filter(t=>!t.collected&&t.x>-100))}if(this.level2Active){if(this.level2Timer++,this.level2Survived++,this.level2Timer>=this.level2SpawnRate){const t=lt.getRandom();this.obstacleManager.obstacles.push(t),this.level2Timer=0,this.level2SpawnRate=Math.max(60,this.level2SpawnRate-1)}this.player.update(),this.powerUpManager.update(),this.waterTankSystem.update();for(let t=this.obstacleManager.obstacles.length-1;t>=0;t--){const e=this.obstacleManager.obstacles[t];if(e.x-=this.gameSpeed,this.obstacleManager.checkCollision(e)&&"sin"===e.type){for(let t=0;t<e.damage;t++){if(!this.player.loseLife())return void this.gameOver()}this.obstacleManager.createExplosion(e.x+e.width/2,e.y+e.height/2),this.obstacleManager.obstacles.splice(t,1)}e.x<-100&&this.obstacleManager.obstacles.splice(t,1)}}else{if(this.player.update(),this.obstacleManager.update(),this.powerUpManager.update(),this.waterTankSystem.update(),this.laserSystem.update(),"endless"===this.mode&&this.laserSystem){((null==(t=this.inputManager.keyboard)?void 0:t.isFiring())||(null==(e=this.inputManager.mouse)?void 0:e.isFiring())||(null==(i=this.inputManager.touch)?void 0:i.isFiring()))&&this.laserSystem.fire()}this.frameCount++,"endless"===this.mode?this.endlessMode.update():null==(s=this.heavenGate)||s.update()}}}onObstacleCleared(t){if(this.obstaclesCleared++,this.score+=100,this.obstacleManager&&this.obstacleManager.addXP(10),console.log(`üéØ Obstacle surmont√©: ${t.id||"sans ID"}`),this.notificationSystem&&t.id){const e=this.narrativeEngine.getTranslatedMessage(t.id);console.log(`üìñ Recherche message pour: ${t.id}`,e?"‚úÖ Trouv√©":"‚ùå Pas trouv√©"),e&&e.hope&&(console.log(`üí≠ Affichage bulle: "${e.hope.substring(0,30)}..."`),this.notificationSystem.showNarrative({text:e.hope,duration:3e3,onClose:()=>{console.log("‚úÖ Bulle ferm√©e, appel onMessagePopped()"),this.obstacleManager&&this.obstacleManager.onMessagePopped()}}))}this.trophySystem.unlockTrophy(t.id)}gameOver(){console.log("üíÄ Game Over"),this.stopAutoSave(),this.saveCurrentScore(),console.log("üíæ Score sauvegard√© au game over"),this.level2Active?this.showGraceChoice():("endless"!==this.mode||this.heavenGate||(this.heavenGate=new tt(this)),console.log("üíÄ Game Over - Mont√©e au paradis..."),this.gameOverAnimation=!0,this.gameOverTimer=0,this.gameOverPhase="flying",this.rejectionBubble=null,this.heavenGate&&(this.heavenGate.visible=!0,this.heavenGate.x=Math.min(this.canvas.width-this.heavenGate.width-50,this.player.x+250),this.heavenGate.y=Math.max(50,Math.min(200,this.player.y-150)),console.log("üö™ La Porte du Paradis brille...")),this.player.flying=!1,this.player.parachuting=!1,this.player.velX=3,this.player.velY=-3)}showGraceChoice(){console.log("‚úùÔ∏è Choix de la Gr√¢ce..."),this.running=!1,this.level2Active=!1;const t=document.createElement("div");t.id="grace-choice-overlay",t.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.8);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            z-index: 10000;\n            font-family: 'Press Start 2P', monospace;\n        ";const e=document.createElement("div");e.textContent=p.t("game.level2.title"),e.style.cssText="\n            color: #FFD700;\n            font-size: 24px;\n            margin-bottom: 30px;\n            text-shadow: 0 0 10px #FFD700;\n        ";const i=document.createElement("div");i.textContent=p.t("game.level2.survived").replace("{seconds}",Math.floor(this.level2Survived/60)),i.style.cssText="\n            color: white;\n            font-size: 14px;\n            margin-bottom: 50px;\n        ";const s=document.createElement("div");s.style.cssText="\n            display: flex;\n            gap: 30px;\n        ";const l=document.createElement("button");l.textContent=p.t("game.level2.continue"),l.style.cssText="\n            font-family: 'Press Start 2P', monospace;\n            font-size: 16px;\n            padding: 20px 30px;\n            background: #4CAF50;\n            color: white;\n            border: 3px solid #45a049;\n            cursor: pointer;\n            text-shadow: 2px 2px #000;\n            box-shadow: 0 5px 15px rgba(0,0,0,0.5);\n        ",l.onmouseover=()=>l.style.background="#45a049",l.onmouseout=()=>l.style.background="#4CAF50",l.onclick=()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),document.body.removeChild(t),this.restartLevel2()};const a=document.createElement("button");a.textContent=p.t("game.level2.chooseGrace"),a.style.cssText="\n            font-family: 'Press Start 2P', monospace;\n            font-size: 16px;\n            padding: 20px 30px;\n            background: #FFD700;\n            color: #000;\n            border: 3px solid #FFA500;\n            cursor: pointer;\n            text-shadow: 2px 2px rgba(255,255,255,0.5);\n            box-shadow: 0 5px 15px rgba(255,215,0,0.5);\n        ",a.onmouseover=()=>a.style.background="#FFA500",a.onmouseout=()=>a.style.background="#FFD700",a.onclick=()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),document.body.removeChild(t),this.acceptGrace()},s.appendChild(l),s.appendChild(a),t.appendChild(e),t.appendChild(i),t.appendChild(s),document.body.appendChild(t)}restartLevel2(){console.log("üîÑ Red√©marrage Niveau 2"),this.player.lives=3,this.player.x=100,this.player.y=this.player.groundY,this.startLevel2(),this.running=!0,this.gameLoop()}acceptGrace(){console.log("‚úùÔ∏è Gr√¢ce accept√©e - Transition vers la Sagesse"),this.notificationSystem&&this.notificationSystem.showNarrative({text:p.t("game.levels.level3Title"),duration:3e3}),setTimeout(()=>{this.trophySystem&&(this.trophySystem.unlockTrophy("grace"),console.log("‚úùÔ∏è Troph√©e La gr√¢ce d√©bloqu√©!")),this.saveCurrentScore(),console.log("üíæ Score sauvegard√© √† la fin du niveau 2"),this.startLevel3()},3e3)}startLevel3(){console.log("üö§ NIVEAU 3: Navigation et Sagesse commence!"),this.audioManager&&this.audioManager.initialized?(console.log("üéµ Tentative de d√©marrage de la musique niveau 3"),this.audioManager.startBackgroundMusic()):console.warn("‚ö†Ô∏è AudioManager non initialis√© au d√©marrage du niveau 3"),this.currentLevel=3,localStorage.setItem("xsheep_currentLevel","3"),this.level3Active=!0,this.level2Active=!1,this.level3Timer=0,this.level3ObstacleTimer=0,this.level3Wisdom=0,this.level3FirstProverbSpawned=!1,this.level3Proverbs=[],this.level3Obstacles=[],this.level3Projectiles=[],this.boatMode=!0,this.leviathanDefeated=!1,this.notificationSystem&&this.notificationSystem.clearAll(),this.powerUpManager&&(this.powerUpManager.powerUps=[]),this.waterTankSystem&&(this.waterTankSystem.tanks=[]),this.renderer&&(this.renderer.particles=[],this.renderer.particleSystem&&(this.renderer.particleSystem.particles=[])),this.lighthouse=new ht(880,180),this.player.lives=3,this.player.x=100,this.player.y=380,this.player.velX=0,this.player.velY=0,this.obstacleManager.obstacles=[],this.obstacleManager.weapons=[],this.obstacleManager.bossLine=[],this.obstacleManager.projectiles=[],this.notificationSystem&&this.notificationSystem.showNarrative({text:p.t("game.levels.level3Description"),duration:5e3}),this.running=!0,this.gameLoop()}triggerLevel3Victory(){console.log("üéä 777 points de sagesse atteints ! Porte du paradis appara√Æt!"),this.heavenGate&&(this.heavenGate.visible=!0,this.heavenGate.x=this.canvas.width/2-this.heavenGate.width/2,this.heavenGate.y=100),this.notificationSystem&&this.notificationSystem.showNarrative({text:"üö™ La Porte du Paradis s'ouvre ! Tu as atteint 777 points de sagesse !",duration:4e3}),setTimeout(()=>{this.startLevel3EnterHeaven()},2e3)}startLevel3EnterHeaven(){console.log("‚ú® Le mouton entre au paradis..."),this.level3Entering=!0,this.level3EnterTimer=0}fireBulletAtLeviathan(){if(!this.leviathan||!this.leviathan.isActive||this.leviathan.defeated)return;const t={x:this.player.x+40,y:this.player.y,width:20,height:20,velX:6,velY:0,icon:"‚ö°",damage:1};this.level3Projectiles.push(t),this.audioManager&&this.audioManager.initialized&&this.audioManager.playPocSound(),setTimeout(()=>{const e=t.x-(this.leviathan.x+this.leviathan.width/2),i=t.y-(this.leviathan.y+this.leviathan.height/2);if(Math.sqrt(e*e+i*i)<100){const e=this.leviathan.takeDamage(t.damage);t.hit=!0,this.renderer.addParticle(this.leviathan.x+this.leviathan.width/2,this.leviathan.y+this.leviathan.height/2,"üí•","#FFD700"),e&&(this.leviathanDefeated=!0,this.notificationSystem&&this.notificationSystem.showNarrative({text:"üêâ L√âVIATHAN VAINCU ! Collecte la sagesse pour ouvrir le paradis !",duration:4e3}),this.audioManager&&this.audioManager.initialized&&this.audioManager.playCollectSound())}},100)}showLevel3Victory(){if(console.log("üéä Niveau 3 Termin√©! Sagesse compl√®te!"),this.running=!1,this.level3Active=!1,this.stopAutoSave(),this.trophySystem&&(this.trophySystem.unlockTrophy("white_sheep"),console.log("üêë‚ú® Troph√©e final d√©bloqu√© : Mouton blanc - La Gr√¢ce")),"adventure"===this.mode){this.saveCurrentScore();const t=new rt,e=this.obstacleManager?this.obstacleManager.totalXP:0,i=this.score+e,s=t.addAdventureScore(i);console.log("üíæ Cumul aventure:",i,"| Nouveau total:",s)}const t=this.obstacleManager?this.obstacleManager.totalXP:0,e=this.score+t,i=document.createElement("div");i.style.cssText="\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background: linear-gradient(135deg, rgba(10,14,39,0.95), rgba(26,58,82,0.95));\n            padding: 25px 40px;\n            border-radius: 20px;\n            border: 3px solid #FFD700;\n            box-shadow: 0 0 50px rgba(255,215,0,0.6), 0 10px 40px rgba(0,0,0,0.8);\n            z-index: 10000;\n            font-family: 'Press Start 2P', monospace;\n            text-align: center;\n            max-width: 800px;\n            max-height: 70vh;\n            overflow-y: auto;\n            animation: popupAppear 0.5s ease-out;\n        ";const s=document.createElement("style");s.textContent="\n            @keyframes popupAppear {\n                from {\n                    transform: translate(-50%, -50%) scale(0.5);\n                    opacity: 0;\n                }\n                to {\n                    transform: translate(-50%, -50%) scale(1);\n                    opacity: 1;\n                }\n            }\n        ",document.head.appendChild(s);const l=document.createElement("div");l.innerHTML=`\n            <div style="color: #FFD700; font-size: 28px; margin-bottom: 20px; text-shadow: 0 0 30px #FFD700;">\n                ${p.t("game.messages.finalVictory.title")}\n            </div>\n            <div style="display: flex; align-items: center; justify-content: space-around; gap: 30px;">\n                <div style="flex: 1; color: white; font-size: 10px; line-height: 2; text-align: left;">\n                    ${p.t("game.messages.finalVictory.grace")}<br><br>\n                    <span style="color: #FFD700;">\n                        ${p.t("game.messages.finalVictory.keepLight")}<br>\n                        ${p.t("game.messages.finalVictory.keepHeart")}\n                    </span><br><br>\n                    <span style="color: #4A90A4; font-size: 14px; text-shadow: 0 0 10px #4A90A4;">\n                        ${p.t("game.messages.finalVictory.chooseLife")}\n                    </span>\n                </div>\n                <div style="padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; min-width: 180px;">\n                    <div style="color: #FFD700; font-size: 12px;">SCORE TOTAL</div>\n                    <div style="color: #00FF00; font-size: 24px; margin-top: 10px;">${e.toLocaleString("fr-FR")}</div>\n                    <div style="color: #888; font-size: 8px; margin-top: 5px;">(${this.score} + ${t} XP)</div>\n                    <div style="color: white; font-size: 11px; margin-top: 10px;">\n                        ‚ù§Ô∏è ${this.player.lives}/${this.player.maxLives} vies\n                    </div>\n                    <div style="margin-top: 15px; font-size: 20px;">\n                        üêë ‚ú® üåô\n                    </div>\n                </div>\n            </div>\n            <button id="return-menu" style="\n                margin-top: 25px;\n                font-family: 'Press Start 2P', monospace;\n                font-size: 11px;\n                padding: 10px 20px;\n                background: #4A90A4;\n                color: white;\n                border: 2px solid #6AB0C4;\n                cursor: pointer;\n                border-radius: 5px;\n                box-shadow: 0 5px 15px rgba(74,144,164,0.5);\n                transition: all 0.3s;\n            " onmouseover="this.style.background='#6AB0C4'" onmouseout="this.style.background='#4A90A4'">\n                ${p.t("game.gameOver.returnMenu")}\n            </button>\n        `,i.appendChild(l),document.body.appendChild(i),document.getElementById("return-menu").onclick=()=>{document.querySelectorAll('[style*="position: fixed"], [style*="position:fixed"]').forEach(t=>t.style.display="none"),setTimeout(()=>{location.reload()},50)}}victory(){console.log("‚ú® VICTOIRE! Tous les boss √©limin√©s!"),this.notificationSystem&&this.notificationSystem.showNarrative({text:p.t("game.levels.level2Title"),duration:3e3}),setTimeout(()=>{this.trophySystem&&(this.trophySystem.unlockTrophy("gold_coin"),console.log("üí∞ Troph√©e Pi√®ce d'or d√©bloqu√©!")),this.saveCurrentScore(),console.log("üíæ Score sauvegard√© √† la fin du niveau 1"),this.startLevel2()},3e3)}startLevel2(){console.log("üî• NIVEAU 2: Les 7 P√©ch√©s Capitaux commence!"),this.audioManager&&this.audioManager.initialized?(console.log("üéµ Tentative de d√©marrage de la musique niveau 2"),this.audioManager.startBackgroundMusic()):console.warn("‚ö†Ô∏è AudioManager non initialis√© au d√©marrage du niveau 2"),this.currentLevel=2,this.level2Active=!0,this.level2Timer=0,this.level2Survived=0,this.currentLevel=2,localStorage.setItem("xsheep_currentLevel","2"),this.obstacleManager.obstacles=[],this.obstacleManager.weapons=[],this.obstacleManager.bossLine=[],this.obstacleManager.projectiles=[],this.powerUpManager&&(this.powerUpManager.powerUps=[]),this.waterTankSystem&&(this.waterTankSystem.tanks=[]),this.renderer&&(this.renderer.particles=[],this.renderer.particleSystem&&(this.renderer.particleSystem.particles=[])),this.notificationSystem&&this.notificationSystem.clearAll(),this.notificationSystem&&this.notificationSystem.showNarrative({text:p.t("game.levels.level2Description"),duration:3e3})}showAdventureGameOver(){const t=this.obstacleManager?this.obstacleManager.totalXP:0,e=this.score+t;this.saveCurrentScore();const i=(new rt).addAdventureScore(e);console.log("üíæ Cumul aventure:",e,"| Nouveau total:",i);const s=document.createElement("div");s.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.85);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            z-index: 1000;\n            color: white;\n            font-family: Arial, sans-serif;\n        ",s.innerHTML=`\n            <h1 style="font-size: 48px; margin: 20px; color: #ff6b6b;">${p.t("game.gameOver.title")}</h1>\n            <p style="font-size: 24px; margin: 10px;">${p.t("game.gameOver.rebirth")}</p>\n            <p style="font-size: 28px; margin: 15px; color: #00FF00; font-weight: bold;">\n                ${p.t("game.gameOver.totalScore")}: ${e.toLocaleString("en"===p.currentLang?"en-US":"fr-FR")}\n            </p>\n            <p style="font-size: 16px; margin: 5px; color: #888;">\n                (${p.t("game.gameOver.score")}: ${this.score.toLocaleString("en"===p.currentLang?"en-US":"fr-FR")} + ${p.t("game.gameOver.xp")}: ${t.toLocaleString("en"===p.currentLang?"en-US":"fr-FR")})\n            </p>\n            <p style="font-size: 20px; margin: 10px;">${p.t("game.gameOver.obstaclesAvoided")}: ${this.obstaclesCleared}</p>\n            <button id="retry-btn" style="\n                margin-top: 30px;\n                padding: 15px 40px;\n                font-size: 24px;\n                background: #4CAF50;\n                color: white;\n                border: none;\n                border-radius: 10px;\n                cursor: pointer;\n                transition: all 0.3s;\n            ">${p.t("game.gameOver.retry")}</button>\n            <button id="menu-btn" style="\n                margin-top: 15px;\n                padding: 12px 30px;\n                font-size: 20px;\n                background: #666;\n                color: white;\n                border: none;\n                border-radius: 10px;\n                cursor: pointer;\n                transition: all 0.3s;\n            ">${p.t("game.gameOver.mainMenu")}</button>\n        `,document.body.appendChild(s),document.getElementById("retry-btn").addEventListener("click",()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),document.body.removeChild(s),this.restart(1)}),document.getElementById("menu-btn").addEventListener("click",()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound();document.querySelectorAll('[style*="position: fixed"], [style*="position:fixed"]').forEach(t=>t.style.display="none"),document.body.removeChild(s),setTimeout(()=>{window.location.href="index.html"},50)})}restart(){const t=this.currentLevel;console.log(`üîÑ Red√©marrage au niveau ${t}`),this.stopAutoSave(),this.running=!1,this.level2Active=!1,this.level3Active=!1,this.gameOverAnimation=!1,this.victoryAnimation=!1,this.boatMode=!1,this.player.x=200,this.player.y=this.canvas.height/2,this.player.velX=0,this.player.velY=0,this.player.lives=this.player.maxLives,this.player.fuel=100,this.player.bonusFuel=0,this.player.invincible=!1,this.player.flying=!1,this.player.parachuting=!1,this.player.rotation=0,this.player.rotationSpeed=0,this.obstacleManager&&(this.obstacleManager.obstacles=[],this.obstacleManager.weapons=[],this.obstacleManager.bossLine=[],this.obstacleManager.projectiles=[]),this.level3Proverbs=[],this.level3Obstacles=[],this.level3Projectiles=[],this.leviathan=null,this.leviathanDefeated=!1,1===t?(this.running=!0,this.gameLoop()):2===t?this.startLevel2():3===t&&this.startLevel3()}restart(t=1){console.log(`üîÑ Red√©marrage au niveau ${t}`),this.running=!1,this.level2Active=!1,this.level3Active=!1,this.gameOverAnimation=!1,this.victoryAnimation=!1,this.boatMode=!1,this.player.x=200,this.player.y=this.canvas.height/2,this.player.velX=0,this.player.velY=0,this.player.lives=this.player.maxLives,this.player.fuel=100,this.player.bonusFuel=0,this.player.invincible=!1,this.player.flying=!1,this.player.parachuting=!1,this.player.rotation=0,this.player.rotationSpeed=0,this.player.whirlpoolScale=1,this.player.tangageTimer=0,this.player.tentacleGrab=!1,this.obstacleManager&&(this.obstacleManager.obstacles=[],this.obstacleManager.weapons=[],this.obstacleManager.bossLine=[],this.obstacleManager.projectiles=[]),this.level3Proverbs=[],this.level3Obstacles=[],this.level3Projectiles=[],this.leviathan=null,this.leviathanDefeated=!1,this.level3Wisdom=0,this.level3FirstProverbSpawned=!1,this.heavenGate&&(this.heavenGate.visible=!1),1===t?(this.currentLevel=1,localStorage.setItem("xsheep_currentLevel","1"),this.running=!0,this.gameLoop()):2===t?this.startLevel2():3===t&&this.startLevel3()}showVictoryScreen(){this.victoryScreenActive=!0,this.victoryScreenData={score:this.score,obstaclesCleared:this.obstaclesCleared},this.paused=!0,this.victoryButtons={continue:{x:this.canvas.width/2-100,y:this.canvas.height-120,width:200,height:40,text:p.t("game.buttons.continue")},menu:{x:this.canvas.width/2-100,y:this.canvas.height-70,width:200,height:40,text:p.t("game.buttons.menu")}},this.victoryClickHandler=this.handleVictoryClick.bind(this),this.canvas.addEventListener("click",this.victoryClickHandler)}handleVictoryClick(t){if(!this.victoryScreenActive||!this.victoryButtons)return;const e=this.canvas.getBoundingClientRect(),i=this.canvas.width/e.width,s=this.canvas.height/e.height,l=(t.clientX-e.left)*i,a=(t.clientY-e.top)*s,o=this.victoryButtons.continue;if(l>=o.x&&l<=o.x+o.width&&a>=o.y&&a<=o.y+o.height)return this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),this.canvas.removeEventListener("click",this.victoryClickHandler),this.victoryScreenActive=!1,this.notificationSystem&&this.notificationSystem.showNarrative({text:p.t("game.messages.finalVictory.continue"),duration:5e3}),void setTimeout(()=>{window.location.reload()},5e3);const n=this.victoryButtons.menu;l>=n.x&&l<=n.x+n.width&&a>=n.y&&a<=n.y+n.height&&(this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),this.canvas.removeEventListener("click",this.victoryClickHandler),window.location.href="index.html")}renderVictoryScreen(t){if(!this.victoryScreenActive)return;const e=.001*Date.now(),i=t.createLinearGradient(0,0,0,this.canvas.height);i.addColorStop(0,"#667eea"),i.addColorStop(.5,"#764ba2"),i.addColorStop(1,"#667eea"),t.fillStyle=i,t.fillRect(0,0,this.canvas.width,this.canvas.height);for(let p=0;p<20;p++){const i=(73*p+20*e)%this.canvas.width,s=97*p%this.canvas.height,l=.3+.3*Math.sin(2*e+p);t.fillStyle=`rgba(255, 255, 255, ${l})`,t.font="20px Arial",t.fillText("‚≠ê",i,s)}const s=150*e%(this.canvas.width+500)-200,l=s-180;t.font="30px Arial",t.fillText("üíÄ",l,60);const a=s-120;t.font="28px Arial",t.fillText("üåÄ",a,55);const o=s-70;t.font="32px Arial",t.fillText("üò°",o,60),t.save();this.renderer.sheepAnimator.draw(t,s-18,40,.8,0,"normal",!1,0),t.font="24px Arial",t.fillText("üí®",s-45,60),t.restore();const n=this.canvas.height-60,r=180*e,h=this.canvas.width+200-r%(this.canvas.width+500),c=h+90;t.font="38px Arial",t.fillText("ü§ñ",c,n),t.save(),t.translate(h,0),t.scale(-1,1),t.translate(-h,0),this.renderer.sheepAnimator.draw(t,h-18,n-20,.8,0,"normal",!1,0),t.scale(-1,1),t.fillStyle="#000",t.font="24px Arial",t.fillText("üí®",-h-50,n),t.restore();const d=8*Math.sin(3*e);t.fillStyle="#00FFFF",t.strokeStyle="#FF00FF",t.lineWidth=3,t.font="bold 52px Impact, Arial Black, Arial",t.textAlign="center",t.shadowColor="#00FFFF",t.shadowBlur=8,t.shadowOffsetX=0,t.shadowOffsetY=0,t.strokeText(p.t("game.victory.impatience"),this.canvas.width/2,130+d),t.fillText(p.t("game.victory.impatience"),this.canvas.width/2,130+d),t.shadowBlur=0,t.fillStyle="#FFD700",t.strokeStyle="#FF8C00",t.lineWidth=2,t.font="bold 24px Impact, Arial Black, Arial",t.shadowColor="#FFD700",t.shadowBlur=5,t.strokeText("‚öîÔ∏è BOSS ANNIHIL√âS ‚öîÔ∏è",this.canvas.width/2,175),t.fillText("‚öîÔ∏è BOSS ANNIHIL√âS ‚öîÔ∏è",this.canvas.width/2,175),t.fillStyle="#FFF",t.font="bold 20px Impact, Arial Black, Arial",t.shadowBlur=4,t.fillText("üëë L√âGENDE CONFIRM√âE üëë",this.canvas.width/2,205),t.shadowBlur=3,t.font="bold 18px Impact, Arial Black, Arial",t.fillStyle="#FFD700",t.shadowColor="#FFD700",t.fillText(p.t("game.victory.victoriousCombat"),this.canvas.width/2,240),t.fillText(p.t("game.victory.perseverance"),this.canvas.width/2,265),t.shadowBlur=2,t.font="bold 14px Arial",t.fillStyle="#87CEEB",t.shadowColor="#87CEEB",t.fillText(p.t("game.victory.lifeLesson1"),this.canvas.width/2,290),t.fillText(p.t("game.victory.lifeLesson2"),this.canvas.width/2,308),t.fillText(p.t("game.victory.lifeLesson3"),this.canvas.width/2,326),t.shadowBlur=5,t.font="bold 22px Impact, Arial Black, Arial",t.fillStyle="#00FF00",t.strokeStyle="#008800",t.lineWidth=2,t.shadowColor="#00FF00";const u=`${p.t("game.victory.scoreLabel")}: ${this.victoryScreenData.score.toLocaleString("fr-FR")}`;t.strokeText(u,this.canvas.width/2,350),t.fillText(u,this.canvas.width/2,350),t.font="bold 18px Impact, Arial Black, Arial",t.fillStyle="#FFF",t.shadowBlur=3,t.shadowColor="#FFF",t.fillText(`${p.t("game.victory.obstaclesDestroyed")}: ${this.victoryScreenData.obstaclesCleared}`,this.canvas.width/2,340);const f=this.victoryButtons.continue,g=1+.1*Math.sin(4*e);t.shadowColor="#00FFFF",t.shadowBlur=8*g;const m=t.createLinearGradient(f.x,f.y,f.x+f.width,f.y);m.addColorStop(0,"#00FFFF"),m.addColorStop(.5,"#0088FF"),m.addColorStop(1,"#00FFFF"),t.fillStyle=m,t.fillRect(f.x,f.y,f.width,f.height),t.strokeStyle="#00FFFF",t.lineWidth=3,t.strokeRect(f.x,f.y,f.width,f.height),t.fillStyle="#000",t.shadowBlur=0,t.font="bold 22px Impact, Arial Black, Arial",t.fillText(p.t("game.victory.continue"),f.x+f.width/2,f.y+f.height/2+8);const x=this.victoryButtons.menu;t.shadowColor="#FF00FF",t.shadowBlur=5,t.fillStyle="rgba(255, 0, 255, 0.3)",t.fillRect(x.x,x.y,x.width,x.height),t.strokeStyle="#FF00FF",t.lineWidth=2,t.strokeRect(x.x,x.y,x.width,x.height),t.fillStyle="#FFF",t.shadowBlur=3,t.shadowColor="#FFF",t.font="bold 18px Impact, Arial Black, Arial",t.fillText(p.t("game.victory.menu"),x.x+x.width/2,x.y+x.height/2+7),t.shadowBlur=0}restartEndlessMode(){console.log("üîÑ Red√©marrage automatique du mode infini..."),this.gameOverAnimation=!1,this.gameOverTimer=0,this.gameOverPhase="flying",this.rejectionBubble=null,this.heavenGate&&(this.heavenGate.visible=!1),this.player.lives=this.player.maxLives,this.player.x=l.START_X,this.player.y=s/2,this.player.velX=0,this.player.velY=0,this.player.flying=!0,this.player.fuel=this.player.maxFuel,this.player.size=1,this.player.rotation=0,this.player.invincible=!0,this.player.invincibleTimer=120,this.player.exclamationMark=!0,this.player.exclamationTimer=120,this.endlessMode&&(this.endlessMode.active=!0,this.endlessMode.distance=0,this.endlessMode.obstacles=[],this.endlessMode.fuels=[],this.endlessMode.spawnTimer=0,this.endlessMode.fuelTimer=0,this.endlessMode.waveLevel=1,this.endlessMode.resetBoss()),this.running=!0,this.renderer.addParticle(i/2,s/2,"üêë JAMAIS ABANDONNER ! üêë","#FFD700"),console.log("‚ú® Mode infini red√©marr√© avec succ√®s!")}}class ft{constructor(){this.canvas=document.getElementById("molecular-canvas"),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="molecular-canvas",this.canvas.style.cssText="\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 0;\n                pointer-events: none;\n            ",document.body.prepend(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.particles=[],this.particleCount=50,this.resize(),this.init(),this.animate(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}init(){this.particles=[];for(let t=0;t<this.particleCount;t++)this.particles.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,vx:.5*(Math.random()-.5),vy:.5*(Math.random()-.5),radius:2*Math.random()+1})}update(){this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,(t.x<0||t.x>this.canvas.width)&&(t.vx*=-1),(t.y<0||t.y>this.canvas.height)&&(t.vy*=-1)})}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="rgba(255, 215, 0, 0.15)",this.ctx.lineWidth=1;for(let t=0;t<this.particles.length;t++)for(let e=t+1;e<this.particles.length;e++){const i=this.particles[t].x-this.particles[e].x,s=this.particles[t].y-this.particles[e].y,l=Math.sqrt(i*i+s*s);if(l<150){const i=(150-l)/150;this.ctx.strokeStyle=`rgba(255, 215, 0, ${.2*i})`,this.ctx.beginPath(),this.ctx.moveTo(this.particles[t].x,this.particles[t].y),this.ctx.lineTo(this.particles[e].x,this.particles[e].y),this.ctx.stroke()}}this.particles.forEach(t=>{this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fill();const e=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,3*t.radius);e.addColorStop(0,"rgba(255, 215, 0, 0.3)"),e.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,3*t.radius,0,2*Math.PI),this.ctx.fill()})}animate(){this.update(),this.draw(),requestAnimationFrame(()=>this.animate())}}class gt{constructor(){this.container=null,this.isOpen=!1,this.createUI()}createUI(){this.button=document.createElement("div"),this.button.id="lang-selector-btn",this.button.style.cssText="\n            cursor: pointer;\n            text-align: center;\n            background: rgba(0, 0, 0, 0.7);\n            padding: 10px;\n            border-radius: 10px;\n            border: 2px solid #FFD700;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 30px;\n            transition: all 0.3s;\n        ";const t=p.getAvailableLanguages().find(t=>t.code===p.currentLang);this.button.textContent=(null==t?void 0:t.flag)||"üåç",this.button.title=p.t("menu.controls.language.change"),this.button.addEventListener("click",()=>this.toggle());const e=document.getElementById("controls-group");e?e.appendChild(this.button):document.body.appendChild(this.button),this.panel=document.createElement("div"),this.panel.id="lang-selector-panel",this.panel.style.cssText="\n            position: fixed;\n            top: 140px;\n            right: 20px;\n            background: rgba(255, 255, 255, 0.95);\n            border: 3px solid #FFD700;\n            border-radius: 15px;\n            padding: 15px;\n            display: none;\n            max-height: 70vh;\n            overflow-y: auto;\n            z-index: 101;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\n            width: 250px;\n        ";const i=document.createElement("div");i.style.cssText="\n            font-size: 16px;\n            font-weight: bold;\n            margin-bottom: 15px;\n            text-align: center;\n            color: #333;\n            border-bottom: 2px solid #FFD700;\n            padding-bottom: 10px;\n        ",i.textContent=p.t("menu.controls.language.panelTitle"),this.panel.appendChild(i);const s=p.getAvailableLanguages(),l=s.filter(t=>"ltr"===t.dir),a=s.filter(t=>"rtl"===t.dir),o=this.createLanguageSection(p.t("menu.controls.language.ltrSection"),l);if(this.panel.appendChild(o),a.length>0){const t=this.createLanguageSection(p.t("menu.controls.language.rtlSection"),a);this.panel.appendChild(t)}document.body.appendChild(this.panel),document.addEventListener("click",t=>{!this.isOpen||this.panel.contains(t.target)||this.button.contains(t.target)||this.close()})}createLanguageSection(t,e){const i=document.createElement("div");i.style.cssText="\n            margin-bottom: 15px;\n        ";const s=document.createElement("div");return s.style.cssText="\n            font-size: 12px;\n            color: #888;\n            margin-bottom: 8px;\n            font-weight: bold;\n        ",s.textContent=t,i.appendChild(s),e.forEach(t=>{const e=document.createElement("div");e.style.cssText=`\n                padding: 10px;\n                margin: 5px 0;\n                border-radius: 8px;\n                cursor: pointer;\n                transition: all 0.2s;\n                background: ${t.code===p.currentLang?"#FFD700":"rgba(240, 240, 240, 0.8)"};\n                border: 2px solid ${t.code===p.currentLang?"#DAA520":"transparent"};\n                display: flex;\n                align-items: center;\n                gap: 10px;\n            `;const s=document.createElement("span");s.style.fontSize="24px",s.textContent=t.flag;const l=document.createElement("span");if(l.style.cssText=`\n                flex: 1;\n                font-size: 14px;\n                font-weight: ${t.code===p.currentLang?"bold":"normal"};\n                color: #333;\n            `,l.textContent=t.name,t.code===p.currentLang){const t=document.createElement("span");t.textContent="‚úì",t.style.cssText="\n                    color: #333;\n                    font-weight: bold;\n                    font-size: 18px;\n                ",e.appendChild(t)}e.appendChild(s),e.appendChild(l),e.addEventListener("mouseenter",()=>{t.code!==p.currentLang&&(e.style.background="rgba(255, 215, 0, 0.3)",e.style.transform="scale(1.05)")}),e.addEventListener("mouseleave",()=>{t.code!==p.currentLang&&(e.style.background="rgba(240, 240, 240, 0.8)",e.style.transform="scale(1)")}),e.addEventListener("click",async()=>{await this.selectLanguage(t.code)}),i.appendChild(e)}),i}async selectLanguage(t){if(t===p.currentLang)return void this.close();console.log(`üåç Changement de langue: ${t}`),await p.changeLanguage(t);const e=p.getAvailableLanguages().find(e=>e.code===t);this.button.textContent=(null==e?void 0:e.flag)||"üåç",window.location.reload()}toggle(){this.isOpen?this.close():this.open()}open(){this.panel.style.display="block",this.isOpen=!0}close(){this.panel.style.display="none",this.isOpen=!1}hide(){this.button&&(this.button.style.display="none"),this.panel&&(this.panel.style.display="none")}show(){this.button&&(this.button.style.display="flex")}destroy(){this.button&&this.button.remove(),this.panel&&this.panel.remove()}}class mt{constructor(){this.menu=null,this.game=null,this.molecularBg=null,this.trophySystem=null,this.audioManager=null,this.languageSelector=null,this.i18n=p,this.init()}async init(){console.log("üêë Mouton Courage - Initialisation..."),await p.init(),console.log(`üåç Langue active: ${p.currentLang}`),this.languageSelector=new gt,this.applyTranslations(),this.molecularBg=new ft,this.trophySystem=new I,this.audioManager=new nt,document.addEventListener("click",()=>{this.audioManager.initialized||this.audioManager.init()},{once:!0}),this.menu=new f({onModeSelected:t=>this.startGame(t),onShow:()=>{this.refreshScores(),this.languageSelector&&this.languageSelector.show()},audioManager:this.audioManager}),window.openTrophyMenu=()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTokeSound(),this.trophySystem.show()},setTimeout(()=>{const t=document.querySelector(".author-signature");t&&t.addEventListener("mouseenter",()=>{this.audioManager&&this.audioManager.initialized&&this.audioManager.playTooksSound()})},100),this.displayMaxScore(),setTimeout(()=>{this.displayMaxScore(),console.log("üîÑ Rafra√Æchissement additionnel des scores")},100),document.addEventListener("visibilitychange",()=>{document.hidden||(console.log("üëÅÔ∏è Page visible, rafra√Æchissement des scores"),this.displayMaxScore())}),console.log("‚úÖ Application pr√™te !")}applyTranslations(){const t=t=>p.t(t),e=document.querySelector(".logo-subtitle");e&&(e.textContent=t("menu.subtitle"));const i=document.querySelector(".menu-header");if(i){i.querySelector(".author-signature")&&(i.innerHTML=`${t("menu.createdBy")} <a href="https://www.emmanuelpayet.art/" target="_blank" rel="noopener noreferrer" class="author-signature">${t("menu.author")}</a>`)}const s=document.querySelector('[data-mode="adventure"] .mode-title');s&&(s.textContent=t("menu.modes.adventure.title"));const l=document.querySelector('[data-mode="adventure"] .mode-description');if(l){const e=t("menu.modes.adventure.description");l.innerHTML=e.join("<br>")}const a=document.querySelectorAll('[data-mode="adventure"] .stat-label');a.length>=3&&(a[0].textContent=t("menu.modes.adventure.stats.chapters"),a[1].textContent=t("menu.modes.adventure.stats.minutes"),a[2].textContent=t("menu.modes.adventure.stats.hope"));const o=document.querySelector('[data-mode="endless"] .mode-title');o&&(o.textContent=t("menu.modes.endless.title"));const n=document.querySelector('[data-mode="endless"] .mode-description');if(n){const e=t("menu.modes.endless.description");n.innerHTML=e.join("<br>")}const r=document.querySelectorAll('[data-mode="endless"] .stat-label');r.length>=3&&(r[0].textContent=t("menu.modes.endless.stats.waves"),r[1].textContent=t("menu.modes.endless.stats.duration"),r[2].textContent=t("menu.modes.endless.stats.record"));const h=localStorage.getItem("xsheep_renderMode")||"pixel";window.updateRenderIcon&&window.updateRenderIcon(h),console.log("üìù Traductions appliqu√©es au menu")}displayMaxScore(){const t=localStorage.getItem("xsheep_maxScore")||"0",e=document.getElementById("display-max-score");e&&(e.textContent=parseInt(t).toLocaleString("fr-FR"),console.log("üìä Score Infini affich√©:",t));const i=localStorage.getItem("xsheep_adventureScore")||"0",s=document.getElementById("adventure-total-score");s&&(s.textContent=parseInt(i).toLocaleString("fr-FR"),console.log("üìä Score Aventure affich√©:",i))}startGame(t){console.log(`üéÆ D√©marrage mode: ${t}`),this.menu.hide(),this.languageSelector&&this.languageSelector.hide(),this.game=new ut(t,this.trophySystem,this.audioManager),this.audioManager&&!this.audioManager.initialized&&this.audioManager.init(),this.game.start()}refreshScores(){this.displayMaxScore(),console.log("üîÑ Scores rafra√Æchis")}}document.addEventListener("DOMContentLoaded",()=>{window.app=new mt});
